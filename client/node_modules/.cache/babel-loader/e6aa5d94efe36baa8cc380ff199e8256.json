{"ast":null,"code":"/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport component from '../modules/component';\nimport resizing from '../modules/resizing';\nimport fileManager from '../modules/fileManager';\nexport default {\n  name: 'video',\n  display: 'dialog',\n  add: function add(core) {\n    core.addModule([dialog, component, resizing, fileManager]);\n    var options = core.options;\n    var context = core.context;\n    var contextVideo = context.video = {\n      _infoList: [],\n      // @Override fileManager\n      _infoIndex: 0,\n      // @Override fileManager\n      _uploadFileLength: 0,\n      // @Override fileManager\n      focusElement: null,\n      // @Override dialog // This element has focus when the dialog is opened.\n      sizeUnit: options._videoSizeUnit,\n      _align: 'none',\n      _floatClassRegExp: '__se__float\\\\-[a-z]+',\n      _youtubeQuery: options.youtubeQuery,\n      _videoRatio: options.videoRatio * 100 + '%',\n      _defaultRatio: options.videoRatio * 100 + '%',\n      _linkValue: '',\n      // @require @Override component\n      _element: null,\n      _cover: null,\n      _container: null,\n      // @Override resizing properties\n      inputX: null,\n      inputY: null,\n      _element_w: 1,\n      _element_h: 1,\n      _element_l: 0,\n      _element_t: 0,\n      _defaultSizeX: '100%',\n      _defaultSizeY: options.videoRatio * 100 + '%',\n      _origin_w: options.videoWidth === '100%' ? '' : options.videoWidth,\n      _origin_h: options.videoHeight === '56.25%' ? '' : options.videoHeight,\n      _proportionChecked: true,\n      _resizing: options.videoResizing,\n      _resizeDotHide: !options.videoHeightShow,\n      _rotation: options.videoRotation,\n      _alignHide: !options.videoAlignShow,\n      _onlyPercentage: options.videoSizeOnlyPercentage,\n      _ratio: false,\n      _ratioX: 1,\n      _ratioY: 1,\n      _captionShow: false\n    };\n    /** video dialog */\n\n    var video_dialog = this.setDialog(core);\n    contextVideo.modal = video_dialog;\n    contextVideo.videoInputFile = video_dialog.querySelector('._se_video_file');\n    contextVideo.videoUrlFile = video_dialog.querySelector('.se-input-url');\n    contextVideo.focusElement = contextVideo.videoUrlFile || contextVideo.videoInputFile;\n    contextVideo.preview = video_dialog.querySelector('.se-link-preview');\n    /** add event listeners */\n\n    video_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n    if (contextVideo.videoInputFile) video_dialog.querySelector('.se-dialog-files-edge-button').addEventListener('click', this._removeSelectedFiles.bind(contextVideo.videoInputFile, contextVideo.videoUrlFile, contextVideo.preview));\n    if (contextVideo.videoInputFile && contextVideo.videoUrlFile) contextVideo.videoInputFile.addEventListener('change', this._fileInputChange.bind(contextVideo));\n    if (contextVideo.videoUrlFile) contextVideo.videoUrlFile.addEventListener('input', this._onLinkPreview.bind(contextVideo.preview, contextVideo, options.linkProtocol));\n    contextVideo.proportion = {};\n    contextVideo.videoRatioOption = {};\n    contextVideo.inputX = {};\n    contextVideo.inputY = {};\n\n    if (options.videoResizing) {\n      contextVideo.proportion = video_dialog.querySelector('._se_video_check_proportion');\n      contextVideo.videoRatioOption = video_dialog.querySelector('.se-video-ratio');\n      contextVideo.inputX = video_dialog.querySelector('._se_video_size_x');\n      contextVideo.inputY = video_dialog.querySelector('._se_video_size_y');\n      contextVideo.inputX.value = options.videoWidth;\n      contextVideo.inputY.value = options.videoHeight;\n      contextVideo.inputX.addEventListener('keyup', this.setInputSize.bind(core, 'x'));\n      contextVideo.inputY.addEventListener('keyup', this.setInputSize.bind(core, 'y'));\n      contextVideo.inputX.addEventListener('change', this.setRatio.bind(core));\n      contextVideo.inputY.addEventListener('change', this.setRatio.bind(core));\n      contextVideo.proportion.addEventListener('change', this.setRatio.bind(core));\n      contextVideo.videoRatioOption.addEventListener('change', this.setVideoRatio.bind(core));\n      video_dialog.querySelector('.se-dialog-btn-revert').addEventListener('click', this.sizeRevert.bind(core));\n    }\n    /** append html */\n\n\n    context.dialog.modal.appendChild(video_dialog);\n    /** empty memory */\n\n    video_dialog = null;\n  },\n\n  /** dialog */\n  setDialog: function setDialog(core) {\n    var option = core.options;\n    var lang = core.lang;\n    var dialog = core.util.createElement('DIV');\n    dialog.className = 'se-dialog-content';\n    dialog.style.display = 'none';\n    var html = '' + '<form method=\"post\" enctype=\"multipart/form-data\">' + '<div class=\"se-dialog-header\">' + '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" title=\"' + lang.dialogBox.close + '\" aria-label=\"' + lang.dialogBox.close + '\">' + core.icons.cancel + '</button>' + '<span class=\"se-modal-title\">' + lang.dialogBox.videoBox.title + '</span>' + '</div>' + '<div class=\"se-dialog-body\">';\n\n    if (option.videoFileInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.videoBox.file + '</label>' + '<div class=\"se-dialog-form-files\">' + '<input class=\"se-input-form _se_video_file\" type=\"file\" accept=\"' + option.videoAccept + '\"' + (option.videoMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' + '<button type=\"button\" data-command=\"filesRemove\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\" aria-label=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' + '</div>' + '</div>';\n    }\n\n    if (option.videoUrlInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.videoBox.url + '</label>' + '<input class=\"se-input-form se-input-url\" type=\"text\" />' + '<pre class=\"se-link-preview\"></pre>' + '</div>';\n    }\n\n    if (option.videoResizing) {\n      var ratioList = option.videoRatioList || [{\n        name: '16:9',\n        value: 0.5625\n      }, {\n        name: '4:3',\n        value: 0.75\n      }, {\n        name: '21:9',\n        value: 0.4285\n      }];\n      var ratio = option.videoRatio;\n      var onlyPercentage = option.videoSizeOnlyPercentage;\n      var onlyPercentDisplay = onlyPercentage ? ' style=\"display: none !important;\"' : '';\n      var heightDisplay = !option.videoHeightShow ? ' style=\"display: none !important;\"' : '';\n      var ratioDisplay = !option.videoRatioShow ? ' style=\"display: none !important;\"' : '';\n      var onlyWidthDisplay = !onlyPercentage && !option.videoHeightShow && !option.videoRatioShow ? ' style=\"display: none !important;\"' : '';\n      html += '' + '<div class=\"se-dialog-form\">' + '<div class=\"se-dialog-size-text\">' + '<label class=\"size-w\">' + lang.dialogBox.width + '</label>' + '<label class=\"se-dialog-size-x\">&nbsp;</label>' + '<label class=\"size-h\"' + heightDisplay + '>' + lang.dialogBox.height + '</label>' + '<label class=\"size-h\"' + ratioDisplay + '>(' + lang.dialogBox.ratio + ')</label>' + '</div>' + '<input class=\"se-input-control _se_video_size_x\" placeholder=\"100%\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + '/>' + '<label class=\"se-dialog-size-x\"' + onlyWidthDisplay + '>' + (onlyPercentage ? '%' : 'x') + '</label>' + '<input class=\"se-input-control _se_video_size_y\" placeholder=\"' + option.videoRatio * 100 + '%\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + heightDisplay + '/>' + '<select class=\"se-input-select se-video-ratio\" title=\"' + lang.dialogBox.ratio + '\" aria-label=\"' + lang.dialogBox.ratio + '\"' + ratioDisplay + '>';\n      if (!heightDisplay) html += '<option value=\"\"> - </option>';\n\n      for (var i = 0, len = ratioList.length; i < len; i++) {\n        html += '<option value=\"' + ratioList[i].value + '\"' + (ratio.toString() === ratioList[i].value.toString() ? ' selected' : '') + '>' + ratioList[i].name + '</option>';\n      }\n\n      html += '</select>' + '<button type=\"button\" title=\"' + lang.dialogBox.revertButton + '\" aria-label=\"' + lang.dialogBox.revertButton + '\" class=\"se-btn se-dialog-btn-revert\" style=\"float: right;\">' + core.icons.revert + '</button>' + '</div>' + '<div class=\"se-dialog-form se-dialog-form-footer\"' + onlyPercentDisplay + onlyWidthDisplay + '>' + '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_video_check_proportion\" checked/>&nbsp;' + lang.dialogBox.proportion + '</label>' + '</div>';\n    }\n\n    html += '' + '</div>' + '<div class=\"se-dialog-footer\">' + '<div' + (option.videoAlignShow ? '' : ' style=\"display: none\"') + '>' + '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"none\" checked>' + lang.dialogBox.basic + '</label>' + '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"left\">' + lang.dialogBox.left + '</label>' + '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"center\">' + lang.dialogBox.center + '</label>' + '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"right\">' + lang.dialogBox.right + '</label>' + '</div>' + '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\" aria-label=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' + '</div>' + '</form>';\n    dialog.innerHTML = html;\n    return dialog;\n  },\n  _fileInputChange: function _fileInputChange() {\n    if (!this.videoInputFile.value) {\n      this.videoUrlFile.removeAttribute('disabled');\n      this.preview.style.textDecoration = '';\n    } else {\n      this.videoUrlFile.setAttribute('disabled', true);\n      this.preview.style.textDecoration = 'line-through';\n    }\n  },\n  _removeSelectedFiles: function _removeSelectedFiles(urlInput, preview) {\n    this.value = '';\n\n    if (urlInput) {\n      urlInput.removeAttribute('disabled');\n      preview.style.textDecoration = '';\n    }\n  },\n  _onLinkPreview: function _onLinkPreview(context, protocol, e) {\n    var value = e.target.value.trim();\n\n    if (/^<iframe.*\\/iframe>$/.test(value)) {\n      context._linkValue = value;\n      this.textContent = '<IFrame :src=\"..\"></IFrame>';\n    } else {\n      context._linkValue = this.textContent = !value ? '' : protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0 ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n    }\n  },\n  _setTagAttrs: function _setTagAttrs(element) {\n    element.setAttribute('controls', true);\n    var attrs = this.options.videoTagAttrs;\n    if (!attrs) return;\n\n    for (var key in attrs) {\n      if (!this.util.hasOwn(attrs, key)) continue;\n      element.setAttribute(key, attrs[key]);\n    }\n  },\n  createVideoTag: function createVideoTag() {\n    var videoTag = this.util.createElement('VIDEO');\n\n    this.plugins.video._setTagAttrs.call(this, videoTag);\n\n    return videoTag;\n  },\n  _setIframeAttrs: function _setIframeAttrs(element) {\n    element.frameBorder = '0';\n    element.allowFullscreen = true;\n    var attrs = this.options.videoIframeAttrs;\n    if (!attrs) return;\n\n    for (var key in attrs) {\n      if (!this.util.hasOwn(attrs, key)) continue;\n      element.setAttribute(key, attrs[key]);\n    }\n  },\n  createIframeTag: function createIframeTag() {\n    var iframeTag = this.util.createElement('IFRAME');\n\n    this.plugins.video._setIframeAttrs.call(this, iframeTag);\n\n    return iframeTag;\n  },\n\n  /**\n   * @Override @Required fileManager\n   */\n  fileTags: ['iframe', 'video'],\n\n  /**\n   * @Override core, resizing, fileManager\n   * @description It is called from core.selectComponent.\n   * @param {Element} element Target element\n   */\n  select: function select(element) {\n    this.plugins.video.onModifyMode.call(this, element, this.plugins.resizing.call_controller_resize.call(this, element, 'video'));\n  },\n\n  /**\n   * @Override fileManager, resizing\n   */\n  destroy: function destroy(element) {\n    var frame = element || this.context.video._element;\n    var container = this.context.video._container;\n    var dataIndex = frame.getAttribute('data-index') * 1;\n    var focusEl = container.previousElementSibling || container.nextElementSibling;\n    var emptyDiv = container.parentNode;\n    this.util.removeItem(container);\n    this.plugins.video.init.call(this);\n    this.controllersOff();\n    if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) {\n      return current.childNodes.length === 0;\n    }, null); // focus\n\n    this.focusEdge(focusEl); // event\n\n    this.plugins.fileManager.deleteInfo.call(this, 'video', dataIndex, this.functions.onVideoUpload); // history stack\n\n    this.history.push(false);\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  on: function on(update) {\n    var contextVideo = this.context.video;\n\n    if (!update) {\n      contextVideo.inputX.value = contextVideo._origin_w = this.options.videoWidth === contextVideo._defaultSizeX ? '' : this.options.videoWidth;\n      contextVideo.inputY.value = contextVideo._origin_h = this.options.videoHeight === contextVideo._defaultSizeY ? '' : this.options.videoHeight;\n      contextVideo.proportion.disabled = true;\n      if (contextVideo.videoInputFile && this.options.videoMultipleFile) contextVideo.videoInputFile.setAttribute('multiple', 'multiple');\n    } else {\n      if (contextVideo.videoInputFile && this.options.videoMultipleFile) contextVideo.videoInputFile.removeAttribute('multiple');\n    }\n\n    if (contextVideo._resizing) {\n      this.plugins.video.setVideoRatioSelect.call(this, contextVideo._origin_h || contextVideo._defaultRatio);\n    }\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  open: function open() {\n    this.plugins.dialog.open.call(this, 'video', 'video' === this.currentControllerName);\n  },\n  setVideoRatio: function setVideoRatio(e) {\n    var contextVideo = this.context.video;\n    var value = e.target.options[e.target.selectedIndex].value;\n    contextVideo._defaultSizeY = contextVideo._videoRatio = !value ? contextVideo._defaultSizeY : value * 100 + '%';\n    contextVideo.inputY.placeholder = !value ? '' : value * 100 + '%';\n    contextVideo.inputY.value = '';\n  },\n\n  /**\n   * @Override resizing\n   * @param {String} xy 'x': width, 'y': height\n   * @param {KeyboardEvent} e Event object\n   */\n  setInputSize: function setInputSize(xy, e) {\n    if (e && e.keyCode === 32) {\n      e.preventDefault();\n      return;\n    }\n\n    var contextVideo = this.context.video;\n\n    this.plugins.resizing._module_setInputSize.call(this, contextVideo, xy);\n\n    if (xy === 'y') {\n      this.plugins.video.setVideoRatioSelect.call(this, e.target.value || contextVideo._defaultRatio);\n    }\n  },\n\n  /**\n   * @Override resizing\n   */\n  setRatio: function setRatio() {\n    this.plugins.resizing._module_setRatio.call(this, this.context.video);\n  },\n  submit: function submit(e) {\n    var contextVideo = this.context.video;\n    var videoPlugin = this.plugins.video;\n    e.preventDefault();\n    e.stopPropagation();\n    contextVideo._align = contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"]:checked').value;\n\n    try {\n      if (contextVideo.videoInputFile && contextVideo.videoInputFile.files.length > 0) {\n        this.showLoading();\n        videoPlugin.submitAction.call(this, this.context.video.videoInputFile.files);\n      } else if (contextVideo.videoUrlFile && contextVideo._linkValue.length > 0) {\n        this.showLoading();\n        videoPlugin.setup_url.call(this, contextVideo._linkValue);\n      }\n    } catch (error) {\n      this.closeLoading();\n      throw Error('[SUNEDITOR.video.submit.fail] cause : \"' + error.message + '\"');\n    } finally {\n      this.plugins.dialog.close.call(this);\n    }\n\n    return false;\n  },\n  submitAction: function submitAction(fileList) {\n    if (fileList.length === 0) return;\n    var fileSize = 0;\n    var files = [];\n\n    for (var i = 0, len = fileList.length; i < len; i++) {\n      if (/video/i.test(fileList[i].type)) {\n        files.push(fileList[i]);\n        fileSize += fileList[i].size;\n      }\n    }\n\n    var limitSize = this.options.videoUploadSizeLimit;\n\n    if (limitSize > 0) {\n      var infoSize = 0;\n      var videosInfo = this.context.video._infoList;\n\n      for (var _i = 0, _len = videosInfo.length; _i < _len; _i++) {\n        infoSize += videosInfo[_i].size * 1;\n      }\n\n      if (fileSize + infoSize > limitSize) {\n        this.closeLoading();\n        var err = '[SUNEDITOR.videoUpload.fail] Size of uploadable total videos: ' + limitSize / 1000 + 'KB';\n\n        if (typeof this.functions.onVideoUploadError !== 'function' || this.functions.onVideoUploadError(err, {\n          'limitSize': limitSize,\n          'currentSize': infoSize,\n          'uploadSize': fileSize\n        }, this)) {\n          this.functions.noticeOpen(err);\n        }\n\n        return;\n      }\n    }\n\n    var contextVideo = this.context.video;\n    contextVideo._uploadFileLength = files.length;\n    var info = {\n      inputWidth: contextVideo.inputX.value,\n      inputHeight: contextVideo.inputY.value,\n      align: contextVideo._align,\n      isUpdate: this.context.dialog.updateModal,\n      element: contextVideo._element\n    };\n\n    if (typeof this.functions.onVideoUploadBefore === 'function') {\n      var result = this.functions.onVideoUploadBefore(files, info, this, function (data) {\n        if (data && this._w.Array.isArray(data.result)) {\n          this.plugins.video.register.call(this, info, data);\n        } else {\n          this.plugins.video.upload.call(this, info, data);\n        }\n      }.bind(this));\n      if (typeof result === 'undefined') return;\n\n      if (!result) {\n        this.closeLoading();\n        return;\n      }\n\n      if (typeof result === 'object' && result.length > 0) files = result;\n    }\n\n    this.plugins.video.upload.call(this, info, files);\n  },\n  error: function error(message, response) {\n    this.closeLoading();\n\n    if (typeof this.functions.onVideoUploadError !== 'function' || this.functions.onVideoUploadError(message, response, this)) {\n      this.functions.noticeOpen(message);\n      throw Error('[SUNEDITOR.plugin.video.error] response: ' + message);\n    }\n  },\n  upload: function upload(info, files) {\n    if (!files) {\n      this.closeLoading();\n      return;\n    }\n\n    if (typeof files === 'string') {\n      this.plugins.video.error.call(this, files, null);\n      return;\n    }\n\n    var videoUploadUrl = this.options.videoUploadUrl;\n    var filesLen = this.context.dialog.updateModal ? 1 : files.length; // server upload\n\n    if (typeof videoUploadUrl === 'string' && videoUploadUrl.length > 0) {\n      var formData = new FormData();\n\n      for (var i = 0; i < filesLen; i++) {\n        formData.append('file-' + i, files[i]);\n      }\n\n      this.plugins.fileManager.upload.call(this, videoUploadUrl, this.options.videoUploadHeader, formData, this.plugins.video.callBack_videoUpload.bind(this, info), this.functions.onVideoUploadError);\n    } else {\n      throw Error('[SUNEDITOR.videoUpload.fail] cause : There is no \"videoUploadUrl\" option.');\n    }\n  },\n  callBack_videoUpload: function callBack_videoUpload(info, xmlHttp) {\n    if (typeof this.functions.videoUploadHandler === 'function') {\n      this.functions.videoUploadHandler(xmlHttp, info, this);\n    } else {\n      var response = JSON.parse(xmlHttp.responseText);\n\n      if (response.errorMessage) {\n        this.plugins.video.error.call(this, response.errorMessage, response);\n      } else {\n        this.plugins.video.register.call(this, info, response);\n      }\n    }\n  },\n  register: function register(info, response) {\n    var fileList = response.result;\n    var videoTag = this.plugins.video.createVideoTag.call(this);\n\n    for (var i = 0, len = fileList.length, file; i < len; i++) {\n      file = {\n        name: fileList[i].name,\n        size: fileList[i].size\n      };\n      this.plugins.video.create_video.call(this, info.isUpdate ? info.element : videoTag.cloneNode(false), fileList[i].url, info.inputWidth, info.inputHeight, info.align, file, info.isUpdate);\n    }\n\n    this.closeLoading();\n  },\n  setup_url: function setup_url(url) {\n    try {\n      var contextVideo = this.context.video;\n      if (!url) url = contextVideo._linkValue;\n      if (!url) return false;\n      /** iframe source */\n\n      if (/^<iframe.*\\/iframe>$/.test(url)) {\n        var oIframe = new this._w.DOMParser().parseFromString(url, 'text/html').querySelector('iframe');\n        url = oIframe.src;\n        if (url.length === 0) return false;\n      }\n      /** youtube */\n\n\n      if (/youtu\\.?be/.test(url)) {\n        if (!/^http/.test(url)) url = 'https://' + url;\n        url = url.replace('watch?v=', '');\n\n        if (!/^\\/\\/.+\\/embed\\//.test(url)) {\n          url = url.replace(url.match(/\\/\\/.+\\//)[0], '//www.youtube.com/embed/').replace('&', '?&');\n        }\n\n        if (contextVideo._youtubeQuery.length > 0) {\n          if (/\\?/.test(url)) {\n            var splitUrl = url.split('?');\n            url = splitUrl[0] + '?' + contextVideo._youtubeQuery + '&' + splitUrl[1];\n          } else {\n            url += '?' + contextVideo._youtubeQuery;\n          }\n        }\n      } else if (/vimeo\\.com/.test(url)) {\n        if (url.endsWith('/')) {\n          url = url.slice(0, -1);\n        }\n\n        url = 'https://player.vimeo.com/video/' + url.slice(url.lastIndexOf('/') + 1);\n      }\n\n      this.plugins.video.create_video.call(this, this.plugins.video[!/embed|iframe|player|\\/e\\/|\\.php|\\.html?/.test(url) && !/vimeo\\.com/.test(url) ? \"createVideoTag\" : \"createIframeTag\"].call(this), url, contextVideo.inputX.value, contextVideo.inputY.value, contextVideo._align, null, this.context.dialog.updateModal);\n    } catch (error) {\n      throw Error('[SUNEDITOR.video.upload.fail] cause : \"' + error.message + '\"');\n    } finally {\n      this.closeLoading();\n    }\n  },\n  create_video: function create_video(oFrame, src, width, height, align, file, isUpdate) {\n    this.context.resizing._resize_plugin = 'video';\n    var contextVideo = this.context.video;\n    var cover = null;\n    var container = null;\n    var init = false;\n    /** update */\n\n    if (isUpdate) {\n      oFrame = contextVideo._element;\n\n      if (oFrame.src !== src) {\n        init = true;\n        var isYoutube = /youtu\\.?be/.test(src);\n        var isVimeo = /vimeo\\.com/.test(src);\n\n        if ((isYoutube || isVimeo) && !/^iframe$/i.test(oFrame.nodeName)) {\n          var newTag = this.plugins.video.createIframeTag.call(this);\n          newTag.src = src;\n          oFrame.parentNode.replaceChild(newTag, oFrame);\n          contextVideo._element = oFrame = newTag;\n        } else if (!isYoutube && !isVimeo && !/^videoo$/i.test(oFrame.nodeName)) {\n          var _newTag = this.plugins.video.createVideoTag.call(this);\n\n          _newTag.src = src;\n          oFrame.parentNode.replaceChild(_newTag, oFrame);\n          contextVideo._element = oFrame = _newTag;\n        } else {\n          oFrame.src = src;\n        }\n      }\n\n      container = contextVideo._container;\n      cover = this.util.getParentElement(oFrame, 'FIGURE');\n    }\n    /** create */\n    else {\n      init = true;\n      oFrame.src = src;\n      contextVideo._element = oFrame;\n      cover = this.plugins.component.set_cover.call(this, oFrame);\n      container = this.plugins.component.set_container.call(this, cover, 'se-video-container');\n    }\n    /** rendering */\n\n\n    contextVideo._cover = cover;\n    contextVideo._container = container;\n\n    var inputUpdate = this.plugins.resizing._module_getSizeX.call(this, contextVideo) !== (width || contextVideo._defaultSizeX) || this.plugins.resizing._module_getSizeY.call(this, contextVideo) !== (height || contextVideo._videoRatio);\n\n    var changeSize = !isUpdate || inputUpdate;\n\n    if (contextVideo._resizing) {\n      this.context.video._proportionChecked = contextVideo.proportion.checked;\n      oFrame.setAttribute('data-proportion', contextVideo._proportionChecked);\n    } // size\n\n\n    var isPercent = false;\n\n    if (changeSize) {\n      isPercent = this.plugins.video.applySize.call(this);\n    } // align\n\n\n    if (!(isPercent && align === 'center')) {\n      this.plugins.video.setAlign.call(this, null, oFrame, cover, container);\n    }\n\n    var changed = true;\n\n    if (!isUpdate) {\n      changed = this.insertComponent(container, false, true, !this.options.mediaAutoSelect);\n\n      if (!this.options.mediaAutoSelect) {\n        var line = this.appendFormatTag(container, null);\n        if (line) this.setRange(line, 0, line, 0);\n      }\n    } else if (contextVideo._resizing && this.context.resizing._rotateVertical && changeSize) {\n      this.plugins.resizing.setTransformSize.call(this, oFrame, null, null);\n    }\n\n    if (changed) {\n      if (init) {\n        this.plugins.fileManager.setInfo.call(this, 'video', oFrame, this.functions.onVideoUpload, file, true);\n      }\n\n      if (isUpdate) {\n        this.selectComponent(oFrame, 'video'); // history stack\n\n        this.history.push(false);\n      }\n    }\n\n    this.context.resizing._resize_plugin = '';\n  },\n  _update_videoCover: function _update_videoCover(oFrame) {\n    if (!oFrame) return;\n    var contextVideo = this.context.video;\n    if (/^video$/i.test(oFrame.nodeName)) this.plugins.video._setTagAttrs.call(this, oFrame);else this.plugins.video._setIframeAttrs.call(this, oFrame);\n    var existElement = this.util.isRangeFormatElement(oFrame.parentNode) || this.util.isWysiwygDiv(oFrame.parentNode) ? oFrame : this.util.getFormatElement(oFrame) || oFrame;\n    var prevFrame = oFrame;\n    contextVideo._element = oFrame = oFrame.cloneNode(true);\n    var cover = contextVideo._cover = this.plugins.component.set_cover.call(this, oFrame);\n    var container = contextVideo._container = this.plugins.component.set_container.call(this, cover, 'se-video-container');\n\n    try {\n      var figcaption = existElement.querySelector('figcaption');\n      var caption = null;\n\n      if (!!figcaption) {\n        caption = this.util.createElement('DIV');\n        caption.innerHTML = figcaption.innerHTML;\n        this.util.removeItem(figcaption);\n      } // size\n\n\n      var size = (oFrame.getAttribute('data-size') || oFrame.getAttribute('data-origin') || '').split(',');\n      this.plugins.video.applySize.call(this, size[0] || prevFrame.style.width || prevFrame.width || '', size[1] || prevFrame.style.height || prevFrame.height || ''); // align\n\n      var format = this.util.getFormatElement(prevFrame);\n      if (format) contextVideo._align = format.style.textAlign || format.style.float;\n      this.plugins.video.setAlign.call(this, null, oFrame, cover, container);\n\n      if (this.util.isListCell(existElement)) {\n        var refer = this.util.getParentElement(prevFrame, function (current) {\n          return current.parentNode === existElement;\n        });\n        existElement.insertBefore(container, refer);\n        this.util.removeItem(prevFrame);\n        this.util.removeEmptyNode(refer, null);\n      } else if (this.util.isFormatElement(existElement)) {\n        var _refer = this.util.getParentElement(prevFrame, function (current) {\n          return current.parentNode === existElement;\n        });\n\n        existElement = this.util.splitElement(existElement, _refer);\n        existElement.parentNode.insertBefore(container, existElement);\n        this.util.removeItem(prevFrame);\n        this.util.removeEmptyNode(existElement, null);\n        if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n      } else {\n        existElement.parentNode.replaceChild(container, existElement);\n      }\n\n      if (!!caption) existElement.parentNode.insertBefore(caption, container.nextElementSibling);\n    } catch (error) {\n      console.warn('[SUNEDITOR.video.error] Maybe the video tag is nested.', error);\n    }\n\n    this.plugins.fileManager.setInfo.call(this, 'video', oFrame, this.functions.onVideoUpload, null, true);\n    this.plugins.video.init.call(this);\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  onModifyMode: function onModifyMode(element, size) {\n    var contextVideo = this.context.video;\n    contextVideo._element = element;\n    contextVideo._cover = this.util.getParentElement(element, 'FIGURE');\n    contextVideo._container = this.util.getParentElement(element, this.util.isMediaComponent);\n    contextVideo._align = element.style.float || element.getAttribute('data-align') || 'none';\n    element.style.float = '';\n\n    if (size) {\n      contextVideo._element_w = size.w;\n      contextVideo._element_h = size.h;\n      contextVideo._element_t = size.t;\n      contextVideo._element_l = size.l;\n    }\n\n    var origin = contextVideo._element.getAttribute('data-size') || contextVideo._element.getAttribute('data-origin');\n\n    var w, h;\n\n    if (origin) {\n      origin = origin.split(',');\n      w = origin[0];\n      h = origin[1];\n    } else if (size) {\n      w = size.w;\n      h = size.h;\n    }\n\n    contextVideo._origin_w = w || element.style.width || element.width || '';\n    contextVideo._origin_h = h || element.style.height || element.height || '';\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  openModify: function openModify(notOpen) {\n    var contextVideo = this.context.video;\n    if (contextVideo.videoUrlFile) contextVideo._linkValue = contextVideo.preview.textContent = contextVideo.videoUrlFile.value = contextVideo._element.src || (contextVideo._element.querySelector('source') || '').src || '';\n    (contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"][value=\"' + contextVideo._align + '\"]') || contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"][value=\"none\"]')).checked = true;\n\n    if (contextVideo._resizing) {\n      this.plugins.resizing._module_setModifyInputSize.call(this, contextVideo, this.plugins.video);\n\n      var y = contextVideo._videoRatio = this.plugins.resizing._module_getSizeY.call(this, contextVideo);\n\n      var ratioSelected = this.plugins.video.setVideoRatioSelect.call(this, y);\n      if (!ratioSelected) contextVideo.inputY.value = contextVideo._onlyPercentage ? this.util.getNumber(y, 2) : y;\n    }\n\n    if (!notOpen) this.plugins.dialog.open.call(this, 'video', true);\n  },\n  setVideoRatioSelect: function setVideoRatioSelect(value) {\n    var ratioSelected = false;\n    var contextVideo = this.context.video;\n    var ratioOptions = contextVideo.videoRatioOption.options;\n    if (/%$/.test(value) || contextVideo._onlyPercentage) value = this.util.getNumber(value, 2) / 100 + '';else if (!this.util.isNumber(value) || value * 1 >= 1) value = '';\n    contextVideo.inputY.placeholder = '';\n\n    for (var i = 0, len = ratioOptions.length; i < len; i++) {\n      if (ratioOptions[i].value === value) {\n        ratioSelected = ratioOptions[i].selected = true;\n        contextVideo.inputY.placeholder = !value ? '' : value * 100 + '%';\n      } else ratioOptions[i].selected = false;\n    }\n\n    return ratioSelected;\n  },\n\n  /**\n   * @Override fileManager\n   */\n  checkFileInfo: function checkFileInfo() {\n    this.plugins.fileManager.checkInfo.call(this, 'video', ['iframe', 'video'], this.functions.onVideoUpload, this.plugins.video._update_videoCover.bind(this), true);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  resetFileInfo: function resetFileInfo() {\n    this.plugins.fileManager.resetInfo.call(this, 'video', this.functions.onVideoUpload);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  applySize: function applySize(w, h) {\n    var contextVideo = this.context.video;\n    if (!w) w = contextVideo.inputX.value || this.options.videoWidth;\n    if (!h) h = contextVideo.inputY.value || this.options.videoHeight;\n\n    if (contextVideo._onlyPercentage || /%$/.test(w) || !w) {\n      this.plugins.video.setPercentSize.call(this, w || '100%', h || (/%$/.test(contextVideo._videoRatio) ? contextVideo._videoRatio : contextVideo._defaultRatio));\n      return true;\n    } else if ((!w || w === 'auto') && (!h || h === 'auto')) {\n      this.plugins.video.setAutoSize.call(this);\n    } else {\n      this.plugins.video.setSize.call(this, w, h || contextVideo._videoRatio || contextVideo._defaultRatio, false);\n    }\n\n    return false;\n  },\n\n  /**\n   * @Override resizing\n   */\n  sizeRevert: function sizeRevert() {\n    this.plugins.resizing._module_sizeRevert.call(this, this.context.video);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setSize: function setSize(w, h, notResetPercentage, direction) {\n    var contextVideo = this.context.video;\n    var onlyW = /^(rw|lw)$/.test(direction);\n    var onlyH = /^(th|bh)$/.test(direction);\n    if (!onlyH) w = this.util.getNumber(w, 0);\n    if (!onlyW) h = this.util.isNumber(h) ? h + contextVideo.sizeUnit : !h ? '' : h;\n    w = w ? w + contextVideo.sizeUnit : '';\n    if (!onlyH) contextVideo._element.style.width = w;\n    if (!onlyW) contextVideo._cover.style.paddingBottom = contextVideo._cover.style.height = h;\n\n    if (!onlyH && !/%$/.test(w)) {\n      contextVideo._cover.style.width = w;\n      contextVideo._container.style.width = '';\n    }\n\n    if (!onlyW && !/%$/.test(h)) {\n      contextVideo._element.style.height = h;\n    } else {\n      contextVideo._element.style.height = '';\n    }\n\n    if (!notResetPercentage) contextVideo._element.removeAttribute('data-percentage'); // save current size\n\n    this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setAutoSize: function setAutoSize() {\n    this.plugins.video.setPercentSize.call(this, 100, this.context.video._defaultRatio);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setOriginSize: function setOriginSize(dataSize) {\n    var contextVideo = this.context.video;\n\n    contextVideo._element.removeAttribute('data-percentage');\n\n    this.plugins.resizing.resetTransform.call(this, contextVideo._element);\n    this.plugins.video.cancelPercentAttr.call(this);\n    var originSize = ((dataSize ? contextVideo._element.getAttribute('data-size') : '') || contextVideo._element.getAttribute('data-origin') || '').split(',');\n\n    if (originSize) {\n      var w = originSize[0];\n      var h = originSize[1];\n\n      if (contextVideo._onlyPercentage || /%$/.test(w) && (/%$/.test(h) || !/\\d/.test(h))) {\n        this.plugins.video.setPercentSize.call(this, w, h);\n      } else {\n        this.plugins.video.setSize.call(this, w, h);\n      } // save current size\n\n\n      this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n    }\n  },\n\n  /**\n   * @Override resizing\n   */\n  setPercentSize: function setPercentSize(w, h) {\n    var contextVideo = this.context.video;\n    h = !!h && !/%$/.test(h) && !this.util.getNumber(h, 0) ? this.util.isNumber(h) ? h + '%' : h : this.util.isNumber(h) ? h + contextVideo.sizeUnit : h || contextVideo._defaultRatio;\n    contextVideo._container.style.width = this.util.isNumber(w) ? w + '%' : w;\n    contextVideo._container.style.height = '';\n    contextVideo._cover.style.width = '100%';\n    contextVideo._cover.style.height = h;\n    contextVideo._cover.style.paddingBottom = h;\n    contextVideo._element.style.width = '100%';\n    contextVideo._element.style.height = '100%';\n    contextVideo._element.style.maxWidth = '';\n    if (contextVideo._align === 'center') this.plugins.video.setAlign.call(this, null, null, null, null);\n\n    contextVideo._element.setAttribute('data-percentage', w + ',' + h); // save current size\n\n\n    this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n  },\n\n  /**\n   * @Override resizing\n   */\n  cancelPercentAttr: function cancelPercentAttr() {\n    var contextVideo = this.context.video;\n    contextVideo._cover.style.width = '';\n    contextVideo._cover.style.height = '';\n    contextVideo._cover.style.paddingBottom = '';\n    contextVideo._container.style.width = '';\n    contextVideo._container.style.height = '';\n    this.util.removeClass(contextVideo._container, this.context.video._floatClassRegExp);\n    this.util.addClass(contextVideo._container, '__se__float-' + contextVideo._align);\n    if (contextVideo._align === 'center') this.plugins.video.setAlign.call(this, null, null, null, null);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setAlign: function setAlign(align, element, cover, container) {\n    var contextVideo = this.context.video;\n    if (!align) align = contextVideo._align;\n    if (!element) element = contextVideo._element;\n    if (!cover) cover = contextVideo._cover;\n    if (!container) container = contextVideo._container;\n\n    if (align && align !== 'none') {\n      cover.style.margin = 'auto';\n    } else {\n      cover.style.margin = '0';\n    }\n\n    if (/%$/.test(element.style.width) && align === 'center') {\n      container.style.minWidth = '100%';\n      cover.style.width = container.style.width;\n      cover.style.height = cover.style.height;\n      cover.style.paddingBottom = !/%$/.test(cover.style.height) ? cover.style.height : this.util.getNumber(this.util.getNumber(cover.style.height, 2) / 100 * this.util.getNumber(cover.style.width, 2), 2) + '%';\n    } else {\n      container.style.minWidth = '';\n      cover.style.width = this.context.resizing._rotateVertical ? element.style.height || element.offsetHeight : element.style.width || '100%';\n      cover.style.paddingBottom = cover.style.height;\n    }\n\n    if (!this.util.hasClass(container, '__se__float-' + align)) {\n      this.util.removeClass(container, contextVideo._floatClassRegExp);\n      this.util.addClass(container, '__se__float-' + align);\n    }\n\n    element.setAttribute('data-align', align);\n  },\n\n  /**\n   * @Override dialog\n   */\n  init: function init() {\n    var contextVideo = this.context.video;\n    if (contextVideo.videoInputFile) contextVideo.videoInputFile.value = '';\n    if (contextVideo.videoUrlFile) contextVideo._linkValue = contextVideo.preview.textContent = contextVideo.videoUrlFile.value = '';\n\n    if (contextVideo.videoInputFile && contextVideo.videoUrlFile) {\n      contextVideo.videoUrlFile.removeAttribute('disabled');\n      contextVideo.preview.style.textDecoration = '';\n    }\n\n    contextVideo._origin_w = this.options.videoWidth;\n    contextVideo._origin_h = this.options.videoHeight;\n    contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"][value=\"none\"]').checked = true;\n\n    if (contextVideo._resizing) {\n      contextVideo.inputX.value = this.options.videoWidth === contextVideo._defaultSizeX ? '' : this.options.videoWidth;\n      contextVideo.inputY.value = this.options.videoHeight === contextVideo._defaultSizeY ? '' : this.options.videoHeight;\n      contextVideo.proportion.checked = true;\n      contextVideo.proportion.disabled = true;\n      this.plugins.video.setVideoRatioSelect.call(this, contextVideo._defaultRatio);\n    }\n  }\n};","map":{"version":3,"names":["dialog","component","resizing","fileManager","name","display","add","core","addModule","options","context","contextVideo","video","_infoList","_infoIndex","_uploadFileLength","focusElement","sizeUnit","_videoSizeUnit","_align","_floatClassRegExp","_youtubeQuery","youtubeQuery","_videoRatio","videoRatio","_defaultRatio","_linkValue","_element","_cover","_container","inputX","inputY","_element_w","_element_h","_element_l","_element_t","_defaultSizeX","_defaultSizeY","_origin_w","videoWidth","_origin_h","videoHeight","_proportionChecked","_resizing","videoResizing","_resizeDotHide","videoHeightShow","_rotation","videoRotation","_alignHide","videoAlignShow","_onlyPercentage","videoSizeOnlyPercentage","_ratio","_ratioX","_ratioY","_captionShow","video_dialog","setDialog","modal","videoInputFile","querySelector","videoUrlFile","preview","addEventListener","submit","bind","_removeSelectedFiles","_fileInputChange","_onLinkPreview","linkProtocol","proportion","videoRatioOption","value","setInputSize","setRatio","setVideoRatio","sizeRevert","appendChild","option","lang","util","createElement","className","style","html","dialogBox","close","icons","cancel","videoBox","title","videoFileInput","file","videoAccept","videoMultipleFile","controller","remove","videoUrlInput","url","ratioList","videoRatioList","ratio","onlyPercentage","onlyPercentDisplay","heightDisplay","ratioDisplay","videoRatioShow","onlyWidthDisplay","width","height","i","len","length","toString","revertButton","revert","basic","left","center","right","submitButton","innerHTML","removeAttribute","textDecoration","setAttribute","urlInput","protocol","e","target","trim","test","textContent","indexOf","_setTagAttrs","element","attrs","videoTagAttrs","key","hasOwn","createVideoTag","videoTag","plugins","call","_setIframeAttrs","frameBorder","allowFullscreen","videoIframeAttrs","createIframeTag","iframeTag","fileTags","select","onModifyMode","call_controller_resize","destroy","frame","container","dataIndex","getAttribute","focusEl","previousElementSibling","nextElementSibling","emptyDiv","parentNode","removeItem","init","controllersOff","wysiwyg","removeItemAllParents","current","childNodes","focusEdge","deleteInfo","functions","onVideoUpload","history","push","on","update","disabled","setVideoRatioSelect","open","currentControllerName","selectedIndex","placeholder","xy","keyCode","preventDefault","_module_setInputSize","_module_setRatio","videoPlugin","stopPropagation","files","showLoading","submitAction","setup_url","error","closeLoading","Error","message","fileList","fileSize","type","size","limitSize","videoUploadSizeLimit","infoSize","videosInfo","err","onVideoUploadError","noticeOpen","info","inputWidth","inputHeight","align","isUpdate","updateModal","onVideoUploadBefore","result","data","_w","Array","isArray","register","upload","response","videoUploadUrl","filesLen","formData","FormData","append","videoUploadHeader","callBack_videoUpload","xmlHttp","videoUploadHandler","JSON","parse","responseText","errorMessage","create_video","cloneNode","oIframe","DOMParser","parseFromString","src","replace","match","splitUrl","split","endsWith","slice","lastIndexOf","oFrame","_resize_plugin","cover","isYoutube","isVimeo","nodeName","newTag","replaceChild","getParentElement","set_cover","set_container","inputUpdate","_module_getSizeX","_module_getSizeY","changeSize","checked","isPercent","applySize","setAlign","changed","insertComponent","mediaAutoSelect","line","appendFormatTag","setRange","_rotateVertical","setTransformSize","setInfo","selectComponent","_update_videoCover","existElement","isRangeFormatElement","isWysiwygDiv","getFormatElement","prevFrame","figcaption","caption","format","textAlign","float","isListCell","refer","insertBefore","removeEmptyNode","isFormatElement","splitElement","children","htmlRemoveWhiteSpace","console","warn","isMediaComponent","w","h","t","l","origin","openModify","notOpen","_module_setModifyInputSize","y","ratioSelected","getNumber","ratioOptions","isNumber","selected","checkFileInfo","checkInfo","resetFileInfo","resetInfo","setPercentSize","setAutoSize","setSize","_module_sizeRevert","notResetPercentage","direction","onlyW","onlyH","paddingBottom","_module_saveCurrentSize","setOriginSize","dataSize","resetTransform","cancelPercentAttr","originSize","maxWidth","removeClass","addClass","margin","minWidth","offsetHeight","hasClass"],"sources":["/Users/jirayuyungmeesuk/Desktop/ v2/client/node_modules/suneditor/src/plugins/dialog/video.js"],"sourcesContent":["/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport component from '../modules/component';\nimport resizing from '../modules/resizing';\nimport fileManager from '../modules/fileManager';\n\nexport default {\n    name: 'video',\n    display: 'dialog',\n    add: function (core) {\n        core.addModule([dialog, component, resizing, fileManager]);\n\n        const options = core.options;\n        const context = core.context;\n        const contextVideo = context.video = {\n            _infoList: [], // @Override fileManager\n            _infoIndex: 0, // @Override fileManager\n            _uploadFileLength: 0, // @Override fileManager\n            focusElement: null, // @Override dialog // This element has focus when the dialog is opened.\n            sizeUnit: options._videoSizeUnit,\n            _align: 'none',\n            _floatClassRegExp: '__se__float\\\\-[a-z]+',\n            _youtubeQuery: options.youtubeQuery,\n            _videoRatio: (options.videoRatio * 100) + '%',\n            _defaultRatio: (options.videoRatio * 100) + '%',\n            _linkValue: '',\n            // @require @Override component\n            _element: null,\n            _cover: null,\n            _container: null,\n            // @Override resizing properties\n            inputX: null,\n            inputY: null,\n            _element_w: 1,\n            _element_h: 1,\n            _element_l: 0,\n            _element_t: 0,\n            _defaultSizeX: '100%',\n            _defaultSizeY: (options.videoRatio * 100) + '%',\n            _origin_w: options.videoWidth === '100%' ? '' : options.videoWidth,\n            _origin_h: options.videoHeight === '56.25%' ? '' : options.videoHeight,\n            _proportionChecked: true,\n            _resizing: options.videoResizing,\n            _resizeDotHide: !options.videoHeightShow,\n            _rotation: options.videoRotation,\n            _alignHide: !options.videoAlignShow,\n            _onlyPercentage: options.videoSizeOnlyPercentage,\n            _ratio: false,\n            _ratioX: 1,\n            _ratioY: 1,\n            _captionShow: false\n        };\n\n        /** video dialog */\n        let video_dialog = this.setDialog(core);\n        contextVideo.modal = video_dialog;\n        contextVideo.videoInputFile = video_dialog.querySelector('._se_video_file');\n        contextVideo.videoUrlFile = video_dialog.querySelector('.se-input-url');\n        contextVideo.focusElement = contextVideo.videoUrlFile || contextVideo.videoInputFile;\n        contextVideo.preview = video_dialog.querySelector('.se-link-preview');\n\n        /** add event listeners */\n        video_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n        if (contextVideo.videoInputFile) video_dialog.querySelector('.se-dialog-files-edge-button').addEventListener('click', this._removeSelectedFiles.bind(contextVideo.videoInputFile, contextVideo.videoUrlFile, contextVideo.preview));\n        if (contextVideo.videoInputFile && contextVideo.videoUrlFile) contextVideo.videoInputFile.addEventListener('change', this._fileInputChange.bind(contextVideo));\n        if (contextVideo.videoUrlFile) contextVideo.videoUrlFile.addEventListener('input', this._onLinkPreview.bind(contextVideo.preview, contextVideo, options.linkProtocol));\n\n        contextVideo.proportion = {};\n        contextVideo.videoRatioOption = {};\n        contextVideo.inputX = {};\n        contextVideo.inputY = {};\n        if (options.videoResizing) {\n            contextVideo.proportion = video_dialog.querySelector('._se_video_check_proportion');\n            contextVideo.videoRatioOption = video_dialog.querySelector('.se-video-ratio');\n            contextVideo.inputX = video_dialog.querySelector('._se_video_size_x');\n            contextVideo.inputY = video_dialog.querySelector('._se_video_size_y');\n            contextVideo.inputX.value = options.videoWidth;\n            contextVideo.inputY.value = options.videoHeight;\n\n            contextVideo.inputX.addEventListener('keyup', this.setInputSize.bind(core, 'x'));\n            contextVideo.inputY.addEventListener('keyup', this.setInputSize.bind(core, 'y'));\n\n            contextVideo.inputX.addEventListener('change', this.setRatio.bind(core));\n            contextVideo.inputY.addEventListener('change', this.setRatio.bind(core));\n            contextVideo.proportion.addEventListener('change', this.setRatio.bind(core));\n            contextVideo.videoRatioOption.addEventListener('change', this.setVideoRatio.bind(core));\n\n            video_dialog.querySelector('.se-dialog-btn-revert').addEventListener('click', this.sizeRevert.bind(core));\n        }\n\n        /** append html */\n        context.dialog.modal.appendChild(video_dialog);\n\n        /** empty memory */\n        video_dialog = null;\n    },\n\n    /** dialog */\n    setDialog: function (core) {\n        const option = core.options;\n        const lang = core.lang;\n        const dialog = core.util.createElement('DIV');\n\n        dialog.className = 'se-dialog-content';\n        dialog.style.display = 'none';\n        let html = '' +\n            '<form method=\"post\" enctype=\"multipart/form-data\">' +\n                '<div class=\"se-dialog-header\">' +\n                    '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" title=\"' + lang.dialogBox.close + '\" aria-label=\"' + lang.dialogBox.close + '\">' +\n                        core.icons.cancel +\n                    '</button>' +\n                    '<span class=\"se-modal-title\">' + lang.dialogBox.videoBox.title + '</span>' +\n                '</div>' +\n                '<div class=\"se-dialog-body\">';\n\n                if (option.videoFileInput) {\n                    html += '' +\n                        '<div class=\"se-dialog-form\">' +\n                            '<label>' + lang.dialogBox.videoBox.file + '</label>' +\n                            '<div class=\"se-dialog-form-files\">' +\n                                '<input class=\"se-input-form _se_video_file\" type=\"file\" accept=\"' + option.videoAccept + '\"' + (option.videoMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' +\n                                '<button type=\"button\" data-command=\"filesRemove\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\" aria-label=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' +\n                            '</div>' +\n                        '</div>' ;\n                }\n    \n                if (option.videoUrlInput) {\n                    html += '' +\n                        '<div class=\"se-dialog-form\">' +\n                            '<label>' + lang.dialogBox.videoBox.url + '</label>' +\n                            '<input class=\"se-input-form se-input-url\" type=\"text\" />' +\n                            '<pre class=\"se-link-preview\"></pre>' +\n                        '</div>';\n                }\n\n            if (option.videoResizing) {\n                const ratioList = option.videoRatioList || [{name: '16:9', value: 0.5625}, {name: '4:3', value: 0.75}, {name: '21:9', value: 0.4285}];\n                const ratio = option.videoRatio;\n                const onlyPercentage = option.videoSizeOnlyPercentage;\n                const onlyPercentDisplay = onlyPercentage ? ' style=\"display: none !important;\"' : '';\n                const heightDisplay = !option.videoHeightShow ? ' style=\"display: none !important;\"' : '';\n                const ratioDisplay = !option.videoRatioShow ? ' style=\"display: none !important;\"' : '';\n                const onlyWidthDisplay = !onlyPercentage && !option.videoHeightShow && !option.videoRatioShow ? ' style=\"display: none !important;\"' : '';\n                html += '' +\n                    '<div class=\"se-dialog-form\">' +\n                        '<div class=\"se-dialog-size-text\">' +\n                            '<label class=\"size-w\">' + lang.dialogBox.width + '</label>' +\n                            '<label class=\"se-dialog-size-x\">&nbsp;</label>' +\n                            '<label class=\"size-h\"' + heightDisplay + '>' + lang.dialogBox.height + '</label>' +\n                            '<label class=\"size-h\"' + ratioDisplay + '>(' + lang.dialogBox.ratio + ')</label>' +\n                        '</div>' +\n                        '<input class=\"se-input-control _se_video_size_x\" placeholder=\"100%\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + '/>' +\n                        '<label class=\"se-dialog-size-x\"' + onlyWidthDisplay + '>' + (onlyPercentage ? '%' : 'x') + '</label>' +\n                        '<input class=\"se-input-control _se_video_size_y\" placeholder=\"' + (option.videoRatio * 100) + '%\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + heightDisplay + '/>' +\n                        '<select class=\"se-input-select se-video-ratio\" title=\"' + lang.dialogBox.ratio + '\" aria-label=\"' + lang.dialogBox.ratio + '\"' + ratioDisplay + '>';\n                            if (!heightDisplay) html += '<option value=\"\"> - </option>';\n                            for (let i = 0, len = ratioList.length; i < len; i++) {\n                                html += '<option value=\"' + ratioList[i].value + '\"' + (ratio.toString() === ratioList[i].value.toString() ? ' selected' : '') + '>' + ratioList[i].name + '</option>';\n                            }\n                        html += '</select>' +\n                        '<button type=\"button\" title=\"' + lang.dialogBox.revertButton + '\" aria-label=\"' + lang.dialogBox.revertButton + '\" class=\"se-btn se-dialog-btn-revert\" style=\"float: right;\">' + core.icons.revert + '</button>' +\n                    '</div>' +\n                    '<div class=\"se-dialog-form se-dialog-form-footer\"' + onlyPercentDisplay + onlyWidthDisplay + '>' +\n                        '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_video_check_proportion\" checked/>&nbsp;' + lang.dialogBox.proportion + '</label>' +\n                    '</div>';\n            }\n\n            html += '' +\n                '</div>' +\n                '<div class=\"se-dialog-footer\">' +\n                    '<div' + (option.videoAlignShow ? '' : ' style=\"display: none\"') + '>' +\n                        '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"none\" checked>' + lang.dialogBox.basic + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"left\">' + lang.dialogBox.left + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"center\">' + lang.dialogBox.center + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"right\">' + lang.dialogBox.right + '</label>' +\n                    '</div>' +\n                    '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\" aria-label=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' +\n                '</div>' +\n            '</form>';\n\n        dialog.innerHTML = html;\n\n        return dialog;\n    },\n\n    _fileInputChange: function () {\n        if (!this.videoInputFile.value) {\n            this.videoUrlFile.removeAttribute('disabled');\n            this.preview.style.textDecoration = '';\n        } else {\n            this.videoUrlFile.setAttribute('disabled', true);\n            this.preview.style.textDecoration = 'line-through';\n        }\n    },\n\n    _removeSelectedFiles: function (urlInput, preview) {\n        this.value = '';\n        if (urlInput) {\n            urlInput.removeAttribute('disabled');\n            preview.style.textDecoration = '';\n        }\n    },\n\n    _onLinkPreview: function (context, protocol, e) {\n        const value = e.target.value.trim();\n        if (/^<iframe.*\\/iframe>$/.test(value)) {\n            context._linkValue = value;\n            this.textContent = '<IFrame :src=\"..\"></IFrame>';\n        } else {\n            context._linkValue = this.textContent = !value ? '' : (protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0) ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n        }\n    },\n\n    _setTagAttrs: function (element) {\n        element.setAttribute('controls', true);\n\n        const attrs = this.options.videoTagAttrs;\n        if (!attrs) return;\n\n        for (let key in attrs) {\n            if (!this.util.hasOwn(attrs, key)) continue;\n            element.setAttribute(key, attrs[key]);\n        }\n    },\n\n    createVideoTag: function () {\n        const videoTag = this.util.createElement('VIDEO');\n        this.plugins.video._setTagAttrs.call(this, videoTag);\n        return videoTag;\n    },\n\n    _setIframeAttrs: function (element) {\n        element.frameBorder = '0';\n        element.allowFullscreen = true;\n\n        const attrs = this.options.videoIframeAttrs;\n        if (!attrs) return;\n\n        for (let key in attrs) {\n            if (!this.util.hasOwn(attrs, key)) continue;\n            element.setAttribute(key, attrs[key]);\n        }\n    },\n\n    createIframeTag: function () {\n        const iframeTag = this.util.createElement('IFRAME');\n        this.plugins.video._setIframeAttrs.call(this, iframeTag);\n        return iframeTag;\n    },\n\n    /**\n     * @Override @Required fileManager\n     */\n    fileTags: ['iframe', 'video'],\n\n    /**\n     * @Override core, resizing, fileManager\n     * @description It is called from core.selectComponent.\n     * @param {Element} element Target element\n     */\n    select: function (element) {\n        this.plugins.video.onModifyMode.call(this, element, this.plugins.resizing.call_controller_resize.call(this, element, 'video'));\n    },\n\n    /**\n     * @Override fileManager, resizing\n     */\n    destroy: function (element) {\n        const frame = element || this.context.video._element;\n        const container = this.context.video._container;\n        const dataIndex = frame.getAttribute('data-index') * 1;\n        let focusEl = (container.previousElementSibling || container.nextElementSibling);\n\n        const emptyDiv = container.parentNode;\n        this.util.removeItem(container);\n        this.plugins.video.init.call(this);\n        this.controllersOff();\n\n        if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) { return current.childNodes.length === 0; }, null);\n\n        // focus\n        this.focusEdge(focusEl);\n\n        // event\n        this.plugins.fileManager.deleteInfo.call(this, 'video', dataIndex, this.functions.onVideoUpload);\n\n        // history stack\n        this.history.push(false);\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    on: function (update) {\n        const contextVideo = this.context.video;\n\n        if (!update) {\n            contextVideo.inputX.value = contextVideo._origin_w = this.options.videoWidth === contextVideo._defaultSizeX ? '' : this.options.videoWidth;\n            contextVideo.inputY.value = contextVideo._origin_h = this.options.videoHeight === contextVideo._defaultSizeY ? '' : this.options.videoHeight;\n            contextVideo.proportion.disabled = true;\n            if (contextVideo.videoInputFile && this.options.videoMultipleFile) contextVideo.videoInputFile.setAttribute('multiple', 'multiple');\n        } else {\n            if (contextVideo.videoInputFile && this.options.videoMultipleFile) contextVideo.videoInputFile.removeAttribute('multiple');\n        }\n\n        if (contextVideo._resizing) {\n            this.plugins.video.setVideoRatioSelect.call(this, contextVideo._origin_h || contextVideo._defaultRatio);\n        }\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    open: function () {\n        this.plugins.dialog.open.call(this, 'video', 'video' === this.currentControllerName);\n    },\n    \n    setVideoRatio: function (e) {\n        const contextVideo = this.context.video;\n        const value = e.target.options[e.target.selectedIndex].value;\n\n        contextVideo._defaultSizeY = contextVideo._videoRatio = !value ? contextVideo._defaultSizeY : (value * 100) + '%';\n        contextVideo.inputY.placeholder = !value ? '' : (value * 100) + '%';\n        contextVideo.inputY.value = '';\n    },\n\n    /**\n     * @Override resizing\n     * @param {String} xy 'x': width, 'y': height\n     * @param {KeyboardEvent} e Event object\n     */\n    setInputSize: function (xy, e) {\n        if (e && e.keyCode === 32) {\n            e.preventDefault();\n            return;\n        }\n\n        const contextVideo = this.context.video;\n        this.plugins.resizing._module_setInputSize.call(this, contextVideo, xy);\n\n        if (xy === 'y') {\n            this.plugins.video.setVideoRatioSelect.call(this, e.target.value || contextVideo._defaultRatio);\n        }\n    },\n\n    /**\n     * @Override resizing\n     */\n    setRatio: function () {\n        this.plugins.resizing._module_setRatio.call(this, this.context.video);\n    },\n\n    submit: function (e) {\n        const contextVideo = this.context.video;\n        const videoPlugin = this.plugins.video;\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        contextVideo._align = contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"]:checked').value;\n\n        try {\n            if (contextVideo.videoInputFile && contextVideo.videoInputFile.files.length > 0) {\n                this.showLoading();\n                videoPlugin.submitAction.call(this, this.context.video.videoInputFile.files);\n            } else if (contextVideo.videoUrlFile && contextVideo._linkValue.length > 0) {\n                this.showLoading();\n                videoPlugin.setup_url.call(this, contextVideo._linkValue);\n            }\n        } catch (error) {\n            this.closeLoading();\n            throw Error('[SUNEDITOR.video.submit.fail] cause : \"' + error.message + '\"');\n        } finally {\n            this.plugins.dialog.close.call(this);\n        }\n\n        return false;\n    },\n\n    submitAction: function (fileList) {\n        if (fileList.length === 0) return;\n\n        let fileSize = 0;\n        let files = [];\n        for (let i = 0, len = fileList.length; i < len; i++) {\n            if (/video/i.test(fileList[i].type)) {\n                files.push(fileList[i]);\n                fileSize += fileList[i].size;\n            }\n        }\n\n        const limitSize = this.options.videoUploadSizeLimit;\n        if (limitSize > 0) {\n            let infoSize = 0;\n            const videosInfo = this.context.video._infoList;\n            for (let i = 0, len = videosInfo.length; i < len; i++) {\n                infoSize += videosInfo[i].size * 1;\n            }\n\n            if ((fileSize + infoSize) > limitSize) {\n                this.closeLoading();\n                const err = '[SUNEDITOR.videoUpload.fail] Size of uploadable total videos: ' + (limitSize/1000) + 'KB';\n                if (typeof this.functions.onVideoUploadError !== 'function' || this.functions.onVideoUploadError(err, { 'limitSize': limitSize, 'currentSize': infoSize, 'uploadSize': fileSize }, this)) {\n                    this.functions.noticeOpen(err);\n                }\n                return;\n            }\n        }\n\n        const contextVideo = this.context.video;\n        contextVideo._uploadFileLength = files.length;\n\n        const info = {\n            inputWidth: contextVideo.inputX.value,\n            inputHeight: contextVideo.inputY.value,\n            align: contextVideo._align,\n            isUpdate: this.context.dialog.updateModal,\n            element: contextVideo._element\n        };\n\n        if (typeof this.functions.onVideoUploadBefore === 'function') {\n            const result = this.functions.onVideoUploadBefore(files, info, this, function (data) {\n                if (data && this._w.Array.isArray(data.result)) {\n                    this.plugins.video.register.call(this, info, data);\n                } else {\n                    this.plugins.video.upload.call(this, info, data);\n                }\n            }.bind(this));\n\n            if (typeof result === 'undefined') return;\n            if (!result) {\n                this.closeLoading();\n                return;\n            }\n            if (typeof result === 'object' && result.length > 0) files = result;\n        }\n\n        this.plugins.video.upload.call(this, info, files);\n    },\n\n    error: function (message, response) {\n        this.closeLoading();\n        if (typeof this.functions.onVideoUploadError !== 'function' || this.functions.onVideoUploadError(message, response, this)) {\n            this.functions.noticeOpen(message);\n            throw Error('[SUNEDITOR.plugin.video.error] response: ' + message);\n        }\n    },\n\n    upload: function (info, files) {\n        if (!files) {\n            this.closeLoading();\n            return;\n        }\n        if (typeof files === 'string') {\n            this.plugins.video.error.call(this, files, null);\n            return;\n        }\n\n        const videoUploadUrl = this.options.videoUploadUrl;\n        const filesLen = this.context.dialog.updateModal ? 1 : files.length;\n\n        // server upload\n        if (typeof videoUploadUrl === 'string' && videoUploadUrl.length > 0) {\n            const formData = new FormData();\n            for (let i = 0; i < filesLen; i++) {\n                formData.append('file-' + i, files[i]);\n            }\n            this.plugins.fileManager.upload.call(this, videoUploadUrl, this.options.videoUploadHeader, formData, this.plugins.video.callBack_videoUpload.bind(this, info), this.functions.onVideoUploadError);\n        } else {\n            throw Error('[SUNEDITOR.videoUpload.fail] cause : There is no \"videoUploadUrl\" option.');\n        }\n    },\n\n    callBack_videoUpload: function (info, xmlHttp) {\n        if (typeof this.functions.videoUploadHandler === 'function') {\n            this.functions.videoUploadHandler(xmlHttp, info, this);\n        } else {\n            const response = JSON.parse(xmlHttp.responseText);\n            if (response.errorMessage) {\n                this.plugins.video.error.call(this, response.errorMessage, response);\n            } else {\n                this.plugins.video.register.call(this, info, response);\n            }\n        }\n    },\n\n    register: function (info, response) {\n        const fileList = response.result;\n        const videoTag = this.plugins.video.createVideoTag.call(this);\n\n        for (let i = 0, len = fileList.length, file; i < len; i++) {\n            file = { name: fileList[i].name, size: fileList[i].size };\n            this.plugins.video.create_video.call(this, (info.isUpdate ? info.element : videoTag.cloneNode(false)), fileList[i].url, info.inputWidth, info.inputHeight, info.align, file, info.isUpdate);\n        }\n\n        this.closeLoading();\n    },\n\n    setup_url: function (url) {\n        try {\n            const contextVideo = this.context.video;\n            if (!url) url = contextVideo._linkValue;\n            if (!url) return false;\n\n            /** iframe source */\n            if (/^<iframe.*\\/iframe>$/.test(url)) {\n                const oIframe = (new this._w.DOMParser()).parseFromString(url, 'text/html').querySelector('iframe');\n                url = oIframe.src;\n                if (url.length === 0) return false;\n            }\n            \n            /** youtube */\n            if (/youtu\\.?be/.test(url)) {\n                if (!/^http/.test(url)) url = 'https://' + url;\n                url = url.replace('watch?v=', '');\n                if (!/^\\/\\/.+\\/embed\\//.test(url)) {\n                    url = url.replace(url.match(/\\/\\/.+\\//)[0], '//www.youtube.com/embed/').replace('&', '?&');\n                }\n\n                if (contextVideo._youtubeQuery.length > 0) {\n                    if (/\\?/.test(url)) {\n                        const splitUrl = url.split('?');\n                        url = splitUrl[0] + '?' + contextVideo._youtubeQuery + '&' + splitUrl[1];\n                    } else {\n                        url += '?' + contextVideo._youtubeQuery;\n                    }\n                }\n            } else if (/vimeo\\.com/.test(url)) {\n                if (url.endsWith('/')) {\n                    url = url.slice(0, -1);\n                }\n                url = 'https://player.vimeo.com/video/' + url.slice(url.lastIndexOf('/') + 1);\n            }\n\n            this.plugins.video.create_video.call(this, this.plugins.video[(!/embed|iframe|player|\\/e\\/|\\.php|\\.html?/.test(url) && !/vimeo\\.com/.test(url) ? \"createVideoTag\" : \"createIframeTag\")].call(this), url, contextVideo.inputX.value, contextVideo.inputY.value, contextVideo._align, null, this.context.dialog.updateModal);\n        } catch (error) {\n            throw Error('[SUNEDITOR.video.upload.fail] cause : \"' + error.message + '\"');\n        } finally {\n            this.closeLoading();\n        }\n    },\n\n    create_video: function (oFrame, src, width, height, align, file, isUpdate) {\n        this.context.resizing._resize_plugin = 'video';\n        const contextVideo = this.context.video;\n        \n        let cover = null;\n        let container = null;\n        let init = false;\n\n        /** update */\n        if (isUpdate) {\n            oFrame = contextVideo._element;\n            if (oFrame.src !== src) {\n                init = true;\n                const isYoutube = /youtu\\.?be/.test(src);\n                const isVimeo = /vimeo\\.com/.test(src);\n                if ((isYoutube || isVimeo) && !/^iframe$/i.test(oFrame.nodeName)) {\n                    const newTag = this.plugins.video.createIframeTag.call(this);\n                    newTag.src = src;\n                    oFrame.parentNode.replaceChild(newTag, oFrame);\n                    contextVideo._element = oFrame = newTag;\n                } else if (!isYoutube && !isVimeo && !/^videoo$/i.test(oFrame.nodeName)) {\n                    const newTag = this.plugins.video.createVideoTag.call(this);\n                    newTag.src = src;\n                    oFrame.parentNode.replaceChild(newTag, oFrame);\n                    contextVideo._element = oFrame = newTag;\n                } else {\n                    oFrame.src = src;\n                }\n            }\n            container = contextVideo._container;\n            cover = this.util.getParentElement(oFrame, 'FIGURE');\n        }\n        /** create */\n        else {\n            init = true;\n            oFrame.src = src;\n            contextVideo._element = oFrame;\n            cover = this.plugins.component.set_cover.call(this, oFrame);\n            container = this.plugins.component.set_container.call(this, cover, 'se-video-container');\n        }\n\n        /** rendering */\n        contextVideo._cover = cover;\n        contextVideo._container = container;\n\n        const inputUpdate = (this.plugins.resizing._module_getSizeX.call(this, contextVideo) !== (width || contextVideo._defaultSizeX)) || (this.plugins.resizing._module_getSizeY.call(this, contextVideo) !== (height || contextVideo._videoRatio));\n        const changeSize = !isUpdate || inputUpdate;\n\n        if (contextVideo._resizing) {\n            this.context.video._proportionChecked = contextVideo.proportion.checked;\n            oFrame.setAttribute('data-proportion', contextVideo._proportionChecked);\n        }\n\n        // size\n        let isPercent = false;\n        if (changeSize) {\n            isPercent = this.plugins.video.applySize.call(this);\n        }\n\n        // align\n        if (!(isPercent && align === 'center')) {\n            this.plugins.video.setAlign.call(this, null, oFrame, cover, container);\n        }\n\n        let changed = true;\n        if (!isUpdate) {\n            changed = this.insertComponent(container, false, true, !this.options.mediaAutoSelect);\n            if (!this.options.mediaAutoSelect) {\n                const line = this.appendFormatTag(container, null);\n                if (line) this.setRange(line, 0, line, 0);\n            }\n        } else if (contextVideo._resizing && this.context.resizing._rotateVertical && changeSize) {\n            this.plugins.resizing.setTransformSize.call(this, oFrame, null, null);\n        }\n\n        if (changed) {\n            if (init) {\n                this.plugins.fileManager.setInfo.call(this, 'video', oFrame, this.functions.onVideoUpload, file, true);\n            }\n            if (isUpdate) {\n                this.selectComponent(oFrame, 'video');\n                // history stack\n                this.history.push(false);\n            }\n        }\n\n        this.context.resizing._resize_plugin = '';\n    },\n\n    _update_videoCover: function (oFrame) {\n        if (!oFrame) return;\n\n        const contextVideo = this.context.video;\n        \n        if (/^video$/i.test(oFrame.nodeName)) this.plugins.video._setTagAttrs.call(this, oFrame);\n        else this.plugins.video._setIframeAttrs.call(this, oFrame);\n        \n        let existElement = (this.util.isRangeFormatElement(oFrame.parentNode) || this.util.isWysiwygDiv(oFrame.parentNode)) ? \n            oFrame : this.util.getFormatElement(oFrame) || oFrame;\n\n        const prevFrame = oFrame;\n        contextVideo._element = oFrame = oFrame.cloneNode(true);\n        const cover = contextVideo._cover = this.plugins.component.set_cover.call(this, oFrame);\n        const container = contextVideo._container = this.plugins.component.set_container.call(this, cover, 'se-video-container');\n\n        try {\n            const figcaption = existElement.querySelector('figcaption');\n            let caption = null;\n            if (!!figcaption) {\n                caption = this.util.createElement('DIV');\n                caption.innerHTML = figcaption.innerHTML;\n                this.util.removeItem(figcaption);\n            }\n\n            // size\n            const size = (oFrame.getAttribute('data-size') || oFrame.getAttribute('data-origin') || '').split(',');\n            this.plugins.video.applySize.call(this, (size[0] || prevFrame.style.width || prevFrame.width || ''), (size[1] || prevFrame.style.height || prevFrame.height || ''));\n\n            // align\n            const format = this.util.getFormatElement(prevFrame);\n            if (format) contextVideo._align = format.style.textAlign || format.style.float;\n            this.plugins.video.setAlign.call(this, null, oFrame, cover, container);\n\n            if (this.util.isListCell(existElement)) {\n                const refer = this.util.getParentElement(prevFrame, function (current) { return current.parentNode === existElement; });\n                existElement.insertBefore(container, refer);\n                this.util.removeItem(prevFrame);\n                this.util.removeEmptyNode(refer, null);\n            } else if (this.util.isFormatElement(existElement)) {\n                const refer = this.util.getParentElement(prevFrame, function (current) { return current.parentNode === existElement; });\n                existElement = this.util.splitElement(existElement, refer);\n                existElement.parentNode.insertBefore(container, existElement);\n                this.util.removeItem(prevFrame);\n                this.util.removeEmptyNode(existElement, null);\n                if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n            } else {\n                existElement.parentNode.replaceChild(container, existElement);\n            }\n\n            if (!!caption) existElement.parentNode.insertBefore(caption, container.nextElementSibling);\n        } catch (error) {\n            console.warn('[SUNEDITOR.video.error] Maybe the video tag is nested.', error);\n        }\n\n        this.plugins.fileManager.setInfo.call(this, 'video', oFrame, this.functions.onVideoUpload, null, true);\n        this.plugins.video.init.call(this);\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    onModifyMode: function (element, size) {\n        const contextVideo = this.context.video;\n        contextVideo._element = element;\n        contextVideo._cover = this.util.getParentElement(element, 'FIGURE');\n        contextVideo._container = this.util.getParentElement(element, this.util.isMediaComponent);\n        contextVideo._align = element.style.float || element.getAttribute('data-align') || 'none';\n        element.style.float = '';\n\n        if (size) {\n            contextVideo._element_w = size.w;\n            contextVideo._element_h = size.h;\n            contextVideo._element_t = size.t;\n            contextVideo._element_l = size.l;\n        }\n\n        let origin = contextVideo._element.getAttribute('data-size') || contextVideo._element.getAttribute('data-origin');\n        let w, h;\n        if (origin) {\n            origin = origin.split(',');\n            w = origin[0];\n            h = origin[1];\n        } else if (size) {\n            w = size.w;\n            h = size.h;\n        }\n\n        contextVideo._origin_w = w || element.style.width || element.width || '';\n        contextVideo._origin_h = h || element.style.height || element.height || '';\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    openModify: function (notOpen) {\n        const contextVideo = this.context.video;\n\n        if (contextVideo.videoUrlFile) contextVideo._linkValue = contextVideo.preview.textContent = contextVideo.videoUrlFile.value = (contextVideo._element.src || (contextVideo._element.querySelector('source') || '').src || '');\n        (contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"][value=\"' + contextVideo._align + '\"]') || contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"][value=\"none\"]')).checked = true;\n\n        if (contextVideo._resizing) {\n            this.plugins.resizing._module_setModifyInputSize.call(this, contextVideo, this.plugins.video);\n            \n            const y = contextVideo._videoRatio = this.plugins.resizing._module_getSizeY.call(this, contextVideo);\n            const ratioSelected = this.plugins.video.setVideoRatioSelect.call(this, y);\n            if (!ratioSelected) contextVideo.inputY.value = contextVideo._onlyPercentage ? this.util.getNumber(y, 2) : y;\n        }\n\n        if (!notOpen) this.plugins.dialog.open.call(this, 'video', true);\n    },\n    \n    setVideoRatioSelect: function (value) {\n        let ratioSelected = false;\n        const contextVideo = this.context.video;\n        const ratioOptions = contextVideo.videoRatioOption.options;\n\n        if (/%$/.test(value) || contextVideo._onlyPercentage) value = (this.util.getNumber(value, 2) / 100) + '';\n        else if (!this.util.isNumber(value) || (value * 1) >= 1) value = '';\n\n        contextVideo.inputY.placeholder = '';\n        for (let i = 0, len = ratioOptions.length; i < len; i++) {\n            if (ratioOptions[i].value === value) {\n                ratioSelected = ratioOptions[i].selected = true;\n                contextVideo.inputY.placeholder = !value ? '' : (value * 100) + '%';\n            }\n            else ratioOptions[i].selected = false;\n        }\n\n        return ratioSelected;\n    },\n\n    /**\n     * @Override fileManager\n     */\n    checkFileInfo: function () {\n        this.plugins.fileManager.checkInfo.call(this, 'video', ['iframe', 'video'], this.functions.onVideoUpload, this.plugins.video._update_videoCover.bind(this), true);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    resetFileInfo: function () {\n        this.plugins.fileManager.resetInfo.call(this, 'video', this.functions.onVideoUpload);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    applySize: function (w, h) {\n        const contextVideo = this.context.video;\n\n        if (!w) w = contextVideo.inputX.value || this.options.videoWidth;\n        if (!h) h = contextVideo.inputY.value || this.options.videoHeight;\n        \n        if (contextVideo._onlyPercentage || /%$/.test(w) || !w) {\n            this.plugins.video.setPercentSize.call(this, (w || '100%'), (h || (/%$/.test(contextVideo._videoRatio) ? contextVideo._videoRatio : contextVideo._defaultRatio)));\n            return true;\n        } else if ((!w || w === 'auto') && (!h || h === 'auto')) {\n            this.plugins.video.setAutoSize.call(this);\n        } else {\n            this.plugins.video.setSize.call(this, w, (h || contextVideo._videoRatio || contextVideo._defaultRatio), false);\n        }\n\n        return false;\n    },\n\n    /**\n     * @Override resizing\n     */\n    sizeRevert: function () {\n        this.plugins.resizing._module_sizeRevert.call(this, this.context.video);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setSize: function (w, h, notResetPercentage, direction) {\n        const contextVideo = this.context.video;\n        const onlyW = /^(rw|lw)$/.test(direction);\n        const onlyH = /^(th|bh)$/.test(direction);\n\n        if (!onlyH) w = this.util.getNumber(w, 0);\n        if (!onlyW) h = this.util.isNumber(h) ? h + contextVideo.sizeUnit : !h ? '' : h;\n        w = w ? w + contextVideo.sizeUnit : '';\n\n        if (!onlyH) contextVideo._element.style.width = w;\n        if (!onlyW) contextVideo._cover.style.paddingBottom = contextVideo._cover.style.height = h;\n\n        if (!onlyH && !/%$/.test(w)) {\n            contextVideo._cover.style.width = w;\n            contextVideo._container.style.width = '';\n        }\n\n        if (!onlyW && !/%$/.test(h)) {\n            contextVideo._element.style.height = h;\n        } else {\n            contextVideo._element.style.height = '';\n        }\n\n        if (!notResetPercentage) contextVideo._element.removeAttribute('data-percentage');\n\n        // save current size\n        this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setAutoSize: function () {\n        this.plugins.video.setPercentSize.call(this, 100, this.context.video._defaultRatio);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setOriginSize: function (dataSize) {\n        const contextVideo = this.context.video;\n        contextVideo._element.removeAttribute('data-percentage');\n\n        this.plugins.resizing.resetTransform.call(this, contextVideo._element);\n        this.plugins.video.cancelPercentAttr.call(this);\n\n        const originSize = ((dataSize ? contextVideo._element.getAttribute('data-size') : '') || contextVideo._element.getAttribute('data-origin') || '').split(',');\n        \n        if (originSize) {\n            const w = originSize[0];\n            const h = originSize[1];\n\n            if (contextVideo._onlyPercentage || (/%$/.test(w) && (/%$/.test(h) || !/\\d/.test(h)))) {\n                this.plugins.video.setPercentSize.call(this, w, h);\n            } else {\n                this.plugins.video.setSize.call(this, w, h);\n            }\n\n            // save current size\n            this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n        }\n    },\n\n    /**\n     * @Override resizing\n     */\n    setPercentSize: function (w, h) {\n        const contextVideo = this.context.video;\n        h = !!h && !/%$/.test(h) && !this.util.getNumber(h, 0) ? this.util.isNumber(h) ? h + '%' : h : this.util.isNumber(h) ? h + contextVideo.sizeUnit : (h || contextVideo._defaultRatio);\n\n        contextVideo._container.style.width = this.util.isNumber(w) ? w + '%' : w;\n        contextVideo._container.style.height = '';\n        contextVideo._cover.style.width = '100%';\n        contextVideo._cover.style.height = h;\n        contextVideo._cover.style.paddingBottom = h;\n        contextVideo._element.style.width = '100%';\n        contextVideo._element.style.height = '100%';\n        contextVideo._element.style.maxWidth = '';\n\n        if (contextVideo._align === 'center') this.plugins.video.setAlign.call(this, null, null, null, null);\n        contextVideo._element.setAttribute('data-percentage', w + ',' + h);\n\n        // save current size\n        this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n    },\n\n    /**\n     * @Override resizing\n     */\n    cancelPercentAttr: function () {\n        const contextVideo = this.context.video;\n        \n        contextVideo._cover.style.width = '';\n        contextVideo._cover.style.height = '';\n        contextVideo._cover.style.paddingBottom = '';\n        contextVideo._container.style.width = '';\n        contextVideo._container.style.height = '';\n\n        this.util.removeClass(contextVideo._container, this.context.video._floatClassRegExp);\n        this.util.addClass(contextVideo._container, '__se__float-' + contextVideo._align);\n\n        if (contextVideo._align === 'center') this.plugins.video.setAlign.call(this, null, null, null, null);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setAlign: function (align, element, cover, container) {\n        const contextVideo = this.context.video;\n        \n        if (!align) align = contextVideo._align;\n        if (!element) element = contextVideo._element;\n        if (!cover) cover = contextVideo._cover;\n        if (!container) container = contextVideo._container;\n\n        if (align && align !== 'none') {\n            cover.style.margin = 'auto';\n        } else {\n            cover.style.margin = '0';\n        }\n\n        if (/%$/.test(element.style.width) && align === 'center') {\n            container.style.minWidth = '100%';\n            cover.style.width = container.style.width;\n            cover.style.height = cover.style.height;\n            cover.style.paddingBottom = !/%$/.test(cover.style.height) ? cover.style.height : this.util.getNumber((this.util.getNumber(cover.style.height, 2) / 100) * this.util.getNumber(cover.style.width, 2), 2) + '%';\n        } else {\n            container.style.minWidth = '';\n            cover.style.width = this.context.resizing._rotateVertical ? (element.style.height || element.offsetHeight) : (element.style.width || '100%');\n            cover.style.paddingBottom = cover.style.height;\n        }\n\n        if (!this.util.hasClass(container, '__se__float-' + align)) {\n            this.util.removeClass(container, contextVideo._floatClassRegExp);\n            this.util.addClass(container, '__se__float-' + align);\n        }\n        \n        element.setAttribute('data-align', align);\n    },\n\n    /**\n     * @Override dialog\n     */\n    init: function () {\n        const contextVideo = this.context.video;\n        if (contextVideo.videoInputFile) contextVideo.videoInputFile.value = '';\n        if (contextVideo.videoUrlFile) contextVideo._linkValue = contextVideo.preview.textContent = contextVideo.videoUrlFile.value = '';\n        if (contextVideo.videoInputFile && contextVideo.videoUrlFile) {\n            contextVideo.videoUrlFile.removeAttribute('disabled');\n            contextVideo.preview.style.textDecoration = '';\n        }\n\n        contextVideo._origin_w = this.options.videoWidth;\n        contextVideo._origin_h = this.options.videoHeight;\n        contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"][value=\"none\"]').checked = true;\n        \n        if (contextVideo._resizing) {\n            contextVideo.inputX.value = this.options.videoWidth === contextVideo._defaultSizeX ? '' : this.options.videoWidth;\n            contextVideo.inputY.value = this.options.videoHeight === contextVideo._defaultSizeY ? '' : this.options.videoHeight;\n            contextVideo.proportion.checked = true;\n            contextVideo.proportion.disabled = true;\n            this.plugins.video.setVideoRatioSelect.call(this, contextVideo._defaultRatio);\n        }\n    }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}