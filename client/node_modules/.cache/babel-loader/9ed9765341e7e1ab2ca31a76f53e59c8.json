{"ast":null,"code":"/*\r\n * wysiwyg web editor\r\n *\r\n * suneditor.js\r\n * Copyright 2017 JiHong Lee.\r\n * MIT license.\r\n */\n'use strict';\n\nimport _Constructor from './constructor';\nimport _Context from './context';\nimport _history from './history';\nimport _util from './util';\nimport _notice from '../plugins/modules/_notice';\n/**\r\n * @description SunEditor constuctor function.\r\n * create core object and event registration.\r\n * core, event, functions\r\n * @param {Object} context\r\n * @param {Object} pluginCallButtons\r\n * @param {Object} plugins \r\n * @param {Object} lang\r\n * @param {Object} options\r\n * @param {Object} _responsiveButtons\r\n * @returns {Object} functions Object\r\n */\n\nexport default function (context, pluginCallButtons, plugins, lang, options, _responsiveButtons) {\n  var _d = context.element.originElement.ownerDocument || document;\n\n  var _w = _d.defaultView || window;\n\n  var util = _util;\n  var icons = options.icons;\n  /**\r\n   * @description editor core object\r\n   * should always bind this object when registering an event in the plug-in.\r\n   */\n\n  var core = {\n    _d: _d,\n    _w: _w,\n    _parser: new _w.DOMParser(),\n    _prevRtl: options.rtl,\n    _editorHeight: 0,\n    _editorHeightPadding: 0,\n    _listCamel: options.__listCommonStyle,\n    _listKebab: util.camelToKebabCase(options.__listCommonStyle),\n\n    /**\r\n     * @description Document object of the iframe if created as an iframe || _d\r\n     * @private\r\n     */\n    _wd: null,\n\n    /**\r\n     * @description Window object of the iframe if created as an iframe || _w\r\n     * @private\r\n     */\n    _ww: null,\n\n    /**\r\n     * @description Closest ShadowRoot to editor if found\r\n     * @private\r\n     */\n    _shadowRoot: null,\n\n    /**\r\n     * @description Block controller mousedown events in \"shadowRoot\" environment\r\n     * @private\r\n     */\n    _shadowRootControllerEventTarget: null,\n\n    /**\r\n     * @description Util object\r\n     */\n    util: util,\n\n    /**\r\n     * @description Functions object\r\n     */\n    functions: null,\n\n    /**\r\n     * @description Editor options\r\n     */\n    options: null,\n\n    /**\r\n     * @description Computed style of the wysiwyg area (window.getComputedStyle(context.element.wysiwyg))\r\n     */\n    wwComputedStyle: null,\n\n    /**\r\n     * @description Notice object\r\n     */\n    notice: _notice,\n\n    /**\r\n     * @description Default icons object\r\n     */\n    icons: icons,\n\n    /**\r\n     * @description History object for undo, redo\r\n     */\n    history: null,\n\n    /**\r\n     * @description Elements and user options parameters of the suneditor\r\n     */\n    context: context,\n\n    /**\r\n     * @description Plugin buttons\r\n     */\n    pluginCallButtons: pluginCallButtons,\n\n    /**\r\n     * @description Loaded plugins\r\n     */\n    plugins: plugins || {},\n\n    /**\r\n     * @description Whether the plugin is initialized\r\n     */\n    initPlugins: {},\n\n    /**\r\n     * @description Object for managing submenu elements\r\n     * @private\r\n     */\n    _targetPlugins: {},\n\n    /**\r\n     * @description Save rendered submenus and containers\r\n     * @private\r\n     */\n    _menuTray: {},\n\n    /**\r\n     * @description loaded language\r\n     */\n    lang: lang,\n\n    /**\r\n     * @description The selection node (core.getSelectionNode()) to which the effect was last applied\r\n     */\n    effectNode: null,\n\n    /**\r\n     * @description submenu element\r\n     */\n    submenu: null,\n\n    /**\r\n     * @description container element\r\n     */\n    container: null,\n\n    /**\r\n     * @description current subment name\r\n     * @private\r\n     */\n    _submenuName: '',\n\n    /**\r\n     * @description binded submenuOff method\r\n     * @private\r\n     */\n    _bindedSubmenuOff: null,\n\n    /**\r\n     * @description binded containerOff method\r\n     * @private\r\n     */\n    _bindedContainerOff: null,\n\n    /**\r\n     * @description active button element in submenu\r\n     */\n    submenuActiveButton: null,\n\n    /**\r\n     * @description active button element in container\r\n     */\n    containerActiveButton: null,\n\n    /**\r\n     * @description The elements array to be processed unvisible when the controllersOff function is executed (resizing, link modified button, table controller)\r\n     */\n    controllerArray: [],\n\n    /**\r\n     * @description The name of the plugin that called the currently active controller\r\n     */\n    currentControllerName: '',\n\n    /**\r\n     * @description The target element of current controller\r\n     */\n    currentControllerTarget: null,\n\n    /**\r\n     * @description The file component object of current selected file tag (getFileComponent)\r\n     */\n    currentFileComponentInfo: null,\n\n    /**\r\n     * @description An array of buttons whose class name is not \"se-code-view-enabled\"\r\n     */\n    codeViewDisabledButtons: [],\n\n    /**\r\n     * @description An array of buttons whose class name is not \"se-resizing-enabled\"\r\n     */\n    resizingDisabledButtons: [],\n\n    /**\r\n     * @description active more layer element in submenu\r\n     * @private\r\n     */\n    _moreLayerActiveButton: null,\n\n    /**\r\n     * @description Tag whitelist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n     * ^(options._editorTagsWhitelist)$\r\n     * @private\r\n     */\n    _htmlCheckWhitelistRegExp: null,\n\n    /**\r\n     * @description Tag blacklist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n     * @private\r\n     */\n    _htmlCheckBlacklistRegExp: null,\n\n    /**\r\n     * @description RegExp when using check disallowd tags. (b, i, ins, strike, s)\r\n     * @private\r\n     */\n    _disallowedTextTagsRegExp: null,\n\n    /**\r\n     * @description Editor tags whitelist (RegExp object)\r\n     * util.createTagsWhitelist(options._editorTagsWhitelist)\r\n     */\n    editorTagsWhitelistRegExp: null,\n\n    /**\r\n     * @description Editor tags blacklist (RegExp object)\r\n     * util.createTagsBlacklist(options.tagsBlacklist)\r\n     */\n    editorTagsBlacklistRegExp: null,\n\n    /**\r\n     * @description Tag whitelist when pasting (RegExp object)\r\n     * util.createTagsWhitelist(options.pasteTagsWhitelist)\r\n     */\n    pasteTagsWhitelistRegExp: null,\n\n    /**\r\n     * @description Tag blacklist when pasting (RegExp object)\r\n     * util.createTagsBlacklist(options.pasteTagsBlacklist)\r\n     */\n    pasteTagsBlacklistRegExp: null,\n\n    /**\r\n     * @description Boolean value of whether the editor has focus\r\n     */\n    hasFocus: false,\n\n    /**\r\n     * @description Boolean value of whether the editor is disabled\r\n     */\n    isDisabled: false,\n\n    /**\r\n     * @description Boolean value of whether the editor is readOnly\r\n     */\n    isReadOnly: false,\n\n    /**\r\n     * @description Attributes whitelist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesWhitelistRegExp: null,\n    _attributesWhitelistRegExp_all_data: null,\n\n    /**\r\n     * @description Attributes blacklist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesBlacklistRegExp: null,\n\n    /**\r\n     * @description Attributes of tags whitelist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesTagsWhitelist: null,\n\n    /**\r\n     * @description Attributes of tags blacklist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesTagsBlacklist: null,\n\n    /**\r\n     * @description binded controllersOff method\r\n     * @private\r\n     */\n    _bindControllersOff: null,\n\n    /**\r\n     * @description Is inline mode?\r\n     * @private\r\n     */\n    _isInline: null,\n\n    /**\r\n     * @description Is balloon|balloon-always mode?\r\n     * @private\r\n     */\n    _isBalloon: null,\n\n    /**\r\n     * @description Is balloon-always mode?\r\n     * @private\r\n     */\n    _isBalloonAlways: null,\n\n    /**\r\n     * @description Required value when using inline mode to sticky toolbar\r\n     * @private\r\n     */\n    _inlineToolbarAttr: {\n      top: '',\n      width: '',\n      isShow: false\n    },\n\n    /**\r\n     * @description Variable that controls the \"blur\" event in the editor of inline or balloon mode when the focus is moved to submenu\r\n     * @private\r\n     */\n    _notHideToolbar: false,\n\n    /**\r\n     * @description Variable value that sticky toolbar mode\r\n     * @private\r\n     */\n    _sticky: false,\n\n    /**\r\n     * @description Variables for controlling focus and blur events\r\n     * @private\r\n     */\n    _antiBlur: false,\n\n    /**\r\n     * @description Component line breaker element\r\n     * @private\r\n     */\n    _lineBreaker: null,\n    _lineBreakerButton: null,\n\n    /**\r\n     * @description If true, (initialize, reset) all indexes of image, video information\r\n     * @private\r\n     */\n    _componentsInfoInit: true,\n    _componentsInfoReset: false,\n\n    /**\r\n     * @description Plugins array with \"active\" method.\r\n     * \"activePlugins\" runs the \"add\" method when creating the editor.\r\n     */\n    activePlugins: null,\n\n    /**\r\n     * @description Information of tags that should maintain HTML structure, style, class name, etc. (In use by \"math\" plugin)\r\n     * When inserting \"html\" such as paste, it is executed on the \"html\" to be inserted. (core.cleanHTML)\r\n     * Basic Editor Actions:\r\n     * 1. All classes not starting with \"__se__\" or \"se-\" in the editor are removed.\r\n     * 2. The style of all tags except the \"span\" tag is removed from the editor.\r\n     * \"managedTagsInfo\" structure ex:\r\n     * managedTagsInfo: {\r\n     *   query: '.__se__xxx, se-xxx'\r\n     *   map: {\r\n     *     '__se__xxx': method.bind(core),\r\n     *     'se-xxx': method.bind(core),\r\n     *   }\r\n     * }\r\n     * @example\r\n     * Define in the following return format in the \"managedTagInfo\" function of the plugin.\r\n     * managedTagInfo() => {\r\n     *  return {\r\n     *    className: 'string', // Class name to identify the tag. (\"__se__xxx\", \"se-xxx\")\r\n     *    // Change the html of the \"element\". (\"element\" is the element found with \"className\".)\r\n     *    // \"method\" is executed by binding \"core\".\r\n     *    method: function (element) {\r\n     *      // this === core\r\n     *      element.innerHTML = // (rendered html);\r\n     *    }\r\n     *  }\r\n     * }\r\n     */\n    managedTagsInfo: null,\n\n    /**\r\n     * @description cashing: options.charCounterType === 'byte-html'\r\n     * @private\r\n     */\n    _charTypeHTML: false,\n\n    /**\r\n     * @description Array of \"checkFileInfo\" functions with the core bound\r\n     * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n     * \"fileInfoPlugins\" runs the \"add\" method when creating the editor.\r\n     * \"checkFileInfo\" method is always call just before the \"change\" event.\r\n     * @private\r\n     */\n    _fileInfoPluginsCheck: null,\n\n    /**\r\n     * @description Array of \"resetFileInfo\" functions with the core bound\r\n     * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n     * \"checkFileInfo\" method is always call just before the \"functions.setOptions\" method.\r\n     * @private\r\n     */\n    _fileInfoPluginsReset: null,\n\n    /**\r\n     * @description Variables for file component management\r\n     * @private\r\n     */\n    _fileManager: {\n      tags: null,\n      regExp: null,\n      queryString: null,\n      pluginRegExp: null,\n      pluginMap: null\n    },\n\n    /**\r\n     * @description Elements that need to change text or className for each selection change\r\n     * After creating the editor, \"activePlugins\" are added.\r\n     * @property {Element} STRONG bold button\r\n     * @property {Element} U underline button\r\n     * @property {Element} EM italic button\r\n     * @property {Element} DEL strike button\r\n     * @property {Element} SUB subscript button\r\n     * @property {Element} SUP superscript button\r\n     * @property {Element} OUTDENT outdent button\r\n     * @property {Element} INDENT indent button\r\n     */\n    commandMap: null,\n\n    /**\r\n     * @description CSS properties related to style tags \r\n     * @private\r\n     */\n    _commandMapStyles: {\n      STRONG: ['font-weight'],\n      U: ['text-decoration'],\n      EM: ['font-style'],\n      DEL: ['text-decoration']\n    },\n\n    /**\r\n     * @description Style button related to edit area\r\n     * @property {Element} fullScreen fullScreen button element\r\n     * @property {Element} showBlocks showBlocks button element\r\n     * @property {Element} codeView codeView button element\r\n     * @private\r\n     */\n    _styleCommandMap: null,\n\n    /**\r\n     * @private\r\n     */\n    _cleanStyleRegExp: {\n      span: new _w.RegExp('\\\\s*[^-a-zA-Z](font-family|font-size|color|background-color)\\\\s*:[^;]+(?!;)*', 'ig'),\n      format: new _w.RegExp('\\\\s*[^-a-zA-Z](text-align|margin-left|margin-right)\\\\s*:[^;]+(?!;)*', 'ig'),\n      fontSizeUnit: new _w.RegExp('\\\\d+' + options.fontSizeUnit + '$', 'i')\n    },\n\n    /**\r\n     * @description Variables used internally in editor operation\r\n     * @property {Boolean} isCodeView State of code view\r\n     * @property {Boolean} isFullScreen State of full screen\r\n     * @property {Number} innerHeight_fullScreen InnerHeight in editor when in full screen\r\n     * @property {Number} resizeClientY Remember the vertical size of the editor before resizing the editor (Used when calculating during resize operation)\r\n     * @property {Number} tabSize Indent size of tab (4)\r\n     * @property {Number} codeIndent Indent size of Code view mode (2)\r\n     * @property {Number} minResizingSize Minimum size of editing area when resized {Number} (.se-wrapper-inner {min-height: 65px;} || 65)\r\n     * @property {Array} currentNodes  An array of the current cursor's node structure\r\n     * @private\r\n     */\n    _variable: {\n      isChanged: false,\n      isCodeView: false,\n      isFullScreen: false,\n      innerHeight_fullScreen: 0,\n      resizeClientY: 0,\n      tabSize: 4,\n      codeIndent: 2,\n      minResizingSize: util.getNumber(context.element.wysiwygFrame.style.minHeight || '65', 0),\n      currentNodes: [],\n      currentNodesMap: [],\n      _range: null,\n      _selectionNode: null,\n      _originCssText: context.element.topArea.style.cssText,\n      _bodyOverflow: '',\n      _editorAreaOriginCssText: '',\n      _wysiwygOriginCssText: '',\n      _codeOriginCssText: '',\n      _fullScreenAttrs: {\n        sticky: false,\n        balloon: false,\n        inline: false\n      },\n      _lineBreakComp: null,\n      _lineBreakDir: ''\n    },\n\n    /**\r\n     * @description Save the current buttons states to \"allCommandButtons\" object\r\n     * @private\r\n     */\n    _saveButtonStates: function _saveButtonStates() {\n      if (!this.allCommandButtons) this.allCommandButtons = {};\n\n      var currentButtons = this.context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]');\n\n      for (var i = 0, element, command; i < currentButtons.length; i++) {\n        element = currentButtons[i];\n        command = element.getAttribute('data-command');\n        this.allCommandButtons[command] = element;\n      }\n    },\n\n    /**\r\n     * @description Recover the current buttons states from \"allCommandButtons\" object\r\n     * @private\r\n     */\n    _recoverButtonStates: function _recoverButtonStates() {\n      if (this.allCommandButtons) {\n        var currentButtons = this.context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]');\n\n        for (var i = 0, button, command, oldButton; i < currentButtons.length; i++) {\n          button = currentButtons[i];\n          command = button.getAttribute('data-command');\n          oldButton = this.allCommandButtons[command];\n\n          if (oldButton) {\n            button.parentElement.replaceChild(oldButton, button);\n            if (this.context.tool[command]) this.context.tool[command] = oldButton;\n          }\n        }\n      }\n    },\n\n    /**\r\n     * @description If the plugin is not added, add the plugin and call the 'add' function.\r\n     * If the plugin is added call callBack function.\r\n     * @param {String} pluginName The name of the plugin to call\r\n     * @param {function} callBackFunction Function to be executed immediately after module call\r\n     * @param {Element|null} _target Plugin target button (This is not necessary if you have a button list when creating the editor)\r\n     */\n    callPlugin: function callPlugin(pluginName, callBackFunction, _target) {\n      _target = _target || pluginCallButtons[pluginName];\n\n      if (!this.plugins[pluginName]) {\n        throw Error('[SUNEDITOR.core.callPlugin.fail] The called plugin does not exist or is in an invalid format. (pluginName:\"' + pluginName + '\")');\n      } else if (!this.initPlugins[pluginName]) {\n        this.plugins[pluginName].add(this, _target);\n        this.initPlugins[pluginName] = true;\n      } else if (typeof this._targetPlugins[pluginName] === 'object' && !!_target) {\n        this.initMenuTarget(pluginName, _target, this._targetPlugins[pluginName]);\n      }\n\n      if (this.plugins[pluginName].active && !this.commandMap[pluginName] && !!_target) {\n        this.commandMap[pluginName] = _target;\n        this.activePlugins.push(pluginName);\n      }\n\n      if (typeof callBackFunction === 'function') callBackFunction();\n    },\n\n    /**\r\n     * @description If the module is not added, add the module and call the 'add' function\r\n     * @param {Array} moduleArray module object's Array [dialog, resizing]\r\n     */\n    addModule: function addModule(moduleArray) {\n      for (var i = 0, len = moduleArray.length, moduleName; i < len; i++) {\n        moduleName = moduleArray[i].name;\n\n        if (!this.plugins[moduleName]) {\n          this.plugins[moduleName] = moduleArray[i];\n        }\n\n        if (!this.initPlugins[moduleName]) {\n          this.initPlugins[moduleName] = true;\n          if (typeof this.plugins[moduleName].add === 'function') this.plugins[moduleName].add(this);\n        }\n      }\n    },\n\n    /**\r\n     * @description Gets the current editor-relative scroll offset.\r\n     * @returns {Object} {top, left}\r\n     */\n    getGlobalScrollOffset: function getGlobalScrollOffset() {\n      var t = 0,\n          l = 0;\n      var el = context.element.topArea;\n\n      while (el) {\n        t += el.scrollTop;\n        l += el.scrollLeft;\n        el = el.parentElement;\n      }\n\n      el = this._shadowRoot ? this._shadowRoot.host : null;\n\n      while (el) {\n        t += el.scrollTop;\n        l += el.scrollLeft;\n        el = el.parentElement;\n      }\n\n      return {\n        top: t,\n        left: l\n      };\n    },\n\n    /**\r\n     * @description Method for managing submenu element.\r\n     * You must add the \"submenu\" element using the this method at custom plugin.\r\n     * @param {String} pluginName Plugin name\r\n     * @param {Element|null} target Target button\r\n     * @param {Element} menu Submenu element\r\n     */\n    initMenuTarget: function initMenuTarget(pluginName, target, menu) {\n      if (!target) {\n        this._targetPlugins[pluginName] = menu;\n      } else {\n        context.element._menuTray.appendChild(menu);\n\n        this._targetPlugins[pluginName] = true;\n        this._menuTray[target.getAttribute('data-command')] = menu;\n      }\n    },\n\n    /**\r\n     * @description Enable submenu\r\n     * @param {Element} element Submenu's button element to call\r\n     */\n    submenuOn: function submenuOn(element) {\n      if (this._bindedSubmenuOff) this._bindedSubmenuOff();\n      if (this._bindControllersOff) this.controllersOff();\n      var submenuName = this._submenuName = element.getAttribute('data-command');\n      var menu = this.submenu = this._menuTray[submenuName];\n      this.submenuActiveButton = element;\n\n      this._setMenuPosition(element, menu);\n\n      this._bindedSubmenuOff = this.submenuOff.bind(this);\n      this.addDocEvent('mousedown', this._bindedSubmenuOff, false);\n      if (this.plugins[submenuName].on) this.plugins[submenuName].on.call(this);\n      this._antiBlur = true;\n    },\n\n    /**\r\n     * @description Disable submenu\r\n     */\n    submenuOff: function submenuOff() {\n      this.removeDocEvent('mousedown', this._bindedSubmenuOff);\n      this._bindedSubmenuOff = null;\n\n      if (this.submenu) {\n        this._submenuName = '';\n        this.submenu.style.display = 'none';\n        this.submenu = null;\n        util.removeClass(this.submenuActiveButton, 'on');\n        this.submenuActiveButton = null;\n        this._notHideToolbar = false;\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Disable more layer\r\n     */\n    moreLayerOff: function moreLayerOff() {\n      if (this._moreLayerActiveButton) {\n        var layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\n        layer.style.display = 'none';\n        util.removeClass(this._moreLayerActiveButton, 'on');\n        this._moreLayerActiveButton = null;\n      }\n    },\n\n    /**\r\n     * @description Enable container\r\n     * @param {Element} element Container's button element to call\r\n     */\n    containerOn: function containerOn(element) {\n      if (this._bindedContainerOff) this._bindedContainerOff();\n      var containerName = this._containerName = element.getAttribute('data-command');\n      var menu = this.container = this._menuTray[containerName];\n      this.containerActiveButton = element;\n\n      this._setMenuPosition(element, menu);\n\n      this._bindedContainerOff = this.containerOff.bind(this);\n      this.addDocEvent('mousedown', this._bindedContainerOff, false);\n      if (this.plugins[containerName].on) this.plugins[containerName].on.call(this);\n      this._antiBlur = true;\n    },\n\n    /**\r\n     * @description Disable container\r\n     */\n    containerOff: function containerOff() {\n      this.removeDocEvent('mousedown', this._bindedContainerOff);\n      this._bindedContainerOff = null;\n\n      if (this.container) {\n        this._containerName = '';\n        this.container.style.display = 'none';\n        this.container = null;\n        util.removeClass(this.containerActiveButton, 'on');\n        this.containerActiveButton = null;\n        this._notHideToolbar = false;\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Set the menu position. (submenu, container)\r\n     * @param {*} element Button element\r\n     * @param {*} menu Menu element\r\n     * @private\r\n     */\n    _setMenuPosition: function _setMenuPosition(element, menu) {\n      menu.style.visibility = 'hidden';\n      menu.style.display = 'block';\n      menu.style.height = '';\n      util.addClass(element, 'on');\n      var toolbar = this.context.element.toolbar;\n      var toolbarW = toolbar.offsetWidth;\n\n      var toolbarOffset = event._getEditorOffsets(context.element.toolbar);\n\n      var menuW = menu.offsetWidth;\n      var l = element.parentElement.offsetLeft + 3; // rtl\n\n      if (options.rtl) {\n        var elementW = element.offsetWidth;\n        var rtlW = menuW > elementW ? menuW - elementW : 0;\n        var rtlL = rtlW > 0 ? 0 : elementW - menuW;\n        menu.style.left = l - rtlW + rtlL + 'px';\n\n        if (toolbarOffset.left > event._getEditorOffsets(menu).left) {\n          menu.style.left = '0px';\n        }\n      } else {\n        var overLeft = toolbarW <= menuW ? 0 : toolbarW - (l + menuW);\n        if (overLeft < 0) menu.style.left = l + overLeft + 'px';else menu.style.left = l + 'px';\n      } // get element top\n\n\n      var t = 0;\n      var offsetEl = element;\n\n      while (offsetEl && offsetEl !== toolbar) {\n        t += offsetEl.offsetTop;\n        offsetEl = offsetEl.offsetParent;\n      }\n\n      var bt = t;\n\n      if (this._isBalloon) {\n        t += toolbar.offsetTop + element.offsetHeight;\n      } else {\n        t -= element.offsetHeight;\n      } // set menu position\n\n\n      var toolbarTop = toolbarOffset.top;\n      var menuHeight = menu.offsetHeight;\n      var scrollTop = this.getGlobalScrollOffset().top;\n      var menuHeight_bottom = _w.innerHeight - (toolbarTop - scrollTop + bt + element.parentElement.offsetHeight);\n\n      if (menuHeight_bottom < menuHeight) {\n        var menuTop = -1 * (menuHeight - bt + 3);\n        var insTop = toolbarTop - scrollTop + menuTop;\n        var menuHeight_top = menuHeight + (insTop < 0 ? insTop : 0);\n\n        if (menuHeight_top > menuHeight_bottom) {\n          menu.style.height = menuHeight_top + 'px';\n          menuTop = -1 * (menuHeight_top - bt + 3);\n        } else {\n          menu.style.height = menuHeight_bottom + 'px';\n          menuTop = bt + element.parentElement.offsetHeight;\n        }\n\n        menu.style.top = menuTop + 'px';\n      } else {\n        menu.style.top = bt + element.parentElement.offsetHeight + 'px';\n      }\n\n      menu.style.visibility = '';\n    },\n\n    /**\r\n     * @description Show controller at editor area (controller elements, function, \"controller target element(@Required)\", \"controller name(@Required)\", etc..)\r\n     * @param {*} arguments controller elements, functions..\r\n     */\n    controllersOn: function controllersOn() {\n      if (this._bindControllersOff) this._bindControllersOff();\n      this.controllerArray = [];\n\n      for (var i = 0, arg; i < arguments.length; i++) {\n        arg = arguments[i];\n        if (!arg) continue;\n\n        if (typeof arg === 'string') {\n          this.currentControllerName = arg;\n          continue;\n        }\n\n        if (typeof arg === 'function') {\n          this.controllerArray.push(arg);\n          continue;\n        }\n\n        if (!util.hasClass(arg, 'se-controller')) {\n          this.currentControllerTarget = arg;\n          this.currentFileComponentInfo = this.getFileComponent(arg);\n          continue;\n        }\n\n        if (arg.style) {\n          arg.style.display = 'block';\n\n          if (this._shadowRoot && this._shadowRootControllerEventTarget.indexOf(arg) === -1) {\n            arg.addEventListener('mousedown', function (e) {\n              e.preventDefault();\n              e.stopPropagation();\n            });\n\n            this._shadowRootControllerEventTarget.push(arg);\n          }\n        }\n\n        this.controllerArray.push(arg);\n      }\n\n      this._bindControllersOff = this.controllersOff.bind(this);\n      this.addDocEvent('mousedown', this._bindControllersOff, false);\n      this.addDocEvent('keydown', this._bindControllersOff, false);\n      this._antiBlur = true;\n      if (typeof functions.showController === 'function') functions.showController(this.currentControllerName, this.controllerArray, this);\n    },\n\n    /**\r\n     * @description Hide controller at editor area (link button, image resize button..)\r\n     * @param {KeyboardEvent|MouseEvent|null} e Event object when called from mousedown and keydown events registered in \"core.controllersOn\"\r\n     */\n    controllersOff: function controllersOff(e) {\n      this._lineBreaker.style.display = 'none';\n      var len = this.controllerArray.length;\n\n      if (e && e.target && len > 0) {\n        for (var i = 0; i < len; i++) {\n          if (typeof this.controllerArray[i].contains === 'function' && this.controllerArray[i].contains(e.target)) return;\n        }\n      }\n\n      if (this._fileManager.pluginRegExp.test(this.currentControllerName) && e && e.type === 'keydown' && e.keyCode !== 27) return;\n      context.element.lineBreaker_t.style.display = context.element.lineBreaker_b.style.display = 'none';\n      this._variable._lineBreakComp = null;\n      this.currentControllerName = '';\n      this.currentControllerTarget = null;\n      this.currentFileComponentInfo = null;\n      this.effectNode = null;\n      if (!this._bindControllersOff) return;\n      this.removeDocEvent('mousedown', this._bindControllersOff);\n      this.removeDocEvent('keydown', this._bindControllersOff);\n      this._bindControllersOff = null;\n\n      if (len > 0) {\n        for (var _i = 0; _i < len; _i++) {\n          if (typeof this.controllerArray[_i] === 'function') this.controllerArray[_i]();else this.controllerArray[_i].style.display = 'none';\n        }\n\n        this.controllerArray = [];\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Specify the position of the controller.\r\n     * @param {Element} controller Controller element.\r\n     * @param {Element} referEl Element that is the basis of the controller's position.\r\n     * @param {String} position Type of position (\"top\" | \"bottom\")\r\n     * When using the \"top\" position, there should not be an arrow on the controller.\r\n     * When using the \"bottom\" position there should be an arrow on the controller.\r\n     * @param {Object} addOffset These are the left and top values that need to be added specially. \r\n     * This argument is required. - {left: 0, top: 0}\r\n     * Please enter the value based on ltr mode.\r\n     * Calculated automatically in rtl mode.\r\n     */\n    setControllerPosition: function setControllerPosition(controller, referEl, position, addOffset) {\n      if (options.rtl) addOffset.left *= -1;\n      var offset = util.getOffset(referEl, context.element.wysiwygFrame);\n      controller.style.visibility = 'hidden';\n      controller.style.display = 'block'; // Height value of the arrow element is 11px\n\n      var topMargin = position === 'top' ? -(controller.offsetHeight + 2) : referEl.offsetHeight + 12;\n      controller.style.top = offset.top + topMargin + addOffset.top + 'px';\n      var l = offset.left - context.element.wysiwygFrame.scrollLeft + addOffset.left;\n      var controllerW = controller.offsetWidth;\n      var referElW = referEl.offsetWidth;\n      var allow = util.hasClass(controller.firstElementChild, 'se-arrow') ? controller.firstElementChild : null; // rtl (Width value of the arrow element is 22px)\n\n      if (options.rtl) {\n        var rtlW = controllerW > referElW ? controllerW - referElW : 0;\n        var rtlL = rtlW > 0 ? 0 : referElW - controllerW;\n        controller.style.left = l - rtlW + rtlL + 'px';\n\n        if (rtlW > 0) {\n          if (allow) allow.style.left = (controllerW - 14 < 10 + rtlW ? controllerW - 14 : 10 + rtlW) + 'px';\n        }\n\n        var overSize = context.element.wysiwygFrame.offsetLeft - controller.offsetLeft;\n\n        if (overSize > 0) {\n          controller.style.left = '0px';\n          if (allow) allow.style.left = overSize + 'px';\n        }\n      } else {\n        controller.style.left = l + 'px';\n\n        var _overSize = context.element.wysiwygFrame.offsetWidth - (controller.offsetLeft + controllerW);\n\n        if (_overSize < 0) {\n          controller.style.left = controller.offsetLeft + _overSize + 'px';\n          if (allow) allow.style.left = 20 - _overSize + 'px';\n        } else {\n          if (allow) allow.style.left = '20px';\n        }\n      }\n\n      controller.style.visibility = '';\n    },\n\n    /**\r\n     * @description javascript execCommand\r\n     * @param {String} command javascript execCommand function property\r\n     * @param {Boolean|undefined} showDefaultUI javascript execCommand function property\r\n     * @param {String|undefined} value javascript execCommand function property\r\n     */\n    execCommand: function execCommand(command, showDefaultUI, value) {\n      this._wd.execCommand(command, showDefaultUI, command === 'formatBlock' ? '<' + value + '>' : value); // history stack\n\n\n      this.history.push(true);\n    },\n\n    /**\r\n     * @description Focus to wysiwyg area using \"native focus function\"\r\n     */\n    nativeFocus: function nativeFocus() {\n      this.__focus();\n\n      this._editorRange();\n    },\n\n    /**\r\n     * @description Focus method\r\n     * @private\r\n     */\n    __focus: function __focus() {\n      var caption = util.getParentElement(this.getSelectionNode(), 'figcaption');\n\n      if (caption) {\n        caption.focus();\n      } else {\n        context.element.wysiwyg.focus();\n      }\n    },\n\n    /**\r\n     * @description Focus to wysiwyg area\r\n     */\n    focus: function focus() {\n      if (context.element.wysiwygFrame.style.display === 'none') return;\n\n      if (options.iframe) {\n        this.nativeFocus();\n      } else {\n        try {\n          var range = this.getRange();\n\n          if (range.startContainer === range.endContainer && util.isWysiwygDiv(range.startContainer)) {\n            var currentNode = range.commonAncestorContainer.children[range.startOffset];\n\n            if (!util.isFormatElement(currentNode) && !util.isComponent(currentNode)) {\n              var format = util.createElement(options.defaultTag);\n              var br = util.createElement('BR');\n              format.appendChild(br);\n              context.element.wysiwyg.insertBefore(format, currentNode);\n              this.setRange(br, 0, br, 0);\n              return;\n            }\n          }\n\n          this.setRange(range.startContainer, range.startOffset, range.endContainer, range.endOffset);\n        } catch (e) {\n          this.nativeFocus();\n        }\n      }\n\n      event._applyTagEffects();\n\n      if (this._isBalloon) event._toggleToolbarBalloon();\n    },\n\n    /**\r\n     * @description If \"focusEl\" is a component, then that component is selected; if it is a format element, the last text is selected\r\n     * If \"focusEdge\" is null, then selected last element\r\n     * @param {Element|null} focusEl Focus element\r\n     */\n    focusEdge: function focusEdge(focusEl) {\n      if (!focusEl) focusEl = context.element.wysiwyg.lastElementChild;\n      var fileComponentInfo = this.getFileComponent(focusEl);\n\n      if (fileComponentInfo) {\n        this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n      } else if (focusEl) {\n        focusEl = util.getChildElement(focusEl, function (current) {\n          return current.childNodes.length === 0 || current.nodeType === 3;\n        }, true);\n        if (!focusEl) this.nativeFocus();else this.setRange(focusEl, focusEl.textContent.length, focusEl, focusEl.textContent.length);\n      } else {\n        this.focus();\n      }\n    },\n\n    /**\r\n     * @description Focusout to wysiwyg area (.blur())\r\n     */\n    blur: function blur() {\n      if (options.iframe) {\n        context.element.wysiwygFrame.blur();\n      } else {\n        context.element.wysiwyg.blur();\n      }\n    },\n\n    /**\r\n     * @description Set current editor's range object and return.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @returns {Object} Range object.\r\n     */\n    setRange: function setRange(startCon, startOff, endCon, endOff) {\n      if (!startCon || !endCon) return;\n      if (startOff > startCon.textContent.length) startOff = startCon.textContent.length;\n      if (endOff > endCon.textContent.length) endOff = endCon.textContent.length;\n\n      if (util.isFormatElement(startCon)) {\n        startCon = startCon.childNodes[startOff] || startCon.childNodes[startOff - 1] || startCon;\n        startOff = startOff > 0 ? startCon.nodeType === 1 ? 1 : startCon.textContent ? startCon.textContent.length : 0 : 0;\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon.childNodes[endOff - 1] || endCon;\n        endOff = endOff > 0 ? endCon.nodeType === 1 ? 1 : endCon.textContent ? endCon.textContent.length : 0 : 0;\n      }\n\n      var range = this._wd.createRange();\n\n      try {\n        range.setStart(startCon, startOff);\n        range.setEnd(endCon, endOff);\n      } catch (error) {\n        console.warn('[SUNEDITOR.core.focus.error] ' + error);\n        this.nativeFocus();\n        return;\n      }\n\n      var selection = this.getSelection();\n\n      if (selection.removeAllRanges) {\n        selection.removeAllRanges();\n      }\n\n      selection.addRange(range);\n\n      this._rangeInfo(range, this.getSelection());\n\n      if (options.iframe) this.__focus();\n      return range;\n    },\n\n    /**\r\n     * @description Remove range object and button effect\r\n     */\n    removeRange: function removeRange() {\n      this._variable._range = null;\n      this._variable._selectionNode = null;\n      if (this.hasFocus) this.getSelection().removeAllRanges();\n\n      this._setKeyEffect([]);\n    },\n\n    /**\r\n     * @description Get current editor's range object\r\n     * @returns {Object}\r\n     */\n    getRange: function getRange() {\n      var range = this._variable._range || this._createDefaultRange();\n\n      var selection = this.getSelection();\n      if (range.collapsed === selection.isCollapsed || !context.element.wysiwyg.contains(selection.focusNode)) return range;\n\n      if (selection.rangeCount > 0) {\n        this._variable._range = selection.getRangeAt(0);\n        return this._variable._range;\n      } else {\n        var sc = selection.anchorNode,\n            ec = selection.focusNode,\n            so = selection.anchorOffset,\n            eo = selection.focusOffset;\n        var compareValue = util.compareElements(sc, ec);\n        var rightDir = compareValue.ancestor && (compareValue.result === 0 ? so <= eo : compareValue.result > 1 ? true : false);\n        return this.setRange(rightDir ? sc : ec, rightDir ? so : eo, rightDir ? ec : sc, rightDir ? eo : so);\n      }\n    },\n\n    /**\r\n     * @description If the \"range\" object is a non-editable area, add a line at the top of the editor and update the \"range\" object.\r\n     * Returns a new \"range\" or argument \"range\".\r\n     * @param {Object} range core.getRange()\r\n     * @param {Element|null} container If there is \"container\" argument, it creates a line in front of the container.\r\n     * @returns {Object} range\r\n     */\n    getRange_addLine: function getRange_addLine(range, container) {\n      if (this._selectionVoid(range)) {\n        var wysiwyg = context.element.wysiwyg;\n        var op = util.createElement(options.defaultTag);\n        op.innerHTML = '<br>';\n        wysiwyg.insertBefore(op, container && container !== wysiwyg ? container.nextElementSibling : wysiwyg.firstElementChild);\n        this.setRange(op.firstElementChild, 0, op.firstElementChild, 1);\n        range = this._variable._range;\n      }\n\n      return range;\n    },\n\n    /**\r\n     * @description Get window selection obejct\r\n     * @returns {Object}\r\n     */\n    getSelection: function getSelection() {\n      return this._shadowRoot && this._shadowRoot.getSelection ? this._shadowRoot.getSelection() : this._ww.getSelection();\n    },\n\n    /**\r\n     * @description Get current select node\r\n     * @returns {Node}\r\n     */\n    getSelectionNode: function getSelectionNode() {\n      if (!context.element.wysiwyg.contains(this._variable._selectionNode)) this._editorRange();\n\n      if (!this._variable._selectionNode) {\n        var selectionNode = util.getChildElement(context.element.wysiwyg.firstChild, function (current) {\n          return current.childNodes.length === 0 || current.nodeType === 3;\n        }, false);\n\n        if (!selectionNode) {\n          this._editorRange();\n        } else {\n          this._variable._selectionNode = selectionNode;\n          return selectionNode;\n        }\n      }\n\n      return this._variable._selectionNode;\n    },\n\n    /**\r\n     * @description Saving the range object and the currently selected node of editor\r\n     * @private\r\n     */\n    _editorRange: function _editorRange() {\n      var selection = this.getSelection();\n      if (!selection) return null;\n      var range = null;\n\n      if (selection.rangeCount > 0) {\n        range = selection.getRangeAt(0);\n      } else {\n        range = this._createDefaultRange();\n      }\n\n      if (util.isFormatElement(range.endContainer) && range.endOffset === 0) {\n        range = this.setRange(range.startContainer, range.startOffset, range.startContainer, range.startContainer.length);\n      }\n\n      this._rangeInfo(range, selection);\n    },\n\n    /**\r\n     * @description Set \"range\" and \"selection\" info.\r\n     * @param {Object} range range object.\r\n     * @param {Object} selection selection object.\r\n     */\n    _rangeInfo: function _rangeInfo(range, selection) {\n      var selectionNode = null;\n      this._variable._range = range;\n\n      if (range.collapsed) {\n        if (util.isWysiwygDiv(range.commonAncestorContainer)) selectionNode = range.commonAncestorContainer.children[range.startOffset] || range.commonAncestorContainer;else selectionNode = range.commonAncestorContainer;\n      } else {\n        selectionNode = selection.extentNode || selection.anchorNode;\n      }\n\n      this._variable._selectionNode = selectionNode;\n    },\n\n    /**\r\n     * @description Return the range object of editor's first child node\r\n     * @returns {Object}\r\n     * @private\r\n     */\n    _createDefaultRange: function _createDefaultRange() {\n      var wysiwyg = context.element.wysiwyg;\n      wysiwyg.focus();\n\n      var range = this._wd.createRange();\n\n      var focusEl = wysiwyg.firstElementChild;\n\n      if (!focusEl) {\n        focusEl = util.createElement(options.defaultTag);\n        focusEl.innerHTML = '<br>';\n        wysiwyg.appendChild(focusEl);\n      }\n\n      range.setStart(focusEl, 0);\n      range.setEnd(focusEl, 0);\n      return range;\n    },\n\n    /**\r\n     * @description Returns true if there is no valid \"selection\".\r\n     * @param {Object} range core.getRange()\r\n     * @returns {Object} range\r\n     * @private\r\n     */\n    _selectionVoid: function _selectionVoid(range) {\n      var comm = range.commonAncestorContainer;\n      return util.isWysiwygDiv(range.startContainer) && util.isWysiwygDiv(range.endContainer) || /FIGURE/i.test(comm.nodeName) || this._fileManager.regExp.test(comm.nodeName) || util.isMediaComponent(comm);\n    },\n\n    /**\r\n     * @description Reset range object to text node selected status.\r\n     * @returns {Boolean} Returns false if there is no valid selection.\r\n     * @private\r\n     */\n    _resetRangeToTextNode: function _resetRangeToTextNode() {\n      var range = this.getRange();\n      if (this._selectionVoid(range)) return false;\n      var startCon = range.startContainer;\n      var startOff = range.startOffset;\n      var endCon = range.endContainer;\n      var endOff = range.endOffset;\n      var tempCon, tempOffset, tempChild;\n\n      if (util.isFormatElement(startCon)) {\n        if (!startCon.childNodes[startOff]) {\n          startCon = startCon.lastChild || startCon;\n          startOff = startCon.textContent.length;\n        } else {\n          startCon = startCon.childNodes[startOff] || startCon;\n          startOff = 0;\n        }\n\n        while (startCon && startCon.nodeType === 1 && startCon.firstChild) {\n          startCon = startCon.firstChild || startCon;\n          startOff = 0;\n        }\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon.lastChild || endCon;\n\n        while (endCon && endCon.nodeType === 1 && endCon.lastChild) {\n          endCon = endCon.lastChild;\n        }\n\n        endOff = endCon.textContent.length;\n      } // startContainer\n\n\n      tempCon = util.isWysiwygDiv(startCon) ? context.element.wysiwyg.firstChild : startCon;\n      tempOffset = startOff;\n\n      if (util.isBreak(tempCon) || tempCon.nodeType === 1 && tempCon.childNodes.length > 0) {\n        var onlyBreak = util.isBreak(tempCon);\n\n        if (!onlyBreak) {\n          while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\n            tempCon = tempCon.childNodes[tempOffset] || tempCon.nextElementSibling || tempCon.nextSibling;\n            tempOffset = 0;\n          }\n\n          var format = util.getFormatElement(tempCon, null);\n\n          if (format === util.getRangeFormatElement(format, null)) {\n            format = util.createElement(util.getParentElement(tempCon, util.isCell) ? 'DIV' : options.defaultTag);\n            tempCon.parentNode.insertBefore(format, tempCon);\n            format.appendChild(tempCon);\n          }\n        }\n\n        if (util.isBreak(tempCon)) {\n          var emptyText = util.createTextNode(util.zeroWidthSpace);\n          tempCon.parentNode.insertBefore(emptyText, tempCon);\n          tempCon = emptyText;\n\n          if (onlyBreak) {\n            if (startCon === endCon) {\n              endCon = tempCon;\n              endOff = 1;\n            }\n          }\n        }\n      } // set startContainer\n\n\n      startCon = tempCon;\n      startOff = tempOffset; // endContainer\n\n      tempCon = util.isWysiwygDiv(endCon) ? context.element.wysiwyg.lastChild : endCon;\n      tempOffset = endOff;\n\n      if (util.isBreak(tempCon) || tempCon.nodeType === 1 && tempCon.childNodes.length > 0) {\n        var _onlyBreak = util.isBreak(tempCon);\n\n        if (!_onlyBreak) {\n          while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\n            tempChild = tempCon.childNodes;\n            if (tempChild.length === 0) break;\n            tempCon = tempChild[tempOffset > 0 ? tempOffset - 1 : tempOffset] || !/FIGURE/i.test(tempChild[0].nodeName) ? tempChild[0] : tempCon.previousElementSibling || tempCon.previousSibling || startCon;\n            tempOffset = tempOffset > 0 ? tempCon.textContent.length : tempOffset;\n          }\n\n          var _format = util.getFormatElement(tempCon, null);\n\n          if (_format === util.getRangeFormatElement(_format, null)) {\n            _format = util.createElement(util.isCell(_format) ? 'DIV' : options.defaultTag);\n            tempCon.parentNode.insertBefore(_format, tempCon);\n\n            _format.appendChild(tempCon);\n          }\n        }\n\n        if (util.isBreak(tempCon)) {\n          var _emptyText = util.createTextNode(util.zeroWidthSpace);\n\n          tempCon.parentNode.insertBefore(_emptyText, tempCon);\n          tempCon = _emptyText;\n          tempOffset = 1;\n\n          if (_onlyBreak && !tempCon.previousSibling) {\n            util.removeItem(endCon);\n          }\n        }\n      } // set endContainer\n\n\n      endCon = tempCon;\n      endOff = tempOffset; // set Range\n\n      this.setRange(startCon, startOff, endCon, endOff);\n      return true;\n    },\n\n    /**\r\n     * @description Returns a \"formatElement\"(util.isFormatElement) array from the currently selected range.\r\n     * @param {Function|null} validation The validation function. (Replaces the default validation function-util.isFormatElement(current))\r\n     * @returns {Array}\r\n     */\n    getSelectedElements: function getSelectedElements(validation) {\n      if (!this._resetRangeToTextNode()) return [];\n      var range = this.getRange();\n\n      if (util.isWysiwygDiv(range.startContainer)) {\n        var children = context.element.wysiwyg.children;\n        if (children.length === 0) return [];\n        this.setRange(children[0], 0, children[children.length - 1], children[children.length - 1].textContent.trim().length);\n        range = this.getRange();\n      }\n\n      var startCon = range.startContainer;\n      var endCon = range.endContainer;\n      var commonCon = range.commonAncestorContainer; // get line nodes\n\n      var lineNodes = util.getListChildren(commonCon, function (current) {\n        return validation ? validation(current) : util.isFormatElement(current);\n      });\n      if (!util.isWysiwygDiv(commonCon) && !util.isRangeFormatElement(commonCon)) lineNodes.unshift(util.getFormatElement(commonCon, null));\n      if (startCon === endCon || lineNodes.length === 1) return lineNodes;\n      var startLine = util.getFormatElement(startCon, null);\n      var endLine = util.getFormatElement(endCon, null);\n      var startIdx = null;\n      var endIdx = null;\n\n      var onlyTable = function onlyTable(current) {\n        return util.isTable(current) ? /^TABLE$/i.test(current.nodeName) : true;\n      };\n\n      var startRangeEl = util.getRangeFormatElement(startLine, onlyTable);\n      var endRangeEl = util.getRangeFormatElement(endLine, onlyTable);\n      if (util.isTable(startRangeEl) && util.isListCell(startRangeEl.parentNode)) startRangeEl = startRangeEl.parentNode;\n      if (util.isTable(endRangeEl) && util.isListCell(endRangeEl.parentNode)) endRangeEl = endRangeEl.parentNode;\n      var sameRange = startRangeEl === endRangeEl;\n\n      for (var i = 0, len = lineNodes.length, line; i < len; i++) {\n        line = lineNodes[i];\n\n        if (startLine === line || !sameRange && line === startRangeEl) {\n          startIdx = i;\n          continue;\n        }\n\n        if (endLine === line || !sameRange && line === endRangeEl) {\n          endIdx = i;\n          break;\n        }\n      }\n\n      if (startIdx === null) startIdx = 0;\n      if (endIdx === null) endIdx = lineNodes.length - 1;\n      return lineNodes.slice(startIdx, endIdx + 1);\n    },\n\n    /**\r\n     * @description Get format elements and components from the selected area. (P, DIV, H[1-6], OL, UL, TABLE..)\r\n     * If some of the component are included in the selection, get the entire that component.\r\n     * @param {Boolean} removeDuplicate If true, if there is a parent and child tag among the selected elements, the child tag is excluded.\r\n     * @returns {Array}\r\n     */\n    getSelectedElementsAndComponents: function getSelectedElementsAndComponents(removeDuplicate) {\n      var commonCon = this.getRange().commonAncestorContainer;\n      var myComponent = util.getParentElement(commonCon, util.isComponent);\n      var selectedLines = util.isTable(commonCon) ? this.getSelectedElements(null) : this.getSelectedElements(function (current) {\n        var component = this.getParentElement(current, this.isComponent);\n        return this.isFormatElement(current) && (!component || component === myComponent) || this.isComponent(current) && !this.getFormatElement(current);\n      }.bind(util));\n\n      if (removeDuplicate) {\n        for (var i = 0, len = selectedLines.length; i < len; i++) {\n          for (var j = i - 1; j >= 0; j--) {\n            if (selectedLines[j].contains(selectedLines[i])) {\n              selectedLines.splice(i, 1);\n              i--;\n              len--;\n              break;\n            }\n          }\n        }\n      }\n\n      return selectedLines;\n    },\n\n    /**\r\n     * @description Determine if this offset is the edge offset of container\r\n     * @param {Node} container The node of the selection object. (range.startContainer..)\r\n     * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n     * @param {String|undefined} dir Select check point - Both edge, Front edge or End edge. (\"front\": Front edge, \"end\": End edge, undefined: Both edge)\r\n     * @returns {Boolean}\r\n     */\n    isEdgePoint: function isEdgePoint(container, offset, dir) {\n      return dir !== 'end' && offset === 0 || (!dir || dir !== 'front') && !container.nodeValue && offset === 1 || (!dir || dir === 'end') && !!container.nodeValue && offset === container.nodeValue.length;\n    },\n\n    /**\r\n     * @description Check if the container and offset values are the edges of the format tag\r\n     * @param {Node} container The node of the selection object. (range.startContainer..)\r\n     * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n     * @param {String} dir Select check point - \"front\": Front edge, \"end\": End edge, undefined: Both edge.\r\n     * @returns {Array|null}\r\n     * @private\r\n     */\n    _isEdgeFormat: function _isEdgeFormat(node, offset, dir) {\n      if (!this.isEdgePoint(node, offset, dir)) return false;\n      var result = [];\n      dir = dir === 'front' ? 'previousSibling' : 'nextSibling';\n\n      while (node && !util.isFormatElement(node) && !util.isWysiwygDiv(node)) {\n        if (!node[dir] || util.isBreak(node[dir]) && !node[dir][dir]) {\n          if (node.nodeType === 1) result.push(node.cloneNode(false));\n          node = node.parentNode;\n        } else {\n          return null;\n        }\n      }\n\n      return result;\n    },\n\n    /**\r\n     * @description Show loading box\r\n     */\n    showLoading: function showLoading() {\n      context.element.loading.style.display = 'block';\n    },\n\n    /**\r\n     * @description Close loading box\r\n     */\n    closeLoading: function closeLoading() {\n      context.element.loading.style.display = 'none';\n    },\n\n    /**\r\n     * @description Append format element to sibling node of argument element.\r\n     * If the \"formatNodeName\" argument value is present, the tag of that argument value is inserted,\r\n     * If not, the currently selected format tag is inserted.\r\n     * @param {Element} element Insert as siblings of that element\r\n     * @param {String|Element|null} formatNode Node name or node obejct to be inserted\r\n     * @returns {Element}\r\n     */\n    appendFormatTag: function appendFormatTag(element, formatNode) {\n      if (!element || !element.parentNode) return null;\n      var currentFormatEl = util.getFormatElement(this.getSelectionNode(), null);\n      var oFormat = null;\n\n      if (!util.isFormatElement(element) && util.isFreeFormatElement(currentFormatEl || element.parentNode)) {\n        oFormat = util.createElement('BR');\n      } else {\n        var oFormatName = formatNode ? typeof formatNode === 'string' ? formatNode : formatNode.nodeName : util.isFormatElement(currentFormatEl) && !util.isRangeFormatElement(currentFormatEl) && !util.isFreeFormatElement(currentFormatEl) ? currentFormatEl.nodeName : options.defaultTag;\n        oFormat = util.createElement(oFormatName);\n        oFormat.innerHTML = '<br>';\n\n        if (formatNode && typeof formatNode !== 'string' || !formatNode && util.isFormatElement(currentFormatEl)) {\n          util.copyTagAttributes(oFormat, formatNode || currentFormatEl);\n        }\n      }\n\n      if (util.isCell(element)) element.insertBefore(oFormat, element.nextElementSibling);else element.parentNode.insertBefore(oFormat, element.nextElementSibling);\n      return oFormat;\n    },\n\n    /**\r\n     * @description The method to insert a element and return. (used elements : table, hr, image, video)\r\n     * If \"element\" is \"HR\", insert and return the new line.\r\n     * @param {Element} element Element to be inserted\r\n     * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @param {Boolean} notSelect If true, Do not automatically select the inserted component.\r\n     * @returns {Element}\r\n     */\n    insertComponent: function insertComponent(element, notHistoryPush, checkCharCount, notSelect) {\n      if (this.isReadOnly || checkCharCount && !this.checkCharCount(element, null)) {\n        return null;\n      }\n\n      var r = this.removeNode();\n      this.getRange_addLine(this.getRange(), r.container);\n      var oNode = null;\n      var selectionNode = this.getSelectionNode();\n      var formatEl = util.getFormatElement(selectionNode, null);\n\n      if (util.isListCell(formatEl)) {\n        this.insertNode(element, selectionNode === formatEl ? null : r.container.nextSibling, false);\n        if (!element.nextSibling) element.parentNode.appendChild(util.createElement('BR'));\n      } else {\n        if (this.getRange().collapsed && (r.container.nodeType === 3 || util.isBreak(r.container))) {\n          var depthFormat = util.getParentElement(r.container, function (current) {\n            return this.isRangeFormatElement(current);\n          }.bind(util));\n          oNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n          if (oNode) formatEl = oNode.previousSibling;\n        }\n\n        this.insertNode(element, util.isRangeFormatElement(formatEl) ? null : formatEl, false);\n        if (formatEl && util.onlyZeroWidthSpace(formatEl)) util.removeItem(formatEl);\n      }\n\n      if (!notSelect) {\n        this.setRange(element, 0, element, 0);\n        var fileComponentInfo = this.getFileComponent(element);\n\n        if (fileComponentInfo) {\n          this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n        } else if (oNode) {\n          oNode = util.getEdgeChildNodes(oNode, null).sc || oNode;\n          this.setRange(oNode, 0, oNode, 0);\n        }\n      } // history stack\n\n\n      if (!notHistoryPush) this.history.push(1);\n      return oNode || element;\n    },\n\n    /**\r\n     * @description Gets the file component and that plugin name\r\n     * return: {target, component, pluginName} | null\r\n     * @param {Element} element Target element (figure tag, component div, file tag)\r\n     * @returns {Object|null}\r\n     */\n    getFileComponent: function getFileComponent(element) {\n      if (!this._fileManager.queryString || !element) return null;\n      var target, pluginName;\n\n      if (/^FIGURE$/i.test(element.nodeName) || /se-component/.test(element.className)) {\n        target = element.querySelector(this._fileManager.queryString);\n      }\n\n      if (!target && element.nodeName && this._fileManager.regExp.test(element.nodeName)) {\n        target = element;\n      }\n\n      if (target) {\n        pluginName = this._fileManager.pluginMap[target.nodeName.toLowerCase()];\n\n        if (pluginName) {\n          return {\n            target: target,\n            component: util.getParentElement(target, util.isComponent),\n            pluginName: pluginName\n          };\n        }\n      }\n\n      return null;\n    },\n\n    /**\r\n     * @description The component(image, video) is selected and the resizing module is called.\r\n     * @param {Element} element Element tag (img, iframe, video)\r\n     * @param {String} pluginName Plugin name (image, video)\r\n     */\n    selectComponent: function selectComponent(element, pluginName) {\n      if (util.isUneditableComponent(util.getParentElement(element, util.isComponent)) || util.isUneditableComponent(element)) return false;\n      if (!this.hasFocus) this.focus();\n      var plugin = this.plugins[pluginName];\n      if (!plugin) return;\n\n      _w.setTimeout(function () {\n        if (typeof plugin.select === 'function') this.callPlugin(pluginName, plugin.select.bind(this, element), null);\n\n        this._setComponentLineBreaker(element);\n      }.bind(this));\n    },\n\n    /**\r\n     * @description Set line breaker of component\r\n     * @param {Element} element Element tag (img, iframe, video)\r\n     * @private\r\n     */\n    _setComponentLineBreaker: function _setComponentLineBreaker(element) {\n      // line breaker\n      this._lineBreaker.style.display = 'none';\n      var container = util.getParentElement(element, util.isComponent);\n      var t_style = context.element.lineBreaker_t.style;\n      var b_style = context.element.lineBreaker_b.style;\n      var target = this.context.resizing.resizeContainer.style.display === 'block' ? this.context.resizing.resizeContainer : element;\n      var isList = util.isListCell(container.parentNode);\n      var componentTop, wScroll, w; // top\n\n      if (isList ? !container.previousSibling : !util.isFormatElement(container.previousElementSibling)) {\n        this._variable._lineBreakComp = container;\n        wScroll = context.element.wysiwyg.scrollTop;\n        componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\n        w = target.offsetWidth / 2 / 2;\n        t_style.top = componentTop - wScroll - 12 + 'px';\n        t_style.left = util.getOffset(target).left + w + 'px';\n        t_style.display = 'block';\n      } else {\n        t_style.display = 'none';\n      } // bottom\n\n\n      if (isList ? !container.nextSibling : !util.isFormatElement(container.nextElementSibling)) {\n        if (!componentTop) {\n          this._variable._lineBreakComp = container;\n          wScroll = context.element.wysiwyg.scrollTop;\n          componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\n          w = target.offsetWidth / 2 / 2;\n        }\n\n        b_style.top = componentTop + target.offsetHeight - wScroll - 12 + 'px';\n        b_style.left = util.getOffset(target).left + target.offsetWidth - w - 24 + 'px';\n        b_style.display = 'block';\n      } else {\n        b_style.display = 'none';\n      }\n    },\n    _checkDuplicateNode: function _checkDuplicateNode(oNode, parentNode) {\n      (function recursionFunc(current) {\n        core._dupleCheck(current, parentNode);\n\n        var childNodes = current.childNodes;\n\n        for (var i = 0, len = childNodes.length; i < len; i++) {\n          recursionFunc(childNodes[i]);\n        }\n      })(oNode);\n    },\n    _dupleCheck: function _dupleCheck(oNode, parentNode) {\n      if (!util.isTextStyleElement(oNode)) return;\n      var oStyles = (oNode.style.cssText.match(/[^;]+;/g) || []).map(function (v) {\n        return v.trim();\n      });\n      var nodeName = oNode.nodeName;\n      if (/^span$/i.test(nodeName) && oStyles.length === 0) return oNode;\n      var duple = false;\n\n      (function recursionFunc(ancestor) {\n        if (util.isWysiwygDiv(ancestor) || !util.isTextStyleElement(ancestor)) return;\n\n        if (ancestor.nodeName === nodeName) {\n          duple = true;\n          var styles = ancestor.style.cssText.match(/[^;]+;/g) || [];\n\n          for (var i = 0, len = styles.length, j; i < len; i++) {\n            if ((j = oStyles.indexOf(styles[i].trim())) > -1) {\n              oStyles.splice(j, 1);\n            }\n          }\n\n          for (var _i2 = 0, _len = ancestor.classList.length; _i2 < _len; _i2++) {\n            oNode.classList.remove(ancestor.classList[_i2]);\n          }\n        }\n\n        recursionFunc(ancestor.parentElement);\n      })(parentNode);\n\n      if (duple) {\n        if (!(oNode.style.cssText = oStyles.join(' '))) {\n          oNode.setAttribute('style', '');\n          oNode.removeAttribute('style');\n        }\n\n        if (!oNode.attributes.length) {\n          oNode.setAttribute('data-se-duple', 'true');\n        }\n      }\n\n      return oNode;\n    },\n\n    /**\r\n     * @description Delete selected node and insert argument value node and return.\r\n     * If the \"afterNode\" exists, it is inserted after the \"afterNode\"\r\n     * Inserting a text node merges with both text nodes on both sides and returns a new \"{ container, startOffset, endOffset }\".\r\n     * @param {Node} oNode Element to be inserted\r\n     * @param {Node|null} afterNode If the node exists, it is inserted after the node\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @returns {Object|Node|null}\r\n     */\n    insertNode: function insertNode(oNode, afterNode, checkCharCount) {\n      if (this.isReadOnly || checkCharCount && !this.checkCharCount(oNode, null)) {\n        return null;\n      }\n\n      var range = this.getRange();\n      var line = util.isListCell(range.commonAncestorContainer) ? range.commonAncestorContainer : util.getFormatElement(this.getSelectionNode(), null);\n      var insertListCell = util.isListCell(line) && (util.isListCell(oNode) || util.isList(oNode));\n      var parentNode,\n          originAfter,\n          tempAfterNode,\n          tempParentNode = null;\n      var freeFormat = util.isFreeFormatElement(line);\n      var isFormats = !freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) || util.isComponent(oNode);\n\n      if (insertListCell) {\n        tempAfterNode = afterNode || util.isList(oNode) ? line.lastChild : line.nextElementSibling;\n        tempParentNode = util.isList(oNode) ? line : (tempAfterNode || line).parentNode;\n      }\n\n      if (!afterNode && (isFormats || util.isComponent(oNode) || util.isMedia(oNode))) {\n        var isEdge = this.isEdgePoint(range.endContainer, range.endOffset, 'end');\n        var r = this.removeNode();\n        var container = r.container;\n        var prevContainer = container === r.prevContainer && range.collapsed ? null : r.prevContainer;\n\n        if (insertListCell && prevContainer) {\n          tempParentNode = prevContainer.nodeType === 3 ? prevContainer.parentNode : prevContainer;\n\n          if (tempParentNode.contains(container)) {\n            var sameParent = true;\n            tempAfterNode = container;\n\n            while (tempAfterNode.parentNode && tempAfterNode.parentNode !== tempParentNode) {\n              tempAfterNode = tempAfterNode.parentNode;\n              sameParent = false;\n            }\n\n            if (sameParent && container === prevContainer) tempAfterNode = tempAfterNode.nextSibling;\n          } else {\n            tempAfterNode = null;\n          }\n        } else if (insertListCell && util.isListCell(container) && !line.parentElement) {\n          line = util.createElement('LI');\n          tempParentNode.appendChild(line);\n          container.appendChild(tempParentNode);\n          tempAfterNode = null;\n        } else if (container.nodeType === 3 || util.isBreak(container) || insertListCell) {\n          var depthFormat = util.getParentElement(container, function (current) {\n            return this.isRangeFormatElement(current) || this.isListCell(current);\n          }.bind(util));\n          afterNode = util.splitElement(container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n\n          if (afterNode) {\n            if (insertListCell) {\n              if (line.contains(container)) {\n                var subList = util.isList(line.lastElementChild);\n                var newCell = null;\n\n                if (!isEdge) {\n                  newCell = line.cloneNode(false);\n                  newCell.appendChild(afterNode.textContent.trim() ? afterNode : util.createTextNode(util.zeroWidthSpace));\n                }\n\n                if (subList) {\n                  if (!newCell) {\n                    newCell = line.cloneNode(false);\n                    newCell.appendChild(util.createTextNode(util.zeroWidthSpace));\n                  }\n\n                  newCell.appendChild(line.lastElementChild);\n                }\n\n                if (newCell) {\n                  line.parentNode.insertBefore(newCell, line.nextElementSibling);\n                  tempAfterNode = afterNode = newCell;\n                }\n              }\n            } else {\n              afterNode = afterNode.previousSibling;\n            }\n          }\n        }\n      }\n\n      range = !afterNode && !isFormats ? this.getRange_addLine(this.getRange(), null) : this.getRange();\n      var commonCon = range.commonAncestorContainer;\n      var startOff = range.startOffset;\n      var endOff = range.endOffset;\n      var formatRange = range.startContainer === commonCon && util.isFormatElement(commonCon);\n      var startCon = formatRange ? commonCon.childNodes[startOff] || commonCon.childNodes[0] || range.startContainer : range.startContainer;\n      var endCon = formatRange ? commonCon.childNodes[endOff] || commonCon.childNodes[commonCon.childNodes.length - 1] || range.endContainer : range.endContainer;\n\n      if (!insertListCell) {\n        if (!afterNode) {\n          parentNode = startCon;\n\n          if (startCon.nodeType === 3) {\n            parentNode = startCon.parentNode;\n          }\n          /** No Select range node */\n\n\n          if (range.collapsed) {\n            if (commonCon.nodeType === 3) {\n              if (commonCon.textContent.length > endOff) afterNode = commonCon.splitText(endOff);else afterNode = commonCon.nextSibling;\n            } else {\n              if (!util.isBreak(parentNode)) {\n                var c = parentNode.childNodes[startOff];\n                var focusNode = c && c.nodeType === 3 && util.onlyZeroWidthSpace(c) && util.isBreak(c.nextSibling) ? c.nextSibling : c;\n\n                if (focusNode) {\n                  if (!focusNode.nextSibling && util.isBreak(focusNode)) {\n                    parentNode.removeChild(focusNode);\n                    afterNode = null;\n                  } else {\n                    afterNode = util.isBreak(focusNode) && !util.isBreak(oNode) ? focusNode : focusNode.nextSibling;\n                  }\n                } else {\n                  afterNode = null;\n                }\n              } else {\n                afterNode = parentNode;\n                parentNode = parentNode.parentNode;\n              }\n            }\n          } else {\n            /** Select range nodes */\n            var isSameContainer = startCon === endCon;\n\n            if (isSameContainer) {\n              if (this.isEdgePoint(endCon, endOff)) afterNode = endCon.nextSibling;else afterNode = endCon.splitText(endOff);\n              var removeNode = startCon;\n              if (!this.isEdgePoint(startCon, startOff)) removeNode = startCon.splitText(startOff);\n              parentNode.removeChild(removeNode);\n\n              if (parentNode.childNodes.length === 0 && isFormats) {\n                parentNode.innerHTML = '<br>';\n              }\n            } else {\n              var removedTag = this.removeNode();\n              var _container = removedTag.container;\n              var _prevContainer = removedTag.prevContainer;\n\n              if (_container && _container.childNodes.length === 0 && isFormats) {\n                if (util.isFormatElement(_container)) {\n                  _container.innerHTML = '<br>';\n                } else if (util.isRangeFormatElement(_container)) {\n                  _container.innerHTML = '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n                }\n              }\n\n              if (util.isListCell(_container) && oNode.nodeType === 3) {\n                parentNode = _container;\n                afterNode = null;\n              } else if (!isFormats && _prevContainer) {\n                parentNode = _prevContainer.nodeType === 3 ? _prevContainer.parentNode : _prevContainer;\n\n                if (parentNode.contains(_container)) {\n                  var _sameParent = true;\n                  afterNode = _container;\n\n                  while (afterNode.parentNode && afterNode.parentNode !== parentNode) {\n                    afterNode = afterNode.parentNode;\n                    _sameParent = false;\n                  }\n\n                  if (_sameParent && _container === _prevContainer) afterNode = afterNode.nextSibling;\n                } else {\n                  afterNode = null;\n                }\n              } else {\n                afterNode = isFormats ? endCon : _container === _prevContainer ? _container.nextSibling : _container;\n                parentNode = !afterNode || !afterNode.parentNode ? commonCon : afterNode.parentNode;\n              }\n\n              while (afterNode && !util.isFormatElement(afterNode) && afterNode.parentNode !== commonCon) {\n                afterNode = afterNode.parentNode;\n              }\n            }\n          }\n        } else {\n          // has afterNode\n          parentNode = afterNode.parentNode;\n          afterNode = afterNode.nextSibling;\n          originAfter = true;\n        }\n      }\n\n      try {\n        // set node\n        if (!insertListCell) {\n          if (util.isWysiwygDiv(afterNode) || parentNode === context.element.wysiwyg.parentNode) {\n            parentNode = context.element.wysiwyg;\n            afterNode = null;\n          }\n\n          if (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode) || !util.isListCell(parentNode) && util.isComponent(oNode)) {\n            var oldParent = parentNode;\n\n            if (util.isList(afterNode)) {\n              parentNode = afterNode;\n              afterNode = null;\n            } else if (util.isListCell(afterNode)) {\n              parentNode = afterNode.previousElementSibling || afterNode;\n            } else if (!originAfter && !afterNode) {\n              var _r = this.removeNode();\n\n              var _container2 = _r.container.nodeType === 3 ? util.isListCell(util.getFormatElement(_r.container, null)) ? _r.container : util.getFormatElement(_r.container, null) || _r.container.parentNode : _r.container;\n\n              var rangeCon = util.isWysiwygDiv(_container2) || util.isRangeFormatElement(_container2);\n              parentNode = rangeCon ? _container2 : _container2.parentNode;\n              afterNode = rangeCon ? null : _container2.nextSibling;\n            }\n\n            if (oldParent.childNodes.length === 0 && parentNode !== oldParent) util.removeItem(oldParent);\n          }\n\n          if (isFormats && !freeFormat && !util.isRangeFormatElement(parentNode) && !util.isListCell(parentNode) && !util.isWysiwygDiv(parentNode)) {\n            afterNode = parentNode.nextElementSibling;\n            parentNode = parentNode.parentNode;\n          }\n\n          if (util.isWysiwygDiv(parentNode) && (oNode.nodeType === 3 || util.isBreak(oNode))) {\n            var fNode = util.createElement(options.defaultTag);\n            fNode.appendChild(oNode);\n            oNode = fNode;\n          }\n        } // insert--\n\n\n        if (insertListCell) {\n          if (!tempParentNode.parentNode) {\n            parentNode = context.element.wysiwyg;\n            afterNode = null;\n          } else {\n            parentNode = tempParentNode;\n            afterNode = tempAfterNode;\n          }\n        } else {\n          afterNode = parentNode === afterNode ? parentNode.lastChild : afterNode;\n        }\n\n        if (util.isListCell(oNode) && !util.isList(parentNode)) {\n          if (util.isListCell(parentNode)) {\n            afterNode = parentNode.nextElementSibling;\n            parentNode = parentNode.parentNode;\n          } else {\n            var ul = util.createElement('ol');\n            parentNode.insertBefore(ul, afterNode);\n            parentNode = ul;\n            afterNode = null;\n          }\n\n          insertListCell = true;\n        }\n\n        this._checkDuplicateNode(oNode, parentNode);\n\n        parentNode.insertBefore(oNode, afterNode);\n\n        if (insertListCell) {\n          if (util.onlyZeroWidthSpace(line.textContent.trim())) {\n            util.removeItem(line);\n            oNode = oNode.lastChild;\n          } else {\n            var chList = util.getArrayItem(line.children, util.isList);\n\n            if (chList) {\n              if (oNode !== chList) {\n                oNode.appendChild(chList);\n                oNode = chList.previousSibling;\n              } else {\n                parentNode.appendChild(oNode);\n                oNode = parentNode;\n              }\n\n              if (util.onlyZeroWidthSpace(line.textContent.trim())) {\n                util.removeItem(line);\n              }\n            }\n          }\n        }\n      } catch (error) {\n        parentNode.appendChild(oNode);\n        console.warn('[SUNEDITOR.insertNode.warn] ' + error);\n      } finally {\n        var dupleNodes = parentNode.querySelectorAll('[data-se-duple]');\n\n        if (dupleNodes.length > 0) {\n          for (var i = 0, len = dupleNodes.length, d, _c, ch, parent; i < len; i++) {\n            d = dupleNodes[i];\n            ch = d.childNodes;\n            parent = d.parentNode;\n\n            while (ch[0]) {\n              _c = ch[0];\n              parent.insertBefore(_c, d);\n            }\n\n            if (d === oNode) oNode = _c;\n            util.removeItem(d);\n          }\n        }\n\n        if ((util.isFormatElement(oNode) || util.isComponent(oNode)) && startCon === endCon) {\n          var cItem = util.getFormatElement(commonCon, null);\n\n          if (cItem && cItem.nodeType === 1 && util.isEmptyLine(cItem)) {\n            util.removeItem(cItem);\n          }\n        }\n\n        if (freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) {\n          oNode = this._setIntoFreeFormat(oNode);\n        }\n\n        if (!util.isComponent(oNode)) {\n          var offset = 1;\n\n          if (oNode.nodeType === 3) {\n            var previous = oNode.previousSibling;\n            var next = oNode.nextSibling;\n            var previousText = !previous || previous.nodeType === 1 || util.onlyZeroWidthSpace(previous) ? '' : previous.textContent;\n            var nextText = !next || next.nodeType === 1 || util.onlyZeroWidthSpace(next) ? '' : next.textContent;\n\n            if (previous && previousText.length > 0) {\n              oNode.textContent = previousText + oNode.textContent;\n              util.removeItem(previous);\n            }\n\n            if (next && next.length > 0) {\n              oNode.textContent += nextText;\n              util.removeItem(next);\n            }\n\n            var newRange = {\n              container: oNode,\n              startOffset: previousText.length,\n              endOffset: oNode.textContent.length - nextText.length\n            };\n            this.setRange(oNode, newRange.startOffset, oNode, newRange.endOffset);\n            return newRange;\n          } else if (!util.isBreak(oNode) && !util.isListCell(oNode) && util.isFormatElement(parentNode)) {\n            var zeroWidth = null;\n\n            if (!oNode.previousSibling || util.isBreak(oNode.previousSibling)) {\n              zeroWidth = util.createTextNode(util.zeroWidthSpace);\n              oNode.parentNode.insertBefore(zeroWidth, oNode);\n            }\n\n            if (!oNode.nextSibling || util.isBreak(oNode.nextSibling)) {\n              zeroWidth = util.createTextNode(util.zeroWidthSpace);\n              oNode.parentNode.insertBefore(zeroWidth, oNode.nextSibling);\n            }\n\n            if (util._isIgnoreNodeChange(oNode)) {\n              oNode = oNode.nextSibling;\n              offset = 0;\n            }\n          }\n\n          this.setRange(oNode, offset, oNode, offset);\n        } // history stack\n\n\n        this.history.push(true);\n        return oNode;\n      }\n    },\n    _setIntoFreeFormat: function _setIntoFreeFormat(oNode) {\n      var parentNode = oNode.parentNode;\n      var oNodeChildren, lastONode;\n\n      while (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) {\n        oNodeChildren = oNode.childNodes;\n        lastONode = null;\n\n        while (oNodeChildren[0]) {\n          lastONode = oNodeChildren[0];\n\n          if (util.isFormatElement(lastONode) || util.isRangeFormatElement(lastONode)) {\n            this._setIntoFreeFormat(lastONode);\n\n            if (!oNode.parentNode) break;\n            oNodeChildren = oNode.childNodes;\n            continue;\n          }\n\n          parentNode.insertBefore(lastONode, oNode);\n        }\n\n        if (oNode.childNodes.length === 0) util.removeItem(oNode);\n        oNode = util.createElement('BR');\n        parentNode.insertBefore(oNode, lastONode.nextSibling);\n      }\n\n      return oNode;\n    },\n\n    /**\r\n     * @description Delete the currently selected nodes and reset selection range\r\n     * Returns {container: \"the last element after deletion\", offset: \"offset\", prevContainer: \"previousElementSibling Of the deleted area\"}\r\n     * @returns {Object}\r\n     */\n    removeNode: function removeNode() {\n      this._resetRangeToTextNode();\n\n      var range = this.getRange();\n      var container,\n          offset = 0;\n      var startCon = range.startContainer;\n      var endCon = range.endContainer;\n      var startOff = range.startOffset;\n      var endOff = range.endOffset;\n      var commonCon = range.commonAncestorContainer.nodeType === 3 && range.commonAncestorContainer.parentNode === startCon.parentNode ? startCon.parentNode : range.commonAncestorContainer;\n\n      if (commonCon === startCon && commonCon === endCon) {\n        startCon = commonCon.children[startOff];\n        endCon = commonCon.children[endOff];\n        startOff = endOff = 0;\n      }\n\n      if (startCon === endCon && range.collapsed) {\n        if (startCon.textContent && util.onlyZeroWidthSpace(startCon.textContent.substr(startOff))) {\n          return {\n            container: startCon,\n            offset: offset,\n            prevContainer: startCon && startCon.parentNode ? startCon : null\n          };\n        }\n      }\n\n      var beforeNode = null;\n      var afterNode = null;\n      var childNodes = util.getListChildNodes(commonCon, null);\n      var startIndex = util.getArrayIndex(childNodes, startCon);\n      var endIndex = util.getArrayIndex(childNodes, endCon);\n\n      if (childNodes.length > 0 && startIndex > -1 && endIndex > -1) {\n        for (var i = startIndex + 1, startNode = startCon; i >= 0; i--) {\n          if (childNodes[i] === startNode.parentNode && childNodes[i].firstChild === startNode && startOff === 0) {\n            startIndex = i;\n            startNode = startNode.parentNode;\n          }\n        }\n\n        for (var _i3 = endIndex - 1, endNode = endCon; _i3 > startIndex; _i3--) {\n          if (childNodes[_i3] === endNode.parentNode && childNodes[_i3].nodeType === 1) {\n            childNodes.splice(_i3, 1);\n            endNode = endNode.parentNode;\n            --endIndex;\n          }\n        }\n      } else {\n        if (childNodes.length === 0) {\n          if (util.isFormatElement(commonCon) || util.isRangeFormatElement(commonCon) || util.isWysiwygDiv(commonCon) || util.isBreak(commonCon) || util.isMedia(commonCon)) {\n            return {\n              container: commonCon,\n              offset: 0\n            };\n          } else if (commonCon.nodeType === 3) {\n            return {\n              container: commonCon,\n              offset: endOff\n            };\n          }\n\n          childNodes.push(commonCon);\n          startCon = endCon = commonCon;\n        } else {\n          startCon = endCon = childNodes[0];\n\n          if (util.isBreak(startCon) || util.onlyZeroWidthSpace(startCon)) {\n            return {\n              container: util.isMedia(commonCon) ? commonCon : startCon,\n              offset: 0\n            };\n          }\n        }\n\n        startIndex = endIndex = 0;\n      }\n\n      for (var _i4 = startIndex; _i4 <= endIndex; _i4++) {\n        var item = childNodes[_i4];\n\n        if (item.length === 0 || item.nodeType === 3 && item.data === undefined) {\n          this._nodeRemoveListItem(item);\n\n          continue;\n        }\n\n        if (item === startCon) {\n          if (startCon.nodeType === 1) {\n            if (util.isComponent(startCon)) continue;else beforeNode = util.createTextNode(startCon.textContent);\n          } else {\n            if (item === endCon) {\n              beforeNode = util.createTextNode(startCon.substringData(0, startOff) + endCon.substringData(endOff, endCon.length - endOff));\n              offset = startOff;\n            } else {\n              beforeNode = util.createTextNode(startCon.substringData(0, startOff));\n            }\n          }\n\n          if (beforeNode.length > 0) {\n            startCon.data = beforeNode.data;\n          } else {\n            this._nodeRemoveListItem(startCon);\n          }\n\n          if (item === endCon) break;\n          continue;\n        }\n\n        if (item === endCon) {\n          if (endCon.nodeType === 1) {\n            if (util.isComponent(endCon)) continue;else afterNode = util.createTextNode(endCon.textContent);\n          } else {\n            afterNode = util.createTextNode(endCon.substringData(endOff, endCon.length - endOff));\n          }\n\n          if (afterNode.length > 0) {\n            endCon.data = afterNode.data;\n          } else {\n            this._nodeRemoveListItem(endCon);\n          }\n\n          continue;\n        }\n\n        this._nodeRemoveListItem(item);\n      }\n\n      var endUl = util.getParentElement(endCon, 'ul');\n      var startLi = util.getParentElement(startCon, 'li');\n\n      if (endUl && startLi && startLi.contains(endUl)) {\n        container = endUl.previousSibling;\n        offset = container.textContent.length;\n      } else {\n        container = endCon && endCon.parentNode ? endCon : startCon && startCon.parentNode ? startCon : range.endContainer || range.startContainer;\n      }\n\n      if (!util.isWysiwygDiv(container) && container.childNodes.length === 0) {\n        var rc = util.removeItemAllParents(container, null, null);\n        if (rc) container = rc.sc || rc.ec || context.element.wysiwyg;\n      } // set range\n\n\n      this.setRange(container, offset, container, offset); // history stack\n\n      this.history.push(true);\n      return {\n        container: container,\n        offset: offset,\n        prevContainer: startCon && startCon.parentNode ? startCon : null\n      };\n    },\n    _nodeRemoveListItem: function _nodeRemoveListItem(item) {\n      var format = util.getFormatElement(item, null);\n      util.removeItem(item);\n      if (!util.isListCell(format)) return;\n      util.removeItemAllParents(format, null, null);\n\n      if (format && util.isList(format.firstChild)) {\n        format.insertBefore(util.createTextNode(util.zeroWidthSpace), format.firstChild);\n      }\n    },\n\n    /**\r\n     * @description Appended all selected format Element to the argument element and insert\r\n     * @param {Element} rangeElement Element of wrap the arguments (BLOCKQUOTE...)\r\n     */\n    applyRangeFormatElement: function applyRangeFormatElement(rangeElement) {\n      this.getRange_addLine(this.getRange(), null);\n      var rangeLines = this.getSelectedElementsAndComponents(false);\n      if (!rangeLines || rangeLines.length === 0) return;\n\n      linesLoop: for (var i = 0, len = rangeLines.length, line, nested, fEl, lEl, f, l; i < len; i++) {\n        line = rangeLines[i];\n        if (!util.isListCell(line)) continue;\n        nested = line.lastElementChild;\n\n        if (nested && util.isListCell(line.nextElementSibling) && rangeLines.indexOf(line.nextElementSibling) > -1) {\n          lEl = nested.lastElementChild;\n\n          if (rangeLines.indexOf(lEl) > -1) {\n            var list = null;\n\n            while (list = lEl.lastElementChild) {\n              if (util.isList(list)) {\n                if (rangeLines.indexOf(list.lastElementChild) > -1) {\n                  lEl = list.lastElementChild;\n                } else {\n                  continue linesLoop;\n                }\n              }\n            }\n\n            fEl = nested.firstElementChild;\n            f = rangeLines.indexOf(fEl);\n            l = rangeLines.indexOf(lEl);\n            rangeLines.splice(f, l - f + 1);\n            len = rangeLines.length;\n            continue;\n          }\n        }\n      }\n\n      var last = rangeLines[rangeLines.length - 1];\n      var standTag, beforeTag, pElement;\n\n      if (util.isRangeFormatElement(last) || util.isFormatElement(last)) {\n        standTag = last;\n      } else {\n        standTag = util.getRangeFormatElement(last, null) || util.getFormatElement(last, null);\n      }\n\n      if (util.isCell(standTag)) {\n        beforeTag = null;\n        pElement = standTag;\n      } else {\n        beforeTag = standTag.nextSibling;\n        pElement = standTag.parentNode;\n      }\n\n      var parentDepth = util.getElementDepth(standTag);\n      var listParent = null;\n      var lineArr = [];\n\n      var removeItems = function removeItems(parent, origin, before) {\n        var cc = null;\n\n        if (parent !== origin && !util.isTable(origin)) {\n          if (origin && util.getElementDepth(parent) === util.getElementDepth(origin)) return before;\n          cc = util.removeItemAllParents(origin, null, parent);\n        }\n\n        return cc ? cc.ec : before;\n      };\n\n      for (var _i5 = 0, _len2 = rangeLines.length, _line, originParent, depth, before, nextLine, nextList, _nested; _i5 < _len2; _i5++) {\n        _line = rangeLines[_i5];\n        originParent = _line.parentNode;\n        if (!originParent || rangeElement.contains(originParent)) continue;\n        depth = util.getElementDepth(_line);\n\n        if (util.isList(originParent)) {\n          if (listParent === null) {\n            if (nextList) {\n              listParent = nextList;\n              _nested = true;\n              nextList = null;\n            } else {\n              listParent = originParent.cloneNode(false);\n            }\n          }\n\n          lineArr.push(_line);\n          nextLine = rangeLines[_i5 + 1];\n\n          if (_i5 === _len2 - 1 || nextLine && nextLine.parentNode !== originParent) {\n            // nested list\n            if (nextLine && _line.contains(nextLine.parentNode)) {\n              nextList = nextLine.parentNode.cloneNode(false);\n            }\n\n            var _list = originParent.parentNode,\n                p = void 0;\n\n            while (util.isList(_list)) {\n              p = util.createElement(_list.nodeName);\n              p.appendChild(listParent);\n              listParent = p;\n              _list = _list.parentNode;\n            }\n\n            var _edge = this.detachRangeFormatElement(originParent, lineArr, null, true, true);\n\n            if (parentDepth >= depth) {\n              parentDepth = depth;\n              pElement = _edge.cc;\n              beforeTag = removeItems(pElement, originParent, _edge.ec);\n              if (beforeTag) pElement = beforeTag.parentNode;\n            } else if (pElement === _edge.cc) {\n              beforeTag = _edge.ec;\n            }\n\n            if (pElement !== _edge.cc) {\n              before = removeItems(pElement, _edge.cc, before);\n              if (before !== undefined) beforeTag = before;else beforeTag = _edge.cc;\n            }\n\n            for (var c = 0, cLen = _edge.removeArray.length; c < cLen; c++) {\n              listParent.appendChild(_edge.removeArray[c]);\n            }\n\n            if (!_nested) rangeElement.appendChild(listParent);\n            if (nextList) _edge.removeArray[_edge.removeArray.length - 1].appendChild(nextList);\n            listParent = null;\n            _nested = false;\n          }\n        } else {\n          if (parentDepth >= depth) {\n            parentDepth = depth;\n            pElement = originParent;\n            beforeTag = _line.nextSibling;\n          }\n\n          rangeElement.appendChild(_line);\n\n          if (pElement !== originParent) {\n            before = removeItems(pElement, originParent);\n            if (before !== undefined) beforeTag = before;\n          }\n        }\n      }\n\n      this.effectNode = null;\n      util.mergeSameTags(rangeElement, null, false);\n      util.mergeNestedTags(rangeElement, function (current) {\n        return this.isList(current);\n      }.bind(util)); // Nested list\n\n      if (beforeTag && util.getElementDepth(beforeTag) > 0 && (util.isList(beforeTag.parentNode) || util.isList(beforeTag.parentNode.parentNode))) {\n        var depthFormat = util.getParentElement(beforeTag, function (current) {\n          return this.isRangeFormatElement(current) && !this.isList(current);\n        }.bind(util));\n        var splitRange = util.splitElement(beforeTag, null, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n        splitRange.parentNode.insertBefore(rangeElement, splitRange);\n      } else {\n        // basic\n        pElement.insertBefore(rangeElement, beforeTag);\n        removeItems(rangeElement, beforeTag);\n      }\n\n      var edge = util.getEdgeChildNodes(rangeElement.firstElementChild, rangeElement.lastElementChild);\n\n      if (rangeLines.length > 1) {\n        this.setRange(edge.sc, 0, edge.ec, edge.ec.textContent.length);\n      } else {\n        this.setRange(edge.ec, edge.ec.textContent.length, edge.ec, edge.ec.textContent.length);\n      } // history stack\n\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description The elements of the \"selectedFormats\" array are detached from the \"rangeElement\" element. (\"LI\" tags are converted to \"P\" tags)\r\n     * When \"selectedFormats\" is null, all elements are detached and return {cc: parentNode, sc: nextSibling, ec: previousSibling, removeArray: [Array of removed elements]}.\r\n     * @param {Element} rangeElement Range format element (PRE, BLOCKQUOTE, OL, UL...)\r\n     * @param {Array|null} selectedFormats Array of format elements (P, DIV, LI...) to remove.\r\n     * If null, Applies to all elements and return {cc: parentNode, sc: nextSibling, ec: previousSibling}\r\n     * @param {Element|null} newRangeElement The node(rangeElement) to replace the currently wrapped node.\r\n     * @param {Boolean} remove If true, deleted without detached.\r\n     * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n     * @returns {Object}\r\n     */\n    detachRangeFormatElement: function detachRangeFormatElement(rangeElement, selectedFormats, newRangeElement, remove, notHistoryPush) {\n      var range = this.getRange();\n      var so = range.startOffset;\n      var eo = range.endOffset;\n      var children = util.getListChildNodes(rangeElement, function (current) {\n        return current.parentNode === rangeElement;\n      });\n      var parent = rangeElement.parentNode;\n      var firstNode = null;\n      var lastNode = null;\n      var rangeEl = rangeElement.cloneNode(false);\n      var removeArray = [];\n      var newList = util.isList(newRangeElement);\n      var insertedNew = false;\n      var reset = false;\n      var moveComplete = false;\n\n      function appendNode(parent, insNode, sibling, originNode) {\n        if (util.onlyZeroWidthSpace(insNode)) insNode.innerHTML = util.zeroWidthSpace;\n\n        if (insNode.nodeType === 3) {\n          parent.insertBefore(insNode, sibling);\n          return insNode;\n        }\n\n        var insChildren = (moveComplete ? insNode : originNode).childNodes;\n        var format = insNode.cloneNode(false);\n        var first = null;\n        var c = null;\n\n        while (insChildren[0]) {\n          c = insChildren[0];\n\n          if (util._notTextNode(c) && !util.isBreak(c) && !util.isListCell(format)) {\n            if (format.childNodes.length > 0) {\n              if (!first) first = format;\n              parent.insertBefore(format, sibling);\n              format = insNode.cloneNode(false);\n            }\n\n            parent.insertBefore(c, sibling);\n            if (!first) first = c;\n          } else {\n            format.appendChild(c);\n          }\n        }\n\n        if (format.childNodes.length > 0) {\n          if (util.isListCell(parent) && util.isListCell(format) && util.isList(sibling)) {\n            if (newList) {\n              first = sibling;\n\n              while (sibling) {\n                format.appendChild(sibling);\n                sibling = sibling.nextSibling;\n              }\n\n              parent.parentNode.insertBefore(format, parent.nextElementSibling);\n            } else {\n              var originNext = originNode.nextElementSibling;\n              var detachRange = util.detachNestedList(originNode, false);\n\n              if (rangeElement !== detachRange || originNext !== originNode.nextElementSibling) {\n                var fChildren = format.childNodes;\n\n                while (fChildren[0]) {\n                  originNode.appendChild(fChildren[0]);\n                }\n\n                rangeElement = detachRange;\n                reset = true;\n              }\n            }\n          } else {\n            parent.insertBefore(format, sibling);\n          }\n\n          if (!first) first = format;\n        }\n\n        return first;\n      } // detach loop\n\n\n      for (var i = 0, len = children.length, insNode, lineIndex, next; i < len; i++) {\n        insNode = children[i];\n        if (insNode.nodeType === 3 && util.isList(rangeEl)) continue;\n        moveComplete = false;\n\n        if (remove && i === 0) {\n          if (!selectedFormats || selectedFormats.length === len || selectedFormats[0] === insNode) {\n            firstNode = rangeElement.previousSibling;\n          } else {\n            firstNode = rangeEl;\n          }\n        }\n\n        if (selectedFormats) lineIndex = selectedFormats.indexOf(insNode);\n\n        if (selectedFormats && lineIndex === -1) {\n          if (!rangeEl) rangeEl = rangeElement.cloneNode(false);\n          rangeEl.appendChild(insNode);\n        } else {\n          if (selectedFormats) next = selectedFormats[lineIndex + 1];\n\n          if (rangeEl && rangeEl.children.length > 0) {\n            parent.insertBefore(rangeEl, rangeElement);\n            rangeEl = null;\n          }\n\n          if (!newList && util.isListCell(insNode)) {\n            if (next && util.getElementDepth(insNode) !== util.getElementDepth(next) && (util.isListCell(parent) || util.getArrayItem(insNode.children, util.isList, false))) {\n              var insNext = insNode.nextElementSibling;\n              var detachRange = util.detachNestedList(insNode, false);\n\n              if (rangeElement !== detachRange || insNext !== insNode.nextElementSibling) {\n                rangeElement = detachRange;\n                reset = true;\n              }\n            } else {\n              var inner = insNode;\n              insNode = util.createElement(remove ? inner.nodeName : util.isList(rangeElement.parentNode) || util.isListCell(rangeElement.parentNode) ? 'LI' : util.isCell(rangeElement.parentNode) ? 'DIV' : options.defaultTag);\n              var isCell = util.isListCell(insNode);\n              var innerChildren = inner.childNodes;\n\n              while (innerChildren[0]) {\n                if (util.isList(innerChildren[0]) && !isCell) break;\n                insNode.appendChild(innerChildren[0]);\n              }\n\n              util.copyFormatAttributes(insNode, inner);\n              moveComplete = true;\n            }\n          } else {\n            insNode = insNode.cloneNode(false);\n          }\n\n          if (!reset) {\n            if (!remove) {\n              if (newRangeElement) {\n                if (!insertedNew) {\n                  parent.insertBefore(newRangeElement, rangeElement);\n                  insertedNew = true;\n                }\n\n                insNode = appendNode(newRangeElement, insNode, null, children[i]);\n              } else {\n                insNode = appendNode(parent, insNode, rangeElement, children[i]);\n              }\n\n              if (!reset) {\n                if (selectedFormats) {\n                  lastNode = insNode;\n\n                  if (!firstNode) {\n                    firstNode = insNode;\n                  }\n                } else if (!firstNode) {\n                  firstNode = lastNode = insNode;\n                }\n              }\n            } else {\n              removeArray.push(insNode);\n              util.removeItem(children[i]);\n            }\n\n            if (reset) {\n              reset = moveComplete = false;\n              children = util.getListChildNodes(rangeElement, function (current) {\n                return current.parentNode === rangeElement;\n              });\n              rangeEl = rangeElement.cloneNode(false);\n              parent = rangeElement.parentNode;\n              i = -1;\n              len = children.length;\n              continue;\n            }\n          }\n        }\n      }\n\n      var rangeParent = rangeElement.parentNode;\n      var rangeRight = rangeElement.nextSibling;\n\n      if (rangeEl && rangeEl.children.length > 0) {\n        rangeParent.insertBefore(rangeEl, rangeRight);\n      }\n\n      if (newRangeElement) firstNode = newRangeElement.previousSibling;else if (!firstNode) firstNode = rangeElement.previousSibling;\n      rangeRight = rangeElement.nextSibling !== rangeEl ? rangeElement.nextSibling : rangeEl ? rangeEl.nextSibling : null;\n\n      if (rangeElement.children.length === 0 || rangeElement.textContent.length === 0) {\n        util.removeItem(rangeElement);\n      } else {\n        util.removeEmptyNode(rangeElement, null);\n      }\n\n      var edge = null;\n\n      if (remove) {\n        edge = {\n          cc: rangeParent,\n          sc: firstNode,\n          ec: rangeRight,\n          removeArray: removeArray\n        };\n      } else {\n        if (!firstNode) firstNode = lastNode;\n        if (!lastNode) lastNode = firstNode;\n        var childEdge = util.getEdgeChildNodes(firstNode, lastNode.parentNode ? firstNode : lastNode);\n        edge = {\n          cc: (childEdge.sc || childEdge.ec).parentNode,\n          sc: childEdge.sc,\n          ec: childEdge.ec\n        };\n      }\n\n      this.effectNode = null;\n      if (notHistoryPush) return edge;\n\n      if (!remove && edge) {\n        if (!selectedFormats) {\n          this.setRange(edge.sc, 0, edge.sc, 0);\n        } else {\n          this.setRange(edge.sc, so, edge.ec, eo);\n        }\n      } // history stack\n\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description \"selectedFormats\" array are detached from the list element.\r\n     * The return value is applied when the first and last lines of \"selectedFormats\" are \"LI\" respectively.\r\n     * @param {Array} selectedFormats Array of format elements (LI, P...) to remove.\r\n     * @param {Boolean} remove If true, deleted without detached.\r\n     * @returns {Object} {sc: <LI>, ec: <LI>}.\r\n     */\n    detachList: function detachList(selectedFormats, remove) {\n      var rangeArr = {};\n      var listFirst = false;\n      var listLast = false;\n      var first = null;\n      var last = null;\n\n      var passComponent = function (current) {\n        return !this.isComponent(current);\n      }.bind(util);\n\n      for (var i = 0, len = selectedFormats.length, r, o, lastIndex, isList; i < len; i++) {\n        lastIndex = i === len - 1;\n        o = util.getRangeFormatElement(selectedFormats[i], passComponent);\n        isList = util.isList(o);\n\n        if (!r && isList) {\n          r = o;\n          rangeArr = {\n            r: r,\n            f: [util.getParentElement(selectedFormats[i], 'LI')]\n          };\n          if (i === 0) listFirst = true;\n        } else if (r && isList) {\n          if (r !== o) {\n            var edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\n            o = selectedFormats[i].parentNode;\n\n            if (listFirst) {\n              first = edge.sc;\n              listFirst = false;\n            }\n\n            if (lastIndex) last = edge.ec;\n\n            if (isList) {\n              r = o;\n              rangeArr = {\n                r: r,\n                f: [util.getParentElement(selectedFormats[i], 'LI')]\n              };\n              if (lastIndex) listLast = true;\n            } else {\n              r = null;\n            }\n          } else {\n            rangeArr.f.push(util.getParentElement(selectedFormats[i], 'LI'));\n            if (lastIndex) listLast = true;\n          }\n        }\n\n        if (lastIndex && util.isList(r)) {\n          var _edge2 = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\n\n          if (listLast || len === 1) last = _edge2.ec;\n          if (listFirst) first = _edge2.sc || last;\n        }\n      }\n\n      return {\n        sc: first,\n        ec: last\n      };\n    },\n\n    /**\r\n     * @description Add, update, and delete nodes from selected text.\r\n     * 1. If there is a node in the \"appendNode\" argument, a node with the same tags and attributes as \"appendNode\" is added to the selection text.\r\n     * 2. If it is in the same tag, only the tag's attributes are changed without adding a tag.\r\n     * 3. If the \"appendNode\" argument is null, the node of the selection is update or remove without adding a new node.\r\n     * 4. The same style as the style attribute of the \"styleArray\" argument is deleted.\r\n     *    (Styles should be put with attribute names from css. [\"background-color\"])\r\n     * 5. The same class name as the class attribute of the \"styleArray\" argument is deleted.\r\n     *    (The class name is preceded by \".\" [\".className\"])\r\n     * 6. Use a list of styles and classes of \"appendNode\" in \"styleArray\" to avoid duplicate property values.\r\n     * 7. If a node with all styles and classes removed has the same tag name as \"appendNode\" or \"removeNodeArray\", or \"appendNode\" is null, that node is deleted.\r\n     * 8. Regardless of the style and class of the node, the tag with the same name as the \"removeNodeArray\" argument value is deleted.\r\n     * 9. If the \"strictRemove\" argument is true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n     *10. It won't work if the parent node has the same class and same value style.\r\n     *    However, if there is a value in \"removeNodeArray\", it works and the text node is separated even if there is no node to replace.\r\n     * @param {Element|null} appendNode The element to be added to the selection. If it is null, only delete the node.\r\n     * @param {Array|null} styleArray The style or className attribute name Array to check (['font-size'], ['.className'], ['font-family', 'color', '.className']...])\r\n     * @param {Array|null} removeNodeArray An array of node names to remove types from, remove all formats when \"appendNode\" is null and there is an empty array or null value. (['span'], ['strong', 'em'] ...])\r\n     * @param {Boolean|null} strictRemove If true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n     */\n    nodeChange: function nodeChange(appendNode, styleArray, removeNodeArray, strictRemove) {\n      this._resetRangeToTextNode();\n\n      var range = this.getRange_addLine(this.getRange(), null);\n      styleArray = styleArray && styleArray.length > 0 ? styleArray : false;\n      removeNodeArray = removeNodeArray && removeNodeArray.length > 0 ? removeNodeArray : false;\n      var isRemoveNode = !appendNode;\n      var isRemoveFormat = isRemoveNode && !removeNodeArray && !styleArray;\n      var startCon = range.startContainer;\n      var startOff = range.startOffset;\n      var endCon = range.endContainer;\n      var endOff = range.endOffset;\n\n      if (isRemoveFormat && range.collapsed && util.isFormatElement(startCon.parentNode) || startCon === endCon && startCon.nodeType === 1 && util.isNonEditable(startCon)) {\n        var format = startCon.parentNode;\n        if (!util.isListCell(format) || !util.getValues(format.style).some(function (k) {\n          return this._listKebab.indexOf(k) > -1;\n        }.bind(this))) return;\n      }\n\n      if (range.collapsed && !isRemoveFormat) {\n        if (startCon.nodeType === 1 && !util.isBreak(startCon) && !util.isComponent(startCon)) {\n          var afterNode = null;\n          var focusNode = startCon.childNodes[startOff];\n\n          if (focusNode) {\n            if (!focusNode.nextSibling) {\n              afterNode = null;\n            } else {\n              afterNode = util.isBreak(focusNode) ? focusNode : focusNode.nextSibling;\n            }\n          }\n\n          var zeroWidth = util.createTextNode(util.zeroWidthSpace);\n          startCon.insertBefore(zeroWidth, afterNode);\n          this.setRange(zeroWidth, 1, zeroWidth, 1);\n          range = this.getRange();\n          startCon = range.startContainer;\n          startOff = range.startOffset;\n          endCon = range.endContainer;\n          endOff = range.endOffset;\n        }\n      }\n\n      if (util.isFormatElement(startCon)) {\n        startCon = startCon.childNodes[startOff] || startCon.firstChild;\n        startOff = 0;\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon.lastChild;\n        endOff = endCon.textContent.length;\n      }\n\n      if (isRemoveNode) {\n        appendNode = util.createElement('DIV');\n      }\n\n      var wRegExp = _w.RegExp;\n      var newNodeName = appendNode.nodeName;\n      /* checked same style property */\n\n      if (!isRemoveFormat && startCon === endCon && !removeNodeArray && appendNode) {\n        var sNode = startCon;\n        var checkCnt = 0;\n        var checkAttrs = [];\n        var checkStyles = appendNode.style;\n\n        for (var i = 0, len = checkStyles.length; i < len; i++) {\n          checkAttrs.push(checkStyles[i]);\n        }\n\n        var ckeckClasses = appendNode.classList;\n\n        for (var _i6 = 0, _len3 = ckeckClasses.length; _i6 < _len3; _i6++) {\n          checkAttrs.push('.' + ckeckClasses[_i6]);\n        }\n\n        if (checkAttrs.length > 0) {\n          while (!util.isFormatElement(sNode) && !util.isWysiwygDiv(sNode)) {\n            for (var _i7 = 0; _i7 < checkAttrs.length; _i7++) {\n              if (sNode.nodeType === 1) {\n                var s = checkAttrs[_i7];\n                var classReg = /^\\./.test(s) ? new wRegExp('\\\\s*' + s.replace(/^\\./, '') + '(\\\\s+|$)', 'ig') : false;\n                var styleCheck = isRemoveNode ? !!sNode.style[s] : !!sNode.style[s] && !!appendNode.style[s] && sNode.style[s] === appendNode.style[s];\n                var classCheck = classReg === false ? false : isRemoveNode ? !!sNode.className.match(classReg) : !!sNode.className.match(classReg) && !!appendNode.className.match(classReg);\n\n                if (styleCheck || classCheck) {\n                  checkCnt++;\n                }\n              }\n            }\n\n            sNode = sNode.parentNode;\n          }\n\n          if (checkCnt >= checkAttrs.length) return;\n        }\n      }\n\n      var start = {},\n          end = {};\n      var newNode,\n          styleRegExp = '',\n          classRegExp = '',\n          removeNodeRegExp = '';\n\n      if (styleArray) {\n        for (var _i8 = 0, _len4 = styleArray.length, _s; _i8 < _len4; _i8++) {\n          _s = styleArray[_i8];\n\n          if (/^\\./.test(_s)) {\n            classRegExp += (classRegExp ? '|' : '\\\\s*(?:') + _s.replace(/^\\./, '');\n          } else {\n            styleRegExp += (styleRegExp ? '|' : '(?:;|^|\\\\s)(?:') + _s;\n          }\n        }\n\n        if (styleRegExp) {\n          styleRegExp += ')\\\\s*:[^;]*\\\\s*(?:;|$)';\n          styleRegExp = new wRegExp(styleRegExp, 'ig');\n        }\n\n        if (classRegExp) {\n          classRegExp += ')(?=\\\\s+|$)';\n          classRegExp = new wRegExp(classRegExp, 'ig');\n        }\n      }\n\n      if (removeNodeArray) {\n        removeNodeRegExp = '^(?:' + removeNodeArray[0];\n\n        for (var _i9 = 1; _i9 < removeNodeArray.length; _i9++) {\n          removeNodeRegExp += '|' + removeNodeArray[_i9];\n        }\n\n        removeNodeRegExp += ')$';\n        removeNodeRegExp = new wRegExp(removeNodeRegExp, 'i');\n      }\n      /** validation check function*/\n\n\n      var wBoolean = _w.Boolean;\n      var _removeCheck = {\n        v: false\n      };\n\n      var validation = function validation(checkNode) {\n        var vNode = checkNode.cloneNode(false); // all path\n\n        if (vNode.nodeType === 3 || util.isBreak(vNode)) return vNode; // all remove\n\n        if (isRemoveFormat) return null; // remove node check\n\n        var tagRemove = !removeNodeRegExp && isRemoveNode || removeNodeRegExp && removeNodeRegExp.test(vNode.nodeName); // tag remove\n\n        if (tagRemove && !strictRemove) {\n          _removeCheck.v = true;\n          return null;\n        } // style regexp\n\n\n        var originStyle = vNode.style.cssText;\n        var style = '';\n\n        if (styleRegExp && originStyle.length > 0) {\n          style = originStyle.replace(styleRegExp, '').trim();\n          if (style !== originStyle) _removeCheck.v = true;\n        } // class check\n\n\n        var originClasses = vNode.className;\n        var classes = '';\n\n        if (classRegExp && originClasses.length > 0) {\n          classes = originClasses.replace(classRegExp, '').trim();\n          if (classes !== originClasses) _removeCheck.v = true;\n        } // remove only\n\n\n        if (isRemoveNode) {\n          if ((classRegExp || !originClasses) && (styleRegExp || !originStyle) && !style && !classes && tagRemove) {\n            _removeCheck.v = true;\n            return null;\n          }\n        } // change\n\n\n        if (style || classes || vNode.nodeName !== newNodeName || wBoolean(styleRegExp) !== wBoolean(originStyle) || wBoolean(classRegExp) !== wBoolean(originClasses)) {\n          if (styleRegExp && originStyle.length > 0) vNode.style.cssText = style;\n\n          if (!vNode.style.cssText) {\n            vNode.removeAttribute('style');\n          }\n\n          if (classRegExp && originClasses.length > 0) vNode.className = classes.trim();\n\n          if (!vNode.className.trim()) {\n            vNode.removeAttribute('class');\n          }\n\n          if (!vNode.style.cssText && !vNode.className && (vNode.nodeName === newNodeName || tagRemove)) {\n            _removeCheck.v = true;\n            return null;\n          }\n\n          return vNode;\n        }\n\n        _removeCheck.v = true;\n        return null;\n      }; // get line nodes\n\n\n      var lineNodes = this.getSelectedElements(null);\n      range = this.getRange();\n      startCon = range.startContainer;\n      startOff = range.startOffset;\n      endCon = range.endContainer;\n      endOff = range.endOffset;\n\n      if (!util.getFormatElement(startCon, null)) {\n        startCon = util.getChildElement(lineNodes[0], function (current) {\n          return current.nodeType === 3;\n        }, false);\n        startOff = 0;\n      }\n\n      if (!util.getFormatElement(endCon, null)) {\n        endCon = util.getChildElement(lineNodes[lineNodes.length - 1], function (current) {\n          return current.nodeType === 3;\n        }, false);\n        endOff = endCon.textContent.length;\n      }\n\n      var oneLine = util.getFormatElement(startCon, null) === util.getFormatElement(endCon, null);\n      var endLength = lineNodes.length - (oneLine ? 0 : 1); // node Changes\n\n      newNode = appendNode.cloneNode(false);\n\n      var isRemoveAnchor = isRemoveFormat || isRemoveNode && function (arr) {\n        for (var n = 0, _len5 = arr.length; n < _len5; n++) {\n          if (util._isMaintainedNode(arr[n]) || util._isSizeNode(arr[n])) return true;\n        }\n\n        return false;\n      }(removeNodeArray);\n\n      var isSizeNode = isRemoveNode || util._isSizeNode(newNode);\n\n      var _getMaintainedNode = this._util_getMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\n\n      var _isMaintainedNode = this._util_isMaintainedNode.bind(util, isRemoveAnchor, isSizeNode); // one line\n\n\n      if (oneLine) {\n        if (this._resetCommonListCell(lineNodes[0], styleArray)) range = this.setRange(startCon, startOff, endCon, endOff);\n\n        var newRange = this._nodeChange_oneLine(lineNodes[0], newNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, range.collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode);\n\n        start.container = newRange.startContainer;\n        start.offset = newRange.startOffset;\n        end.container = newRange.endContainer;\n        end.offset = newRange.endOffset;\n\n        if (start.container === end.container && util.onlyZeroWidthSpace(start.container)) {\n          start.offset = end.offset = 1;\n        }\n\n        this._setCommonListStyle(newRange.ancestor, null);\n      } else {\n        // multi line \n        var appliedCommonList = false;\n        if (endLength > 0 && this._resetCommonListCell(lineNodes[endLength], styleArray)) appliedCommonList = true;\n        if (this._resetCommonListCell(lineNodes[0], styleArray)) appliedCommonList = true;\n        if (appliedCommonList) this.setRange(startCon, startOff, endCon, endOff); // end\n\n        if (endLength > 0) {\n          newNode = appendNode.cloneNode(false);\n          end = this._nodeChange_endLine(lineNodes[endLength], newNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode);\n        } // mid\n\n\n        for (var _i10 = endLength - 1, _newRange; _i10 > 0; _i10--) {\n          this._resetCommonListCell(lineNodes[_i10], styleArray);\n\n          newNode = appendNode.cloneNode(false);\n          _newRange = this._nodeChange_middleLine(lineNodes[_i10], newNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, end.container);\n\n          if (_newRange.endContainer && _newRange.ancestor.contains(_newRange.endContainer)) {\n            end.ancestor = null;\n            end.container = _newRange.endContainer;\n          }\n\n          this._setCommonListStyle(_newRange.ancestor, null);\n        } // start\n\n\n        newNode = appendNode.cloneNode(false);\n        start = this._nodeChange_startLine(lineNodes[0], newNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, end.container);\n\n        if (start.endContainer) {\n          end.ancestor = null;\n          end.container = start.endContainer;\n        }\n\n        if (endLength <= 0) {\n          end = start;\n        } else if (!end.container) {\n          end.ancestor = null;\n          end.container = start.container;\n          end.offset = start.container.textContent.length;\n        }\n\n        this._setCommonListStyle(start.ancestor, null);\n\n        this._setCommonListStyle(end.ancestor || util.getFormatElement(end.container), null);\n      } // set range\n\n\n      this.controllersOff();\n      this.setRange(start.container, start.offset, end.container, end.offset); // history stack\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description Reset common style of list cell\r\n     * @param {Element} el List cell element. <li>\r\n     * @param {Array|null} styleArray Style array\r\n     * @private\r\n     */\n    _resetCommonListCell: function _resetCommonListCell(el, styleArray) {\n      if (!util.isListCell(el)) return;\n      if (!styleArray) styleArray = this._listKebab;\n      var children = util.getArrayItem(el.childNodes, function (current) {\n        return !util.isBreak(current);\n      }, true);\n      var elStyles = el.style;\n      var ec = [],\n          ek = [],\n          elKeys = util.getValues(elStyles);\n\n      for (var i = 0, len = this._listKebab.length; i < len; i++) {\n        if (elKeys.indexOf(this._listKebab[i]) > -1 && styleArray.indexOf(this._listKebab[i]) > -1) {\n          ec.push(this._listCamel[i]);\n          ek.push(this._listKebab[i]);\n        }\n      }\n\n      if (!ec.length) return; // reset cell style---\n\n      var refer = util.createElement('SPAN');\n\n      for (var _i11 = 0, _len6 = ec.length; _i11 < _len6; _i11++) {\n        refer.style[ec[_i11]] = elStyles[ek[_i11]];\n        elStyles.removeProperty(ek[_i11]);\n      }\n\n      var sel = refer.cloneNode(false);\n      var r = null,\n          appliedEl = false;\n\n      var _loop = function _loop(_c2, _s2, _i12, _len7) {\n        _c2 = children[_i12];\n\n        if (options._textTagsMap[_c2.nodeName.toLowerCase()]) {\n          s = _s2;\n          {\n            c = _c2;\n            return \"continue\";\n          }\n        }\n\n        _s2 = util.getValues(_c2.style);\n\n        if (_s2.length === 0 || ec.some(function (k) {\n          c = _c2;\n          s = _s2;\n          return _s2.indexOf(k) === -1;\n        }) && _s2.some(function (k) {\n          ec.indexOf(k) > -1;\n        })) {\n          r = _c2.nextSibling;\n          sel.appendChild(_c2);\n        } else if (sel.childNodes.length > 0) {\n          el.insertBefore(sel, r);\n          sel = refer.cloneNode(false);\n          r = null;\n          appliedEl = true;\n        }\n\n        c = _c2;\n        s = _s2;\n      };\n\n      for (var _i12 = 0, _len7 = children.length, c, s; _i12 < _len7; _i12++) {\n        var _ret = _loop(c, s, _i12, _len7);\n\n        if (_ret === \"continue\") continue;\n      }\n\n      if (sel.childNodes.length > 0) {\n        el.insertBefore(sel, r);\n        appliedEl = true;\n      }\n\n      if (!elStyles.length) {\n        el.removeAttribute('style');\n      }\n\n      return appliedEl;\n    },\n\n    /**\r\n     * @description If certain styles are applied to all child nodes of the list cell, the style of the list cell is also changed. (bold, color, size)\r\n     * @param {Element} el List cell element. <li>\r\n     * @param {Element|null} child Variable for recursive call. (\"null\" on the first call)\r\n     * @private\r\n     */\n    _setCommonListStyle: function _setCommonListStyle(el, child) {\n      if (!util.isListCell(el)) return;\n      var children = util.getArrayItem((child || el).childNodes, function (current) {\n        return !util.isBreak(current);\n      }, true);\n      child = children[0];\n      if (!child || children.length > 1 || child.nodeType !== 1) return; // set cell style---\n\n      var childStyle = child.style;\n      var elStyle = el.style;\n      var nodeName = child.nodeName.toLowerCase();\n      var appliedEl = false; // bold, italic\n\n      if (options._textTagsMap[nodeName] === options._defaultCommand.bold.toLowerCase()) elStyle.fontWeight = 'bold';\n      if (options._textTagsMap[nodeName] === options._defaultCommand.italic.toLowerCase()) elStyle.fontStyle = 'italic'; // styles\n\n      var cKeys = util.getValues(childStyle);\n\n      if (cKeys.length > 0) {\n        for (var i = 0, len = this._listCamel.length; i < len; i++) {\n          if (cKeys.indexOf(this._listKebab[i]) > -1) {\n            elStyle[this._listCamel[i]] = childStyle[this._listCamel[i]];\n            childStyle.removeProperty(this._listKebab[i]);\n            appliedEl = true;\n          }\n        }\n      }\n\n      this._setCommonListStyle(el, child);\n\n      if (!appliedEl) return; // common style\n\n      if (!childStyle.length) {\n        var ch = child.childNodes;\n        var p = child.parentNode;\n        var n = child.nextSibling;\n\n        while (ch.length > 0) {\n          p.insertBefore(ch[0], n);\n        }\n\n        util.removeItem(child);\n      }\n    },\n\n    /**\r\n     * @description Strip remove node\r\n     * @param {Node} removeNode The remove node\r\n     * @private\r\n     */\n    _stripRemoveNode: function _stripRemoveNode(removeNode) {\n      var element = removeNode.parentNode;\n      if (!removeNode || removeNode.nodeType === 3 || !element) return;\n      var children = removeNode.childNodes;\n\n      while (children[0]) {\n        element.insertBefore(children[0], removeNode);\n      }\n\n      element.removeChild(removeNode);\n    },\n\n    /**\r\n     * @description Return the parent maintained tag. (bind and use a util object)\r\n     * @param {Element} element Element\r\n     * @returns {Element}\r\n     * @private\r\n     */\n    _util_getMaintainedNode: function _util_getMaintainedNode(_isRemove, _isSizeNode, element) {\n      if (!element || _isRemove) return null;\n      return this.getParentElement(element, this._isMaintainedNode.bind(this)) || (!_isSizeNode ? this.getParentElement(element, this._isSizeNode.bind(this)) : null);\n    },\n\n    /**\r\n     * @description Check if element is a tag that should be persisted. (bind and use a util object)\r\n     * @param {Element} element Element\r\n     * @returns {Element}\r\n     * @private\r\n     */\n    _util_isMaintainedNode: function _util_isMaintainedNode(_isRemove, _isSizeNode, element) {\n      if (!element || _isRemove || element.nodeType !== 1) return false;\n\n      var anchor = this._isMaintainedNode(element);\n\n      return this.getParentElement(element, this._isMaintainedNode.bind(this)) ? anchor : anchor || (!_isSizeNode ? this._isSizeNode(element) : false);\n    },\n\n    /**\r\n     * @description wraps text nodes of line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @param {Boolean} collapsed range.collapsed\r\n     * @returns {{ancestor: *, startContainer: *, startOffset: *, endContainer: *, endOffset: *}}\r\n     * @private\r\n     */\n    _nodeChange_oneLine: function _nodeChange_oneLine(element, newInnerNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\n      // not add tag\n      var parentCon = startCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon === endCon.parentNode && parentCon.nodeName === newInnerNode.nodeName) {\n        if (util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff)) && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\n          var children = parentCon.childNodes;\n          var sameTag = true;\n\n          for (var i = 0, len = children.length, _c3, _s3, e, z; i < len; i++) {\n            _c3 = children[i];\n            z = !util.onlyZeroWidthSpace(_c3);\n\n            if (_c3 === startCon) {\n              _s3 = true;\n              continue;\n            }\n\n            if (_c3 === endCon) {\n              e = true;\n              continue;\n            }\n\n            if (!_s3 && z || _s3 && e && z) {\n              sameTag = false;\n              break;\n            }\n          }\n\n          if (sameTag) {\n            util.copyTagAttributes(parentCon, newInnerNode);\n            return {\n              ancestor: element,\n              startContainer: startCon,\n              startOffset: startOff,\n              endContainer: endCon,\n              endOffset: endOff\n            };\n          }\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      var el = element;\n      var nNodeArray = [newInnerNode];\n      var pNode = element.cloneNode(false);\n      var isSameNode = startCon === endCon;\n      var startContainer = startCon;\n      var startOffset = startOff;\n      var endContainer = endCon;\n      var endOffset = endOff;\n      var startPass = false;\n      var endPass = false;\n      var pCurrent, newNode, appendNode, cssText, anchorNode;\n      var wRegExp = _w.RegExp;\n\n      function checkCss(vNode) {\n        var regExp = new wRegExp('(?:;|^|\\\\s)(?:' + cssText + 'null)\\\\s*:[^;]*\\\\s*(?:;|$)', 'ig');\n        var style = '';\n\n        if (regExp && vNode.style.cssText.length > 0) {\n          style = regExp.test(vNode.style.cssText);\n        }\n\n        return !style;\n      }\n\n      (function recursionFunc(current, ancestor) {\n        var childNodes = current.childNodes;\n\n        for (var _i13 = 0, _len8 = childNodes.length, vNode; _i13 < _len8; _i13++) {\n          var child = childNodes[_i13];\n          if (!child) continue;\n          var coverNode = ancestor;\n          var cloneNode = void 0; // startContainer\n\n          if (!startPass && child === startContainer) {\n            var line = pNode;\n            anchorNode = _getMaintainedNode(child);\n            var prevNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(0, startOffset));\n            var textNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(startOffset, isSameNode ? endOffset >= startOffset ? endOffset - startOffset : startContainer.data.length - startOffset : startContainer.data.length - startOffset));\n\n            if (anchorNode) {\n              var a = _getMaintainedNode(ancestor);\n\n              if (a && a.parentNode !== line) {\n                var m = a;\n                var p = null;\n\n                while (m.parentNode !== line) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.appendChild(a);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            }\n\n            if (!util.onlyZeroWidthSpace(prevNode)) {\n              ancestor.appendChild(prevNode);\n            }\n\n            var prevAnchorNode = _getMaintainedNode(ancestor);\n\n            if (!!prevAnchorNode) anchorNode = prevAnchorNode;\n            if (anchorNode) line = anchorNode;\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n\n            while (newNode !== line && newNode !== el && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\n                pCurrent.push(vNode);\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            var childNode = pCurrent.pop() || textNode;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            newInnerNode.appendChild(childNode);\n            line.appendChild(newInnerNode);\n\n            if (anchorNode && !_getMaintainedNode(endContainer)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            startContainer = textNode;\n            startOffset = 0;\n            startPass = true;\n            if (newNode !== textNode) newNode.appendChild(startContainer);\n            if (!isSameNode) continue;\n          } // endContainer\n\n\n          if (!endPass && child === endContainer) {\n            anchorNode = _getMaintainedNode(child);\n            var afterNode = util.createTextNode(endContainer.nodeType === 1 ? '' : endContainer.substringData(endOffset, endContainer.length - endOffset));\n\n            var _textNode = util.createTextNode(isSameNode || endContainer.nodeType === 1 ? '' : endContainer.substringData(0, endOffset));\n\n            if (anchorNode) {\n              anchorNode = anchorNode.cloneNode(false);\n            } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!util.onlyZeroWidthSpace(afterNode)) {\n              newNode = child;\n              cssText = '';\n              pCurrent = [];\n              var anchors = [];\n\n              while (newNode !== pNode && newNode !== el && newNode !== null) {\n                if (newNode.nodeType === 1 && checkCss(newNode)) {\n                  if (_isMaintainedNode(newNode)) anchors.push(newNode.cloneNode(false));else pCurrent.push(newNode.cloneNode(false));\n                  cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n                }\n\n                newNode = newNode.parentNode;\n              }\n\n              pCurrent = pCurrent.concat(anchors);\n              cloneNode = appendNode = newNode = pCurrent.pop() || afterNode;\n\n              while (pCurrent.length > 0) {\n                newNode = pCurrent.pop();\n                appendNode.appendChild(newNode);\n                appendNode = newNode;\n              }\n\n              pNode.appendChild(cloneNode);\n              newNode.textContent = afterNode.data;\n            }\n\n            if (anchorNode && cloneNode) {\n              var afterAnchorNode = _getMaintainedNode(cloneNode);\n\n              if (afterAnchorNode) {\n                anchorNode = afterAnchorNode;\n              }\n            }\n\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n\n            while (newNode !== pNode && newNode !== el && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\n                pCurrent.push(vNode);\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            var _childNode = pCurrent.pop() || _textNode;\n\n            appendNode = newNode = _childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              newInnerNode.appendChild(_childNode);\n              anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\n              pNode.appendChild(anchorNode);\n              nNodeArray.push(newInnerNode);\n              anchorNode = null;\n            } else {\n              newInnerNode.appendChild(_childNode);\n            }\n\n            endContainer = _textNode;\n            endOffset = _textNode.data.length;\n            endPass = true;\n\n            if (!isRemoveFormat && collapsed) {\n              newInnerNode = _textNode;\n              _textNode.textContent = util.zeroWidthSpace;\n            }\n\n            if (newNode !== _textNode) newNode.appendChild(endContainer);\n            continue;\n          } // other\n\n\n          if (startPass) {\n            if (child.nodeType === 1 && !util.isBreak(child)) {\n              if (util._isIgnoreNodeChange(child)) {\n                pNode.appendChild(child.cloneNode(true));\n\n                if (!collapsed) {\n                  newInnerNode = newInnerNode.cloneNode(false);\n                  pNode.appendChild(newInnerNode);\n                  nNodeArray.push(newInnerNode);\n                }\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n            var _anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = endPass ? newNode.cloneNode(false) : validation(newNode);\n\n              if (newNode.nodeType === 1 && !util.isBreak(child) && vNode && checkCss(newNode)) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) _anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(_anchors);\n\n            var _childNode2 = pCurrent.pop() || child;\n\n            appendNode = newNode = _childNode2;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(_childNode2) && !util.onlyZeroWidthSpace(newInnerNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!endPass && !anchorNode && _isMaintainedNode(_childNode2)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              var aChildren = _childNode2.childNodes;\n\n              for (var _a = 0, aLen = aChildren.length; _a < aLen; _a++) {\n                newInnerNode.appendChild(aChildren[_a]);\n              }\n\n              _childNode2.appendChild(newInnerNode);\n\n              pNode.appendChild(_childNode2);\n              nNodeArray.push(newInnerNode);\n              if (newInnerNode.children.length > 0) ancestor = newNode;else ancestor = newInnerNode;\n            } else if (_childNode2 === child) {\n              if (!endPass) ancestor = newInnerNode;else ancestor = pNode;\n            } else if (endPass) {\n              pNode.appendChild(_childNode2);\n              ancestor = newNode;\n            } else {\n              newInnerNode.appendChild(_childNode2);\n              ancestor = newNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                var ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.appendChild(newInnerNode);\n              } else {\n                anchorNode = null;\n              }\n            }\n          }\n\n          cloneNode = child.cloneNode(false);\n          ancestor.appendChild(cloneNode);\n          if (child.nodeType === 1 && !util.isBreak(child)) coverNode = cloneNode;\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          startContainer: startCon,\n          startOffset: startOff,\n          endContainer: endCon,\n          endOffset: endOff\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (var _i14 = 0; _i14 < nNodeArray.length; _i14++) {\n          var removeNode = nNodeArray[_i14];\n          var textNode = void 0,\n              textNode_s = void 0,\n              textNode_e = void 0;\n\n          if (collapsed) {\n            textNode = util.createTextNode(util.zeroWidthSpace);\n            pNode.replaceChild(textNode, removeNode);\n          } else {\n            var rChildren = removeNode.childNodes;\n            textNode_s = rChildren[0];\n\n            while (rChildren[0]) {\n              textNode_e = rChildren[0];\n              pNode.insertBefore(textNode_e, removeNode);\n            }\n\n            util.removeItem(removeNode);\n          }\n\n          if (_i14 === 0) {\n            if (collapsed) {\n              startContainer = endContainer = textNode;\n            } else {\n              startContainer = textNode_s;\n              endContainer = textNode_e;\n            }\n          }\n        }\n      } else {\n        if (isRemoveNode) {\n          for (var _i15 = 0; _i15 < nNodeArray.length; _i15++) {\n            this._stripRemoveNode(nNodeArray[_i15]);\n          }\n        }\n\n        if (collapsed) {\n          startContainer = endContainer = newInnerNode;\n        }\n      }\n\n      util.removeEmptyNode(pNode, newInnerNode);\n\n      if (collapsed) {\n        startOffset = startContainer.textContent.length;\n        endOffset = endContainer.textContent.length;\n      } // endContainer reset\n\n\n      var endConReset = isRemoveFormat || endContainer.textContent.length === 0;\n\n      if (!util.isBreak(endContainer) && endContainer.textContent.length === 0) {\n        util.removeItem(endContainer);\n        endContainer = startContainer;\n      }\n\n      endOffset = endConReset ? endContainer.textContent.length : endOffset; // node change\n\n      var newStartOffset = {\n        s: 0,\n        e: 0\n      };\n      var startPath = util.getNodePath(startContainer, pNode, newStartOffset);\n      var mergeEndCon = !endContainer.parentNode;\n      if (mergeEndCon) endContainer = startContainer;\n      var newEndOffset = {\n        s: 0,\n        e: 0\n      };\n      var endPath = util.getNodePath(endContainer, pNode, !mergeEndCon && !endConReset ? newEndOffset : null);\n      startOffset += newStartOffset.s;\n      endOffset = collapsed ? startOffset : mergeEndCon ? startContainer.textContent.length : endConReset ? endOffset + newStartOffset.s : endOffset + newEndOffset.s; // tag merge\n\n      var newOffsets = util.mergeSameTags(pNode, [startPath, endPath], true);\n      element.parentNode.replaceChild(pNode, element);\n      startContainer = util.getNodeFromPath(startPath, pNode);\n      endContainer = util.getNodeFromPath(endPath, pNode);\n      return {\n        ancestor: pNode,\n        startContainer: startContainer,\n        startOffset: startOffset + newOffsets[0],\n        endContainer: endContainer,\n        endOffset: endOffset + newOffsets[1]\n      };\n    },\n\n    /**\r\n     * @description wraps first line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @returns {null|Node} If end container is renewed, returned renewed node\r\n     * @returns {Object} { ancestor, container, offset, endContainer }\r\n     * @private\r\n     */\n    _nodeChange_startLine: function _nodeChange_startLine(element, newInnerNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, _endContainer) {\n      // not add tag\n      var parentCon = startCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.nextSibling && util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff))) {\n        var sameTag = true;\n        var _s4 = startCon.previousSibling;\n\n        while (_s4) {\n          if (!util.onlyZeroWidthSpace(_s4)) {\n            sameTag = false;\n            break;\n          }\n\n          _s4 = _s4.previousSibling;\n        }\n\n        if (sameTag) {\n          util.copyTagAttributes(parentCon, newInnerNode);\n          return {\n            ancestor: element,\n            container: startCon,\n            offset: startOff\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      var el = element;\n      var nNodeArray = [newInnerNode];\n      var pNode = element.cloneNode(false);\n      var container = startCon;\n      var offset = startOff;\n      var passNode = false;\n      var pCurrent, newNode, appendNode, anchorNode;\n\n      (function recursionFunc(current, ancestor) {\n        var childNodes = current.childNodes;\n\n        for (var i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\n          var child = childNodes[i];\n          if (!child) continue;\n          var coverNode = ancestor;\n\n          if (passNode && !util.isBreak(child)) {\n            if (child.nodeType === 1) {\n              if (util._isIgnoreNodeChange(child)) {\n                newInnerNode = newInnerNode.cloneNode(false);\n                cloneChild = child.cloneNode(true);\n                pNode.appendChild(cloneChild);\n                pNode.appendChild(newInnerNode);\n                nNodeArray.push(newInnerNode); // end container\n\n                if (_endContainer && child.contains(_endContainer)) {\n                  var endPath = util.getNodePath(_endContainer, child);\n                  _endContainer = util.getNodeFromPath(endPath, cloneChild);\n                }\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            var anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = validation(newNode);\n\n              if (newNode.nodeType === 1 && vNode) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(anchors);\n            var isTopNode = pCurrent.length > 0;\n            var childNode = pCurrent.pop() || child;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!anchorNode && _isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              var aChildren = childNode.childNodes;\n\n              for (var a = 0, aLen = aChildren.length; a < aLen; a++) {\n                newInnerNode.appendChild(aChildren[a]);\n              }\n\n              childNode.appendChild(newInnerNode);\n              pNode.appendChild(childNode);\n              ancestor = !_isMaintainedNode(newNode) ? newNode : newInnerNode;\n              nNodeArray.push(newInnerNode);\n            } else if (isTopNode) {\n              newInnerNode.appendChild(childNode);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                var ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.appendChild(newInnerNode);\n              } else {\n                anchorNode = null;\n              }\n            }\n          } // startContainer\n\n\n          if (!passNode && child === container) {\n            var line = pNode;\n            anchorNode = _getMaintainedNode(child);\n            var prevNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\n            var textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, container.length - offset));\n\n            if (anchorNode) {\n              var _a2 = _getMaintainedNode(ancestor);\n\n              if (_a2 && _a2.parentNode !== line) {\n                var m = _a2;\n                var p = null;\n\n                while (m.parentNode !== line) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.appendChild(_a2);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            }\n\n            if (!util.onlyZeroWidthSpace(prevNode)) {\n              ancestor.appendChild(prevNode);\n            }\n\n            var prevAnchorNode = _getMaintainedNode(ancestor);\n\n            if (!!prevAnchorNode) anchorNode = prevAnchorNode;\n            if (anchorNode) line = anchorNode;\n            newNode = ancestor;\n            pCurrent = [];\n\n            while (newNode !== line && newNode !== null) {\n              vNode = validation(newNode);\n\n              if (newNode.nodeType === 1 && vNode) {\n                pCurrent.push(vNode);\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            var _childNode3 = pCurrent.pop() || ancestor;\n\n            appendNode = newNode = _childNode3;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_childNode3 !== ancestor) {\n              newInnerNode.appendChild(_childNode3);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\n            line.appendChild(newInnerNode);\n            container = textNode;\n            offset = 0;\n            passNode = true;\n            ancestor.appendChild(container);\n            continue;\n          }\n\n          vNode = !passNode ? child.cloneNode(false) : validation(child);\n\n          if (vNode) {\n            ancestor.appendChild(vNode);\n            if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\n          }\n\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          container: startCon,\n          offset: startOff,\n          endContainer: _endContainer\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (var i = 0; i < nNodeArray.length; i++) {\n          var removeNode = nNodeArray[i];\n          var rChildren = removeNode.childNodes;\n          var textNode = rChildren[0];\n\n          while (rChildren[0]) {\n            pNode.insertBefore(rChildren[0], removeNode);\n          }\n\n          util.removeItem(removeNode);\n          if (i === 0) container = textNode;\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (var _i16 = 0; _i16 < nNodeArray.length; _i16++) {\n          this._stripRemoveNode(nNodeArray[_i16]);\n        }\n      }\n\n      if (!isRemoveFormat && pNode.childNodes.length === 0) {\n        if (element.childNodes) {\n          container = element.childNodes[0];\n        } else {\n          container = util.createTextNode(util.zeroWidthSpace);\n          element.appendChild(container);\n        }\n      } else {\n        util.removeEmptyNode(pNode, newInnerNode);\n\n        if (util.onlyZeroWidthSpace(pNode.textContent)) {\n          container = pNode.firstChild;\n          offset = 0;\n        } // node change\n\n\n        var offsets = {\n          s: 0,\n          e: 0\n        };\n        var path = util.getNodePath(container, pNode, offsets);\n        offset += offsets.s; // tag merge\n\n        var newOffsets = util.mergeSameTags(pNode, [path], true);\n        element.parentNode.replaceChild(pNode, element);\n        container = util.getNodeFromPath(path, pNode);\n        offset += newOffsets[0];\n      }\n\n      return {\n        ancestor: pNode,\n        container: container,\n        offset: offset,\n        endContainer: _endContainer\n      };\n    },\n\n    /**\r\n     * @description wraps mid lines selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @param {Node} _endContainer Offset node of last line already modified (end.container)\r\n     * @returns {Object} { ancestor, endContainer: \"If end container is renewed, returned renewed node\" }\r\n     * @private\r\n     */\n    _nodeChange_middleLine: function _nodeChange_middleLine(element, newInnerNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, _endContainer) {\n      // not add tag\n      if (!isRemoveNode) {\n        // end container path\n        var endPath = null;\n        if (_endContainer && element.contains(_endContainer)) endPath = util.getNodePath(_endContainer, element);\n        var tempNode = element.cloneNode(true);\n        var newNodeName = newInnerNode.nodeName;\n        var newCssText = newInnerNode.style.cssText;\n        var newClass = newInnerNode.className;\n        var children = tempNode.childNodes;\n        var i = 0,\n            len = children.length;\n\n        for (var child; i < len; i++) {\n          child = children[i];\n          if (child.nodeType === 3) break;\n\n          if (child.nodeName === newNodeName) {\n            child.style.cssText += newCssText;\n            util.addClass(child, newClass);\n          } else if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\n            continue;\n          } else if (len === 1) {\n            children = child.childNodes;\n            len = children.length;\n            i = -1;\n            continue;\n          } else {\n            break;\n          }\n        }\n\n        if (len > 0 && i === len) {\n          element.innerHTML = tempNode.innerHTML;\n          return {\n            ancestor: element,\n            endContainer: endPath ? util.getNodeFromPath(endPath, element) : null\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      var pNode = element.cloneNode(false);\n      var nNodeArray = [newInnerNode];\n      var noneChange = true;\n\n      (function recursionFunc(current, ancestor) {\n        var childNodes = current.childNodes;\n\n        for (var _i17 = 0, _len9 = childNodes.length, vNode, cloneChild; _i17 < _len9; _i17++) {\n          var _child = childNodes[_i17];\n          if (!_child) continue;\n          var coverNode = ancestor;\n\n          if (!util.isBreak(_child) && util._isIgnoreNodeChange(_child)) {\n            if (newInnerNode.childNodes.length > 0) {\n              pNode.appendChild(newInnerNode);\n              newInnerNode = newInnerNode.cloneNode(false);\n            }\n\n            cloneChild = _child.cloneNode(true);\n            pNode.appendChild(cloneChild);\n            pNode.appendChild(newInnerNode);\n            nNodeArray.push(newInnerNode);\n            ancestor = newInnerNode; // end container\n\n            if (_endContainer && _child.contains(_endContainer)) {\n              var _endPath = util.getNodePath(_endContainer, _child);\n\n              _endContainer = util.getNodeFromPath(_endPath, cloneChild);\n            }\n\n            continue;\n          } else {\n            vNode = validation(_child);\n\n            if (vNode) {\n              noneChange = false;\n              ancestor.appendChild(vNode);\n              if (_child.nodeType === 1) coverNode = vNode;\n            }\n          }\n\n          if (!util.isBreak(_child)) recursionFunc(_child, coverNode);\n        }\n      })(element, newInnerNode); // not remove tag\n\n\n      if (noneChange || isRemoveNode && !isRemoveFormat && !_removeCheck.v) return {\n        ancestor: element,\n        endContainer: _endContainer\n      };\n      pNode.appendChild(newInnerNode);\n\n      if (isRemoveFormat && isRemoveNode) {\n        for (var _i18 = 0; _i18 < nNodeArray.length; _i18++) {\n          var removeNode = nNodeArray[_i18];\n          var rChildren = removeNode.childNodes;\n\n          while (rChildren[0]) {\n            pNode.insertBefore(rChildren[0], removeNode);\n          }\n\n          util.removeItem(removeNode);\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (var _i19 = 0; _i19 < nNodeArray.length; _i19++) {\n          this._stripRemoveNode(nNodeArray[_i19]);\n        }\n      }\n\n      util.removeEmptyNode(pNode, newInnerNode);\n      util.mergeSameTags(pNode, null, true); // node change\n\n      element.parentNode.replaceChild(pNode, element);\n      return {\n        ancestor: pNode,\n        endContainer: _endContainer\n      };\n    },\n\n    /**\r\n     * @description wraps last line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @returns {Object} { ancestor, container, offset }\r\n     * @private\r\n     */\n    _nodeChange_endLine: function _nodeChange_endLine(element, newInnerNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\n      // not add tag\n      var parentCon = endCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.previousSibling && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\n        var sameTag = true;\n        var e = endCon.nextSibling;\n\n        while (e) {\n          if (!util.onlyZeroWidthSpace(e)) {\n            sameTag = false;\n            break;\n          }\n\n          e = e.nextSibling;\n        }\n\n        if (sameTag) {\n          util.copyTagAttributes(parentCon, newInnerNode);\n          return {\n            ancestor: element,\n            container: endCon,\n            offset: endOff\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      var el = element;\n      var nNodeArray = [newInnerNode];\n      var pNode = element.cloneNode(false);\n      var container = endCon;\n      var offset = endOff;\n      var passNode = false;\n      var pCurrent, newNode, appendNode, anchorNode;\n\n      (function recursionFunc(current, ancestor) {\n        var childNodes = current.childNodes;\n\n        for (var i = childNodes.length - 1, vNode; 0 <= i; i--) {\n          var child = childNodes[i];\n          if (!child) continue;\n          var coverNode = ancestor;\n\n          if (passNode && !util.isBreak(child)) {\n            if (child.nodeType === 1) {\n              if (util._isIgnoreNodeChange(child)) {\n                newInnerNode = newInnerNode.cloneNode(false);\n                var cloneChild = child.cloneNode(true);\n                pNode.insertBefore(cloneChild, ancestor);\n                pNode.insertBefore(newInnerNode, cloneChild);\n                nNodeArray.push(newInnerNode);\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            var anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = validation(newNode);\n\n              if (vNode && newNode.nodeType === 1) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(anchors);\n            var isTopNode = pCurrent.length > 0;\n            var childNode = pCurrent.pop() || child;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.insertBefore(newInnerNode, pNode.firstChild);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!anchorNode && _isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              var aChildren = childNode.childNodes;\n\n              for (var a = 0, aLen = aChildren.length; a < aLen; a++) {\n                newInnerNode.appendChild(aChildren[a]);\n              }\n\n              childNode.appendChild(newInnerNode);\n              pNode.insertBefore(childNode, pNode.firstChild);\n              nNodeArray.push(newInnerNode);\n              if (newInnerNode.children.length > 0) ancestor = newNode;else ancestor = newInnerNode;\n            } else if (isTopNode) {\n              newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                var ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.insertBefore(newInnerNode, pNode.firstChild);\n              } else {\n                anchorNode = null;\n              }\n            }\n          } // endContainer\n\n\n          if (!passNode && child === container) {\n            anchorNode = _getMaintainedNode(child);\n            var afterNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, container.length - offset));\n            var textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\n\n            if (anchorNode) {\n              anchorNode = anchorNode.cloneNode(false);\n\n              var _a3 = _getMaintainedNode(ancestor);\n\n              if (_a3 && _a3.parentNode !== pNode) {\n                var m = _a3;\n                var p = null;\n\n                while (m.parentNode !== pNode) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.insertBefore(_a3, m.parentNode.firstChild);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!util.onlyZeroWidthSpace(afterNode)) {\n              ancestor.insertBefore(afterNode, ancestor.firstChild);\n            }\n\n            newNode = ancestor;\n            pCurrent = [];\n\n            while (newNode !== pNode && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1) {\n                pCurrent.push(vNode);\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            var _childNode4 = pCurrent.pop() || ancestor;\n\n            appendNode = newNode = _childNode4;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_childNode4 !== ancestor) {\n              newInnerNode.insertBefore(_childNode4, newInnerNode.firstChild);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\n\n            if (anchorNode) {\n              anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\n              pNode.insertBefore(anchorNode, pNode.firstChild);\n              anchorNode = null;\n            } else {\n              pNode.insertBefore(newInnerNode, pNode.firstChild);\n            }\n\n            container = textNode;\n            offset = textNode.data.length;\n            passNode = true;\n            ancestor.insertBefore(container, ancestor.firstChild);\n            continue;\n          }\n\n          vNode = !passNode ? child.cloneNode(false) : validation(child);\n\n          if (vNode) {\n            ancestor.insertBefore(vNode, ancestor.firstChild);\n            if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\n          }\n\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          container: endCon,\n          offset: endOff\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (var i = 0; i < nNodeArray.length; i++) {\n          var removeNode = nNodeArray[i];\n          var rChildren = removeNode.childNodes;\n          var textNode = null;\n\n          while (rChildren[0]) {\n            textNode = rChildren[0];\n            pNode.insertBefore(textNode, removeNode);\n          }\n\n          util.removeItem(removeNode);\n\n          if (i === nNodeArray.length - 1) {\n            container = textNode;\n            offset = textNode.textContent.length;\n          }\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (var _i20 = 0; _i20 < nNodeArray.length; _i20++) {\n          this._stripRemoveNode(nNodeArray[_i20]);\n        }\n      }\n\n      if (!isRemoveFormat && pNode.childNodes.length === 0) {\n        if (element.childNodes) {\n          container = element.childNodes[0];\n        } else {\n          container = util.createTextNode(util.zeroWidthSpace);\n          element.appendChild(container);\n        }\n      } else {\n        if (!isRemoveNode && newInnerNode.textContent.length === 0) {\n          util.removeEmptyNode(pNode, null);\n          return {\n            ancestor: null,\n            container: null,\n            offset: 0\n          };\n        }\n\n        util.removeEmptyNode(pNode, newInnerNode);\n\n        if (util.onlyZeroWidthSpace(pNode.textContent)) {\n          container = pNode.firstChild;\n          offset = container.textContent.length;\n        } else if (util.onlyZeroWidthSpace(container)) {\n          container = newInnerNode;\n          offset = 1;\n        } // node change\n\n\n        var offsets = {\n          s: 0,\n          e: 0\n        };\n        var path = util.getNodePath(container, pNode, offsets);\n        offset += offsets.s; // tag merge\n\n        var newOffsets = util.mergeSameTags(pNode, [path], true);\n        element.parentNode.replaceChild(pNode, element);\n        container = util.getNodeFromPath(path, pNode);\n        offset += newOffsets[0];\n      }\n\n      return {\n        ancestor: pNode,\n        container: container,\n        offset: container.nodeType === 1 && offset === 1 ? container.childNodes.length : offset\n      };\n    },\n\n    /**\r\n     * @description Run plugin calls and basic commands.\r\n     * @param {String} command Command string\r\n     * @param {String} display Display type string ('command', 'submenu', 'dialog', 'container')\r\n     * @param {Element} target The element of command button\r\n     */\n    actionCall: function actionCall(command, display, target) {\n      // call plugins\n      if (display) {\n        if (/more/i.test(display)) {\n          if (target !== this._moreLayerActiveButton) {\n            var layer = context.element.toolbar.querySelector('.' + command);\n\n            if (layer) {\n              if (this._moreLayerActiveButton) this.moreLayerOff();\n              this._moreLayerActiveButton = target;\n              layer.style.display = 'block';\n\n              event._showToolbarBalloon();\n\n              event._showToolbarInline();\n            }\n\n            util.addClass(target, 'on');\n          } else {\n            var _layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\n\n            if (_layer) {\n              this.moreLayerOff();\n\n              event._showToolbarBalloon();\n\n              event._showToolbarInline();\n            }\n          }\n\n          return;\n        }\n\n        if (/container/.test(display) && (this._menuTray[command] === null || target !== this.containerActiveButton)) {\n          this.callPlugin(command, this.containerOn.bind(this, target), target);\n          return;\n        }\n\n        if (this.isReadOnly && util.arrayIncludes(this.resizingDisabledButtons, target)) return;\n\n        if (/submenu/.test(display) && (this._menuTray[command] === null || target !== this.submenuActiveButton)) {\n          this.callPlugin(command, this.submenuOn.bind(this, target), target);\n          return;\n        } else if (/dialog/.test(display)) {\n          this.callPlugin(command, this.plugins[command].open.bind(this), target);\n          return;\n        } else if (/command/.test(display)) {\n          this.callPlugin(command, this.plugins[command].action.bind(this), target);\n        } else if (/fileBrowser/.test(display)) {\n          this.callPlugin(command, this.plugins[command].open.bind(this, null), target);\n        }\n      } // default command\n      else if (command) {\n        this.commandHandler(target, command);\n      }\n\n      if (/submenu/.test(display)) {\n        this.submenuOff();\n      } else if (!/command/.test(display)) {\n        this.submenuOff();\n        this.containerOff();\n      }\n    },\n\n    /**\r\n     * @description Execute command of command button(All Buttons except submenu and dialog)\r\n     * (selectAll, codeView, fullScreen, indent, outdent, undo, redo, removeFormat, print, preview, showBlocks, save, bold, underline, italic, strike, subscript, superscript, copy, cut, paste)\r\n     * @param {Element|null} target The element of command button\r\n     * @param {String} command Property of command button (data-value)\r\n     */\n    commandHandler: function commandHandler(target, command) {\n      if (core.isReadOnly && !/copy|cut|selectAll|codeView|fullScreen|print|preview|showBlocks/.test(command)) return;\n\n      switch (command) {\n        case 'copy':\n        case 'cut':\n          this.execCommand(command);\n          break;\n\n        case 'paste':\n          break;\n\n        case 'selectAll':\n          this.containerOff();\n          var wysiwyg = context.element.wysiwyg;\n          var first = util.getChildElement(wysiwyg.firstChild, function (current) {\n            return current.childNodes.length === 0 || current.nodeType === 3;\n          }, false) || wysiwyg.firstChild;\n          var last = util.getChildElement(wysiwyg.lastChild, function (current) {\n            return current.childNodes.length === 0 || current.nodeType === 3;\n          }, true) || wysiwyg.lastChild;\n          if (!first || !last) return;\n\n          if (util.isMedia(first)) {\n            var info = this.getFileComponent(first);\n            var br = util.createElement('BR');\n            var format = util.createElement(options.defaultTag);\n            format.appendChild(br);\n            first = info ? info.component : first;\n            first.parentNode.insertBefore(format, first);\n            first = br;\n          }\n\n          if (util.isMedia(last)) {\n            var _br = util.createElement('BR');\n\n            var _format2 = util.createElement(options.defaultTag);\n\n            _format2.appendChild(_br);\n\n            wysiwyg.appendChild(_format2);\n            last = _br;\n          }\n\n          event._showToolbarBalloon(this.setRange(first, 0, last, last.textContent.length));\n\n          break;\n\n        case 'codeView':\n          this.toggleCodeView();\n          break;\n\n        case 'fullScreen':\n          this.toggleFullScreen(target);\n          break;\n\n        case 'indent':\n        case 'outdent':\n          this.indent(command);\n          break;\n\n        case 'undo':\n          this.history.undo();\n          break;\n\n        case 'redo':\n          this.history.redo();\n          break;\n\n        case 'removeFormat':\n          this.removeFormat();\n          this.focus();\n          break;\n\n        case 'print':\n          this.print();\n          break;\n\n        case 'preview':\n          this.preview();\n          break;\n\n        case 'showBlocks':\n          this.toggleDisplayBlocks();\n          break;\n\n        case 'dir':\n          this.setDir(options.rtl ? 'ltr' : 'rtl');\n          break;\n\n        case 'dir_ltr':\n          this.setDir('ltr');\n          break;\n\n        case 'dir_rtl':\n          this.setDir('rtl');\n          break;\n\n        case 'save':\n          if (typeof options.callBackSave === 'function') {\n            options.callBackSave(this.getContents(false), this._variable.isChanged);\n          } else if (this._variable.isChanged && typeof functions.save === 'function') {\n            functions.save();\n          } else {\n            throw Error('[SUNEDITOR.core.commandHandler.fail] Please register call back function in creation option. (callBackSave : Function)');\n          }\n\n          this._variable.isChanged = false;\n          if (context.tool.save) context.tool.save.setAttribute('disabled', true);\n          break;\n\n        default:\n          // 'STRONG', 'U', 'EM', 'DEL', 'SUB', 'SUP'..\n          command = options._defaultCommand[command.toLowerCase()] || command;\n          if (!this.commandMap[command]) this.commandMap[command] = target;\n          var nodesMap = this._variable.currentNodesMap;\n          var cmd = nodesMap.indexOf(command) > -1 ? null : util.createElement(command);\n          var removeNode = command;\n\n          if (/^SUB$/i.test(command) && nodesMap.indexOf('SUP') > -1) {\n            removeNode = 'SUP';\n          } else if (/^SUP$/i.test(command) && nodesMap.indexOf('SUB') > -1) {\n            removeNode = 'SUB';\n          }\n\n          this.nodeChange(cmd, this._commandMapStyles[command] || null, [removeNode], false);\n          this.focus();\n      }\n    },\n\n    /**\r\n     * @description Remove format of the currently selected range\r\n     */\n    removeFormat: function removeFormat() {\n      this.nodeChange(null, null, null, null);\n    },\n\n    /**\r\n     * @description This method implements indentation to selected range.\r\n     * Setted \"margin-left\" to \"25px\" in the top \"P\" tag of the parameter node.\r\n     * @param {String} command Separator (\"indent\" or \"outdent\")\r\n     */\n    indent: function indent(command) {\n      var range = this.getRange();\n      var rangeLines = this.getSelectedElements(null);\n      var cells = [];\n      var shift = 'indent' !== command;\n      var marginDir = options.rtl ? 'marginRight' : 'marginLeft';\n      var sc = range.startContainer;\n      var ec = range.endContainer;\n      var so = range.startOffset;\n      var eo = range.endOffset;\n\n      for (var i = 0, len = rangeLines.length, f, margin; i < len; i++) {\n        f = rangeLines[i];\n\n        if (!util.isListCell(f) || !this.plugins.list) {\n          margin = /\\d+/.test(f.style[marginDir]) ? util.getNumber(f.style[marginDir], 0) : 0;\n\n          if (shift) {\n            margin -= 25;\n          } else {\n            margin += 25;\n          }\n\n          util.setStyle(f, marginDir, margin <= 0 ? '' : margin + 'px');\n        } else {\n          if (shift || f.previousElementSibling) {\n            cells.push(f);\n          }\n        }\n      } // list cells\n\n\n      if (cells.length > 0) {\n        this.plugins.list.editInsideList.call(this, shift, cells);\n      }\n\n      this.effectNode = null;\n      this.setRange(sc, so, ec, eo); // history stack\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description Add or remove the class name of \"body\" so that the code block is visible\r\n     */\n    toggleDisplayBlocks: function toggleDisplayBlocks() {\n      var wysiwyg = context.element.wysiwyg;\n      util.toggleClass(wysiwyg, 'se-show-block');\n\n      if (util.hasClass(wysiwyg, 'se-show-block')) {\n        util.addClass(this._styleCommandMap.showBlocks, 'active');\n      } else {\n        util.removeClass(this._styleCommandMap.showBlocks, 'active');\n      }\n\n      this._resourcesStateChange();\n    },\n\n    /**\r\n     * @description Changes to code view or wysiwyg view\r\n     */\n    toggleCodeView: function toggleCodeView() {\n      var isCodeView = this._variable.isCodeView;\n      this.controllersOff();\n      util.setDisabledButtons(!isCodeView, this.codeViewDisabledButtons);\n\n      if (isCodeView) {\n        if (!util.isNonEditable(context.element.wysiwygFrame)) this._setCodeDataToEditor();\n        context.element.wysiwygFrame.scrollTop = 0;\n        context.element.code.style.display = 'none';\n        context.element.wysiwygFrame.style.display = 'block';\n        this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\n        this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\n        if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = '0px';\n        this._variable.isCodeView = false;\n\n        if (!this._variable.isFullScreen) {\n          this._notHideToolbar = false;\n\n          if (/balloon|balloon-always/i.test(options.mode)) {\n            context.element._arrow.style.display = '';\n            this._isInline = false;\n            this._isBalloon = true;\n\n            event._hideToolbar();\n          }\n        }\n\n        this.nativeFocus();\n        util.removeClass(this._styleCommandMap.codeView, 'active'); // history stack\n\n        if (!util.isNonEditable(context.element.wysiwygFrame)) {\n          this.history.push(false);\n\n          this.history._resetCachingButton();\n        }\n      } else {\n        this._setEditorDataToCodeView();\n\n        this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\n        this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\n        if (this._variable.isFullScreen) context.element.code.style.height = '100%';else if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = context.element.code.scrollHeight > 0 ? context.element.code.scrollHeight + 'px' : 'auto';\n        if (options.codeMirrorEditor) options.codeMirrorEditor.refresh();\n        this._variable.isCodeView = true;\n\n        if (!this._variable.isFullScreen) {\n          this._notHideToolbar = true;\n\n          if (this._isBalloon) {\n            context.element._arrow.style.display = 'none';\n            context.element.toolbar.style.left = '';\n            this._isInline = true;\n            this._isBalloon = false;\n\n            event._showToolbarInline();\n          }\n        }\n\n        this._variable._range = null;\n        context.element.code.focus();\n        util.addClass(this._styleCommandMap.codeView, 'active');\n      }\n\n      this._checkPlaceholder();\n\n      if (this.isReadOnly) util.setDisabledButtons(true, this.resizingDisabledButtons); // user event\n\n      if (typeof functions.toggleCodeView === 'function') functions.toggleCodeView(this._variable.isCodeView, this);\n    },\n\n    /**\r\n     * @description Convert the data of the code view and put it in the WYSIWYG area.\r\n     * @private\r\n     */\n    _setCodeDataToEditor: function _setCodeDataToEditor() {\n      var code_html = this._getCodeView();\n\n      if (options.fullPage) {\n        var parseDocument = this._parser.parseFromString(code_html, 'text/html');\n\n        var headChildren = parseDocument.head.children;\n\n        for (var i = 0, len = headChildren.length; i < len; i++) {\n          if (/^script$/i.test(headChildren[i].tagName)) {\n            parseDocument.head.removeChild(headChildren[i]);\n            i--, len--;\n          }\n        }\n\n        var headers = parseDocument.head.innerHTML;\n\n        if (!parseDocument.head.querySelector('link[rel=\"stylesheet\"]') || this.options.height === 'auto' && !parseDocument.head.querySelector('style')) {\n          headers += util._setIframeCssTags(this.options);\n        }\n\n        this._wd.head.innerHTML = headers;\n        this._wd.body.innerHTML = this.convertContentsForEditor(parseDocument.body.innerHTML);\n        var attrs = parseDocument.body.attributes;\n\n        for (var _i21 = 0, _len10 = attrs.length; _i21 < _len10; _i21++) {\n          if (attrs[_i21].name === 'contenteditable') continue;\n\n          this._wd.body.setAttribute(attrs[_i21].name, attrs[_i21].value);\n        }\n\n        if (!util.hasClass(this._wd.body, 'sun-editor-editable')) {\n          var editableClasses = options._editableClass.split(' ');\n\n          for (var _i22 = 0; _i22 < editableClasses.length; _i22++) {\n            util.addClass(this._wd.body, options._editableClass[_i22]);\n          }\n        }\n      } else {\n        context.element.wysiwyg.innerHTML = code_html.length > 0 ? this.convertContentsForEditor(code_html) : '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n      }\n    },\n\n    /**\r\n     * @description Convert the data of the WYSIWYG area and put it in the code view area.\r\n     * @private\r\n     */\n    _setEditorDataToCodeView: function _setEditorDataToCodeView() {\n      var codeContents = this.convertHTMLForCodeView(context.element.wysiwyg, false);\n      var codeValue = '';\n\n      if (options.fullPage) {\n        var attrs = util.getAttributesToString(this._wd.body, null);\n        codeValue = '<!DOCTYPE html>\\n<html>\\n' + this._wd.head.outerHTML.replace(/>(?!\\n)/g, '>\\n') + '<body ' + attrs + '>\\n' + codeContents + '</body>\\n</html>';\n      } else {\n        codeValue = codeContents;\n      }\n\n      context.element.code.style.display = 'block';\n      context.element.wysiwygFrame.style.display = 'none';\n\n      this._setCodeView(codeValue);\n    },\n\n    /**\r\n     * @description Changes to full screen or default screen\r\n     * @param {Element|null} element full screen button\r\n     */\n    toggleFullScreen: function toggleFullScreen(element) {\n      var topArea = context.element.topArea;\n      var toolbar = context.element.toolbar;\n      var editorArea = context.element.editorArea;\n      var wysiwygFrame = context.element.wysiwygFrame;\n      var code = context.element.code;\n      var _var = this._variable;\n      this.controllersOff();\n      var wasToolbarHidden = toolbar.style.display === 'none' || this._isInline && !this._inlineToolbarAttr.isShow;\n\n      if (!_var.isFullScreen) {\n        _var.isFullScreen = true;\n        _var._fullScreenAttrs.inline = this._isInline;\n        _var._fullScreenAttrs.balloon = this._isBalloon;\n\n        if (this._isInline || this._isBalloon) {\n          this._isInline = false;\n          this._isBalloon = false;\n        }\n\n        if (!!options.toolbarContainer) context.element.relative.insertBefore(toolbar, editorArea);\n        topArea.style.position = 'fixed';\n        topArea.style.top = '0';\n        topArea.style.left = '0';\n        topArea.style.width = '100%';\n        topArea.style.maxWidth = '100%';\n        topArea.style.height = '100%';\n        topArea.style.zIndex = '2147483647';\n\n        if (context.element._stickyDummy.style.display !== ('none' && '')) {\n          _var._fullScreenAttrs.sticky = true;\n          context.element._stickyDummy.style.display = 'none';\n          util.removeClass(toolbar, 'se-toolbar-sticky');\n        }\n\n        _var._bodyOverflow = _d.body.style.overflow;\n        _d.body.style.overflow = 'hidden';\n        _var._editorAreaOriginCssText = editorArea.style.cssText;\n        _var._wysiwygOriginCssText = wysiwygFrame.style.cssText;\n        _var._codeOriginCssText = code.style.cssText;\n        editorArea.style.cssText = toolbar.style.cssText = '';\n        wysiwygFrame.style.cssText = (wysiwygFrame.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0] + options.defaultStyle;\n        code.style.cssText = (code.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\n        toolbar.style.width = wysiwygFrame.style.height = code.style.height = '100%';\n        toolbar.style.position = 'relative';\n        toolbar.style.display = 'block';\n        _var.innerHeight_fullScreen = _w.innerHeight - toolbar.offsetHeight;\n        editorArea.style.height = _var.innerHeight_fullScreen - options.fullScreenOffset + 'px';\n        if (element) util.changeElement(element.firstElementChild, icons.reduction);\n\n        if (options.iframe && options.height === 'auto') {\n          editorArea.style.overflow = 'auto';\n\n          this._iframeAutoHeight();\n        }\n\n        context.element.topArea.style.marginTop = options.fullScreenOffset + 'px';\n        util.addClass(this._styleCommandMap.fullScreen, 'active');\n      } else {\n        _var.isFullScreen = false;\n        wysiwygFrame.style.cssText = _var._wysiwygOriginCssText;\n        code.style.cssText = _var._codeOriginCssText;\n        toolbar.style.cssText = '';\n        editorArea.style.cssText = _var._editorAreaOriginCssText;\n        topArea.style.cssText = _var._originCssText;\n        _d.body.style.overflow = _var._bodyOverflow;\n        if (options.height === 'auto' && !options.codeMirrorEditor) event._codeViewAutoHeight();\n        if (!!options.toolbarContainer) options.toolbarContainer.appendChild(toolbar);\n\n        if (options.stickyToolbar > -1) {\n          util.removeClass(toolbar, 'se-toolbar-sticky');\n        }\n\n        if (_var._fullScreenAttrs.sticky && !options.toolbarContainer) {\n          _var._fullScreenAttrs.sticky = false;\n          context.element._stickyDummy.style.display = 'block';\n          util.addClass(toolbar, \"se-toolbar-sticky\");\n        }\n\n        this._isInline = _var._fullScreenAttrs.inline;\n        this._isBalloon = _var._fullScreenAttrs.balloon;\n        if (this._isInline) event._showToolbarInline();\n        if (!!options.toolbarContainer) util.removeClass(toolbar, 'se-toolbar-balloon');\n        event.onScroll_window();\n        if (element) util.changeElement(element.firstElementChild, icons.expansion);\n        context.element.topArea.style.marginTop = '';\n        util.removeClass(this._styleCommandMap.fullScreen, 'active');\n      }\n\n      if (wasToolbarHidden) functions.toolbar.hide(); // user event\n\n      if (typeof functions.toggleFullScreen === 'function') functions.toggleFullScreen(this._variable.isFullScreen, this);\n    },\n\n    /**\r\n     * @description Prints the current contents of the editor.\r\n     */\n    print: function print() {\n      var iframe = util.createElement('IFRAME');\n      iframe.style.display = 'none';\n\n      _d.body.appendChild(iframe);\n\n      var contentsHTML = options.printTemplate ? options.printTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\n      var printDocument = util.getIframeDocument(iframe);\n      var wDoc = this._wd;\n\n      if (options.iframe) {\n        var arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\n        printDocument.write('' + '<!DOCTYPE html><html>' + '<head>' + wDoc.head.innerHTML + '</head>' + '<body ' + arrts + '>' + contentsHTML + '</body>' + '</html>');\n      } else {\n        var links = _d.head.getElementsByTagName('link');\n\n        var styles = _d.head.getElementsByTagName('style');\n\n        var linkHTML = '';\n\n        for (var i = 0, len = links.length; i < len; i++) {\n          linkHTML += links[i].outerHTML;\n        }\n\n        for (var _i23 = 0, _len11 = styles.length; _i23 < _len11; _i23++) {\n          linkHTML += styles[_i23].outerHTML;\n        }\n\n        printDocument.write('' + '<!DOCTYPE html><html>' + '<head>' + linkHTML + '</head>' + '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\">' + contentsHTML + '</body>' + '</html>');\n      }\n\n      this.showLoading();\n\n      _w.setTimeout(function () {\n        try {\n          iframe.focus(); // IE or Edge, Chromium\n\n          if (util.isIE_Edge || util.isChromium || !!_d.documentMode || !!_w.StyleMedia) {\n            try {\n              iframe.contentWindow.document.execCommand('print', false, null);\n            } catch (e) {\n              iframe.contentWindow.print();\n            }\n          } else {\n            // Other browsers\n            iframe.contentWindow.print();\n          }\n        } catch (error) {\n          throw Error('[SUNEDITOR.core.print.fail] error: ' + error);\n        } finally {\n          core.closeLoading();\n          util.removeItem(iframe);\n        }\n      }, 1000);\n    },\n\n    /**\r\n     * @description Open the preview window.\r\n     */\n    preview: function preview() {\n      core.submenuOff();\n      core.containerOff();\n      core.controllersOff();\n      var contentsHTML = options.previewTemplate ? options.previewTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\n\n      var windowObject = _w.open('', '_blank');\n\n      windowObject.mimeType = 'text/html';\n      var wDoc = this._wd;\n\n      if (options.iframe) {\n        var arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\n        windowObject.document.write('' + '<!DOCTYPE html><html>' + '<head>' + wDoc.head.innerHTML + '<style>body {overflow:auto !important; margin: 10px auto !important; height:auto !important; outline:1px dashed #ccc;}</style>' + '</head>' + '<body ' + arrts + '>' + contentsHTML + '</body>' + '</html>');\n      } else {\n        var links = _d.head.getElementsByTagName('link');\n\n        var styles = _d.head.getElementsByTagName('style');\n\n        var linkHTML = '';\n\n        for (var i = 0, len = links.length; i < len; i++) {\n          linkHTML += links[i].outerHTML;\n        }\n\n        for (var _i24 = 0, _len12 = styles.length; _i24 < _len12; _i24++) {\n          linkHTML += styles[_i24].outerHTML;\n        }\n\n        windowObject.document.write('' + '<!DOCTYPE html><html>' + '<head>' + '<meta charset=\"utf-8\" />' + '<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1\">' + '<title>' + lang.toolbar.preview + '</title>' + linkHTML + '</head>' + '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\" style=\"margin:10px auto !important; height:auto !important; outline:1px dashed #ccc;\">' + contentsHTML + '</body>' + '</html>');\n      }\n    },\n\n    /**\r\n     * @description Set direction to \"rtl\" or \"ltr\".\r\n     * @param {String} dir \"rtl\" or \"ltr\"\r\n     */\n    setDir: function setDir(dir) {\n      var rtl = dir === 'rtl';\n      var changeDir = this._prevRtl !== rtl;\n      this._prevRtl = options.rtl = rtl;\n\n      if (changeDir) {\n        // align buttons\n        if (this.plugins.align) {\n          this.plugins.align.exchangeDir.call(this);\n        } // indent buttons\n\n\n        if (context.tool.indent) util.changeElement(context.tool.indent.firstElementChild, icons.indent);\n        if (context.tool.outdent) util.changeElement(context.tool.outdent.firstElementChild, icons.outdent);\n      }\n\n      var el = context.element;\n\n      if (rtl) {\n        util.addClass(el.topArea, 'se-rtl');\n        util.addClass(el.wysiwygFrame, 'se-rtl');\n      } else {\n        util.removeClass(el.topArea, 'se-rtl');\n        util.removeClass(el.wysiwygFrame, 'se-rtl');\n      }\n\n      var lineNodes = util.getListChildren(el.wysiwyg, function (current) {\n        return util.isFormatElement(current) && (current.style.marginRight || current.style.marginLeft || current.style.textAlign);\n      });\n\n      for (var i = 0, len = lineNodes.length, n, l, r; i < len; i++) {\n        n = lineNodes[i]; // indent margin\n\n        r = n.style.marginRight;\n        l = n.style.marginLeft;\n\n        if (r || l) {\n          n.style.marginRight = l;\n          n.style.marginLeft = r;\n        } // text align\n\n\n        r = n.style.textAlign;\n        if (r === 'left') n.style.textAlign = 'right';else if (r === 'right') n.style.textAlign = 'left';\n      }\n\n      var tool = context.tool;\n\n      if (tool.dir) {\n        util.changeTxt(tool.dir.querySelector('.se-tooltip-text'), lang.toolbar[options.rtl ? 'dir_ltr' : 'dir_rtl']);\n        util.changeElement(tool.dir.firstElementChild, icons[options.rtl ? 'dir_ltr' : 'dir_rtl']);\n      }\n\n      if (tool.dir_ltr) {\n        if (rtl) util.removeClass(tool.dir_ltr, 'active');else util.addClass(tool.dir_ltr, 'active');\n      }\n\n      if (tool.dir_rtl) {\n        if (rtl) util.addClass(tool.dir_rtl, 'active');else util.removeClass(tool.dir_rtl, 'active');\n      }\n    },\n\n    /**\r\n     * @description Sets the HTML string\r\n     * @param {String|undefined} html HTML string\r\n     */\n    setContents: function setContents(html) {\n      this.removeRange();\n      var convertValue = html === null || html === undefined ? '' : this.convertContentsForEditor(html);\n\n      this._resetComponents();\n\n      if (!this._variable.isCodeView) {\n        context.element.wysiwyg.innerHTML = convertValue; // history stack\n\n        this.history.push(false);\n      } else {\n        var value = this.convertHTMLForCodeView(convertValue, false);\n\n        this._setCodeView(value);\n      }\n    },\n\n    /**\r\n     * @description Sets the contents of the iframe's head tag and body tag when using the \"iframe\" or \"fullPage\" option.\r\n     * @param {Object} ctx { head: HTML string, body: HTML string}\r\n     */\n    setIframeContents: function setIframeContents(ctx) {\n      if (!options.iframe) return false;\n      if (ctx.head) this._wd.head.innerHTML = ctx.head.replace(/<script[\\s\\S]*>[\\s\\S]*<\\/script>/gi, '');\n      if (ctx.body) this._wd.body.innerHTML = this.convertContentsForEditor(ctx.body);\n    },\n\n    /**\r\n     * @description Gets the current contents\r\n     * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n     * @returns {Object}\r\n     */\n    getContents: function getContents(onlyContents) {\n      var contents = this.convertHTMLForCodeView(context.element.wysiwyg, true);\n      var renderHTML = util.createElement('DIV');\n      renderHTML.innerHTML = contents;\n      var figcaptions = util.getListChildren(renderHTML, function (current) {\n        return /FIGCAPTION/i.test(current.nodeName);\n      });\n\n      for (var i = 0, len = figcaptions.length; i < len; i++) {\n        figcaptions[i].removeAttribute('contenteditable');\n      }\n\n      if (options.fullPage && !onlyContents) {\n        var attrs = util.getAttributesToString(this._wd.body, ['contenteditable']);\n        return '<!DOCTYPE html><html>' + this._wd.head.outerHTML + '<body ' + attrs + '>' + renderHTML.innerHTML + '</body></html>';\n      } else {\n        return renderHTML.innerHTML;\n      }\n    },\n\n    /**\r\n     * @description Gets the current contents with containing parent div(div.sun-editor-editable).\r\n     * <div class=\"sun-editor-editable\">{contents}</div>\r\n     * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n     * @returns {String}\r\n     */\n    getFullContents: function getFullContents(onlyContents) {\n      return '<div class=\"sun-editor-editable' + (options.rtl ? ' se-rtl' : '') + '\">' + this.getContents(onlyContents) + '</div>';\n    },\n\n    /**\r\n     * @description Returns HTML string according to tag type and configuration.\r\n     * Use only \"cleanHTML\"\r\n     * @param {Node} node Node\r\n     * @param {Boolean} requireFormat If true, text nodes that do not have a format node is wrapped with the format tag.\r\n     * @private\r\n     */\n    _makeLine: function _makeLine(node, requireFormat) {\n      var defaultTag = options.defaultTag; // element\n\n      if (node.nodeType === 1) {\n        if (util._disallowedTags(node)) return '';\n        var ch = util.getListChildNodes(node, function (current) {\n          return util.isSpanWithoutAttr(current);\n        }) || [];\n\n        for (var i = ch.length - 1; i >= 0; i--) {\n          ch[i].outerHTML = ch[i].innerHTML;\n        }\n\n        if (!requireFormat || util.isFormatElement(node) || util.isRangeFormatElement(node) || util.isComponent(node) || util.isMedia(node) || util.isAnchor(node) && util.isMedia(node.firstElementChild)) {\n          return util.isSpanWithoutAttr(node) ? node.innerHTML : node.outerHTML;\n        } else {\n          return '<' + defaultTag + '>' + (util.isSpanWithoutAttr(node) ? node.innerHTML : node.outerHTML) + '</' + defaultTag + '>';\n        }\n      } // text\n\n\n      if (node.nodeType === 3) {\n        if (!requireFormat) return util._HTMLConvertor(node.textContent);\n        var textArray = node.textContent.split(/\\n/g);\n        var html = '';\n\n        for (var _i25 = 0, tLen = textArray.length, text; _i25 < tLen; _i25++) {\n          text = textArray[_i25].trim();\n          if (text.length > 0) html += '<' + defaultTag + '>' + util._HTMLConvertor(text) + '</' + defaultTag + '>';\n        }\n\n        return html;\n      } // comments\n\n\n      if (node.nodeType === 8 && this._allowHTMLComments) {\n        return '<!--' + node.textContent.trim() + '-->';\n      }\n\n      return '';\n    },\n\n    /**\r\n     * @description Removes attribute values such as style and converts tags that do not conform to the \"html5\" standard.\r\n     * @param {String} text \r\n     * @returns {String} HTML string\r\n     * @private\r\n     */\n    _tagConvertor: function _tagConvertor(text) {\n      if (!this._disallowedTextTagsRegExp) return text;\n      var ec = options._textTagsMap;\n      return text.replace(this._disallowedTextTagsRegExp, function (m, t, n, p) {\n        return t + (typeof ec[n] === 'string' ? ec[n] : n) + (p ? ' ' + p : '');\n      });\n    },\n\n    /**\r\n     * @description Delete disallowed tags\r\n     * @param {String} html HTML string\r\n     * @returns {String}\r\n     * @private\r\n     */\n    _deleteDisallowedTags: function _deleteDisallowedTags(html) {\n      return html.replace(/\\n/g, '').replace(/<(script|style)[\\s\\S]*>[\\s\\S]*<\\/(script|style)>/gi, '').replace(/<[a-z0-9]+\\:[a-z0-9]+[^>^\\/]*>[^>]*<\\/[a-z0-9]+\\:[a-z0-9]+>/gi, '').replace(this.editorTagsWhitelistRegExp, '').replace(this.editorTagsBlacklistRegExp, '');\n    },\n    _convertFontSize: function _convertFontSize(to, size) {\n      var value = size.match(/(\\d+(?:\\.\\d+)?)(.+)/);\n      var sizeNum = value[1] * 1;\n      var from = value[2];\n      var pxSize = sizeNum;\n\n      if (/em/.test(from)) {\n        pxSize = this.round(sizeNum / 0.0625);\n      } else if (from === 'pt') {\n        pxSize = this.round(sizeNum * 1.333);\n      } else if (from === '%') {\n        pxSize = sizeNum / 100;\n      }\n\n      switch (to) {\n        case 'em':\n        case 'rem':\n        case '%':\n          return (pxSize * 0.0625).toFixed(2) + to;\n\n        case 'pt':\n          return this.floor(pxSize / 1.333) + to;\n\n        default:\n          // px\n          return pxSize + to;\n      }\n    },\n    _cleanStyle: function _cleanStyle(m, v, name) {\n      var sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\n\n      if (sv) {\n        if (!v) v = [];\n        var style = sv[0].replace(/&quot;/g, '').match(this._cleanStyleRegExp[name]);\n\n        if (style) {\n          var allowedStyle = [];\n\n          for (var i = 0, len = style.length, r; i < len; i++) {\n            r = style[i].match(/([a-zA-Z0-9-]+)(:)([^:]+$)/);\n\n            if (r && !/inherit|initial/i.test(r[3])) {\n              var k = util.kebabToCamelCase(r[1].trim());\n\n              var _v = this.wwComputedStyle[k].replace(/\"/g, '');\n\n              var _c4 = r[3].trim();\n\n              switch (k) {\n                case 'fontFamily':\n                  if (!options.plugins.font || options.font.indexOf(_c4) === -1) continue;\n                  break;\n\n                case 'fontSize':\n                  if (!options.plugins.fontSize) continue;\n\n                  if (!this._cleanStyleRegExp.fontSizeUnit.test(r[0])) {\n                    r[0] = r[0].replace(this._w.RegExp('\\\\d+' + r[0].match(/\\d+(.+$)/)[1]), this._convertFontSize.bind(this._w.Math, options.fontSizeUnit));\n                  }\n\n                  break;\n\n                case 'color':\n                  if (!options.plugins.fontColor || /rgba\\(([0-9]+\\s*,\\s*){3}0\\)|windowtext/i.test(_c4)) continue;\n                  break;\n\n                case 'backgroundColor':\n                  if (!options.plugins.hiliteColor || /rgba\\(([0-9]+\\s*,\\s*){3}0\\)|windowtext/i.test(_c4)) continue;\n                  break;\n              }\n\n              if (_v !== _c4) {\n                allowedStyle.push(r[0]);\n              }\n            }\n          }\n\n          if (allowedStyle.length > 0) v.push('style=\"' + allowedStyle.join(';') + '\"');\n        }\n      }\n\n      return v;\n    },\n\n    /**\r\n     * @description Tag and tag attribute check RegExp function. (used by \"cleanHTML\" and \"convertContentsForEditor\")\r\n     * @param {Boolean} lowLevelCheck Row level check\r\n     * @param {String} m RegExp value\r\n     * @param {String} t RegExp value\r\n     * @returns {String}\r\n     * @private\r\n     */\n    _cleanTags: function _cleanTags(lowLevelCheck, m, t) {\n      if (/^<[a-z0-9]+\\:[a-z0-9]+/i.test(m)) return m;\n      var v = null;\n      var tagName = t.match(/(?!<)[a-zA-Z0-9\\-]+/)[0].toLowerCase(); // blacklist\n\n      var bAttr = this._attributesTagsBlacklist[tagName];\n      m = m.replace(/\\s(?:on[a-z]+)\\s*=\\s*(\")[^\"]*\\1/ig, '');\n      if (bAttr) m = m.replace(bAttr, '');else m = m.replace(this._attributesBlacklistRegExp, ''); // whitelist\n\n      var wAttr = this._attributesTagsWhitelist[tagName];\n      if (wAttr) v = m.match(wAttr);else v = m.match(lowLevelCheck ? this._attributesWhitelistRegExp : this._attributesWhitelistRegExp_all_data); // attribute\n\n      if (lowLevelCheck) {\n        if (tagName === 'a') {\n          var sv = m.match(/(?:(?:id|name)\\s*=\\s*(?:\"|')[^\"']*(?:\"|'))/g);\n\n          if (sv) {\n            if (!v) v = [];\n            v.push(sv[0]);\n          }\n        } else if (!v || !/style=/i.test(v.toString())) {\n          if (tagName === 'span') {\n            v = this._cleanStyle(m, v, 'span');\n          } else if (/^(P|DIV|H[1-6]|PRE)$/i.test(tagName)) {\n            v = this._cleanStyle(m, v, 'format');\n          }\n        }\n      } else {\n        var _sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\n\n        if (_sv && !v) v = [_sv[0]];else if (_sv && !v.some(function (v) {\n          return /^style/.test(v.trim());\n        })) v.push(_sv[0]);\n      } // img\n\n\n      if (tagName === 'img') {\n        var w = '',\n            h = '';\n\n        var _sv2 = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\n\n        if (!v) v = [];\n\n        if (_sv2) {\n          w = _sv2[0].match(/width:(.+);/);\n          w = util.getNumber(w ? w[1] : '', -1) || '';\n          h = _sv2[0].match(/height:(.+);/);\n          h = util.getNumber(h ? h[1] : '', -1) || '';\n        }\n\n        if (!w || !h) {\n          var avw = m.match(/width\\s*=\\s*((?:\"|')[^\"']*(?:\"|'))/);\n          var avh = m.match(/height\\s*=\\s*((?:\"|')[^\"']*(?:\"|'))/);\n\n          if (avw || avh) {\n            w = !w ? util.getNumber(avw ? avw[1] : '') || '' : w;\n            h = !h ? util.getNumber(avh ? avh[1] : '') || '' : h;\n          }\n        }\n\n        v.push('data-origin=\"' + (w + ',' + h) + '\"');\n      }\n\n      if (v) {\n        for (var i = 0, len = v.length; i < len; i++) {\n          if (lowLevelCheck && /^class=\"(?!(__se__|se-|katex))/.test(v[i].trim())) continue;\n          t += ' ' + (/^(?:href|src)\\s*=\\s*('|\"|\\s)*javascript\\s*\\:/i.test(v[i].trim()) ? '' : v[i]);\n        }\n      }\n\n      return t;\n    },\n\n    /**\r\n     * @description Determines if formatting is required and returns a domTree\r\n     * @param {Element} dom documentFragment\r\n     * @returns {Element}\r\n     * @private\r\n     */\n    _editFormat: function _editFormat(dom) {\n      var value = '',\n          f;\n      var tempTree = dom.childNodes;\n\n      for (var i = 0, len = tempTree.length, n; i < len; i++) {\n        n = tempTree[i];\n\n        if (!util.isFormatElement(n) && !util.isRangeFormatElement(n) && !util.isComponent(n) && !/meta/i.test(n.nodeName)) {\n          if (!f) f = util.createElement(options.defaultTag);\n          f.appendChild(n);\n          i--;\n          len--;\n        } else {\n          if (f) {\n            value += f.outerHTML;\n            f = null;\n          }\n\n          value += n.outerHTML;\n        }\n      }\n\n      if (f) value += f.outerHTML;\n      return _d.createRange().createContextualFragment(value);\n    },\n    _convertListCell: function _convertListCell(domTree) {\n      var html = '';\n\n      for (var i = 0, len = domTree.length, node; i < len; i++) {\n        node = domTree[i];\n\n        if (node.nodeType === 1) {\n          if (util.isList(node)) {\n            html += node.innerHTML;\n          } else if (util.isListCell(node)) {\n            html += node.outerHTML;\n          } else if (util.isFormatElement(node)) {\n            html += '<li>' + (node.innerHTML.trim() || '<br>') + '</li>';\n          } else if (util.isRangeFormatElement(node) && !util.isTable(node)) {\n            html += this._convertListCell(node);\n          } else {\n            html += '<li>' + node.outerHTML + '</li>';\n          }\n        } else {\n          html += '<li>' + (node.textContent || '<br>') + '</li>';\n        }\n      }\n\n      return html;\n    },\n    _isFormatData: function _isFormatData(domTree) {\n      var requireFormat = false;\n\n      for (var i = 0, len = domTree.length, t; i < len; i++) {\n        t = domTree[i];\n\n        if (t.nodeType === 1 && !util.isTextStyleElement(t) && !util.isBreak(t) && !util._disallowedTags(t)) {\n          requireFormat = true;\n          break;\n        }\n      }\n\n      return requireFormat;\n    },\n\n    /**\r\n     * @description Gets the clean HTML code for editor\r\n     * @param {String} html HTML string\r\n     * @param {String|RegExp|null} whitelist Regular expression of allowed tags.\r\n     * RegExp object is create by util.createTagsWhitelist method. (core.pasteTagsWhitelistRegExp)\r\n     * @param {String|RegExp|null} blacklist Regular expression of disallowed tags.\r\n     * RegExp object is create by util.createTagsBlacklist method. (core.pasteTagsBlacklistRegExp)\r\n     * @returns {String}\r\n     */\n    cleanHTML: function cleanHTML(html, whitelist, blacklist) {\n      html = this._deleteDisallowedTags(this._parser.parseFromString(html, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, true));\n\n      var dom = _d.createRange().createContextualFragment(html);\n\n      try {\n        util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, this._htmlCheckBlacklistRegExp, true);\n      } catch (error) {\n        console.warn('[SUNEDITOR.cleanHTML.consistencyCheck.fail] ' + error);\n      }\n\n      if (this.managedTagsInfo && this.managedTagsInfo.query) {\n        var textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\n\n        for (var i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\n          classList = [].slice.call(textCompList[i].classList);\n\n          for (var _c5 = 0, cLen = classList.length; _c5 < cLen; _c5++) {\n            initMethod = this.managedTagsInfo.map[classList[_c5]];\n\n            if (initMethod) {\n              initMethod(textCompList[i]);\n              break;\n            }\n          }\n        }\n      }\n\n      var domTree = dom.childNodes;\n      var cleanHTML = '';\n\n      var requireFormat = this._isFormatData(domTree);\n\n      if (requireFormat) {\n        domTree = this._editFormat(dom).childNodes;\n      }\n\n      for (var _i26 = 0, _len13 = domTree.length; _i26 < _len13; _i26++) {\n        cleanHTML += this._makeLine(domTree[_i26], requireFormat);\n      }\n\n      cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\n\n      if (!cleanHTML) {\n        cleanHTML = html;\n      } else {\n        if (whitelist) cleanHTML = cleanHTML.replace(typeof whitelist === 'string' ? util.createTagsWhitelist(whitelist) : whitelist, '');\n        if (blacklist) cleanHTML = cleanHTML.replace(typeof blacklist === 'string' ? util.createTagsBlacklist(blacklist) : blacklist, '');\n      }\n\n      return this._tagConvertor(cleanHTML);\n    },\n\n    /**\r\n     * @description Converts contents into a format that can be placed in an editor\r\n     * @param {String} contents contents\r\n     * @returns {String}\r\n     */\n    convertContentsForEditor: function convertContentsForEditor(contents) {\n      contents = this._deleteDisallowedTags(this._parser.parseFromString(contents, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, false));\n\n      var dom = _d.createRange().createContextualFragment(contents);\n\n      try {\n        util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, this._htmlCheckBlacklistRegExp, false);\n      } catch (error) {\n        console.warn('[SUNEDITOR.convertContentsForEditor.consistencyCheck.fail] ' + error);\n      }\n\n      if (this.managedTagsInfo && this.managedTagsInfo.query) {\n        var textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\n\n        for (var i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\n          classList = [].slice.call(textCompList[i].classList);\n\n          for (var _c6 = 0, cLen = classList.length; _c6 < cLen; _c6++) {\n            initMethod = this.managedTagsInfo.map[classList[_c6]];\n\n            if (initMethod) {\n              initMethod(textCompList[i]);\n              break;\n            }\n          }\n        }\n      }\n\n      var domTree = dom.childNodes;\n      var cleanHTML = '',\n          p = null;\n\n      for (var _i27 = 0, t; _i27 < domTree.length; _i27++) {\n        t = domTree[_i27];\n\n        if (!util.isFormatElement(t) && !util.isRangeFormatElement(t) && !util.isComponent(t) && !util.isMedia(t) && t.nodeType !== 8) {\n          if (!p) p = util.createElement(options.defaultTag);\n          p.appendChild(t);\n          _i27--;\n\n          if (domTree[_i27 + 1] && !util.isFormatElement(domTree[_i27 + 1])) {\n            continue;\n          } else {\n            t = p;\n            p = null;\n          }\n        }\n\n        if (p) {\n          cleanHTML += this._makeLine(p, true);\n          p = null;\n        }\n\n        cleanHTML += this._makeLine(t, true);\n      }\n\n      if (p) cleanHTML += this._makeLine(p, true);\n      if (cleanHTML.length === 0) return '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n      cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\n      return this._tagConvertor(cleanHTML);\n    },\n\n    /**\r\n     * @description Converts wysiwyg area element into a format that can be placed in an editor of code view mode\r\n     * @param {Element|String} html WYSIWYG element (context.element.wysiwyg) or HTML string.\r\n     * @param {Boolean} comp If true, does not line break and indentation of tags.\r\n     * @returns {String}\r\n     */\n    convertHTMLForCodeView: function convertHTMLForCodeView(html, comp) {\n      var returnHTML = '';\n      var wRegExp = _w.RegExp;\n      var brReg = new wRegExp('^(BLOCKQUOTE|PRE|TABLE|THEAD|TBODY|TR|TH|TD|OL|UL|IMG|IFRAME|VIDEO|AUDIO|FIGURE|FIGCAPTION|HR|BR|CANVAS|SELECT)$', 'i');\n      var wDoc = typeof html === 'string' ? _d.createRange().createContextualFragment(html) : html;\n\n      var isFormat = function (current) {\n        return this.isFormatElement(current) || this.isComponent(current);\n      }.bind(util);\n\n      var brChar = comp ? '' : '\\n';\n      var indentSize = comp ? 0 : this._variable.codeIndent * 1;\n      indentSize = indentSize > 0 ? new _w.Array(indentSize + 1).join(' ') : '';\n\n      (function recursionFunc(element, indent) {\n        var children = element.childNodes;\n        var elementRegTest = brReg.test(element.nodeName);\n        var elementIndent = elementRegTest ? indent : '';\n\n        for (var i = 0, len = children.length, node, br, lineBR, nodeRegTest, tag, tagIndent; i < len; i++) {\n          node = children[i];\n          nodeRegTest = brReg.test(node.nodeName);\n          br = nodeRegTest ? brChar : '';\n          lineBR = isFormat(node) && !elementRegTest && !/^(TH|TD)$/i.test(element.nodeName) ? brChar : '';\n\n          if (node.nodeType === 8) {\n            returnHTML += '\\n<!-- ' + node.textContent.trim() + ' -->' + br;\n            continue;\n          }\n\n          if (node.nodeType === 3) {\n            if (!util.isList(node.parentElement)) returnHTML += util._HTMLConvertor(/^\\n+$/.test(node.data) ? '' : node.data);\n            continue;\n          }\n\n          if (node.childNodes.length === 0) {\n            returnHTML += (/^HR$/i.test(node.nodeName) ? brChar : '') + (/^PRE$/i.test(node.parentElement.nodeName) && /^BR$/i.test(node.nodeName) ? '' : elementIndent) + node.outerHTML + br;\n            continue;\n          }\n\n          if (!node.outerHTML) {\n            // IE\n            returnHTML += new _w.XMLSerializer().serializeToString(node);\n          } else {\n            tag = node.nodeName.toLowerCase();\n            tagIndent = elementIndent || nodeRegTest ? indent : '';\n            returnHTML += (lineBR || (elementRegTest ? '' : br)) + tagIndent + node.outerHTML.match(wRegExp('<' + tag + '[^>]*>', 'i'))[0] + br;\n            recursionFunc(node, indent + indentSize, '');\n            returnHTML += (/\\n$/.test(returnHTML) ? tagIndent : '') + '</' + tag + '>' + (lineBR || br || elementRegTest ? brChar : '' || /^(TH|TD)$/i.test(node.nodeName) ? brChar : '');\n          }\n        }\n      })(wDoc, '');\n\n      return returnHTML.trim() + brChar;\n    },\n\n    /**\r\n     * @description Add an event to document.\r\n     * When created as an Iframe, the same event is added to the document in the Iframe.\r\n     * @param {String} type Event type\r\n     * @param {Function} listener Event listener\r\n     * @param {Boolean} useCapture Use event capture\r\n     */\n    addDocEvent: function addDocEvent(type, listener, useCapture) {\n      _d.addEventListener(type, listener, useCapture);\n\n      if (options.iframe) {\n        this._wd.addEventListener(type, listener);\n      }\n    },\n\n    /**\r\n     * @description Remove events from document.\r\n     * When created as an Iframe, the event of the document inside the Iframe is also removed.\r\n     * @param {String} type Event type\r\n     * @param {Function} listener Event listener\r\n     */\n    removeDocEvent: function removeDocEvent(type, listener) {\n      _d.removeEventListener(type, listener);\n\n      if (options.iframe) {\n        this._wd.removeEventListener(type, listener);\n      }\n    },\n\n    /**\r\n     * @description The current number of characters is counted and displayed.\r\n     * @param {String} inputText Text added.\r\n     * @returns {Boolean}\r\n     * @private\r\n     */\n    _charCount: function _charCount(inputText) {\n      var maxCharCount = options.maxCharCount;\n      var countType = options.charCounterType;\n      var nextCharCount = 0;\n      if (!!inputText) nextCharCount = this.getCharLength(inputText, countType);\n\n      this._setCharCount();\n\n      if (maxCharCount > 0) {\n        var over = false;\n        var count = functions.getCharCount(countType);\n\n        if (count > maxCharCount) {\n          over = true;\n\n          if (nextCharCount > 0) {\n            this._editorRange();\n\n            var range = this.getRange();\n            var endOff = range.endOffset - 1;\n            var text = this.getSelectionNode().textContent;\n            var slicePosition = range.endOffset - (count - maxCharCount);\n            this.getSelectionNode().textContent = text.slice(0, slicePosition < 0 ? 0 : slicePosition) + text.slice(range.endOffset, text.length);\n            this.setRange(range.endContainer, endOff, range.endContainer, endOff);\n          }\n        } else if (count + nextCharCount > maxCharCount) {\n          over = true;\n        }\n\n        if (over) {\n          this._callCounterBlink();\n\n          if (nextCharCount > 0) return false;\n        }\n      }\n\n      return true;\n    },\n\n    /**\r\n     * @description When \"element\" is added, if it is greater than \"options.maxCharCount\", false is returned.\r\n     * @param {Node|String} element Element node or String.\r\n     * @param {String|null} charCounterType charCounterType. If it is null, the options.charCounterType\r\n     * @returns {Boolean}\r\n     */\n    checkCharCount: function checkCharCount(element, charCounterType) {\n      if (options.maxCharCount) {\n        var countType = charCounterType || options.charCounterType;\n        var length = this.getCharLength(typeof element === 'string' ? element : this._charTypeHTML && element.nodeType === 1 ? element.outerHTML : element.textContent, countType);\n\n        if (length > 0 && length + functions.getCharCount(countType) > options.maxCharCount) {\n          this._callCounterBlink();\n\n          return false;\n        }\n      }\n\n      return true;\n    },\n\n    /**\r\n     * @description Get the length of the content.\r\n     * Depending on the option, the length of the character is taken. (charCounterType)\r\n     * @param {String} content Content to count\r\n     * @param {String} charCounterType options.charCounterType\r\n     * @returns {Number}\r\n     */\n    getCharLength: function getCharLength(content, charCounterType) {\n      return /byte/.test(charCounterType) ? util.getByteLength(content) : content.length;\n    },\n\n    /**\r\n     * @description Reset buttons of the responsive toolbar.\r\n     */\n    resetResponsiveToolbar: function resetResponsiveToolbar() {\n      core.controllersOff();\n      var responsiveSize = event._responsiveButtonSize;\n\n      if (responsiveSize) {\n        var w = 0;\n\n        if ((core._isBalloon || core._isInline) && options.toolbarWidth === 'auto') {\n          w = context.element.topArea.offsetWidth;\n        } else {\n          w = context.element.toolbar.offsetWidth;\n        }\n\n        var responsiveWidth = 'default';\n\n        for (var i = 1, len = responsiveSize.length; i < len; i++) {\n          if (w < responsiveSize[i]) {\n            responsiveWidth = responsiveSize[i] + '';\n            break;\n          }\n        }\n\n        if (event._responsiveCurrentSize !== responsiveWidth) {\n          event._responsiveCurrentSize = responsiveWidth;\n          functions.setToolbarButtons(event._responsiveButtons[responsiveWidth]);\n        }\n      }\n    },\n\n    /**\r\n     * @description Set the char count to charCounter element textContent.\r\n     * @private\r\n     */\n    _setCharCount: function _setCharCount() {\n      if (context.element.charCounter) {\n        _w.setTimeout(function () {\n          context.element.charCounter.textContent = functions.getCharCount(options.charCounterType);\n        });\n      }\n    },\n\n    /**\r\n     * @description The character counter blinks.\r\n     * @private\r\n     */\n    _callCounterBlink: function _callCounterBlink() {\n      var charWrapper = context.element.charWrapper;\n\n      if (charWrapper && !util.hasClass(charWrapper, 'se-blink')) {\n        util.addClass(charWrapper, 'se-blink');\n\n        _w.setTimeout(function () {\n          util.removeClass(charWrapper, 'se-blink');\n        }, 600);\n      }\n    },\n\n    /**\r\n     * @description Check the components such as image and video and modify them according to the format.\r\n     * @private\r\n     */\n    _checkComponents: function _checkComponents() {\n      for (var i = 0, len = this._fileInfoPluginsCheck.length; i < len; i++) {\n        this._fileInfoPluginsCheck[i]();\n      }\n    },\n\n    /**\r\n     * @description Initialize the information of the components.\r\n     * @private\r\n     */\n    _resetComponents: function _resetComponents() {\n      for (var i = 0, len = this._fileInfoPluginsReset.length; i < len; i++) {\n        this._fileInfoPluginsReset[i]();\n      }\n    },\n\n    /**\r\n     * @description Set method in the code view area\r\n     * @param {String} value HTML string\r\n     * @private\r\n     */\n    _setCodeView: function _setCodeView(value) {\n      if (options.codeMirrorEditor) {\n        options.codeMirrorEditor.getDoc().setValue(value);\n      } else {\n        context.element.code.value = value;\n      }\n    },\n\n    /**\r\n     * @description Get method in the code view area\r\n     * @private\r\n     */\n    _getCodeView: function _getCodeView() {\n      return options.codeMirrorEditor ? options.codeMirrorEditor.getDoc().getValue() : context.element.code.value;\n    },\n\n    /**\r\n     * @description remove class, display text.\r\n     * @param {Array|null} ignoredList Igonred button list\r\n     */\n    _setKeyEffect: function _setKeyEffect(ignoredList) {\n      var commandMap = this.commandMap;\n      var activePlugins = this.activePlugins;\n\n      for (var key in commandMap) {\n        if (ignoredList.indexOf(key) > -1 || !util.hasOwn(commandMap, key)) continue;\n\n        if (activePlugins.indexOf(key) > -1) {\n          plugins[key].active.call(this, null);\n        } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\n          if (!util.isImportantDisabled(commandMap.OUTDENT)) commandMap.OUTDENT.setAttribute('disabled', true);\n        } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\n          if (!util.isImportantDisabled(commandMap.INDENT)) commandMap.INDENT.removeAttribute('disabled');\n        } else {\n          util.removeClass(commandMap[key], 'active');\n        }\n      }\n    },\n\n    /**\r\n     * @description Initializ core variable\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _init: function _init(reload, _initHTML) {\n      var wRegExp = _w.RegExp;\n      this._ww = options.iframe ? context.element.wysiwygFrame.contentWindow : _w;\n      this._wd = _d;\n      this._charTypeHTML = options.charCounterType === 'byte-html';\n      this.wwComputedStyle = _w.getComputedStyle(context.element.wysiwyg);\n      this._editorHeight = context.element.wysiwygFrame.offsetHeight;\n      this._editorHeightPadding = util.getNumber(this.wwComputedStyle.getPropertyValue('padding-top')) + util.getNumber(this.wwComputedStyle.getPropertyValue('padding-bottom'));\n\n      if (!options.iframe && typeof _w.ShadowRoot === 'function') {\n        var child = context.element.wysiwygFrame;\n\n        while (child) {\n          if (child.shadowRoot) {\n            this._shadowRoot = child.shadowRoot;\n            break;\n          } else if (child instanceof _w.ShadowRoot) {\n            this._shadowRoot = child;\n            break;\n          }\n\n          child = child.parentNode;\n        }\n\n        if (this._shadowRoot) this._shadowRootControllerEventTarget = [];\n      } // set disallow text nodes\n\n\n      var disallowTextTags = _w.Object.keys(options._textTagsMap);\n\n      var allowTextTags = !options.addTagsWhitelist ? [] : options.addTagsWhitelist.split('|').filter(function (v) {\n        return /b|i|ins|s|strike/i.test(v);\n      });\n\n      for (var i = 0; i < allowTextTags.length; i++) {\n        disallowTextTags.splice(disallowTextTags.indexOf(allowTextTags[i].toLowerCase()), 1);\n      }\n\n      this._disallowedTextTagsRegExp = disallowTextTags.length === 0 ? null : new wRegExp('(<\\\\/?)(' + disallowTextTags.join('|') + ')\\\\b\\\\s*([^>^<]+)?\\\\s*(?=>)', 'gi'); // set whitelist\n\n      var getRegList = function getRegList(str, str2) {\n        return !str ? '^' : str === '*' ? '[a-z-]+' : !str2 ? str : str + '|' + str2;\n      }; // tags\n\n\n      var defaultAttr = 'contenteditable|colspan|rowspan|target|href|download|rel|src|alt|class|type|controls|origin-size';\n      var dataAttr = 'data-format|data-size|data-file-size|data-file-name|data-origin|data-align|data-image-link|data-rotate|data-proportion|data-percentage|data-exp|data-font-size';\n      this._allowHTMLComments = options._editorTagsWhitelist.indexOf('//') > -1 || options._editorTagsWhitelist === '*'; // html check\n\n      this._htmlCheckWhitelistRegExp = new wRegExp('^(' + getRegList(options._editorTagsWhitelist.replace('|//', ''), '') + ')$', 'i');\n      this._htmlCheckBlacklistRegExp = new wRegExp('^(' + (options.tagsBlacklist || '^') + ')$', 'i'); // tags\n\n      this.editorTagsWhitelistRegExp = util.createTagsWhitelist(getRegList(options._editorTagsWhitelist.replace('|//', '|<!--|-->'), ''));\n      this.editorTagsBlacklistRegExp = util.createTagsBlacklist(options.tagsBlacklist.replace('|//', '|<!--|-->')); // paste tags\n\n      this.pasteTagsWhitelistRegExp = util.createTagsWhitelist(getRegList(options.pasteTagsWhitelist, ''));\n      this.pasteTagsBlacklistRegExp = util.createTagsBlacklist(options.pasteTagsBlacklist); // attributes\n\n      var regEndStr = '\\\\s*=\\\\s*(\\\")[^\\\"]*\\\\1';\n      var _wAttr = options.attributesWhitelist;\n      var tagsAttr = {};\n      var allAttr = '';\n\n      if (!!_wAttr) {\n        for (var k in _wAttr) {\n          if (!util.hasOwn(_wAttr, k) || /^on[a-z]+$/i.test(_wAttr[k])) continue;\n\n          if (k === 'all') {\n            allAttr = getRegList(_wAttr[k], defaultAttr);\n          } else {\n            tagsAttr[k] = new wRegExp('\\\\s(?:' + getRegList(_wAttr[k], '') + ')' + regEndStr, 'ig');\n          }\n        }\n      }\n\n      this._attributesWhitelistRegExp = new wRegExp('\\\\s(?:' + (allAttr || defaultAttr + '|' + dataAttr) + ')' + regEndStr, 'ig');\n      this._attributesWhitelistRegExp_all_data = new wRegExp('\\\\s(?:' + ((allAttr || defaultAttr) + '|data-[a-z0-9\\\\-]+') + ')' + regEndStr, 'ig');\n      this._attributesTagsWhitelist = tagsAttr; // blacklist\n\n      var _bAttr = options.attributesBlacklist;\n      tagsAttr = {};\n      allAttr = '';\n\n      if (!!_bAttr) {\n        for (var _k in _bAttr) {\n          if (!util.hasOwn(_bAttr, _k)) continue;\n\n          if (_k === 'all') {\n            allAttr = getRegList(_bAttr[_k], '');\n          } else {\n            tagsAttr[_k] = new wRegExp('\\\\s(?:' + getRegList(_bAttr[_k], '') + ')' + regEndStr, 'ig');\n          }\n        }\n      }\n\n      this._attributesBlacklistRegExp = new wRegExp('\\\\s(?:' + (allAttr || '^') + ')' + regEndStr, 'ig');\n      this._attributesTagsBlacklist = tagsAttr; // set modes\n\n      this._isInline = /inline/i.test(options.mode);\n      this._isBalloon = /balloon|balloon-always/i.test(options.mode);\n      this._isBalloonAlways = /balloon-always/i.test(options.mode); // caching buttons\n\n      this._cachingButtons(); // file components\n\n\n      this._fileInfoPluginsCheck = [];\n      this._fileInfoPluginsReset = []; // text components\n\n      this.managedTagsInfo = {\n        query: '',\n        map: {}\n      };\n      var managedClass = []; // Command and file plugins registration\n\n      this.activePlugins = [];\n      this._fileManager.tags = [];\n      this._fileManager.pluginMap = {};\n      var filePluginRegExp = [];\n      var plugin, button;\n\n      for (var key in plugins) {\n        if (!util.hasOwn(plugins, key)) continue;\n        plugin = plugins[key];\n        button = pluginCallButtons[key];\n\n        if ((plugin.active || plugin.action) && button) {\n          this.callPlugin(key, null, button);\n        }\n\n        if (typeof plugin.checkFileInfo === 'function' && typeof plugin.resetFileInfo === 'function') {\n          this.callPlugin(key, null, button);\n\n          this._fileInfoPluginsCheck.push(plugin.checkFileInfo.bind(this));\n\n          this._fileInfoPluginsReset.push(plugin.resetFileInfo.bind(this));\n        }\n\n        if (_w.Array.isArray(plugin.fileTags)) {\n          var fileTags = plugin.fileTags;\n          this.callPlugin(key, null, button);\n          this._fileManager.tags = this._fileManager.tags.concat(fileTags);\n          filePluginRegExp.push(key);\n\n          for (var tag = 0, tLen = fileTags.length; tag < tLen; tag++) {\n            this._fileManager.pluginMap[fileTags[tag].toLowerCase()] = key;\n          }\n        }\n\n        if (plugin.managedTags) {\n          var info = plugin.managedTags();\n          managedClass.push('.' + info.className);\n          this.managedTagsInfo.map[info.className] = info.method.bind(this);\n        }\n      }\n\n      this.managedTagsInfo.query = managedClass.toString();\n      this._fileManager.queryString = this._fileManager.tags.join(',');\n      this._fileManager.regExp = new wRegExp('^(' + (this._fileManager.tags.join('|') || '^') + ')$', 'i');\n      this._fileManager.pluginRegExp = new wRegExp('^(' + (filePluginRegExp.length === 0 ? '^' : filePluginRegExp.join('|')) + ')$', 'i'); // cache editor's element\n\n      this._variable._originCssText = context.element.topArea.style.cssText;\n      this._placeholder = context.element.placeholder;\n      this._lineBreaker = context.element.lineBreaker;\n      this._lineBreakerButton = this._lineBreaker.querySelector('button'); // Excute history function\n\n      this.history = _history(this, this._onChange_historyStack.bind(this)); // register notice module\n\n      this.addModule([_notice]); // Init, validate\n\n      if (options.iframe) {\n        this._wd = context.element.wysiwygFrame.contentDocument;\n        context.element.wysiwyg = this._wd.body;\n        if (options._editorStyles.editor) context.element.wysiwyg.style.cssText = options._editorStyles.editor;\n        if (options.height === 'auto') this._iframeAuto = this._wd.body;\n      }\n\n      this._initWysiwygArea(reload, _initHTML);\n    },\n\n    /**\r\n     * @description Caching basic buttons to use\r\n     * @private\r\n     */\n    _cachingButtons: function _cachingButtons() {\n      this.codeViewDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-code-view-enabled\"]):not([data-display=\"MORE\"])');\n      this.resizingDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-resizing-enabled\"]):not([data-display=\"MORE\"])');\n\n      this._saveButtonStates();\n\n      var tool = context.tool;\n      this.commandMap = {\n        OUTDENT: tool.outdent,\n        INDENT: tool.indent\n      };\n      this.commandMap[options.textTags.bold.toUpperCase()] = tool.bold;\n      this.commandMap[options.textTags.underline.toUpperCase()] = tool.underline;\n      this.commandMap[options.textTags.italic.toUpperCase()] = tool.italic;\n      this.commandMap[options.textTags.strike.toUpperCase()] = tool.strike;\n      this.commandMap[options.textTags.sub.toUpperCase()] = tool.subscript;\n      this.commandMap[options.textTags.sup.toUpperCase()] = tool.superscript;\n      this._styleCommandMap = {\n        fullScreen: tool.fullScreen,\n        showBlocks: tool.showBlocks,\n        codeView: tool.codeView\n      };\n    },\n\n    /**\r\n     * @description Initializ wysiwyg area (Only called from core._init)\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _initWysiwygArea: function _initWysiwygArea(reload, _initHTML) {\n      context.element.wysiwyg.innerHTML = reload ? _initHTML : this.convertContentsForEditor(typeof _initHTML === 'string' ? _initHTML : context.element.originElement.value);\n    },\n\n    /**\r\n     * @description Called when there are changes to tags in the wysiwyg region.\r\n     * @private\r\n     */\n    _resourcesStateChange: function _resourcesStateChange() {\n      this._iframeAutoHeight();\n\n      this._checkPlaceholder();\n    },\n\n    /**\r\n     * @description Called when after execute \"history.push\"\r\n     * @private\r\n     */\n    _onChange_historyStack: function _onChange_historyStack() {\n      if (this.hasFocus) event._applyTagEffects();\n      this._variable.isChanged = true;\n      if (context.tool.save) context.tool.save.removeAttribute('disabled'); // user event\n\n      if (functions.onChange) functions.onChange(this.getContents(true), this);\n      if (context.element.toolbar.style.display === 'block') event._showToolbarBalloon();\n    },\n\n    /**\r\n     * @description Modify the height value of the iframe when the height of the iframe is automatic.\r\n     * @private\r\n     */\n    _iframeAutoHeight: function _iframeAutoHeight() {\n      if (this._iframeAuto) {\n        _w.setTimeout(function () {\n          var h = core._iframeAuto.offsetHeight;\n          context.element.wysiwygFrame.style.height = h + 'px';\n          if (util.isIE) core.__callResizeFunction(h, null);\n        });\n      } else if (util.isIE) {\n        core.__callResizeFunction(context.element.wysiwygFrame.offsetHeight, null);\n      }\n    },\n    __callResizeFunction: function __callResizeFunction(h, resizeObserverEntry) {\n      h = h === -1 ? resizeObserverEntry.borderBoxSize && resizeObserverEntry.borderBoxSize[0] ? resizeObserverEntry.borderBoxSize[0].blockSize : resizeObserverEntry.contentRect.height + this._editorHeightPadding : h;\n\n      if (this._editorHeight !== h) {\n        if (typeof functions.onResizeEditor === 'function') functions.onResizeEditor(h, this._editorHeight, core, resizeObserverEntry);\n        this._editorHeight = h;\n      }\n    },\n\n    /**\r\n     * @description Set display property when there is placeholder.\r\n     * @private\r\n     */\n    _checkPlaceholder: function _checkPlaceholder() {\n      if (this._placeholder) {\n        if (this._variable.isCodeView) {\n          this._placeholder.style.display = 'none';\n          return;\n        }\n\n        var wysiwyg = context.element.wysiwyg;\n\n        if (!util.onlyZeroWidthSpace(wysiwyg.textContent) || wysiwyg.querySelector(util._allowedEmptyNodeList) || (wysiwyg.innerText.match(/\\n/g) || '').length > 1) {\n          this._placeholder.style.display = 'none';\n        } else {\n          this._placeholder.style.display = 'block';\n        }\n      }\n    },\n\n    /**\r\n     * @description If there is no default format, add a format and move \"selection\".\r\n     * @param {String|null} formatName Format tag name (default: 'P')\r\n     * @returns {undefined|null}\r\n     * @private\r\n     */\n    _setDefaultFormat: function _setDefaultFormat(formatName) {\n      if (this._fileManager.pluginRegExp.test(this.currentControllerName)) return;\n      var range = this.getRange();\n      var commonCon = range.commonAncestorContainer;\n      var startCon = range.startContainer;\n      var rangeEl = util.getRangeFormatElement(commonCon, null);\n      var focusNode, offset, format;\n      var fileComponent = util.getParentElement(commonCon, util.isComponent);\n\n      if (fileComponent && !util.isTable(fileComponent)) {\n        return;\n      } else if (commonCon.nodeType === 1 && commonCon.getAttribute('data-se-embed') === 'true') {\n        var el = commonCon.nextElementSibling;\n        if (!util.isFormatElement(el)) el = this.appendFormatTag(commonCon, options.defaultTag);\n        this.setRange(el.firstChild, 0, el.firstChild, 0);\n        return;\n      }\n\n      if ((util.isRangeFormatElement(startCon) || util.isWysiwygDiv(startCon)) && (util.isComponent(startCon.children[range.startOffset]) || util.isComponent(startCon.children[range.startOffset - 1]))) return;\n      if (util.getParentElement(commonCon, util.isNotCheckingNode)) return null;\n\n      if (rangeEl) {\n        format = util.createElement(formatName || options.defaultTag);\n        format.innerHTML = rangeEl.innerHTML;\n        if (format.childNodes.length === 0) format.innerHTML = util.zeroWidthSpace;\n        rangeEl.innerHTML = format.outerHTML;\n        format = rangeEl.firstChild;\n        focusNode = util.getEdgeChildNodes(format, null).sc;\n\n        if (!focusNode) {\n          focusNode = util.createTextNode(util.zeroWidthSpace);\n          format.insertBefore(focusNode, format.firstChild);\n        }\n\n        offset = focusNode.textContent.length;\n        this.setRange(focusNode, offset, focusNode, offset);\n        return;\n      }\n\n      if (util.isRangeFormatElement(commonCon) && commonCon.childNodes.length <= 1) {\n        var br = null;\n\n        if (commonCon.childNodes.length === 1 && util.isBreak(commonCon.firstChild)) {\n          br = commonCon.firstChild;\n        } else {\n          br = util.createTextNode(util.zeroWidthSpace);\n          commonCon.appendChild(br);\n        }\n\n        this.setRange(br, 1, br, 1);\n        return;\n      }\n\n      this.execCommand('formatBlock', false, formatName || options.defaultTag);\n      focusNode = util.getEdgeChildNodes(commonCon, commonCon);\n      focusNode = focusNode ? focusNode.ec : commonCon;\n      format = util.getFormatElement(focusNode, null);\n\n      if (!format) {\n        this.removeRange();\n\n        this._editorRange();\n\n        return;\n      }\n\n      if (util.isBreak(format.nextSibling)) util.removeItem(format.nextSibling);\n      if (util.isBreak(format.previousSibling)) util.removeItem(format.previousSibling);\n\n      if (util.isBreak(focusNode)) {\n        var zeroWidth = util.createTextNode(util.zeroWidthSpace);\n        focusNode.parentNode.insertBefore(zeroWidth, focusNode);\n        focusNode = zeroWidth;\n      }\n\n      this.effectNode = null;\n      this.nativeFocus();\n    },\n\n    /**\r\n     * @description Initialization after \"setOptions\"\r\n     * @param {Object} el context.element\r\n     * @param {String} _initHTML Initial html string\r\n     * @private\r\n     */\n    _setOptionsInit: function _setOptionsInit(el, _initHTML) {\n      this.context = context = _Context(el.originElement, this._getConstructed(el), options);\n      this._componentsInfoReset = true;\n\n      this._editorInit(true, _initHTML);\n    },\n\n    /**\r\n     * @description Initializ editor\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _editorInit: function _editorInit(reload, _initHTML) {\n      // initialize core and add event listeners\n      this._init(reload, _initHTML);\n\n      event._addEvent();\n\n      this._setCharCount();\n\n      event._offStickyToolbar();\n\n      event.onResize_window(); // toolbar visibility\n\n      context.element.toolbar.style.visibility = ''; // wisywig attributes\n\n      var attr = options.frameAttrbutes;\n\n      for (var k in attr) {\n        context.element.wysiwyg.setAttribute(k, attr[k]);\n      }\n\n      this._checkComponents();\n\n      this._componentsInfoInit = false;\n      this._componentsInfoReset = false;\n      this.history.reset(true);\n\n      _w.setTimeout(function () {\n        // observer\n        if (event._resizeObserver) event._resizeObserver.observe(context.element.wysiwygFrame);\n        if (event._toolbarObserver) event._toolbarObserver.observe(context.element._toolbarShadow); // resource state\n\n        core._resourcesStateChange(); // user event\n\n\n        if (typeof functions.onload === 'function') functions.onload(core, reload);\n      });\n    },\n\n    /**\r\n     * @description Create and return an object to cache the new context.\r\n     * @param {Element} contextEl context.element\r\n     * @returns {Object}\r\n     * @private\r\n     */\n    _getConstructed: function _getConstructed(contextEl) {\n      return {\n        _top: contextEl.topArea,\n        _relative: contextEl.relative,\n        _toolBar: contextEl.toolbar,\n        _toolbarShadow: contextEl._toolbarShadow,\n        _menuTray: contextEl._menuTray,\n        _editorArea: contextEl.editorArea,\n        _wysiwygArea: contextEl.wysiwygFrame,\n        _codeArea: contextEl.code,\n        _placeholder: contextEl.placeholder,\n        _resizingBar: contextEl.resizingBar,\n        _navigation: contextEl.navigation,\n        _charCounter: contextEl.charCounter,\n        _charWrapper: contextEl.charWrapper,\n        _loading: contextEl.loading,\n        _lineBreaker: contextEl.lineBreaker,\n        _lineBreaker_t: contextEl.lineBreaker_t,\n        _lineBreaker_b: contextEl.lineBreaker_b,\n        _resizeBack: contextEl.resizeBackground,\n        _stickyDummy: contextEl._stickyDummy,\n        _arrow: contextEl._arrow\n      };\n    }\n  };\n  /**\r\n   * @description event function\r\n   */\n\n  var event = {\n    _IEisComposing: false,\n    // In IE, there is no \"e.isComposing\" in the key-up event.\n    _lineBreakerBind: null,\n    _responsiveCurrentSize: 'default',\n    _responsiveButtonSize: null,\n    _responsiveButtons: null,\n    _directionKeyCode: new _w.RegExp('^(8|13|3[2-9]|40|46)$'),\n    _nonTextKeyCode: new _w.RegExp('^(8|13|1[6-9]|20|27|3[3-9]|40|45|46|11[2-9]|12[0-3]|144|145)$'),\n    _historyIgnoreKeyCode: new _w.RegExp('^(1[6-9]|20|27|3[3-9]|40|45|11[2-9]|12[0-3]|144|145)$'),\n    _onButtonsCheck: new _w.RegExp('^(' + _w.Object.keys(options._textTagsMap).join('|') + ')$', 'i'),\n    _frontZeroWidthReg: new _w.RegExp(util.zeroWidthSpace + '+', ''),\n    _keyCodeShortcut: {\n      65: 'A',\n      66: 'B',\n      83: 'S',\n      85: 'U',\n      73: 'I',\n      89: 'Y',\n      90: 'Z',\n      219: '[',\n      221: ']'\n    },\n    _shortcutCommand: function _shortcutCommand(keyCode, shift) {\n      var command = null;\n      var keyStr = event._keyCodeShortcut[keyCode];\n\n      switch (keyStr) {\n        case 'A':\n          command = 'selectAll';\n          break;\n\n        case 'B':\n          if (options.shortcutsDisable.indexOf('bold') === -1) {\n            command = 'bold';\n          }\n\n          break;\n\n        case 'S':\n          if (shift && options.shortcutsDisable.indexOf('strike') === -1) {\n            command = 'strike';\n          } else if (!shift && options.shortcutsDisable.indexOf('save') === -1) {\n            command = 'save';\n          }\n\n          break;\n\n        case 'U':\n          if (options.shortcutsDisable.indexOf('underline') === -1) {\n            command = 'underline';\n          }\n\n          break;\n\n        case 'I':\n          if (options.shortcutsDisable.indexOf('italic') === -1) {\n            command = 'italic';\n          }\n\n          break;\n\n        case 'Z':\n          if (options.shortcutsDisable.indexOf('undo') === -1) {\n            if (shift) {\n              command = 'redo';\n            } else {\n              command = 'undo';\n            }\n          }\n\n          break;\n\n        case 'Y':\n          if (options.shortcutsDisable.indexOf('undo') === -1) {\n            command = 'redo';\n          }\n\n          break;\n\n        case '[':\n          if (options.shortcutsDisable.indexOf('indent') === -1) {\n            command = options.rtl ? 'indent' : 'outdent';\n          }\n\n          break;\n\n        case ']':\n          if (options.shortcutsDisable.indexOf('indent') === -1) {\n            command = options.rtl ? 'outdent' : 'indent';\n          }\n\n          break;\n      }\n\n      if (!command) return !!keyStr;\n      core.commandHandler(core.commandMap[command], command);\n      return true;\n    },\n    _applyTagEffects: function _applyTagEffects() {\n      var selectionNode = core.getSelectionNode();\n      if (selectionNode === core.effectNode) return;\n      core.effectNode = selectionNode;\n      var marginDir = options.rtl ? 'marginRight' : 'marginLeft';\n      var commandMap = core.commandMap;\n      var classOnCheck = event._onButtonsCheck;\n      var commandMapNodes = [];\n      var currentNodes = [];\n      var activePlugins = core.activePlugins;\n      var cLen = activePlugins.length;\n      var nodeName = '';\n\n      while (selectionNode.firstChild) {\n        selectionNode = selectionNode.firstChild;\n      }\n\n      for (var element = selectionNode; !util.isWysiwygDiv(element); element = element.parentNode) {\n        if (!element) break;\n        if (element.nodeType !== 1 || util.isBreak(element)) continue;\n        nodeName = element.nodeName.toUpperCase();\n        currentNodes.push(nodeName);\n        /* Active plugins */\n\n        if (!core.isReadOnly) {\n          for (var _c7 = 0, name; _c7 < cLen; _c7++) {\n            name = activePlugins[_c7];\n\n            if (commandMapNodes.indexOf(name) === -1 && plugins[name].active.call(core, element)) {\n              commandMapNodes.push(name);\n            }\n          }\n        }\n\n        if (util.isFormatElement(element)) {\n          /* Outdent */\n          if (commandMapNodes.indexOf('OUTDENT') === -1 && commandMap.OUTDENT && !util.isImportantDisabled(commandMap.OUTDENT)) {\n            if (util.isListCell(element) || element.style[marginDir] && util.getNumber(element.style[marginDir], 0) > 0) {\n              commandMapNodes.push('OUTDENT');\n              commandMap.OUTDENT.removeAttribute('disabled');\n            }\n          }\n          /* Indent */\n\n\n          if (commandMapNodes.indexOf('INDENT') === -1 && commandMap.INDENT && !util.isImportantDisabled(commandMap.INDENT)) {\n            commandMapNodes.push('INDENT');\n\n            if (util.isListCell(element) && !element.previousElementSibling) {\n              commandMap.INDENT.setAttribute('disabled', true);\n            } else {\n              commandMap.INDENT.removeAttribute('disabled');\n            }\n          }\n\n          continue;\n        }\n        /** default active buttons [strong, ins, em, del, sub, sup] */\n\n\n        if (classOnCheck && classOnCheck.test(nodeName)) {\n          commandMapNodes.push(nodeName);\n          util.addClass(commandMap[nodeName], 'active');\n        }\n      }\n\n      core._setKeyEffect(commandMapNodes);\n      /** save current nodes */\n\n\n      core._variable.currentNodes = currentNodes.reverse();\n      core._variable.currentNodesMap = commandMapNodes;\n      /**  Displays the current node structure to resizingBar */\n\n      if (options.showPathLabel) context.element.navigation.textContent = core._variable.currentNodes.join(' > ');\n    },\n    _cancelCaptionEdit: function _cancelCaptionEdit() {\n      this.setAttribute('contenteditable', false);\n      this.removeEventListener('blur', event._cancelCaptionEdit);\n    },\n    _buttonsEventHandler: function _buttonsEventHandler(e) {\n      var target = e.target;\n      if (core._bindControllersOff) e.stopPropagation();\n\n      if (/^(input|textarea|select|option)$/i.test(target.nodeName)) {\n        core._antiBlur = false;\n      } else {\n        e.preventDefault();\n      }\n\n      if (util.getParentElement(target, '.se-submenu')) {\n        e.stopPropagation();\n        core._notHideToolbar = true;\n      } else {\n        var command = target.getAttribute('data-command');\n        var className = target.className;\n\n        while (!command && !/se-menu-list/.test(className) && !/sun-editor-common/.test(className)) {\n          target = target.parentNode;\n          command = target.getAttribute('data-command');\n          className = target.className;\n        }\n\n        if (command === core._submenuName || command === core._containerName) {\n          e.stopPropagation();\n        }\n      }\n    },\n    onClick_toolbar: function onClick_toolbar(e) {\n      var target = e.target;\n      var display = target.getAttribute('data-display');\n      var command = target.getAttribute('data-command');\n      var className = target.className;\n      core.controllersOff();\n\n      while (target.parentNode && !command && !/se-menu-list/.test(className) && !/se-toolbar/.test(className)) {\n        target = target.parentNode;\n        command = target.getAttribute('data-command');\n        display = target.getAttribute('data-display');\n        className = target.className;\n      }\n\n      if (!command && !display) return;\n      if (target.disabled) return;\n      core.actionCall(command, display, target);\n    },\n    onMouseDown_wysiwyg: function onMouseDown_wysiwyg(e) {\n      if (core.isReadOnly || util.isNonEditable(context.element.wysiwyg)) return; // user event\n\n      if (typeof functions.onMouseDown === 'function' && functions.onMouseDown(e, core) === false) return;\n      var tableCell = util.getParentElement(e.target, util.isCell);\n\n      if (tableCell) {\n        var tablePlugin = core.plugins.table;\n\n        if (tablePlugin && tableCell !== tablePlugin._fixedCell && !tablePlugin._shift) {\n          core.callPlugin('table', function () {\n            tablePlugin.onTableCellMultiSelect.call(core, tableCell, false);\n          }, null);\n        }\n      }\n\n      if (core._isBalloon) {\n        event._hideToolbar();\n      }\n\n      if (/FIGURE/i.test(e.target.nodeName)) e.preventDefault();\n    },\n    onClick_wysiwyg: function onClick_wysiwyg(e) {\n      var targetElement = e.target;\n\n      if (core.isReadOnly) {\n        e.preventDefault();\n\n        if (util.isAnchor(targetElement)) {\n          _w.open(targetElement.href, targetElement.target);\n        }\n\n        return false;\n      }\n\n      if (util.isNonEditable(context.element.wysiwyg)) return; // user event\n\n      if (typeof functions.onClick === 'function' && functions.onClick(e, core) === false) return;\n      var fileComponentInfo = core.getFileComponent(targetElement);\n\n      if (fileComponentInfo) {\n        e.preventDefault();\n        core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n        return;\n      }\n\n      var figcaption = util.getParentElement(targetElement, 'FIGCAPTION');\n\n      if (figcaption && (util.isNonEditable(figcaption) || !figcaption.getAttribute(\"contenteditable\"))) {\n        e.preventDefault();\n        figcaption.setAttribute('contenteditable', true);\n        figcaption.focus();\n\n        if (core._isInline && !core._inlineToolbarAttr.isShow) {\n          event._showToolbarInline();\n\n          var hideToolbar = function hideToolbar() {\n            event._hideToolbar();\n\n            figcaption.removeEventListener('blur', hideToolbar);\n          };\n\n          figcaption.addEventListener('blur', hideToolbar);\n        }\n      }\n\n      _w.setTimeout(core._editorRange.bind(core));\n\n      core._editorRange();\n\n      var selectionNode = core.getSelectionNode();\n      var formatEl = util.getFormatElement(selectionNode, null);\n      var rangeEl = util.getRangeFormatElement(selectionNode, null);\n\n      if (!formatEl && !util.isNonEditable(targetElement) && !util.isList(rangeEl)) {\n        var range = core.getRange();\n\n        if (util.getFormatElement(range.startContainer) === util.getFormatElement(range.endContainer)) {\n          if (util.isList(rangeEl)) {\n            e.preventDefault();\n            var oLi = util.createElement('LI');\n            var prevLi = selectionNode.nextElementSibling;\n            oLi.appendChild(selectionNode);\n            rangeEl.insertBefore(oLi, prevLi);\n            core.focus();\n          } else if (!util.isWysiwygDiv(selectionNode) && !util.isComponent(selectionNode) && (!util.isTable(selectionNode) || util.isCell(selectionNode)) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\n            e.preventDefault();\n            core.focus();\n          } else {\n            event._applyTagEffects();\n          }\n        }\n      } else {\n        event._applyTagEffects();\n      }\n\n      if (core._isBalloon) _w.setTimeout(event._toggleToolbarBalloon);\n    },\n    _balloonDelay: null,\n    _showToolbarBalloonDelay: function _showToolbarBalloonDelay() {\n      if (event._balloonDelay) {\n        _w.clearTimeout(event._balloonDelay);\n      }\n\n      event._balloonDelay = _w.setTimeout(function () {\n        _w.clearTimeout(this._balloonDelay);\n\n        this._balloonDelay = null;\n\n        this._showToolbarBalloon();\n      }.bind(event), 350);\n    },\n    _toggleToolbarBalloon: function _toggleToolbarBalloon() {\n      core._editorRange();\n\n      var range = core.getRange();\n      if (core._bindControllersOff || !core._isBalloonAlways && range.collapsed) event._hideToolbar();else event._showToolbarBalloon(range);\n    },\n    _showToolbarBalloon: function _showToolbarBalloon(rangeObj) {\n      if (!core._isBalloon) return;\n      var range = rangeObj || core.getRange();\n      var toolbar = context.element.toolbar;\n      var topArea = context.element.topArea;\n      var selection = core.getSelection();\n      var isDirTop;\n\n      if (core._isBalloonAlways && range.collapsed) {\n        isDirTop = true;\n      } else if (selection.focusNode === selection.anchorNode) {\n        isDirTop = selection.focusOffset < selection.anchorOffset;\n      } else {\n        var childNodes = util.getListChildNodes(range.commonAncestorContainer, null);\n        isDirTop = util.getArrayIndex(childNodes, selection.focusNode) < util.getArrayIndex(childNodes, selection.anchorNode);\n      }\n\n      var rects = range.getClientRects();\n      rects = rects[isDirTop ? 0 : rects.length - 1];\n      var globalScroll = core.getGlobalScrollOffset();\n      var scrollLeft = globalScroll.left;\n      var scrollTop = globalScroll.top;\n      var editorWidth = topArea.offsetWidth;\n\n      var offsets = event._getEditorOffsets(null);\n\n      var stickyTop = offsets.top;\n      var editorLeft = offsets.left;\n      toolbar.style.top = '-10000px';\n      toolbar.style.visibility = 'hidden';\n      toolbar.style.display = 'block';\n\n      if (!rects) {\n        var node = core.getSelectionNode();\n\n        if (util.isFormatElement(node)) {\n          var zeroWidth = util.createTextNode(util.zeroWidthSpace);\n          core.insertNode(zeroWidth, null, false);\n          core.setRange(zeroWidth, 1, zeroWidth, 1);\n\n          core._editorRange();\n\n          rects = core.getRange().getClientRects();\n          rects = rects[isDirTop ? 0 : rects.length - 1];\n        }\n\n        if (!rects) {\n          var nodeOffset = util.getOffset(node, context.element.wysiwygFrame);\n          rects = {\n            left: nodeOffset.left,\n            top: nodeOffset.top,\n            right: nodeOffset.left,\n            bottom: nodeOffset.top + node.offsetHeight,\n            noText: true\n          };\n          scrollLeft = 0;\n          scrollTop = 0;\n        }\n\n        isDirTop = true;\n      }\n\n      var arrowMargin = _w.Math.round(context.element._arrow.offsetWidth / 2);\n\n      var toolbarWidth = toolbar.offsetWidth;\n      var toolbarHeight = toolbar.offsetHeight;\n      var iframeRects = /iframe/i.test(context.element.wysiwygFrame.nodeName) ? context.element.wysiwygFrame.getClientRects()[0] : null;\n\n      if (iframeRects) {\n        rects = {\n          left: rects.left + iframeRects.left,\n          top: rects.top + iframeRects.top,\n          right: rects.right + iframeRects.right - iframeRects.width,\n          bottom: rects.bottom + iframeRects.bottom - iframeRects.height\n        };\n      }\n\n      event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\n\n      if (toolbarWidth !== toolbar.offsetWidth || toolbarHeight !== toolbar.offsetHeight) {\n        event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\n      }\n\n      if (options.toolbarContainer) {\n        var editorParent = topArea.parentElement;\n        var container = options.toolbarContainer;\n        var left = container.offsetLeft;\n        var top = container.offsetTop;\n\n        while (!container.parentElement.contains(editorParent) || !/^(BODY|HTML)$/i.test(container.parentElement.nodeName)) {\n          container = container.offsetParent;\n          left += container.offsetLeft;\n          top += container.offsetTop;\n        }\n\n        toolbar.style.left = toolbar.offsetLeft - left + topArea.offsetLeft + 'px';\n        toolbar.style.top = toolbar.offsetTop - top + topArea.offsetTop + 'px';\n      }\n\n      toolbar.style.visibility = '';\n    },\n    _setToolbarOffset: function _setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin) {\n      var padding = 1;\n      var toolbarWidth = toolbar.offsetWidth;\n      var toolbarHeight = rects.noText && !isDirTop ? 0 : toolbar.offsetHeight;\n      var absoluteLeft = (isDirTop ? rects.left : rects.right) - editorLeft - toolbarWidth / 2 + scrollLeft;\n      var overRight = absoluteLeft + toolbarWidth - editorWidth;\n      var t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\n      var l = absoluteLeft < 0 ? padding : overRight < 0 ? absoluteLeft : absoluteLeft - overRight - padding - 1;\n      var resetTop = false;\n      var space = t + (isDirTop ? event._getEditorOffsets(null).top : toolbar.offsetHeight - context.element.wysiwyg.offsetHeight);\n\n      if (!isDirTop && space > 0 && event._getPageBottomSpace() < space) {\n        isDirTop = true;\n        resetTop = true;\n      } else if (isDirTop && _d.documentElement.offsetTop > space) {\n        isDirTop = false;\n        resetTop = true;\n      }\n\n      if (resetTop) t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\n      toolbar.style.left = _w.Math.floor(l) + 'px';\n      toolbar.style.top = _w.Math.floor(t) + 'px';\n\n      if (isDirTop) {\n        util.removeClass(context.element._arrow, 'se-arrow-up');\n        util.addClass(context.element._arrow, 'se-arrow-down');\n        context.element._arrow.style.top = toolbarHeight + 'px';\n      } else {\n        util.removeClass(context.element._arrow, 'se-arrow-down');\n        util.addClass(context.element._arrow, 'se-arrow-up');\n        context.element._arrow.style.top = -arrowMargin + 'px';\n      }\n\n      var arrow_left = _w.Math.floor(toolbarWidth / 2 + (absoluteLeft - l));\n\n      context.element._arrow.style.left = (arrow_left + arrowMargin > toolbar.offsetWidth ? toolbar.offsetWidth - arrowMargin : arrow_left < arrowMargin ? arrowMargin : arrow_left) + 'px';\n    },\n    _showToolbarInline: function _showToolbarInline() {\n      if (!core._isInline) return;\n      var toolbar = context.element.toolbar;\n      if (options.toolbarContainer) toolbar.style.position = 'relative';else toolbar.style.position = 'absolute';\n      toolbar.style.visibility = 'hidden';\n      toolbar.style.display = 'block';\n      core._inlineToolbarAttr.width = toolbar.style.width = options.toolbarWidth;\n      core._inlineToolbarAttr.top = toolbar.style.top = (options.toolbarContainer ? 0 : -1 - toolbar.offsetHeight) + 'px';\n      if (typeof functions.showInline === 'function') functions.showInline(toolbar, context, core);\n      event.onScroll_window();\n      core._inlineToolbarAttr.isShow = true;\n      toolbar.style.visibility = '';\n    },\n    _hideToolbar: function _hideToolbar() {\n      if (!core._notHideToolbar && !core._variable.isFullScreen) {\n        context.element.toolbar.style.display = 'none';\n        core._inlineToolbarAttr.isShow = false;\n      }\n    },\n    onInput_wysiwyg: function onInput_wysiwyg(e) {\n      if (core.isReadOnly || core.isDisabled) {\n        e.preventDefault();\n        e.stopPropagation();\n        core.history.go(core.history.getCurrentIndex());\n        return false;\n      }\n\n      core._editorRange();\n\n      var data = (e.data === null ? '' : e.data === undefined ? ' ' : e.data) || '';\n\n      if (!core._charCount(data)) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      } // user event\n\n\n      if (typeof functions.onInput === 'function' && functions.onInput(e, core) === false) return; // history stack\n\n      core.history.push(true);\n    },\n    _isUneditableNode: function _isUneditableNode(range, isFront) {\n      var container = isFront ? range.startContainer : range.endContainer;\n      var offset = isFront ? range.startOffset : range.endOffset;\n      var siblingKey = isFront ? 'previousSibling' : 'nextSibling';\n      var isElement = container.nodeType === 1;\n      var siblingNode;\n\n      if (isElement) {\n        siblingNode = event._isUneditableNode_getSibling(container.childNodes[offset], siblingKey, container);\n        return siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\n      } else {\n        siblingNode = event._isUneditableNode_getSibling(container, siblingKey, container);\n        return core.isEdgePoint(container, offset, isFront ? 'front' : 'end') && siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\n      }\n    },\n    _isUneditableNode_getSibling: function _isUneditableNode_getSibling(selectNode, siblingKey, container) {\n      if (!selectNode) return null;\n      var siblingNode = selectNode[siblingKey];\n\n      if (!siblingNode) {\n        siblingNode = util.getFormatElement(container);\n        siblingNode = siblingNode ? siblingNode[siblingKey] : null;\n        if (siblingNode && !util.isComponent(siblingNode)) siblingNode = siblingKey === 'previousSibling' ? siblingNode.firstElementChild : siblingNode.lastElementChild;else return null;\n      }\n\n      return siblingNode;\n    },\n    _onShortcutKey: false,\n    onKeyDown_wysiwyg: function onKeyDown_wysiwyg(e) {\n      var keyCode = e.keyCode;\n      var shift = e.shiftKey;\n      var ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\n      var alt = e.altKey;\n      event._IEisComposing = keyCode === 229;\n\n      if (!ctrl && core.isReadOnly && !event._directionKeyCode.test(keyCode)) {\n        e.preventDefault();\n        return false;\n      }\n\n      core.submenuOff();\n\n      if (core._isBalloon) {\n        event._hideToolbar();\n      } // user event\n\n\n      if (typeof functions.onKeyDown === 'function' && functions.onKeyDown(e, core) === false) return;\n      /** Shortcuts */\n\n      if (ctrl && event._shortcutCommand(keyCode, shift)) {\n        event._onShortcutKey = true;\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      } else if (event._onShortcutKey) {\n        event._onShortcutKey = false;\n      }\n      /** default key action */\n\n\n      var selectionNode = core.getSelectionNode();\n      var range = core.getRange();\n      var selectRange = !range.collapsed || range.startContainer !== range.endContainer;\n      var fileComponentName = core._fileManager.pluginRegExp.test(core.currentControllerName) ? core.currentControllerName : '';\n      var formatEl = util.getFormatElement(selectionNode, null) || selectionNode;\n      var rangeEl = util.getRangeFormatElement(formatEl, null);\n\n      switch (keyCode) {\n        case 8:\n          /** backspace key */\n          if (!selectRange) {\n            if (fileComponentName) {\n              e.preventDefault();\n              e.stopPropagation();\n              core.plugins[fileComponentName].destroy.call(core);\n              break;\n            }\n          }\n\n          if (selectRange && event._hardDelete()) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          }\n\n          if (!util.isFormatElement(formatEl) && !context.element.wysiwyg.firstElementChild && !util.isComponent(selectionNode) && core._setDefaultFormat(options.defaultTag) !== null) {\n            e.preventDefault();\n            e.stopPropagation();\n            return false;\n          }\n\n          if (!selectRange && !formatEl.previousElementSibling && range.startOffset === 0 && !selectionNode.previousSibling && !util.isListCell(formatEl) && util.isFormatElement(formatEl) && (!util.isFreeFormatElement(formatEl) || util.isClosureFreeFormatElement(formatEl))) {\n            // closure range\n            if (util.isClosureRangeFormatElement(formatEl.parentNode)) {\n              e.preventDefault();\n              e.stopPropagation();\n              return false;\n            } // maintain default format\n\n\n            if (util.isWysiwygDiv(formatEl.parentNode) && formatEl.childNodes.length <= 1 && (!formatEl.firstChild || util.onlyZeroWidthSpace(formatEl.textContent))) {\n              e.preventDefault();\n              e.stopPropagation();\n\n              if (formatEl.nodeName.toUpperCase() === options.defaultTag.toUpperCase()) {\n                formatEl.innerHTML = '<br>';\n                var attrs = formatEl.attributes;\n\n                while (attrs[0]) {\n                  formatEl.removeAttribute(attrs[0].name);\n                }\n              } else {\n                var defaultFormat = util.createElement(options.defaultTag);\n                defaultFormat.innerHTML = '<br>';\n                formatEl.parentElement.replaceChild(defaultFormat, formatEl);\n              }\n\n              core.nativeFocus();\n              return false;\n            }\n          } // clean remove tag\n\n\n          if (formatEl && range.startContainer === range.endContainer && selectionNode.nodeType === 3 && !util.isFormatElement(selectionNode.parentNode)) {\n            if (range.collapsed ? selectionNode.textContent.length === 1 : range.endOffset - range.startOffset === selectionNode.textContent.length) {\n              e.preventDefault();\n              var offset = null;\n              var prev = selectionNode.parentNode.previousSibling;\n              var next = selectionNode.parentNode.nextSibling;\n\n              if (!prev) {\n                if (!next) {\n                  prev = util.createElement('BR');\n                  formatEl.appendChild(prev);\n                } else {\n                  prev = next;\n                  offset = 0;\n                }\n              }\n\n              selectionNode.textContent = '';\n              util.removeItemAllParents(selectionNode, null, formatEl);\n              offset = typeof offset === 'number' ? offset : prev.nodeType === 3 ? prev.textContent.length : 1;\n              core.setRange(prev, offset, prev, offset);\n              break;\n            }\n          } // tag[contenteditable=\"false\"]\n\n\n          if (event._isUneditableNode(range, true)) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // nested list\n\n\n          var commonCon = range.commonAncestorContainer;\n          formatEl = util.getFormatElement(range.startContainer, null);\n          rangeEl = util.getRangeFormatElement(formatEl, null);\n\n          if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\n            if (util.isListCell(formatEl) && util.isList(rangeEl) && (util.isListCell(rangeEl.parentNode) || formatEl.previousElementSibling) && (selectionNode === formatEl || selectionNode.nodeType === 3 && (!selectionNode.previousSibling || util.isList(selectionNode.previousSibling))) && (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.startContainer) : range.startOffset === 0 && range.collapsed)) {\n              if (range.startContainer !== range.endContainer) {\n                e.preventDefault();\n                core.removeNode();\n\n                if (range.startContainer.nodeType === 3) {\n                  core.setRange(range.startContainer, range.startContainer.textContent.length, range.startContainer, range.startContainer.textContent.length);\n                } // history stack\n\n\n                core.history.push(true);\n              } else {\n                var _prev = formatEl.previousElementSibling || rangeEl.parentNode;\n\n                if (util.isListCell(_prev)) {\n                  e.preventDefault();\n                  var prevLast = _prev;\n\n                  if (!_prev.contains(formatEl) && util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\n                    prevLast = prevLast.lastElementChild.lastElementChild;\n\n                    while (util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\n                      prevLast = prevLast.lastElementChild && prevLast.lastElementChild.lastElementChild;\n                    }\n\n                    _prev = prevLast;\n                  }\n\n                  var con = _prev === rangeEl.parentNode ? rangeEl.previousSibling : _prev.lastChild;\n\n                  if (!con) {\n                    con = util.createTextNode(util.zeroWidthSpace);\n                    rangeEl.parentNode.insertBefore(con, rangeEl.parentNode.firstChild);\n                  }\n\n                  var _offset = con.nodeType === 3 ? con.textContent.length : 1;\n\n                  var children = formatEl.childNodes;\n                  var after = con;\n                  var child = children[0];\n\n                  while (child = children[0]) {\n                    _prev.insertBefore(child, after.nextSibling);\n\n                    after = child;\n                  }\n\n                  util.removeItem(formatEl);\n                  if (rangeEl.children.length === 0) util.removeItem(rangeEl);\n                  core.setRange(con, _offset, con, _offset); // history stack\n\n                  core.history.push(true);\n                }\n              }\n\n              break;\n            } // detach range\n\n\n            if (!selectRange && range.startOffset === 0) {\n              var detach = true;\n              var comm = commonCon;\n\n              while (comm && comm !== rangeEl && !util.isWysiwygDiv(comm)) {\n                if (comm.previousSibling) {\n                  if (comm.previousSibling.nodeType === 1 || !util.onlyZeroWidthSpace(comm.previousSibling.textContent.trim())) {\n                    detach = false;\n                    break;\n                  }\n                }\n\n                comm = comm.parentNode;\n              }\n\n              if (detach && rangeEl.parentNode) {\n                e.preventDefault();\n                core.detachRangeFormatElement(rangeEl, util.isListCell(formatEl) ? [formatEl] : null, null, false, false); // history stack\n\n                core.history.push(true);\n                break;\n              }\n            }\n          } // component\n\n\n          if (!selectRange && formatEl && (range.startOffset === 0 || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\n            var sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] : selectionNode;\n            var _prev2 = formatEl.previousSibling; // select file component\n\n            var ignoreZWS = (commonCon.nodeType === 3 || util.isBreak(commonCon)) && !commonCon.previousSibling && range.startOffset === 0;\n\n            if (!sel.previousSibling && (util.isComponent(commonCon.previousSibling) || ignoreZWS && util.isComponent(_prev2))) {\n              var fileComponentInfo = core.getFileComponent(_prev2);\n\n              if (fileComponentInfo) {\n                e.preventDefault();\n                e.stopPropagation();\n                if (formatEl.textContent.length === 0) util.removeItem(formatEl);\n                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\n              } else if (util.isComponent(_prev2)) {\n                e.preventDefault();\n                e.stopPropagation();\n                util.removeItem(_prev2);\n              }\n\n              break;\n            } // delete nonEditable\n\n\n            if (util.isNonEditable(sel.previousSibling)) {\n              e.preventDefault();\n              e.stopPropagation();\n              util.removeItem(sel.previousSibling);\n              break;\n            }\n          }\n\n          break;\n\n        case 46:\n          /** delete key */\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            core.plugins[fileComponentName].destroy.call(core);\n            break;\n          }\n\n          if (selectRange && event._hardDelete()) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // tag[contenteditable=\"false\"]\n\n\n          if (event._isUneditableNode(range, false)) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // component\n\n\n          if ((util.isFormatElement(selectionNode) || selectionNode.nextSibling === null || util.onlyZeroWidthSpace(selectionNode.nextSibling) && selectionNode.nextSibling.nextSibling === null) && range.startOffset === selectionNode.textContent.length) {\n            var nextEl = formatEl.nextElementSibling;\n            if (!nextEl) break;\n\n            if (util.isComponent(nextEl)) {\n              e.preventDefault();\n\n              if (util.onlyZeroWidthSpace(formatEl)) {\n                util.removeItem(formatEl); // table component\n\n                if (util.isTable(nextEl)) {\n                  var cell = util.getChildElement(nextEl, util.isCell, false);\n                  cell = cell.firstElementChild || cell;\n                  core.setRange(cell, 0, cell, 0);\n                  break;\n                }\n              } // select file component\n\n\n              var _fileComponentInfo = core.getFileComponent(nextEl);\n\n              if (_fileComponentInfo) {\n                e.stopPropagation();\n                if (core.selectComponent(_fileComponentInfo.target, _fileComponentInfo.pluginName) === false) core.blur();\n              } else if (util.isComponent(nextEl)) {\n                e.stopPropagation();\n                util.removeItem(nextEl);\n              }\n\n              break;\n            }\n          }\n\n          if (!selectRange && (core.isEdgePoint(range.endContainer, range.endOffset) || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\n            var _sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] || selectionNode : selectionNode; // delete nonEditable\n\n\n            if (_sel && util.isNonEditable(_sel.nextSibling)) {\n              e.preventDefault();\n              e.stopPropagation();\n              util.removeItem(_sel.nextSibling);\n              break;\n            } else if (util.isComponent(_sel)) {\n              e.preventDefault();\n              e.stopPropagation();\n              util.removeItem(_sel);\n              break;\n            }\n          } // nested list\n\n\n          formatEl = util.getFormatElement(range.startContainer, null);\n          rangeEl = util.getRangeFormatElement(formatEl, null);\n\n          if (util.isListCell(formatEl) && util.isList(rangeEl) && (selectionNode === formatEl || selectionNode.nodeType === 3 && (!selectionNode.nextSibling || util.isList(selectionNode.nextSibling)) && (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.endContainer) : range.endOffset === selectionNode.textContent.length && range.collapsed))) {\n            if (range.startContainer !== range.endContainer) core.removeNode();\n\n            var _next = util.getArrayItem(formatEl.children, util.isList, false);\n\n            _next = _next || formatEl.nextElementSibling || rangeEl.parentNode.nextElementSibling;\n\n            if (_next && (util.isList(_next) || util.getArrayItem(_next.children, util.isList, false))) {\n              e.preventDefault();\n\n              var _con, _children;\n\n              if (util.isList(_next)) {\n                var _child2 = _next.firstElementChild;\n                _children = _child2.childNodes;\n                _con = _children[0];\n\n                while (_children[0]) {\n                  formatEl.insertBefore(_children[0], _next);\n                }\n\n                util.removeItem(_child2);\n              } else {\n                _con = _next.firstChild;\n                _children = _next.childNodes;\n\n                while (_children[0]) {\n                  formatEl.appendChild(_children[0]);\n                }\n\n                util.removeItem(_next);\n              }\n\n              core.setRange(_con, 0, _con, 0); // history stack\n\n              core.history.push(true);\n            }\n\n            break;\n          }\n\n          break;\n\n        case 9:\n          /** tab key */\n          if (fileComponentName || options.tabDisable) break;\n          e.preventDefault();\n          if (ctrl || alt || util.isWysiwygDiv(selectionNode)) break;\n          var isEdge = !range.collapsed || core.isEdgePoint(range.startContainer, range.startOffset);\n          var selectedFormats = core.getSelectedElements(null);\n          selectionNode = core.getSelectionNode();\n          var cells = [];\n          var lines = [];\n          var fc = util.isListCell(selectedFormats[0]),\n              lc = util.isListCell(selectedFormats[selectedFormats.length - 1]);\n          var r = {\n            sc: range.startContainer,\n            so: range.startOffset,\n            ec: range.endContainer,\n            eo: range.endOffset\n          };\n\n          for (var i = 0, len = selectedFormats.length, f; i < len; i++) {\n            f = selectedFormats[i];\n\n            if (util.isListCell(f)) {\n              if (!f.previousElementSibling && !shift) {\n                continue;\n              } else {\n                cells.push(f);\n              }\n            } else {\n              lines.push(f);\n            }\n          } // Nested list\n\n\n          if (cells.length > 0 && isEdge && core.plugins.list) {\n            r = core.plugins.list.editInsideList.call(core, shift, cells);\n          } else {\n            // table\n            var tableCell = util.getParentElement(selectionNode, util.isCell);\n\n            if (tableCell && isEdge) {\n              var table = util.getParentElement(tableCell, 'table');\n\n              var _cells = util.getListChildren(table, util.isCell);\n\n              var idx = shift ? util.prevIdx(_cells, tableCell) : util.nextIdx(_cells, tableCell);\n              if (idx === _cells.length && !shift) idx = 0;\n              if (idx === -1 && shift) idx = _cells.length - 1;\n              var moveCell = _cells[idx];\n              if (!moveCell) break;\n              moveCell = moveCell.firstElementChild || moveCell;\n              core.setRange(moveCell, 0, moveCell, 0);\n              break;\n            }\n\n            lines = lines.concat(cells);\n            fc = lc = null;\n          } // Lines tab(4)\n\n\n          if (lines.length > 0) {\n            if (!shift) {\n              var tabText = util.createTextNode(new _w.Array(core._variable.tabSize + 1).join(\"\\xA0\"));\n\n              if (lines.length === 1) {\n                var textRange = core.insertNode(tabText, null, true);\n                if (!textRange) return false;\n\n                if (!fc) {\n                  r.sc = tabText;\n                  r.so = textRange.endOffset;\n                }\n\n                if (!lc) {\n                  r.ec = tabText;\n                  r.eo = textRange.endOffset;\n                }\n              } else {\n                var _len14 = lines.length - 1;\n\n                for (var _i28 = 0, _child3; _i28 <= _len14; _i28++) {\n                  _child3 = lines[_i28].firstChild;\n                  if (!_child3) continue;\n\n                  if (util.isBreak(_child3)) {\n                    lines[_i28].insertBefore(tabText.cloneNode(false), _child3);\n                  } else {\n                    _child3.textContent = tabText.textContent + _child3.textContent;\n                  }\n                }\n\n                var firstChild = util.getChildElement(lines[0], 'text', false);\n                var endChild = util.getChildElement(lines[_len14], 'text', true);\n\n                if (!fc && firstChild) {\n                  r.sc = firstChild;\n                  r.so = 0;\n                }\n\n                if (!lc && endChild) {\n                  r.ec = endChild;\n                  r.eo = endChild.textContent.length;\n                }\n              }\n            } else {\n              var _len15 = lines.length - 1;\n\n              for (var _i29 = 0, line; _i29 <= _len15; _i29++) {\n                line = lines[_i29].childNodes;\n\n                for (var _c8 = 0, cLen = line.length, _child4; _c8 < cLen; _c8++) {\n                  _child4 = line[_c8];\n                  if (!_child4) break;\n                  if (util.onlyZeroWidthSpace(_child4)) continue;\n\n                  if (/^\\s{1,4}$/.test(_child4.textContent)) {\n                    util.removeItem(_child4);\n                  } else if (/^\\s{1,4}/.test(_child4.textContent)) {\n                    _child4.textContent = _child4.textContent.replace(/^\\s{1,4}/, '');\n                  }\n\n                  break;\n                }\n              }\n\n              var _firstChild = util.getChildElement(lines[0], 'text', false);\n\n              var _endChild = util.getChildElement(lines[_len15], 'text', true);\n\n              if (!fc && _firstChild) {\n                r.sc = _firstChild;\n                r.so = 0;\n              }\n\n              if (!lc && _endChild) {\n                r.ec = _endChild;\n                r.eo = _endChild.textContent.length;\n              }\n            }\n          }\n\n          core.setRange(r.sc, r.so, r.ec, r.eo); // history stack\n\n          core.history.push(false);\n          break;\n\n        case 13:\n          /** enter key */\n          var freeFormatEl = util.getFreeFormatElement(selectionNode, null);\n\n          if (core._charTypeHTML) {\n            var enterHTML = '';\n\n            if (!shift && freeFormatEl || shift) {\n              enterHTML = '<br>';\n            } else {\n              enterHTML = '<' + formatEl.nodeName + '><br></' + formatEl.nodeName + '>';\n            }\n\n            if (!core.checkCharCount(enterHTML, 'byte-html')) {\n              e.preventDefault();\n              return false;\n            }\n          }\n\n          if (!shift) {\n            var formatInners = core._isEdgeFormat(range.endContainer, range.endOffset, 'end');\n\n            if (formatInners && /^H[1-6]$/i.test(formatEl.nodeName) || /^HR$/i.test(formatEl.nodeName)) {\n              e.preventDefault();\n              var temp = null;\n              var newFormat = core.appendFormatTag(formatEl, options.defaultTag);\n\n              if (formatInners && formatInners.length > 0) {\n                temp = formatInners.pop();\n                var innerNode = temp;\n\n                while (formatInners.length > 0) {\n                  temp = temp.appendChild(formatInners.pop());\n                }\n\n                newFormat.appendChild(innerNode);\n              }\n\n              temp = !temp ? newFormat.firstChild : temp.appendChild(newFormat.firstChild);\n              core.setRange(temp, 0, temp, 0);\n              break;\n            } else if (options.lineAttrReset && formatEl && !util.isListCell(formatEl)) {\n              e.preventDefault();\n              e.stopPropagation();\n              var newEl;\n\n              if (!range.collapsed) {\n                var isMultiLine = util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null);\n\n                var _r2 = core.removeNode();\n\n                if (isMultiLine) {\n                  newEl = util.getFormatElement(_r2.container, null);\n\n                  if (!_r2.prevContainer) {\n                    var _newFormat = formatEl.cloneNode(false);\n\n                    _newFormat.innerHTML = '<br>';\n                    newEl.parentNode.insertBefore(_newFormat, newEl);\n                  } else if (newEl !== formatEl && newEl.nextElementSibling === formatEl) {\n                    newEl = formatEl;\n                  }\n                } else {\n                  newEl = util.splitElement(_r2.container, _r2.offset, 0);\n                }\n              } else {\n                if (util.onlyZeroWidthSpace(formatEl)) newEl = core.appendFormatTag(formatEl, formatEl.cloneNode(false));else newEl = util.splitElement(range.endContainer, range.endOffset, 0);\n              }\n\n              var resetAttr = options.lineAttrReset === '*' ? null : options.lineAttrReset;\n              var _attrs = newEl.attributes;\n              var _i30 = 0;\n\n              while (_attrs[_i30]) {\n                if (resetAttr && resetAttr.test(_attrs[_i30].name)) {\n                  _i30++;\n                  continue;\n                }\n\n                newEl.removeAttribute(_attrs[_i30].name);\n              }\n\n              core.setRange(newEl.firstChild, 0, newEl.firstChild, 0);\n              break;\n            }\n\n            if (freeFormatEl) {\n              e.preventDefault();\n              var selectionFormat = selectionNode === freeFormatEl;\n              var wSelection = core.getSelection();\n              var _children2 = selectionNode.childNodes,\n                  _offset2 = wSelection.focusOffset,\n                  _prev3 = selectionNode.previousElementSibling,\n                  _next2 = selectionNode.nextSibling;\n\n              if (!util.isClosureFreeFormatElement(freeFormatEl) && !!_children2 && (selectionFormat && range.collapsed && _children2.length - 1 <= _offset2 + 1 && util.isBreak(_children2[_offset2]) && (!_children2[_offset2 + 1] || (!_children2[_offset2 + 2] || util.onlyZeroWidthSpace(_children2[_offset2 + 2].textContent)) && _children2[_offset2 + 1].nodeType === 3 && util.onlyZeroWidthSpace(_children2[_offset2 + 1].textContent)) && _offset2 > 0 && util.isBreak(_children2[_offset2 - 1]) || !selectionFormat && util.onlyZeroWidthSpace(selectionNode.textContent) && util.isBreak(_prev3) && (util.isBreak(_prev3.previousSibling) || !util.onlyZeroWidthSpace(_prev3.previousSibling.textContent)) && (!_next2 || !util.isBreak(_next2) && util.onlyZeroWidthSpace(_next2.textContent)))) {\n                if (selectionFormat) util.removeItem(_children2[_offset2 - 1]);else util.removeItem(selectionNode);\n\n                var _newEl = core.appendFormatTag(freeFormatEl, util.isFormatElement(freeFormatEl.nextElementSibling) && !util.isRangeFormatElement(freeFormatEl.nextElementSibling) ? freeFormatEl.nextElementSibling : null);\n\n                util.copyFormatAttributes(_newEl, freeFormatEl);\n                core.setRange(_newEl, 1, _newEl, 1);\n                break;\n              }\n\n              if (selectionFormat) {\n                functions.insertHTML(range.collapsed && util.isBreak(range.startContainer.childNodes[range.startOffset - 1]) ? '<br>' : '<br><br>', true, false);\n                var focusNode = wSelection.focusNode;\n                var wOffset = wSelection.focusOffset;\n\n                if (freeFormatEl === focusNode) {\n                  focusNode = focusNode.childNodes[wOffset - _offset2 > 1 ? wOffset - 1 : wOffset];\n                }\n\n                core.setRange(focusNode, 1, focusNode, 1);\n              } else {\n                var focusNext = wSelection.focusNode.nextSibling;\n                var br = util.createElement('BR');\n                core.insertNode(br, null, false);\n                var brPrev = br.previousSibling,\n                    brNext = br.nextSibling;\n\n                if (!util.isBreak(focusNext) && !util.isBreak(brPrev) && (!brNext || util.onlyZeroWidthSpace(brNext))) {\n                  br.parentNode.insertBefore(br.cloneNode(false), br);\n                  core.setRange(br, 1, br, 1);\n                } else {\n                  core.setRange(brNext, 0, brNext, 0);\n                }\n              }\n\n              event._onShortcutKey = true;\n              break;\n            }\n          }\n\n          if (selectRange) break;\n\n          if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\n            var _range = core.getRange();\n\n            if (core.isEdgePoint(_range.endContainer, _range.endOffset) && util.isList(selectionNode.nextSibling)) {\n              e.preventDefault();\n\n              var _newEl2 = util.createElement('LI');\n\n              var _br2 = util.createElement('BR');\n\n              _newEl2.appendChild(_br2);\n\n              formatEl.parentNode.insertBefore(_newEl2, formatEl.nextElementSibling);\n\n              _newEl2.appendChild(selectionNode.nextSibling);\n\n              core.setRange(_br2, 1, _br2, 1);\n              break;\n            }\n\n            if ((_range.commonAncestorContainer.nodeType === 3 ? !_range.commonAncestorContainer.nextElementSibling : true) && util.onlyZeroWidthSpace(formatEl.innerText.trim())) {\n              e.preventDefault();\n              var _newEl3 = null;\n\n              if (util.isListCell(rangeEl.parentNode)) {\n                rangeEl = formatEl.parentNode.parentNode.parentNode;\n                _newEl3 = util.splitElement(formatEl, null, util.getElementDepth(formatEl) - 2);\n\n                if (!_newEl3) {\n                  var newListCell = util.createElement('LI');\n                  newListCell.innerHTML = '<br>';\n                  rangeEl.insertBefore(newListCell, _newEl3);\n                  _newEl3 = newListCell;\n                }\n              } else {\n                var _newFormat2 = util.isCell(rangeEl.parentNode) ? 'DIV' : util.isList(rangeEl.parentNode) ? 'LI' : util.isFormatElement(rangeEl.nextElementSibling) && !util.isRangeFormatElement(rangeEl.nextElementSibling) ? rangeEl.nextElementSibling.nodeName : util.isFormatElement(rangeEl.previousElementSibling) && !util.isRangeFormatElement(rangeEl.previousElementSibling) ? rangeEl.previousElementSibling.nodeName : options.defaultTag;\n\n                _newEl3 = util.createElement(_newFormat2);\n                var edge = core.detachRangeFormatElement(rangeEl, [formatEl], null, true, true);\n                edge.cc.insertBefore(_newEl3, edge.ec);\n              }\n\n              _newEl3.innerHTML = '<br>';\n              util.removeItemAllParents(formatEl, null, null);\n              core.setRange(_newEl3, 1, _newEl3, 1);\n              break;\n            }\n          }\n\n          if (rangeEl && util.getParentElement(rangeEl, 'FIGCAPTION') && util.getParentElement(rangeEl, util.isList)) {\n            e.preventDefault();\n            formatEl = core.appendFormatTag(formatEl, null);\n            core.setRange(formatEl, 0, formatEl, 0);\n          }\n\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            var compContext = context[fileComponentName];\n            var container = compContext._container;\n            var sibling = container.previousElementSibling || container.nextElementSibling;\n            var _newEl4 = null;\n\n            if (util.isListCell(container.parentNode)) {\n              _newEl4 = util.createElement('BR');\n            } else {\n              _newEl4 = util.createElement(util.isFormatElement(sibling) && !util.isRangeFormatElement(sibling) ? sibling.nodeName : options.defaultTag);\n              _newEl4.innerHTML = '<br>';\n            }\n\n            container.parentNode.insertBefore(_newEl4, container);\n            core.callPlugin(fileComponentName, function () {\n              if (core.selectComponent(compContext._element, fileComponentName) === false) core.blur();\n            }, null);\n          }\n\n          break;\n\n        case 27:\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            core.controllersOff();\n            return false;\n          }\n\n          break;\n      }\n\n      if (shift && keyCode === 16) {\n        e.preventDefault();\n        e.stopPropagation();\n        var tablePlugin = core.plugins.table;\n\n        if (tablePlugin && !tablePlugin._shift && !tablePlugin._ref) {\n          var _cell = util.getParentElement(formatEl, util.isCell);\n\n          if (_cell) {\n            tablePlugin.onTableCellMultiSelect.call(core, _cell, true);\n            return;\n          }\n        }\n      } else if (shift && (util.isOSX_IOS ? alt : ctrl) && keyCode === 32) {\n        e.preventDefault();\n        e.stopPropagation();\n        var nbsp = core.insertNode(util.createTextNode(\"\\xA0\"));\n\n        if (nbsp && nbsp.container) {\n          core.setRange(nbsp.container, nbsp.endOffset, nbsp.container, nbsp.endOffset);\n          return;\n        }\n      }\n\n      if (util.isIE && !ctrl && !alt && !selectRange && !event._nonTextKeyCode.test(keyCode) && util.isBreak(range.commonAncestorContainer)) {\n        var zeroWidth = util.createTextNode(util.zeroWidthSpace);\n        core.insertNode(zeroWidth, null, false);\n        core.setRange(zeroWidth, 1, zeroWidth, 1);\n      }\n    },\n    onKeyUp_wysiwyg: function onKeyUp_wysiwyg(e) {\n      if (event._onShortcutKey) return;\n\n      core._editorRange();\n\n      var keyCode = e.keyCode;\n      var ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\n      var alt = e.altKey;\n\n      if (core.isReadOnly) {\n        if (!ctrl && event._directionKeyCode.test(keyCode)) event._applyTagEffects();\n        return;\n      }\n\n      var range = core.getRange();\n      var selectionNode = core.getSelectionNode();\n\n      if (core._isBalloon && (core._isBalloonAlways && keyCode !== 27 || !range.collapsed)) {\n        if (core._isBalloonAlways) {\n          if (keyCode !== 27) event._showToolbarBalloonDelay();\n        } else {\n          event._showToolbarBalloon();\n\n          return;\n        }\n      }\n      /** when format tag deleted */\n\n\n      if (keyCode === 8 && util.isWysiwygDiv(selectionNode) && selectionNode.textContent === '' && selectionNode.children.length === 0) {\n        e.preventDefault();\n        e.stopPropagation();\n        selectionNode.innerHTML = '';\n        var oFormatTag = util.createElement(util.isFormatElement(core._variable.currentNodes[0]) ? core._variable.currentNodes[0] : options.defaultTag);\n        oFormatTag.innerHTML = '<br>';\n        selectionNode.appendChild(oFormatTag);\n        core.setRange(oFormatTag, 0, oFormatTag, 0);\n\n        event._applyTagEffects();\n\n        core.history.push(false);\n        return;\n      }\n\n      var formatEl = util.getFormatElement(selectionNode, null);\n      var rangeEl = util.getRangeFormatElement(selectionNode, null);\n\n      if (!formatEl && range.collapsed && !util.isComponent(selectionNode) && !util.isList(selectionNode) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\n        selectionNode = core.getSelectionNode();\n      }\n\n      if (event._directionKeyCode.test(keyCode)) {\n        event._applyTagEffects();\n      }\n\n      var textKey = !ctrl && !alt && !event._nonTextKeyCode.test(keyCode);\n\n      if (textKey && selectionNode.nodeType === 3 && util.zeroWidthRegExp.test(selectionNode.textContent) && !(e.isComposing !== undefined ? e.isComposing : event._IEisComposing)) {\n        var so = range.startOffset,\n            eo = range.endOffset;\n        var frontZeroWidthCnt = (selectionNode.textContent.substring(0, eo).match(event._frontZeroWidthReg) || '').length;\n        so = range.startOffset - frontZeroWidthCnt;\n        eo = range.endOffset - frontZeroWidthCnt;\n        selectionNode.textContent = selectionNode.textContent.replace(util.zeroWidthRegExp, '');\n        core.setRange(selectionNode, so < 0 ? 0 : so, selectionNode, eo < 0 ? 0 : eo);\n      }\n\n      core._charCount(''); // user event\n\n\n      if (typeof functions.onKeyUp === 'function' && functions.onKeyUp(e, core) === false) return; // history stack\n\n      if (!ctrl && !alt && !event._historyIgnoreKeyCode.test(keyCode)) {\n        core.history.push(true);\n      }\n    },\n    onScroll_wysiwyg: function onScroll_wysiwyg(e) {\n      core.controllersOff();\n      if (core._isBalloon) event._hideToolbar(); // user event\n\n      if (typeof functions.onScroll === 'function') functions.onScroll(e, core);\n    },\n    onFocus_wysiwyg: function onFocus_wysiwyg(e) {\n      if (core._antiBlur) return;\n      core.hasFocus = true;\n\n      _w.setTimeout(event._applyTagEffects);\n\n      if (core._isInline) event._showToolbarInline(); // user event\n\n      if (typeof functions.onFocus === 'function') functions.onFocus(e, core);\n    },\n    onBlur_wysiwyg: function onBlur_wysiwyg(e) {\n      if (core._antiBlur || core._variable.isCodeView) return;\n      core.hasFocus = false;\n      core.effectNode = null;\n      core.controllersOff();\n      if (core._isInline || core._isBalloon) event._hideToolbar();\n\n      core._setKeyEffect([]);\n\n      core._variable.currentNodes = [];\n      core._variable.currentNodesMap = [];\n      if (options.showPathLabel) context.element.navigation.textContent = ''; // user event\n\n      if (typeof functions.onBlur === 'function') functions.onBlur(e, core);\n    },\n    onMouseDown_resizingBar: function onMouseDown_resizingBar(e) {\n      e.stopPropagation();\n      core.submenuOff();\n      core.controllersOff();\n      core._variable.resizeClientY = e.clientY;\n      context.element.resizeBackground.style.display = 'block';\n\n      function closureFunc() {\n        context.element.resizeBackground.style.display = 'none';\n\n        _d.removeEventListener('mousemove', event._resize_editor);\n\n        _d.removeEventListener('mouseup', closureFunc);\n      }\n\n      _d.addEventListener('mousemove', event._resize_editor);\n\n      _d.addEventListener('mouseup', closureFunc);\n    },\n    _resize_editor: function _resize_editor(e) {\n      var resizeInterval = context.element.editorArea.offsetHeight + (e.clientY - core._variable.resizeClientY);\n      var h = resizeInterval < core._variable.minResizingSize ? core._variable.minResizingSize : resizeInterval;\n      context.element.wysiwygFrame.style.height = context.element.code.style.height = h + 'px';\n      core._variable.resizeClientY = e.clientY;\n      if (util.isIE) core.__callResizeFunction(h, null);\n    },\n    onResize_window: function onResize_window() {\n      if (util.isIE) core.resetResponsiveToolbar();\n      if (context.element.toolbar.offsetWidth === 0) return;\n\n      if (context.fileBrowser && context.fileBrowser.area.style.display === 'block') {\n        context.fileBrowser.body.style.maxHeight = _w.innerHeight - context.fileBrowser.header.offsetHeight - 50 + 'px';\n      }\n\n      if (core.submenuActiveButton && core.submenu) {\n        core._setMenuPosition(core.submenuActiveButton, core.submenu);\n      }\n\n      if (core._variable.isFullScreen) {\n        core._variable.innerHeight_fullScreen += _w.innerHeight - context.element.toolbar.offsetHeight - core._variable.innerHeight_fullScreen;\n        context.element.editorArea.style.height = core._variable.innerHeight_fullScreen + 'px';\n        return;\n      }\n\n      if (core._variable.isCodeView && core._isInline) {\n        event._showToolbarInline();\n\n        return;\n      }\n\n      core._iframeAutoHeight();\n\n      if (core._sticky) {\n        context.element.toolbar.style.width = context.element.topArea.offsetWidth - 2 + 'px';\n        event.onScroll_window();\n      }\n    },\n    onScroll_window: function onScroll_window() {\n      if (core._variable.isFullScreen || context.element.toolbar.offsetWidth === 0 || options.stickyToolbar < 0) return;\n      var element = context.element;\n      var editorHeight = element.editorArea.offsetHeight;\n      var y = (this.scrollY || _d.documentElement.scrollTop) + options.stickyToolbar;\n      var editorTop = event._getEditorOffsets(options.toolbarContainer).top - (core._isInline ? element.toolbar.offsetHeight : 0);\n      var inlineOffset = core._isInline && y - editorTop > 0 ? y - editorTop - context.element.toolbar.offsetHeight : 0;\n\n      if (y < editorTop) {\n        event._offStickyToolbar();\n      } else if (y + core._variable.minResizingSize >= editorHeight + editorTop) {\n        if (!core._sticky) event._onStickyToolbar(inlineOffset);\n        element.toolbar.style.top = inlineOffset + editorHeight + editorTop + options.stickyToolbar - y - core._variable.minResizingSize + 'px';\n      } else if (y >= editorTop) {\n        event._onStickyToolbar(inlineOffset);\n      }\n    },\n    _getEditorOffsets: function _getEditorOffsets(container) {\n      var offsetEl = container || context.element.topArea;\n      var t = 0,\n          l = 0,\n          s = 0;\n\n      while (offsetEl) {\n        t += offsetEl.offsetTop;\n        l += offsetEl.offsetLeft;\n        s += offsetEl.scrollTop;\n        offsetEl = offsetEl.offsetParent;\n      }\n\n      return {\n        top: t,\n        left: l,\n        scroll: s\n      };\n    },\n    _getPageBottomSpace: function _getPageBottomSpace() {\n      return _d.documentElement.scrollHeight - (event._getEditorOffsets(null).top + context.element.topArea.offsetHeight);\n    },\n    _onStickyToolbar: function _onStickyToolbar(inlineOffset) {\n      var element = context.element;\n\n      if (!core._isInline && !options.toolbarContainer) {\n        element._stickyDummy.style.height = element.toolbar.offsetHeight + 'px';\n        element._stickyDummy.style.display = 'block';\n      }\n\n      element.toolbar.style.top = options.stickyToolbar + inlineOffset + 'px';\n      element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : element.toolbar.offsetWidth + 'px';\n      util.addClass(element.toolbar, 'se-toolbar-sticky');\n      core._sticky = true;\n    },\n    _offStickyToolbar: function _offStickyToolbar() {\n      var element = context.element;\n      element._stickyDummy.style.display = 'none';\n      element.toolbar.style.top = core._isInline ? core._inlineToolbarAttr.top : '';\n      element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : '';\n      element.editorArea.style.marginTop = '';\n      util.removeClass(element.toolbar, 'se-toolbar-sticky');\n      core._sticky = false;\n    },\n    _codeViewAutoHeight: function _codeViewAutoHeight() {\n      if (core._variable.isFullScreen) return;\n      context.element.code.style.height = context.element.code.scrollHeight + 'px';\n    },\n    // FireFox - table delete, Chrome - image, video, audio\n    _hardDelete: function _hardDelete() {\n      var range = core.getRange();\n      var sc = range.startContainer;\n      var ec = range.endContainer; // table\n\n      var sCell = util.getRangeFormatElement(sc);\n      var eCell = util.getRangeFormatElement(ec);\n      var sIsCell = util.isCell(sCell);\n      var eIsCell = util.isCell(eCell);\n      var ancestor = range.commonAncestorContainer;\n\n      if ((sIsCell && !sCell.previousElementSibling && !sCell.parentElement.previousElementSibling || eIsCell && !eCell.nextElementSibling && !eCell.parentElement.nextElementSibling) && sCell !== eCell) {\n        if (!sIsCell) {\n          util.removeItem(util.getParentElement(eCell, function (current) {\n            return ancestor === current.parentNode;\n          }));\n        } else if (!eIsCell) {\n          util.removeItem(util.getParentElement(sCell, function (current) {\n            return ancestor === current.parentNode;\n          }));\n        } else {\n          util.removeItem(util.getParentElement(sCell, function (current) {\n            return ancestor === current.parentNode;\n          }));\n          core.nativeFocus();\n          return true;\n        }\n      } // component\n\n\n      var sComp = sc.nodeType === 1 ? util.getParentElement(sc, '.se-component') : null;\n      var eComp = ec.nodeType === 1 ? util.getParentElement(ec, '.se-component') : null;\n      if (sComp) util.removeItem(sComp);\n      if (eComp) util.removeItem(eComp);\n      return false;\n    },\n    onPaste_wysiwyg: function onPaste_wysiwyg(e) {\n      var clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\n      if (!clipboardData) return true;\n      return event._dataTransferAction('paste', e, clipboardData);\n    },\n    _setClipboardComponent: function _setClipboardComponent(e, info, clipboardData) {\n      e.preventDefault();\n      e.stopPropagation();\n      clipboardData.setData('text/html', info.component.outerHTML);\n    },\n    onCopy_wysiwyg: function onCopy_wysiwyg(e) {\n      var clipboardData = util.isIE ? _w.clipboardData : e.clipboardData; // user event\n\n      if (typeof functions.onCopy === 'function' && !functions.onCopy(e, clipboardData, core)) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      var info = core.currentFileComponentInfo;\n\n      if (info && !util.isIE) {\n        event._setClipboardComponent(e, info, clipboardData);\n\n        util.addClass(info.component, 'se-component-copy'); // copy effect\n\n        _w.setTimeout(function () {\n          util.removeClass(info.component, 'se-component-copy');\n        }, 150);\n      }\n    },\n    onSave_wysiwyg: function onSave_wysiwyg(content) {\n      // user event\n      if (typeof functions.onSave === 'function') {\n        functions.onSave(content, core);\n        return;\n      }\n    },\n    onCut_wysiwyg: function onCut_wysiwyg(e) {\n      var clipboardData = util.isIE ? _w.clipboardData : e.clipboardData; // user event\n\n      if (typeof functions.onCut === 'function' && !functions.onCut(e, clipboardData, core)) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      var info = core.currentFileComponentInfo;\n\n      if (info && !util.isIE) {\n        event._setClipboardComponent(e, info, clipboardData);\n\n        util.removeItem(info.component);\n        core.controllersOff();\n      }\n\n      _w.setTimeout(function () {\n        // history stack\n        core.history.push(false);\n      });\n    },\n    onDrop_wysiwyg: function onDrop_wysiwyg(e) {\n      if (core.isReadOnly || util.isIE) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      var dataTransfer = e.dataTransfer;\n      if (!dataTransfer) return true;\n      core.removeNode();\n\n      event._setDropLocationSelection(e);\n\n      return event._dataTransferAction('drop', e, dataTransfer);\n    },\n    _setDropLocationSelection: function _setDropLocationSelection(e) {\n      if (e.rangeParent) {\n        core.setRange(e.rangeParent, e.rangeOffset, e.rangeParent, e.rangeOffset);\n      } else if (core._wd.caretRangeFromPoint) {\n        var r = core._wd.caretRangeFromPoint(e.clientX, e.clientY);\n\n        core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\n      } else {\n        var _r3 = core.getRange();\n\n        core.setRange(_r3.startContainer, _r3.startOffset, _r3.endContainer, _r3.endOffset);\n      }\n    },\n    _dataTransferAction: function _dataTransferAction(type, e, data) {\n      var plainText, cleanData;\n\n      if (util.isIE) {\n        plainText = data.getData('Text');\n        var range = core.getRange();\n        var tempDiv = util.createElement('DIV');\n        var tempRange = {\n          sc: range.startContainer,\n          so: range.startOffset,\n          ec: range.endContainer,\n          eo: range.endOffset\n        };\n        tempDiv.setAttribute('contenteditable', true);\n        tempDiv.style.cssText = 'position:absolute; top:0; left:0; width:1px; height:1px; overflow:hidden;';\n        context.element.relative.appendChild(tempDiv);\n        tempDiv.focus();\n\n        _w.setTimeout(function () {\n          cleanData = tempDiv.innerHTML;\n          util.removeItem(tempDiv);\n          core.setRange(tempRange.sc, tempRange.so, tempRange.ec, tempRange.eo);\n\n          event._setClipboardData(type, e, plainText, cleanData, data);\n        });\n\n        return true;\n      } else {\n        plainText = data.getData('text/plain');\n        cleanData = data.getData('text/html');\n\n        if (event._setClipboardData(type, e, plainText, cleanData, data) === false) {\n          e.preventDefault();\n          e.stopPropagation();\n          return false;\n        }\n      }\n    },\n    _setClipboardData: function _setClipboardData(type, e, plainText, cleanData, data) {\n      // MS word, OneNode, Excel\n      var MSData = /class=[\"']*Mso(Normal|List)/i.test(cleanData) || /content=[\"']*Word.Document/i.test(cleanData) || /content=[\"']*OneNote.File/i.test(cleanData) || /content=[\"']*Excel.Sheet/i.test(cleanData);\n      var onlyText = !cleanData;\n\n      if (!onlyText) {\n        cleanData = cleanData.replace(/^<html>\\r?\\n?<body>\\r?\\n?\\x3C!--StartFragment--\\>|\\x3C!--EndFragment-->\\r?\\n?<\\/body\\>\\r?\\n?<\\/html>$/g, '');\n\n        if (MSData) {\n          cleanData = cleanData.replace(/\\n/g, ' ');\n          plainText = plainText.replace(/\\n/g, ' ');\n        } else {\n          cleanData = (plainText === cleanData ? plainText : cleanData).replace(/\\n/g, '<br>');\n        }\n\n        cleanData = core.cleanHTML(cleanData, core.pasteTagsWhitelistRegExp, core.pasteTagsBlacklistRegExp);\n      } else {\n        cleanData = util._HTMLConvertor(plainText).replace(/\\n/g, '<br>');\n      }\n\n      var maxCharCount = core._charCount(core._charTypeHTML ? cleanData : plainText); // user event - paste\n\n\n      if (type === 'paste' && typeof functions.onPaste === 'function') {\n        var value = functions.onPaste(e, cleanData, maxCharCount, core);\n        if (!value) return false;\n        if (typeof value === 'string') cleanData = value;\n      } // user event - drop\n\n\n      if (type === 'drop' && typeof functions.onDrop === 'function') {\n        var _value = functions.onDrop(e, cleanData, maxCharCount, core);\n\n        if (!_value) return false;\n        if (typeof _value === 'string') cleanData = _value;\n      } // files\n\n\n      var files = data.files;\n\n      if (files.length > 0 && !MSData) {\n        if (/^image/.test(files[0].type) && core.plugins.image) {\n          functions.insertImage(files);\n        }\n\n        return false;\n      }\n\n      if (!maxCharCount) {\n        return false;\n      }\n\n      if (cleanData) {\n        functions.insertHTML(cleanData, true, false);\n        return false;\n      }\n    },\n    onMouseMove_wysiwyg: function onMouseMove_wysiwyg(e) {\n      if (core.isDisabled || core.isReadOnly) return false;\n      var component = util.getParentElement(e.target, util.isComponent);\n      var lineBreakerStyle = core._lineBreaker.style;\n\n      if (component && !core.currentControllerName) {\n        var ctxEl = context.element;\n        var scrollTop = 0;\n        var el = ctxEl.wysiwyg;\n\n        do {\n          scrollTop += el.scrollTop;\n          el = el.parentElement;\n        } while (el && !/^(BODY|HTML)$/i.test(el.nodeName));\n\n        var wScroll = ctxEl.wysiwyg.scrollTop;\n\n        var offsets = event._getEditorOffsets(null);\n\n        var componentTop = util.getOffset(component, ctxEl.wysiwygFrame).top + wScroll;\n        var y = e.pageY + scrollTop + (options.iframe && !options.toolbarContainer ? ctxEl.toolbar.offsetHeight : 0);\n\n        var _c9 = componentTop + (options.iframe ? scrollTop : offsets.top);\n\n        var isList = util.isListCell(component.parentNode);\n        var dir = '',\n            top = '';\n\n        if ((isList ? !component.previousSibling : !util.isFormatElement(component.previousElementSibling)) && y < _c9 + 20) {\n          top = componentTop;\n          dir = 't';\n        } else if ((isList ? !component.nextSibling : !util.isFormatElement(component.nextElementSibling)) && y > _c9 + component.offsetHeight - 20) {\n          top = componentTop + component.offsetHeight;\n          dir = 'b';\n        } else {\n          lineBreakerStyle.display = 'none';\n          return;\n        }\n\n        core._variable._lineBreakComp = component;\n        core._variable._lineBreakDir = dir;\n        lineBreakerStyle.top = top - wScroll + 'px';\n        core._lineBreakerButton.style.left = util.getOffset(component).left + component.offsetWidth / 2 - 15 + 'px';\n        lineBreakerStyle.display = 'block';\n      } // off line breaker\n      else if (lineBreakerStyle.display !== 'none') {\n        lineBreakerStyle.display = 'none';\n      }\n    },\n    _onMouseDown_lineBreak: function _onMouseDown_lineBreak(e) {\n      e.preventDefault();\n    },\n    _onLineBreak: function _onLineBreak(e) {\n      e.preventDefault();\n      var component = core._variable._lineBreakComp;\n      var dir = !this ? core._variable._lineBreakDir : this;\n      var isList = util.isListCell(component.parentNode);\n      var format = util.createElement(isList ? 'BR' : util.isCell(component.parentNode) ? 'DIV' : options.defaultTag);\n      if (!isList) format.innerHTML = '<br>';\n      if (core._charTypeHTML && !core.checkCharCount(format.outerHTML, 'byte-html')) return;\n      component.parentNode.insertBefore(format, dir === 't' ? component : component.nextSibling);\n      core._lineBreaker.style.display = 'none';\n      core._variable._lineBreakComp = null;\n      var focusEl = isList ? format : format.firstChild;\n      core.setRange(focusEl, 1, focusEl, 1); // history stack\n\n      core.history.push(false);\n    },\n    _resizeObserver: null,\n    _toolbarObserver: null,\n    _addEvent: function _addEvent() {\n      var eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\n\n      if (!util.isIE) {\n        this._resizeObserver = new _w.ResizeObserver(function (entries) {\n          core.__callResizeFunction(-1, entries[0]);\n        });\n      }\n      /** toolbar event */\n\n\n      context.element.toolbar.addEventListener('mousedown', event._buttonsEventHandler, false);\n\n      context.element._menuTray.addEventListener('mousedown', event._buttonsEventHandler, false);\n\n      context.element.toolbar.addEventListener('click', event.onClick_toolbar, false);\n      /** editor area */\n\n      eventWysiwyg.addEventListener('mousedown', event.onMouseDown_wysiwyg, false);\n      eventWysiwyg.addEventListener('click', event.onClick_wysiwyg, false);\n      eventWysiwyg.addEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg, false);\n      eventWysiwyg.addEventListener('keydown', event.onKeyDown_wysiwyg, false);\n      eventWysiwyg.addEventListener('keyup', event.onKeyUp_wysiwyg, false);\n      eventWysiwyg.addEventListener('paste', event.onPaste_wysiwyg, false);\n      eventWysiwyg.addEventListener('copy', event.onCopy_wysiwyg, false);\n      eventWysiwyg.addEventListener('cut', event.onCut_wysiwyg, false);\n      eventWysiwyg.addEventListener('drop', event.onDrop_wysiwyg, false);\n      eventWysiwyg.addEventListener('scroll', event.onScroll_wysiwyg, false);\n      eventWysiwyg.addEventListener('focus', event.onFocus_wysiwyg, false);\n      eventWysiwyg.addEventListener('blur', event.onBlur_wysiwyg, false);\n      /** line breaker */\n\n      event._lineBreakerBind = {\n        a: event._onLineBreak.bind(''),\n        t: event._onLineBreak.bind('t'),\n        b: event._onLineBreak.bind('b')\n      };\n      eventWysiwyg.addEventListener('mousemove', event.onMouseMove_wysiwyg, false);\n\n      core._lineBreakerButton.addEventListener('mousedown', event._onMouseDown_lineBreak, false);\n\n      core._lineBreakerButton.addEventListener('click', event._lineBreakerBind.a, false);\n\n      context.element.lineBreaker_t.addEventListener('mousedown', event._lineBreakerBind.t, false);\n      context.element.lineBreaker_b.addEventListener('mousedown', event._lineBreakerBind.b, false);\n      /** Events are registered only when there is a table plugin.  */\n\n      if (core.plugins.table) {\n        eventWysiwyg.addEventListener('touchstart', event.onMouseDown_wysiwyg, {\n          passive: true,\n          useCapture: false\n        });\n      }\n      /** code view area auto line */\n\n\n      if (options.height === 'auto' && !options.codeMirrorEditor) {\n        context.element.code.addEventListener('keydown', event._codeViewAutoHeight, false);\n        context.element.code.addEventListener('keyup', event._codeViewAutoHeight, false);\n        context.element.code.addEventListener('paste', event._codeViewAutoHeight, false);\n      }\n      /** resizingBar */\n\n\n      if (context.element.resizingBar) {\n        if (/\\d+/.test(options.height) && options.resizeEnable) {\n          context.element.resizingBar.addEventListener('mousedown', event.onMouseDown_resizingBar, false);\n        } else {\n          util.addClass(context.element.resizingBar, 'se-resizing-none');\n        }\n      }\n      /** set response toolbar */\n\n\n      event._setResponsiveToolbar();\n      /** responsive toolbar observer */\n\n\n      if (!util.isIE) this._toolbarObserver = new _w.ResizeObserver(core.resetResponsiveToolbar);\n      /** window event */\n\n      _w.addEventListener('resize', event.onResize_window, false);\n\n      if (options.stickyToolbar > -1) {\n        _w.addEventListener('scroll', event.onScroll_window, false);\n      }\n    },\n    _removeEvent: function _removeEvent() {\n      var eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\n      context.element.toolbar.removeEventListener('mousedown', event._buttonsEventHandler);\n\n      context.element._menuTray.removeEventListener('mousedown', event._buttonsEventHandler);\n\n      context.element.toolbar.removeEventListener('click', event.onClick_toolbar);\n      eventWysiwyg.removeEventListener('mousedown', event.onMouseDown_wysiwyg);\n      eventWysiwyg.removeEventListener('click', event.onClick_wysiwyg);\n      eventWysiwyg.removeEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg);\n      eventWysiwyg.removeEventListener('keydown', event.onKeyDown_wysiwyg);\n      eventWysiwyg.removeEventListener('keyup', event.onKeyUp_wysiwyg);\n      eventWysiwyg.removeEventListener('paste', event.onPaste_wysiwyg);\n      eventWysiwyg.removeEventListener('copy', event.onCopy_wysiwyg);\n      eventWysiwyg.removeEventListener('cut', event.onCut_wysiwyg);\n      eventWysiwyg.removeEventListener('drop', event.onDrop_wysiwyg);\n      eventWysiwyg.removeEventListener('scroll', event.onScroll_wysiwyg);\n      eventWysiwyg.removeEventListener('mousemove', event.onMouseMove_wysiwyg);\n\n      core._lineBreakerButton.removeEventListener('mousedown', event._onMouseDown_lineBreak);\n\n      core._lineBreakerButton.removeEventListener('click', event._lineBreakerBind.a);\n\n      context.element.lineBreaker_t.removeEventListener('mousedown', event._lineBreakerBind.t);\n      context.element.lineBreaker_b.removeEventListener('mousedown', event._lineBreakerBind.b);\n      event._lineBreakerBind = null;\n      eventWysiwyg.removeEventListener('touchstart', event.onMouseDown_wysiwyg, {\n        passive: true,\n        useCapture: false\n      });\n      eventWysiwyg.removeEventListener('focus', event.onFocus_wysiwyg);\n      eventWysiwyg.removeEventListener('blur', event.onBlur_wysiwyg);\n      context.element.code.removeEventListener('keydown', event._codeViewAutoHeight);\n      context.element.code.removeEventListener('keyup', event._codeViewAutoHeight);\n      context.element.code.removeEventListener('paste', event._codeViewAutoHeight);\n\n      if (context.element.resizingBar) {\n        context.element.resizingBar.removeEventListener('mousedown', event.onMouseDown_resizingBar);\n      }\n\n      if (event._resizeObserver) {\n        event._resizeObserver.unobserve(context.element.wysiwygFrame);\n\n        event._resizeObserver = null;\n      }\n\n      if (event._toolbarObserver) {\n        event._toolbarObserver.unobserve(context.element._toolbarShadow);\n\n        event._toolbarObserver = null;\n      }\n\n      _w.removeEventListener('resize', event.onResize_window);\n\n      _w.removeEventListener('scroll', event.onScroll_window);\n    },\n    _setResponsiveToolbar: function _setResponsiveToolbar() {\n      if (_responsiveButtons.length === 0) {\n        _responsiveButtons = null;\n        return;\n      }\n\n      event._responsiveCurrentSize = 'default';\n      var sizeArray = event._responsiveButtonSize = [];\n      var buttonsObj = event._responsiveButtons = {\n        default: _responsiveButtons[0]\n      };\n\n      for (var i = 1, len = _responsiveButtons.length, size, buttonGroup; i < len; i++) {\n        buttonGroup = _responsiveButtons[i];\n        size = buttonGroup[0] * 1;\n        sizeArray.push(size);\n        buttonsObj[size] = buttonGroup[1];\n      }\n\n      sizeArray.sort(function (a, b) {\n        return a - b;\n      }).unshift('default');\n    }\n  };\n  /** functions */\n\n  var functions = {\n    /**\r\n     * @description Core, Util object\r\n     */\n    core: core,\n    util: util,\n\n    /**\r\n     * @description Event functions\r\n     * @param {Object} e Event Object\r\n     * @param {Object} core Core object\r\n     */\n    onload: null,\n    onScroll: null,\n    onMouseDown: null,\n    onClick: null,\n    onInput: null,\n    onKeyDown: null,\n    onKeyUp: null,\n    onCopy: null,\n    onCut: null,\n    onFocus: null,\n    onBlur: null,\n\n    /**\r\n     * @description Event functions\r\n     * @param {String} contents Current contents\r\n     * @param {Object} core Core object\r\n     */\n    onChange: null,\n\n    /**\r\n     * @description Event functions\r\n     * @param {String} contents Current contents\r\n     * @param {Object} core Core object\r\n     */\n    onSave: null,\n\n    /**\r\n     * @description Event functions (drop, paste)\r\n     * When false is returned, the default behavior is stopped.\r\n     * If the string is returned, the cleanData value is modified to the return value.\r\n     * @param {Object} e Event object.\r\n     * @param {String} cleanData HTML string modified for editor format.\r\n     * @param {Boolean} maxChartCount option (true if max character is exceeded)\r\n     * @param {Object} core Core object\r\n     * @returns {Boolean|String}\r\n     */\n    onDrop: null,\n    onPaste: null,\n\n    /**\r\n     * @description Called just before the inline toolbar is positioned and displayed on the screen.\r\n     * @param {Element} toolbar Toolbar Element\r\n     * @param {Object} context The editor's context object (editor.getContext())\r\n     * @param {Object} core Core object\r\n     */\n    showInline: null,\n\n    /**\r\n     * @description Called just after the controller is positioned and displayed on the screen.\r\n     * controller - editing elements displayed on the screen [image resizing, table editor, link editor..]]\r\n     * @param {String} name The name of the plugin that called the controller\r\n     * @param {Array} controllers Array of Controller elements\r\n     * @param {Object} core Core object\r\n     */\n    showController: null,\n\n    /**\r\n     * @description An event when toggling between code view and wysiwyg view.\r\n     * @param {Boolean} isCodeView Whether the current code view mode\r\n     * @param {Object} core Core object\r\n     */\n    toggleCodeView: null,\n\n    /**\r\n     * @description An event when toggling full screen.\r\n     * @param {Boolean} isFullScreen Whether the current full screen mode\r\n     * @param {Object} core Core object\r\n     */\n    toggleFullScreen: null,\n\n    /**\r\n     * @description It replaces the default callback function of the image upload\r\n     * @param {Object} response Response object\r\n     * @param {Object} info Input information\r\n     * - linkValue: Link url value\r\n     * - linkNewWindow: Open in new window Check Value\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update image if true, create image if false\r\n     * - element: If isUpdate is true, the currently selected image.\r\n     * @param {Object} core Core object\r\n     */\n    imageUploadHandler: null,\n\n    /**\r\n     * @description It replaces the default callback function of the video upload\r\n     * @param xmlHttp xmlHttpRequest object\r\n     * @param info Input information\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update video if true, create video if false\r\n     * - element: If isUpdate is true, the currently selected video.\r\n     * @param core Core object\r\n     */\n    videoUploadHandler: null,\n\n    /**\r\n     * @description It replaces the default callback function of the audio upload\r\n     * @param xmlHttp xmlHttpRequest object\r\n     * @param info Input information\r\n     * - isUpdate: Update audio if true, create audio if false\r\n     * - element: If isUpdate is true, the currently selected audio.\r\n     * @param core Core object\r\n     */\n    audioUploadHandler: null,\n\n    /**\r\n     * @description Called before the image is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no image upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - linkValue: Link url value\r\n     * - linkNewWindow: Open in new window Check Value\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update image if true, create image if false\r\n     * - element: If isUpdate is true, the currently selected image.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"imageUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onImageUploadBefore: null,\n\n    /**\r\n     * @description Called before the video is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no video(iframe, video) upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update video if true, create video if false\r\n     * - element: If isUpdate is true, the currently selected video.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"videoUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onVideoUploadBefore: null,\n\n    /**\r\n     * @description Called before the audio is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no audio upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - isUpdate: Update audio if true, create audio if false\r\n     * - element: If isUpdate is true, the currently selected audio.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"audioUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onAudioUploadBefore: null,\n\n    /**\r\n     * @description Called when the image is uploaded, updated, deleted\r\n     * @param {Element} targetElement Target element\r\n     * @param {Number} index Uploaded index\r\n     * @param {String} state Upload status ('create', 'update', 'delete')\r\n     * @param {Object} info Image info object\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @param {Number} remainingFilesCount Count of remaining files to upload (0 when added as a url)\r\n     * @param {Object} core Core object\r\n     */\n    onImageUpload: null,\n\n    /**\r\n    * @description Called when the video(iframe, video) is is uploaded, updated, deleted\r\n    * -- arguments is same \"onImageUpload\" --\r\n    */\n    onVideoUpload: null,\n\n    /**\r\n    * @description Called when the audio is is uploaded, updated, deleted\r\n    * -- arguments is same \"onImageUpload\" --\r\n    */\n    onAudioUpload: null,\n\n    /**\r\n     * @description Called when the image is upload failed\r\n     * @param {String} errorMessage Error message\r\n     * @param {Object} result Response Object\r\n     * @param {Object} core Core object\r\n     * @returns {Boolean}\r\n     */\n    onImageUploadError: null,\n\n    /**\r\n     * @description Called when the video(iframe, video) upload failed\r\n     * -- arguments is same \"onImageUploadError\" --\r\n     */\n    onVideoUploadError: null,\n\n    /**\r\n     * @description Called when the audio upload failed\r\n     * -- arguments is same \"onImageUploadError\" --\r\n     */\n    onAudioUploadError: null,\n\n    /**\r\n     * @description Called when the editor is resized using the bottom bar\r\n     */\n    onResizeEditor: null,\n\n    /**\r\n     * @description Called after the \"setToolbarButtons\" invocation.\r\n     * Can be used to tweak buttons properties (useful for custom buttons)\r\n     * @param {Array} buttonList Button list \r\n     * @param {Object} core Core object\r\n     */\n    onSetToolbarButtons: null,\n\n    /**\r\n     * @description Reset the buttons on the toolbar. (Editor is not reloaded)\r\n     * You cannot set a new plugin for the button.\r\n     * @param {Array} buttonList Button list \r\n     */\n    setToolbarButtons: function setToolbarButtons(buttonList) {\n      core.submenuOff();\n      core.containerOff();\n      core.moreLayerOff();\n\n      var newToolbar = _Constructor._createToolBar(_d, buttonList, core.plugins, options);\n\n      _responsiveButtons = newToolbar.responsiveButtons;\n\n      event._setResponsiveToolbar();\n\n      context.element.toolbar.replaceChild(newToolbar._buttonTray, context.element._buttonTray);\n\n      var newContext = _Context(context.element.originElement, core._getConstructed(context.element), options);\n\n      context.element = newContext.element;\n      context.tool = newContext.tool;\n      if (options.iframe) context.element.wysiwyg = core._wd.body;\n\n      core._recoverButtonStates();\n\n      core._cachingButtons();\n\n      core.history._resetCachingButton();\n\n      core.effectNode = null;\n      if (core.hasFocus) event._applyTagEffects();\n      if (core.isReadOnly) util.setDisabledButtons(true, core.resizingDisabledButtons);\n      if (typeof functions.onSetToolbarButtons === 'function') functions.onSetToolbarButtons(newToolbar._buttonTray.querySelectorAll('button'), core);\n    },\n\n    /**\r\n     * @description Add or reset option property (Editor is reloaded)\r\n     * @param {Object} _options Options\r\n     */\n    setOptions: function setOptions(_options) {\n      event._removeEvent();\n\n      core._resetComponents();\n\n      util.removeClass(core._styleCommandMap.showBlocks, 'active');\n      util.removeClass(core._styleCommandMap.codeView, 'active');\n      core._variable.isCodeView = false;\n      core._iframeAuto = null;\n      core.plugins = _options.plugins || core.plugins;\n      var mergeOptions = [options, _options].reduce(function (init, option) {\n        for (var key in option) {\n          if (!util.hasOwn(option, key)) continue;\n\n          if (key === 'plugins' && option[key] && init[key]) {\n            (function () {\n              var i = init[key],\n                  o = option[key];\n              i = i.length ? i : _w.Object.keys(i).map(function (name) {\n                return i[name];\n              });\n              o = o.length ? o : _w.Object.keys(o).map(function (name) {\n                return o[name];\n              });\n              init[key] = o.filter(function (val) {\n                return i.indexOf(val) === -1;\n              }).concat(i);\n            })();\n          } else {\n            init[key] = option[key];\n          }\n        }\n\n        return init;\n      }, {});\n      var el = context.element;\n      var _initHTML = el.wysiwyg.innerHTML; // set option\n\n      var cons = _Constructor._setOptions(mergeOptions, context, options);\n\n      if (cons.callButtons) {\n        pluginCallButtons = cons.callButtons;\n        core.initPlugins = {};\n      }\n\n      if (cons.plugins) {\n        core.plugins = plugins = cons.plugins;\n      } // reset context\n\n\n      if (el._menuTray.children.length === 0) this._menuTray = {};\n      _responsiveButtons = cons.toolbar.responsiveButtons;\n      core.options = options = mergeOptions;\n      core.lang = lang = options.lang;\n\n      if (options.iframe) {\n        el.wysiwygFrame.addEventListener('load', function () {\n          util._setIframeDocument(this, options);\n\n          core._setOptionsInit(el, _initHTML);\n        });\n      }\n\n      el.editorArea.appendChild(el.wysiwygFrame);\n\n      if (!options.iframe) {\n        core._setOptionsInit(el, _initHTML);\n      }\n    },\n\n    /**\r\n     * @description Set \"options.defaultStyle\" style.\r\n     * Define the style of the edit area\r\n     * It can also be defined with the \"setOptions\" method, but the \"setDefaultStyle\" method does not render the editor again.\r\n     * @param {String} style Style string\r\n     */\n    setDefaultStyle: function setDefaultStyle(style) {\n      var newStyles = options._editorStyles = util._setDefaultOptionStyle(options, style);\n\n      var el = context.element; // top area\n\n      el.topArea.style.cssText = newStyles.top; // code view\n\n      el.code.style.cssText = options._editorStyles.frame;\n      el.code.style.display = 'none';\n\n      if (options.height === 'auto') {\n        el.code.style.overflow = 'hidden';\n      } else {\n        el.code.style.overflow = '';\n      } // wysiwyg frame\n\n\n      if (!options.iframe) {\n        el.wysiwygFrame.style.cssText = newStyles.frame + newStyles.editor;\n      } else {\n        el.wysiwygFrame.style.cssText = newStyles.frame;\n        el.wysiwyg.style.cssText = newStyles.editor;\n      }\n    },\n\n    /**\r\n     * @description Open a notice area\r\n     * @param {String} message Notice message\r\n     */\n    noticeOpen: function noticeOpen(message) {\n      core.notice.open.call(core, message);\n    },\n\n    /**\r\n     * @description Close a notice area\r\n     */\n    noticeClose: function noticeClose() {\n      core.notice.close.call(core);\n    },\n\n    /**\r\n     * @description Copying the contents of the editor to the original textarea and execute onSave callback\r\n     * * not working during enabled codeView mode\r\n     */\n    save: function save() {\n      var contents = core.getContents(false);\n      context.element.originElement.value = contents;\n      event.onSave_wysiwyg(contents, core);\n    },\n\n    /**\r\n     * @description Gets the suneditor's context object. Contains settings, plugins, and cached element objects\r\n     * @returns {Object}\r\n     */\n    getContext: function getContext() {\n      return context;\n    },\n\n    /**\r\n     * @description Gets the contents of the suneditor\r\n     * * not working during enabled codeView mode\r\n     * @param {Boolean} onlyContents - Return only the contents of the body without headers when the \"fullPage\" option is true\r\n     * @returns {String}\r\n     */\n    getContents: function getContents(onlyContents) {\n      return core.getContents(onlyContents);\n    },\n\n    /**\r\n     * @description Gets only the text of the suneditor contents\r\n     * * not working during enabled codeView mode\r\n     * @returns {String}\r\n     */\n    getText: function getText() {\n      return context.element.wysiwyg.textContent;\n    },\n\n    /**\r\n     * @description Get the editor's number of characters or binary data size.\r\n     * You can use the \"charCounterType\" option format.\r\n     * @param {String|null} charCounterType options - charCounterType ('char', 'byte', 'byte-html')\r\n     * If argument is no value, the currently set \"charCounterType\" option is used.\r\n     * @returns {Number}\r\n     */\n    getCharCount: function getCharCount(charCounterType) {\n      charCounterType = typeof charCounterType === 'string' ? charCounterType : options.charCounterType;\n      return core.getCharLength(core._charTypeHTML ? context.element.wysiwyg.innerHTML : context.element.wysiwyg.textContent, charCounterType);\n    },\n\n    /**\r\n     * @description Gets uploaded images informations\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @returns {Array}\r\n     */\n    getImagesInfo: function getImagesInfo() {\n      return context.image ? context.image._infoList : [];\n    },\n\n    /**\r\n     * @description Gets uploaded files(plugin using fileManager) information list.\r\n     * image: [img], video: [video, iframe], audio: [audio]\r\n     * When the argument value is 'image', it is the same function as \"getImagesInfo\".\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @param {String} pluginName Plugin name (image, video, audio)\r\n     * @returns {Array}\r\n     */\n    getFilesInfo: function getFilesInfo(pluginName) {\n      return context[pluginName] ? context[pluginName]._infoList : [];\n    },\n\n    /**\r\n     * @description Upload images using image plugin\r\n     * @param {FileList} files FileList\r\n     */\n    insertImage: function insertImage(files) {\n      if (!core.plugins.image || !files) return;\n      if (!core.initPlugins.image) core.callPlugin('image', core.plugins.image.submitAction.bind(core, files), null);else core.plugins.image.submitAction.call(core, files);\n      core.focus();\n    },\n\n    /**\r\n     * @description Inserts an HTML element or HTML string or plain string at the current cursor position\r\n     * @param {Element|String} html HTML Element or HTML string or plain string\r\n     * @param {Boolean} notCleaningData If true, inserts the HTML string without refining it with core.cleanHTML.\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @param {Boolean} rangeSelection If true, range select the inserted node.\r\n     */\n    insertHTML: function insertHTML(html, notCleaningData, checkCharCount, rangeSelection) {\n      if (!context.element.wysiwygFrame.contains(core.getSelection().focusNode)) core.focus();\n\n      if (typeof html === 'string') {\n        if (!notCleaningData) html = core.cleanHTML(html, null, null);\n\n        try {\n          if (util.isListCell(util.getFormatElement(core.getSelectionNode(), null))) {\n            var _dom = _d.createRange().createContextualFragment(html);\n\n            var _domTree = _dom.childNodes;\n            if (core._isFormatData(_domTree)) html = core._convertListCell(_domTree);\n          }\n\n          var dom = _d.createRange().createContextualFragment(html);\n\n          var domTree = dom.childNodes;\n\n          if (checkCharCount) {\n            var type = core._charTypeHTML ? 'outerHTML' : 'textContent';\n            var checkHTML = '';\n\n            for (var i = 0, len = domTree.length; i < len; i++) {\n              checkHTML += domTree[i][type];\n            }\n\n            if (!core.checkCharCount(checkHTML, null)) return;\n          }\n\n          var _c10, a, t, prev, firstCon;\n\n          while (_c10 = domTree[0]) {\n            if (prev && prev.nodeType === 3 && a && a.nodeType === 1 && util.isBreak(_c10)) {\n              prev = _c10;\n              util.removeItem(_c10);\n              continue;\n            }\n\n            t = core.insertNode(_c10, a, false);\n            a = t.container || t;\n            if (!firstCon) firstCon = t;\n            prev = _c10;\n          }\n\n          if (prev.nodeType === 3 && a.nodeType === 1) a = prev;\n          var offset = a.nodeType === 3 ? t.endOffset || a.textContent.length : a.childNodes.length;\n          if (rangeSelection) core.setRange(firstCon.container || firstCon, firstCon.startOffset || 0, a, offset);else core.setRange(a, offset, a, offset);\n        } catch (error) {\n          if (core.isDisabled || core.isReadOnly) return;\n          console.warn('[SUNEDITOR.insertHTML.fail] ' + error);\n          core.execCommand('insertHTML', false, html);\n        }\n      } else {\n        if (util.isComponent(html)) {\n          core.insertComponent(html, false, checkCharCount, false);\n        } else {\n          var afterNode = null;\n\n          if (util.isFormatElement(html) || util.isMedia(html)) {\n            afterNode = util.getFormatElement(core.getSelectionNode(), null);\n          }\n\n          core.insertNode(html, afterNode, checkCharCount);\n        }\n      }\n\n      core.effectNode = null;\n      core.focus(); // history stack\n\n      core.history.push(false);\n    },\n\n    /**\r\n     * @description Change the contents of the suneditor\r\n     * @param {String|undefined} contents Contents to Input\r\n     */\n    setContents: function setContents(contents) {\n      core.setContents(contents);\n    },\n\n    /**\r\n     * @description Add contents to the suneditor\r\n     * @param {String} contents Contents to Input\r\n     */\n    appendContents: function appendContents(contents) {\n      var convertValue = core.convertContentsForEditor(contents);\n\n      if (!core._variable.isCodeView) {\n        var temp = util.createElement('DIV');\n        temp.innerHTML = convertValue;\n        var wysiwyg = context.element.wysiwyg;\n        var children = temp.children;\n\n        for (var i = 0, len = children.length; i < len; i++) {\n          if (children[i]) {\n            wysiwyg.appendChild(children[i]);\n          }\n        }\n      } else {\n        core._setCodeView(core._getCodeView() + '\\n' + core.convertHTMLForCodeView(convertValue, false));\n      } // history stack\n\n\n      core.history.push(false);\n    },\n\n    /**\r\n     * @description Switch to or off \"ReadOnly\" mode.\r\n     * @param {Boolean} value \"readOnly\" boolean value.\r\n     */\n    readOnly: function readOnly(value) {\n      core.isReadOnly = value;\n      util.setDisabledButtons(!!value, core.resizingDisabledButtons);\n\n      if (value) {\n        /** off menus */\n        core.controllersOff();\n        if (core.submenuActiveButton && core.submenuActiveButton.disabled) core.submenuOff();\n        if (core._moreLayerActiveButton && core._moreLayerActiveButton.disabled) core.moreLayerOff();\n        if (core.containerActiveButton && core.containerActiveButton.disabled) core.containerOff();\n        if (core.modalForm) core.plugins.dialog.close.call(core);\n        context.element.code.setAttribute(\"readOnly\", \"true\");\n        util.addClass(context.element.wysiwygFrame, 'se-read-only');\n      } else {\n        context.element.code.removeAttribute(\"readOnly\");\n        util.removeClass(context.element.wysiwygFrame, 'se-read-only');\n      }\n\n      if (options.codeMirrorEditor) options.codeMirrorEditor.setOption('readOnly', !!value);\n    },\n\n    /**\r\n     * @description Disable the suneditor\r\n     */\n    disable: function disable() {\n      this.toolbar.disable();\n      this.wysiwyg.disable();\n    },\n\n    /**\r\n     * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n     */\n    disabled: function disabled() {\n      this.disable();\n    },\n\n    /**\r\n     * @description Enable the suneditor\r\n     */\n    enable: function enable() {\n      this.toolbar.enable();\n      this.wysiwyg.enable();\n    },\n\n    /**\r\n     * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n     */\n    enabled: function enabled() {\n      this.enable();\n    },\n\n    /**\r\n     * @description Show the suneditor\r\n     */\n    show: function show() {\n      var topAreaStyle = context.element.topArea.style;\n      if (topAreaStyle.display === 'none') topAreaStyle.display = options.display;\n    },\n\n    /**\r\n     * @description Hide the suneditor\r\n     */\n    hide: function hide() {\n      context.element.topArea.style.display = 'none';\n    },\n\n    /**\r\n     * @description Destroy the suneditor\r\n     */\n    destroy: function destroy() {\n      /** off menus */\n      core.submenuOff();\n      core.containerOff();\n      core.controllersOff();\n      if (core.notice) core.notice.close.call(core);\n      if (core.modalForm) core.plugins.dialog.close.call(core);\n      /** remove history */\n\n      core.history._destroy();\n      /** remove event listeners */\n\n\n      event._removeEvent();\n      /** remove element */\n\n\n      util.removeItem(context.element.toolbar);\n      util.removeItem(context.element.topArea);\n      /** remove object reference */\n\n      for (var k in core.functions) {\n        if (util.hasOwn(core, k)) delete core.functions[k];\n      }\n\n      for (var _k2 in core) {\n        if (util.hasOwn(core, _k2)) delete core[_k2];\n      }\n\n      for (var _k3 in event) {\n        if (util.hasOwn(event, _k3)) delete event[_k3];\n      }\n\n      for (var _k4 in context) {\n        if (util.hasOwn(context, _k4)) delete context[_k4];\n      }\n\n      for (var _k5 in pluginCallButtons) {\n        if (util.hasOwn(pluginCallButtons, _k5)) delete pluginCallButtons[_k5];\n      }\n      /** remove user object */\n\n\n      for (var _k6 in this) {\n        if (util.hasOwn(this, _k6)) delete this[_k6];\n      }\n    },\n\n    /**\r\n     * @description Toolbar methods\r\n     */\n    toolbar: {\n      /**\r\n       * @description Disable the toolbar\r\n       */\n      disable: function disable() {\n        /** off menus */\n        core.submenuOff();\n        core.moreLayerOff();\n        core.containerOff();\n        context.tool.cover.style.display = 'block';\n      },\n\n      /**\r\n       * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n       */\n      disabled: function disabled() {\n        this.disable();\n      },\n\n      /**\r\n       * @description Enable the toolbar\r\n       */\n      enable: function enable() {\n        context.tool.cover.style.display = 'none';\n      },\n\n      /**\r\n       * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n       */\n      enabled: function enabled() {\n        this.enable();\n      },\n\n      /**\r\n       * @description Show the toolbar\r\n       */\n      show: function show() {\n        if (core._isInline) {\n          event._showToolbarInline();\n        } else {\n          context.element.toolbar.style.display = '';\n          context.element._stickyDummy.style.display = '';\n        }\n      },\n\n      /**\r\n       * @description Hide the toolbar\r\n       */\n      hide: function hide() {\n        if (core._isInline) {\n          event._hideToolbar();\n        } else {\n          context.element.toolbar.style.display = 'none';\n          context.element._stickyDummy.style.display = 'none';\n        }\n      }\n    },\n\n    /**\r\n     * @description Wysiwyg methods\r\n     */\n    wysiwyg: {\n      /**\r\n       * @description Disable the wysiwyg area\r\n       */\n      disable: function disable() {\n        /** off menus */\n        core.controllersOff();\n        if (core.modalForm) core.plugins.dialog.close.call(core);\n        context.element.wysiwyg.setAttribute('contenteditable', false);\n        core.isDisabled = true;\n\n        if (options.codeMirrorEditor) {\n          options.codeMirrorEditor.setOption('readOnly', true);\n        } else {\n          context.element.code.setAttribute('disabled', 'disabled');\n        }\n      },\n\n      /**\r\n       * @description Enable the wysiwyg area\r\n       */\n      enable: function enable() {\n        context.element.wysiwyg.setAttribute('contenteditable', true);\n        core.isDisabled = false;\n\n        if (options.codeMirrorEditor) {\n          options.codeMirrorEditor.setOption('readOnly', false);\n        } else {\n          context.element.code.removeAttribute('disabled');\n        }\n      }\n    }\n  };\n  /************ Core init ************/\n  // functions\n\n  core.functions = functions;\n  core.options = options; // Create to sibling node\n\n  var contextEl = context.element;\n  var originEl = contextEl.originElement;\n  var topEl = contextEl.topArea;\n  originEl.style.display = 'none';\n  topEl.style.display = 'block'; // init\n\n  if (options.iframe) {\n    contextEl.wysiwygFrame.addEventListener('load', function () {\n      util._setIframeDocument(this, options);\n\n      core._editorInit(false, options.value);\n\n      options.value = null;\n    });\n  } // insert editor element\n\n\n  if (typeof originEl.nextElementSibling === 'object') {\n    originEl.parentNode.insertBefore(topEl, originEl.nextElementSibling);\n  } else {\n    originEl.parentNode.appendChild(topEl);\n  }\n\n  contextEl.editorArea.appendChild(contextEl.wysiwygFrame);\n  contextEl = originEl = topEl = null; // init\n\n  if (!options.iframe) {\n    core._editorInit(false, options.value);\n\n    options.value = null;\n  }\n\n  return functions;\n}","map":{"version":3,"names":["_Constructor","_Context","_history","_util","_notice","context","pluginCallButtons","plugins","lang","options","_responsiveButtons","_d","element","originElement","ownerDocument","document","_w","defaultView","window","util","icons","core","_parser","DOMParser","_prevRtl","rtl","_editorHeight","_editorHeightPadding","_listCamel","__listCommonStyle","_listKebab","camelToKebabCase","_wd","_ww","_shadowRoot","_shadowRootControllerEventTarget","functions","wwComputedStyle","notice","history","initPlugins","_targetPlugins","_menuTray","effectNode","submenu","container","_submenuName","_bindedSubmenuOff","_bindedContainerOff","submenuActiveButton","containerActiveButton","controllerArray","currentControllerName","currentControllerTarget","currentFileComponentInfo","codeViewDisabledButtons","resizingDisabledButtons","_moreLayerActiveButton","_htmlCheckWhitelistRegExp","_htmlCheckBlacklistRegExp","_disallowedTextTagsRegExp","editorTagsWhitelistRegExp","editorTagsBlacklistRegExp","pasteTagsWhitelistRegExp","pasteTagsBlacklistRegExp","hasFocus","isDisabled","isReadOnly","_attributesWhitelistRegExp","_attributesWhitelistRegExp_all_data","_attributesBlacklistRegExp","_attributesTagsWhitelist","_attributesTagsBlacklist","_bindControllersOff","_isInline","_isBalloon","_isBalloonAlways","_inlineToolbarAttr","top","width","isShow","_notHideToolbar","_sticky","_antiBlur","_lineBreaker","_lineBreakerButton","_componentsInfoInit","_componentsInfoReset","activePlugins","managedTagsInfo","_charTypeHTML","_fileInfoPluginsCheck","_fileInfoPluginsReset","_fileManager","tags","regExp","queryString","pluginRegExp","pluginMap","commandMap","_commandMapStyles","STRONG","U","EM","DEL","_styleCommandMap","_cleanStyleRegExp","span","RegExp","format","fontSizeUnit","_variable","isChanged","isCodeView","isFullScreen","innerHeight_fullScreen","resizeClientY","tabSize","codeIndent","minResizingSize","getNumber","wysiwygFrame","style","minHeight","currentNodes","currentNodesMap","_range","_selectionNode","_originCssText","topArea","cssText","_bodyOverflow","_editorAreaOriginCssText","_wysiwygOriginCssText","_codeOriginCssText","_fullScreenAttrs","sticky","balloon","inline","_lineBreakComp","_lineBreakDir","_saveButtonStates","allCommandButtons","currentButtons","_buttonTray","querySelectorAll","i","command","length","getAttribute","_recoverButtonStates","button","oldButton","parentElement","replaceChild","tool","callPlugin","pluginName","callBackFunction","_target","Error","add","initMenuTarget","active","push","addModule","moduleArray","len","moduleName","name","getGlobalScrollOffset","t","l","el","scrollTop","scrollLeft","host","left","target","menu","appendChild","submenuOn","controllersOff","submenuName","_setMenuPosition","submenuOff","bind","addDocEvent","on","call","removeDocEvent","display","removeClass","moreLayerOff","layer","toolbar","querySelector","containerOn","containerName","_containerName","containerOff","visibility","height","addClass","toolbarW","offsetWidth","toolbarOffset","event","_getEditorOffsets","menuW","offsetLeft","elementW","rtlW","rtlL","overLeft","offsetEl","offsetTop","offsetParent","bt","offsetHeight","toolbarTop","menuHeight","menuHeight_bottom","innerHeight","menuTop","insTop","menuHeight_top","controllersOn","arg","arguments","hasClass","getFileComponent","indexOf","addEventListener","e","preventDefault","stopPropagation","showController","contains","test","type","keyCode","lineBreaker_t","lineBreaker_b","setControllerPosition","controller","referEl","position","addOffset","offset","getOffset","topMargin","controllerW","referElW","allow","firstElementChild","overSize","execCommand","showDefaultUI","value","nativeFocus","__focus","_editorRange","caption","getParentElement","getSelectionNode","focus","wysiwyg","iframe","range","getRange","startContainer","endContainer","isWysiwygDiv","currentNode","commonAncestorContainer","children","startOffset","isFormatElement","isComponent","createElement","defaultTag","br","insertBefore","setRange","endOffset","_applyTagEffects","_toggleToolbarBalloon","focusEdge","focusEl","lastElementChild","fileComponentInfo","selectComponent","getChildElement","current","childNodes","nodeType","textContent","blur","startCon","startOff","endCon","endOff","createRange","setStart","setEnd","error","console","warn","selection","getSelection","removeAllRanges","addRange","_rangeInfo","removeRange","_setKeyEffect","_createDefaultRange","collapsed","isCollapsed","focusNode","rangeCount","getRangeAt","sc","anchorNode","ec","so","anchorOffset","eo","focusOffset","compareValue","compareElements","rightDir","ancestor","result","getRange_addLine","_selectionVoid","op","innerHTML","nextElementSibling","selectionNode","firstChild","extentNode","comm","nodeName","isMediaComponent","_resetRangeToTextNode","tempCon","tempOffset","tempChild","lastChild","isBreak","onlyBreak","nextSibling","getFormatElement","getRangeFormatElement","isCell","parentNode","emptyText","createTextNode","zeroWidthSpace","previousElementSibling","previousSibling","removeItem","getSelectedElements","validation","trim","commonCon","lineNodes","getListChildren","isRangeFormatElement","unshift","startLine","endLine","startIdx","endIdx","onlyTable","isTable","startRangeEl","endRangeEl","isListCell","sameRange","line","slice","getSelectedElementsAndComponents","removeDuplicate","myComponent","selectedLines","component","j","splice","isEdgePoint","dir","nodeValue","_isEdgeFormat","node","cloneNode","showLoading","loading","closeLoading","appendFormatTag","formatNode","currentFormatEl","oFormat","isFreeFormatElement","oFormatName","copyTagAttributes","insertComponent","notHistoryPush","checkCharCount","notSelect","r","removeNode","oNode","formatEl","insertNode","depthFormat","splitElement","getElementDepth","onlyZeroWidthSpace","getEdgeChildNodes","className","toLowerCase","isUneditableComponent","plugin","setTimeout","select","_setComponentLineBreaker","t_style","b_style","resizing","resizeContainer","isList","componentTop","wScroll","w","_checkDuplicateNode","recursionFunc","_dupleCheck","isTextStyleElement","oStyles","match","map","v","duple","styles","classList","remove","join","setAttribute","removeAttribute","attributes","afterNode","insertListCell","originAfter","tempAfterNode","tempParentNode","freeFormat","isFormats","isMedia","isEdge","prevContainer","sameParent","subList","newCell","formatRange","splitText","c","removeChild","isSameContainer","removedTag","oldParent","rangeCon","fNode","ul","chList","getArrayItem","dupleNodes","d","ch","parent","cItem","isEmptyLine","_setIntoFreeFormat","previous","next","previousText","nextText","newRange","zeroWidth","_isIgnoreNodeChange","oNodeChildren","lastONode","substr","beforeNode","getListChildNodes","startIndex","getArrayIndex","endIndex","startNode","endNode","item","data","undefined","_nodeRemoveListItem","substringData","endUl","startLi","rc","removeItemAllParents","applyRangeFormatElement","rangeElement","rangeLines","linesLoop","nested","fEl","lEl","f","list","last","standTag","beforeTag","pElement","parentDepth","listParent","lineArr","removeItems","origin","before","cc","originParent","depth","nextLine","nextList","p","edge","detachRangeFormatElement","cLen","removeArray","mergeSameTags","mergeNestedTags","splitRange","selectedFormats","newRangeElement","firstNode","lastNode","rangeEl","newList","insertedNew","reset","moveComplete","appendNode","insNode","sibling","originNode","insChildren","first","_notTextNode","originNext","detachRange","detachNestedList","fChildren","lineIndex","insNext","inner","innerChildren","copyFormatAttributes","rangeParent","rangeRight","removeEmptyNode","childEdge","detachList","rangeArr","listFirst","listLast","passComponent","o","lastIndex","nodeChange","styleArray","removeNodeArray","strictRemove","isRemoveNode","isRemoveFormat","isNonEditable","getValues","some","k","wRegExp","newNodeName","sNode","checkCnt","checkAttrs","checkStyles","ckeckClasses","s","classReg","replace","styleCheck","classCheck","start","end","newNode","styleRegExp","classRegExp","removeNodeRegExp","wBoolean","Boolean","_removeCheck","checkNode","vNode","tagRemove","originStyle","originClasses","classes","oneLine","endLength","isRemoveAnchor","arr","n","_isMaintainedNode","_isSizeNode","isSizeNode","_getMaintainedNode","_util_getMaintainedNode","_util_isMaintainedNode","_resetCommonListCell","_nodeChange_oneLine","_setCommonListStyle","appliedCommonList","_nodeChange_endLine","_nodeChange_middleLine","_nodeChange_startLine","elStyles","ek","elKeys","refer","removeProperty","sel","appliedEl","_textTagsMap","child","childStyle","elStyle","_defaultCommand","bold","fontWeight","italic","fontStyle","cKeys","_stripRemoveNode","_isRemove","anchor","newInnerNode","parentCon","sameTag","z","nNodeArray","pNode","isSameNode","startPass","endPass","pCurrent","checkCss","coverNode","prevNode","textNode","a","m","prevAnchorNode","childNode","pop","anchors","concat","afterAnchorNode","aChildren","aLen","ancestorAnchorNode","textNode_s","textNode_e","rChildren","endConReset","newStartOffset","startPath","getNodePath","mergeEndCon","newEndOffset","endPath","newOffsets","getNodeFromPath","_endContainer","passNode","cloneChild","isTopNode","offsets","path","tempNode","newCssText","newClass","noneChange","actionCall","_showToolbarBalloon","_showToolbarInline","arrayIncludes","open","action","commandHandler","info","toggleCodeView","toggleFullScreen","indent","undo","redo","removeFormat","print","preview","toggleDisplayBlocks","setDir","callBackSave","getContents","save","nodesMap","cmd","cells","shift","marginDir","margin","setStyle","editInsideList","toggleClass","showBlocks","_resourcesStateChange","setDisabledButtons","_setCodeDataToEditor","code","codeMirrorEditor","mode","_arrow","_hideToolbar","codeView","_resetCachingButton","_setEditorDataToCodeView","scrollHeight","refresh","_checkPlaceholder","code_html","_getCodeView","fullPage","parseDocument","parseFromString","headChildren","head","tagName","headers","_setIframeCssTags","body","convertContentsForEditor","attrs","editableClasses","_editableClass","split","codeContents","convertHTMLForCodeView","codeValue","getAttributesToString","outerHTML","_setCodeView","editorArea","_var","wasToolbarHidden","toolbarContainer","relative","maxWidth","zIndex","_stickyDummy","overflow","defaultStyle","fullScreenOffset","changeElement","reduction","_iframeAutoHeight","marginTop","fullScreen","_codeViewAutoHeight","stickyToolbar","onScroll_window","expansion","hide","contentsHTML","printTemplate","printDocument","getIframeDocument","wDoc","arrts","_printClass","write","links","getElementsByTagName","linkHTML","isIE_Edge","isChromium","documentMode","StyleMedia","contentWindow","previewTemplate","windowObject","mimeType","changeDir","align","exchangeDir","outdent","marginRight","marginLeft","textAlign","changeTxt","dir_ltr","dir_rtl","setContents","html","convertValue","_resetComponents","setIframeContents","ctx","onlyContents","contents","renderHTML","figcaptions","getFullContents","_makeLine","requireFormat","_disallowedTags","isSpanWithoutAttr","isAnchor","_HTMLConvertor","textArray","tLen","text","_allowHTMLComments","_tagConvertor","_deleteDisallowedTags","_convertFontSize","to","size","sizeNum","from","pxSize","round","toFixed","floor","_cleanStyle","sv","allowedStyle","kebabToCamelCase","font","fontSize","Math","fontColor","hiliteColor","_cleanTags","lowLevelCheck","bAttr","wAttr","toString","h","avw","avh","_editFormat","dom","tempTree","createContextualFragment","_convertListCell","domTree","_isFormatData","cleanHTML","whitelist","blacklist","_consistencyCheckOfHTML","query","textCompList","initMethod","htmlRemoveWhiteSpace","createTagsWhitelist","createTagsBlacklist","comp","returnHTML","brReg","isFormat","brChar","indentSize","Array","elementRegTest","elementIndent","lineBR","nodeRegTest","tag","tagIndent","XMLSerializer","serializeToString","listener","useCapture","removeEventListener","_charCount","inputText","maxCharCount","countType","charCounterType","nextCharCount","getCharLength","_setCharCount","over","count","getCharCount","slicePosition","_callCounterBlink","content","getByteLength","resetResponsiveToolbar","responsiveSize","_responsiveButtonSize","toolbarWidth","responsiveWidth","_responsiveCurrentSize","setToolbarButtons","charCounter","charWrapper","_checkComponents","getDoc","setValue","getValue","ignoredList","key","hasOwn","OUTDENT","isImportantDisabled","INDENT","_init","reload","_initHTML","getComputedStyle","getPropertyValue","ShadowRoot","shadowRoot","disallowTextTags","Object","keys","allowTextTags","addTagsWhitelist","filter","getRegList","str","str2","defaultAttr","dataAttr","_editorTagsWhitelist","tagsBlacklist","pasteTagsWhitelist","pasteTagsBlacklist","regEndStr","_wAttr","attributesWhitelist","tagsAttr","allAttr","_bAttr","attributesBlacklist","_cachingButtons","managedClass","filePluginRegExp","checkFileInfo","resetFileInfo","isArray","fileTags","managedTags","method","_placeholder","placeholder","lineBreaker","_onChange_historyStack","contentDocument","_editorStyles","editor","_iframeAuto","_initWysiwygArea","textTags","toUpperCase","underline","strike","sub","subscript","sup","superscript","onChange","isIE","__callResizeFunction","resizeObserverEntry","borderBoxSize","blockSize","contentRect","onResizeEditor","_allowedEmptyNodeList","innerText","_setDefaultFormat","formatName","fileComponent","isNotCheckingNode","_setOptionsInit","_getConstructed","_editorInit","_addEvent","_offStickyToolbar","onResize_window","attr","frameAttrbutes","_resizeObserver","observe","_toolbarObserver","_toolbarShadow","onload","contextEl","_top","_relative","_toolBar","_editorArea","_wysiwygArea","_codeArea","_resizingBar","resizingBar","_navigation","navigation","_charCounter","_charWrapper","_loading","_lineBreaker_t","_lineBreaker_b","_resizeBack","resizeBackground","_IEisComposing","_lineBreakerBind","_directionKeyCode","_nonTextKeyCode","_historyIgnoreKeyCode","_onButtonsCheck","_frontZeroWidthReg","_keyCodeShortcut","_shortcutCommand","keyStr","shortcutsDisable","classOnCheck","commandMapNodes","reverse","showPathLabel","_cancelCaptionEdit","_buttonsEventHandler","onClick_toolbar","disabled","onMouseDown_wysiwyg","onMouseDown","tableCell","tablePlugin","table","_fixedCell","_shift","onTableCellMultiSelect","onClick_wysiwyg","targetElement","href","onClick","figcaption","hideToolbar","oLi","prevLi","_balloonDelay","_showToolbarBalloonDelay","clearTimeout","rangeObj","isDirTop","rects","getClientRects","globalScroll","editorWidth","stickyTop","editorLeft","nodeOffset","right","bottom","noText","arrowMargin","toolbarHeight","iframeRects","_setToolbarOffset","editorParent","padding","absoluteLeft","overRight","resetTop","space","_getPageBottomSpace","documentElement","arrow_left","showInline","onInput_wysiwyg","go","getCurrentIndex","onInput","_isUneditableNode","isFront","siblingKey","isElement","siblingNode","_isUneditableNode_getSibling","selectNode","_onShortcutKey","onKeyDown_wysiwyg","shiftKey","ctrl","ctrlKey","metaKey","alt","altKey","onKeyDown","selectRange","fileComponentName","destroy","_hardDelete","isClosureFreeFormatElement","isClosureRangeFormatElement","defaultFormat","prev","prevLast","con","after","detach","ignoreZWS","nextEl","cell","tabDisable","lines","fc","lc","idx","prevIdx","nextIdx","moveCell","tabText","textRange","endChild","freeFormatEl","getFreeFormatElement","enterHTML","formatInners","temp","newFormat","innerNode","lineAttrReset","newEl","isMultiLine","resetAttr","selectionFormat","wSelection","insertHTML","wOffset","focusNext","brPrev","brNext","newListCell","compContext","_container","_element","_ref","isOSX_IOS","nbsp","onKeyUp_wysiwyg","oFormatTag","textKey","zeroWidthRegExp","isComposing","frontZeroWidthCnt","substring","onKeyUp","onScroll_wysiwyg","onScroll","onFocus_wysiwyg","onFocus","onBlur_wysiwyg","onBlur","onMouseDown_resizingBar","clientY","closureFunc","_resize_editor","resizeInterval","fileBrowser","area","maxHeight","header","editorHeight","y","scrollY","editorTop","inlineOffset","_onStickyToolbar","scroll","sCell","eCell","sIsCell","eIsCell","sComp","eComp","onPaste_wysiwyg","clipboardData","_dataTransferAction","_setClipboardComponent","setData","onCopy_wysiwyg","onCopy","onSave_wysiwyg","onSave","onCut_wysiwyg","onCut","onDrop_wysiwyg","dataTransfer","_setDropLocationSelection","rangeOffset","caretRangeFromPoint","clientX","plainText","cleanData","getData","tempDiv","tempRange","_setClipboardData","MSData","onlyText","onPaste","onDrop","files","image","insertImage","onMouseMove_wysiwyg","lineBreakerStyle","ctxEl","pageY","_onMouseDown_lineBreak","_onLineBreak","eventWysiwyg","ResizeObserver","entries","b","passive","resizeEnable","_setResponsiveToolbar","_removeEvent","unobserve","sizeArray","buttonsObj","default","buttonGroup","sort","imageUploadHandler","videoUploadHandler","audioUploadHandler","onImageUploadBefore","onVideoUploadBefore","onAudioUploadBefore","onImageUpload","onVideoUpload","onAudioUpload","onImageUploadError","onVideoUploadError","onAudioUploadError","onSetToolbarButtons","buttonList","newToolbar","_createToolBar","responsiveButtons","newContext","setOptions","_options","mergeOptions","reduce","init","option","val","cons","_setOptions","callButtons","_setIframeDocument","setDefaultStyle","newStyles","_setDefaultOptionStyle","frame","noticeOpen","message","noticeClose","close","getContext","getText","getImagesInfo","_infoList","getFilesInfo","submitAction","notCleaningData","rangeSelection","checkHTML","firstCon","appendContents","readOnly","modalForm","dialog","setOption","disable","enable","enabled","show","topAreaStyle","_destroy","cover","originEl","topEl"],"sources":["/Users/jirayuyungmeesuk/Desktop/ v2/client/node_modules/suneditor/src/lib/core.js"],"sourcesContent":["/*\r\n * wysiwyg web editor\r\n *\r\n * suneditor.js\r\n * Copyright 2017 JiHong Lee.\r\n * MIT license.\r\n */\r\n'use strict';\r\n\r\nimport _Constructor from './constructor';\r\nimport _Context from './context';\r\nimport _history from './history';\r\nimport _util from './util';\r\nimport _notice from '../plugins/modules/_notice';\r\n\r\n/**\r\n * @description SunEditor constuctor function.\r\n * create core object and event registration.\r\n * core, event, functions\r\n * @param {Object} context\r\n * @param {Object} pluginCallButtons\r\n * @param {Object} plugins \r\n * @param {Object} lang\r\n * @param {Object} options\r\n * @param {Object} _responsiveButtons\r\n * @returns {Object} functions Object\r\n */\r\nexport default function (context, pluginCallButtons, plugins, lang, options, _responsiveButtons) {\r\n    const _d = context.element.originElement.ownerDocument || document;\r\n    const _w = _d.defaultView || window;\r\n    const util = _util;\r\n    const icons = options.icons;\r\n\r\n    /**\r\n     * @description editor core object\r\n     * should always bind this object when registering an event in the plug-in.\r\n     */\r\n    const core = {\r\n        _d: _d,\r\n        _w: _w,\r\n        _parser: new _w.DOMParser(),\r\n        _prevRtl: options.rtl,\r\n        _editorHeight: 0,\r\n        _editorHeightPadding: 0,\r\n        _listCamel: options.__listCommonStyle,\r\n        _listKebab: util.camelToKebabCase(options.__listCommonStyle),\r\n\r\n        /**\r\n         * @description Document object of the iframe if created as an iframe || _d\r\n         * @private\r\n         */\r\n        _wd: null,\r\n\r\n        /**\r\n         * @description Window object of the iframe if created as an iframe || _w\r\n         * @private\r\n         */\r\n        _ww: null,\r\n        \r\n        /**\r\n         * @description Closest ShadowRoot to editor if found\r\n         * @private\r\n         */\r\n        _shadowRoot: null,\r\n\r\n        /**\r\n         * @description Block controller mousedown events in \"shadowRoot\" environment\r\n         * @private\r\n         */\r\n        _shadowRootControllerEventTarget: null,\r\n\r\n        /**\r\n         * @description Util object\r\n         */\r\n        util: util,\r\n\r\n        /**\r\n         * @description Functions object\r\n         */\r\n        functions: null,\r\n\r\n        /**\r\n         * @description Editor options\r\n         */\r\n        options: null,\r\n\r\n        /**\r\n         * @description Computed style of the wysiwyg area (window.getComputedStyle(context.element.wysiwyg))\r\n         */\r\n        wwComputedStyle: null,\r\n\r\n        /**\r\n         * @description Notice object\r\n         */\r\n        notice: _notice,\r\n\r\n        /**\r\n         * @description Default icons object\r\n         */\r\n        icons: icons,\r\n\r\n        /**\r\n         * @description History object for undo, redo\r\n         */\r\n        history: null,\r\n        \r\n        /**\r\n         * @description Elements and user options parameters of the suneditor\r\n         */\r\n        context: context,\r\n\r\n        /**\r\n         * @description Plugin buttons\r\n         */\r\n        pluginCallButtons: pluginCallButtons,\r\n\r\n        /**\r\n         * @description Loaded plugins\r\n         */\r\n        plugins: plugins || {},\r\n\r\n        /**\r\n         * @description Whether the plugin is initialized\r\n         */\r\n        initPlugins: {},\r\n\r\n        /**\r\n         * @description Object for managing submenu elements\r\n         * @private\r\n         */\r\n        _targetPlugins: {},\r\n\r\n        /**\r\n         * @description Save rendered submenus and containers\r\n         * @private\r\n         */\r\n        _menuTray: {},\r\n\r\n        /**\r\n         * @description loaded language\r\n         */\r\n        lang: lang,\r\n\r\n        /**\r\n         * @description The selection node (core.getSelectionNode()) to which the effect was last applied\r\n         */\r\n        effectNode: null,\r\n\r\n        /**\r\n         * @description submenu element\r\n         */\r\n        submenu: null,\r\n\r\n        /**\r\n         * @description container element\r\n         */\r\n        container: null,\r\n\r\n        /**\r\n         * @description current subment name\r\n         * @private\r\n         */\r\n        _submenuName: '',\r\n\r\n        /**\r\n         * @description binded submenuOff method\r\n         * @private\r\n         */\r\n        _bindedSubmenuOff: null,\r\n\r\n        /**\r\n         * @description binded containerOff method\r\n         * @private\r\n         */\r\n        _bindedContainerOff: null,\r\n\r\n        /**\r\n         * @description active button element in submenu\r\n         */\r\n        submenuActiveButton: null,\r\n\r\n        /**\r\n         * @description active button element in container\r\n         */\r\n        containerActiveButton: null,\r\n\r\n        /**\r\n         * @description The elements array to be processed unvisible when the controllersOff function is executed (resizing, link modified button, table controller)\r\n         */\r\n        controllerArray: [],\r\n\r\n        /**\r\n         * @description The name of the plugin that called the currently active controller\r\n         */\r\n        currentControllerName: '',\r\n\r\n        /**\r\n         * @description The target element of current controller\r\n         */\r\n        currentControllerTarget: null,\r\n\r\n        /**\r\n         * @description The file component object of current selected file tag (getFileComponent)\r\n         */\r\n        currentFileComponentInfo: null,\r\n\r\n        /**\r\n         * @description An array of buttons whose class name is not \"se-code-view-enabled\"\r\n         */\r\n        codeViewDisabledButtons: [],\r\n\r\n        /**\r\n         * @description An array of buttons whose class name is not \"se-resizing-enabled\"\r\n         */\r\n        resizingDisabledButtons: [],\r\n\r\n        /**\r\n         * @description active more layer element in submenu\r\n         * @private\r\n         */\r\n        _moreLayerActiveButton: null,\r\n\r\n        /**\r\n         * @description Tag whitelist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n         * ^(options._editorTagsWhitelist)$\r\n         * @private\r\n         */\r\n        _htmlCheckWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Tag blacklist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n         * @private\r\n         */\r\n         _htmlCheckBlacklistRegExp: null,\r\n\r\n        /**\r\n         * @description RegExp when using check disallowd tags. (b, i, ins, strike, s)\r\n         * @private\r\n         */\r\n        _disallowedTextTagsRegExp: null,\r\n\r\n        /**\r\n         * @description Editor tags whitelist (RegExp object)\r\n         * util.createTagsWhitelist(options._editorTagsWhitelist)\r\n         */\r\n        editorTagsWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Editor tags blacklist (RegExp object)\r\n         * util.createTagsBlacklist(options.tagsBlacklist)\r\n         */\r\n        editorTagsBlacklistRegExp: null,\r\n\r\n        /**\r\n         * @description Tag whitelist when pasting (RegExp object)\r\n         * util.createTagsWhitelist(options.pasteTagsWhitelist)\r\n         */\r\n        pasteTagsWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Tag blacklist when pasting (RegExp object)\r\n         * util.createTagsBlacklist(options.pasteTagsBlacklist)\r\n         */\r\n        pasteTagsBlacklistRegExp: null,\r\n\r\n        /**\r\n         * @description Boolean value of whether the editor has focus\r\n         */\r\n        hasFocus: false,\r\n\r\n        /**\r\n         * @description Boolean value of whether the editor is disabled\r\n         */\r\n        isDisabled: false,\r\n\r\n        /**\r\n         * @description Boolean value of whether the editor is readOnly\r\n         */\r\n        isReadOnly: false,\r\n\r\n        /**\r\n         * @description Attributes whitelist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesWhitelistRegExp: null,\r\n        _attributesWhitelistRegExp_all_data: null,\r\n\r\n        /**\r\n         * @description Attributes blacklist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesBlacklistRegExp: null,\r\n\r\n        /**\r\n         * @description Attributes of tags whitelist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesTagsWhitelist: null,\r\n\r\n        /**\r\n         * @description Attributes of tags blacklist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesTagsBlacklist: null,\r\n\r\n        /**\r\n         * @description binded controllersOff method\r\n         * @private\r\n         */\r\n        _bindControllersOff: null,\r\n\r\n        /**\r\n         * @description Is inline mode?\r\n         * @private\r\n         */\r\n        _isInline: null,\r\n\r\n        /**\r\n         * @description Is balloon|balloon-always mode?\r\n         * @private\r\n         */\r\n        _isBalloon: null,\r\n\r\n        /**\r\n         * @description Is balloon-always mode?\r\n         * @private\r\n         */\r\n        _isBalloonAlways: null,\r\n\r\n        /**\r\n         * @description Required value when using inline mode to sticky toolbar\r\n         * @private\r\n         */\r\n        _inlineToolbarAttr: {top: '', width: '', isShow: false},\r\n\r\n        /**\r\n         * @description Variable that controls the \"blur\" event in the editor of inline or balloon mode when the focus is moved to submenu\r\n         * @private\r\n         */\r\n        _notHideToolbar: false,\r\n\r\n        /**\r\n         * @description Variable value that sticky toolbar mode\r\n         * @private\r\n         */\r\n        _sticky: false,\r\n\r\n        /**\r\n         * @description Variables for controlling focus and blur events\r\n         * @private\r\n         */\r\n        _antiBlur: false,\r\n\r\n        /**\r\n         * @description Component line breaker element\r\n         * @private\r\n         */\r\n        _lineBreaker: null,\r\n        _lineBreakerButton: null,\r\n\r\n        /**\r\n         * @description If true, (initialize, reset) all indexes of image, video information\r\n         * @private\r\n         */\r\n        _componentsInfoInit: true,\r\n        _componentsInfoReset: false,\r\n\r\n        /**\r\n         * @description Plugins array with \"active\" method.\r\n         * \"activePlugins\" runs the \"add\" method when creating the editor.\r\n         */\r\n        activePlugins: null,\r\n\r\n        /**\r\n         * @description Information of tags that should maintain HTML structure, style, class name, etc. (In use by \"math\" plugin)\r\n         * When inserting \"html\" such as paste, it is executed on the \"html\" to be inserted. (core.cleanHTML)\r\n         * Basic Editor Actions:\r\n         * 1. All classes not starting with \"__se__\" or \"se-\" in the editor are removed.\r\n         * 2. The style of all tags except the \"span\" tag is removed from the editor.\r\n         * \"managedTagsInfo\" structure ex:\r\n         * managedTagsInfo: {\r\n         *   query: '.__se__xxx, se-xxx'\r\n         *   map: {\r\n         *     '__se__xxx': method.bind(core),\r\n         *     'se-xxx': method.bind(core),\r\n         *   }\r\n         * }\r\n         * @example\r\n         * Define in the following return format in the \"managedTagInfo\" function of the plugin.\r\n         * managedTagInfo() => {\r\n         *  return {\r\n         *    className: 'string', // Class name to identify the tag. (\"__se__xxx\", \"se-xxx\")\r\n         *    // Change the html of the \"element\". (\"element\" is the element found with \"className\".)\r\n         *    // \"method\" is executed by binding \"core\".\r\n         *    method: function (element) {\r\n         *      // this === core\r\n         *      element.innerHTML = // (rendered html);\r\n         *    }\r\n         *  }\r\n         * }\r\n         */\r\n        managedTagsInfo: null,\r\n\r\n        /**\r\n         * @description cashing: options.charCounterType === 'byte-html'\r\n         * @private\r\n         */\r\n        _charTypeHTML: false,\r\n\r\n        /**\r\n         * @description Array of \"checkFileInfo\" functions with the core bound\r\n         * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n         * \"fileInfoPlugins\" runs the \"add\" method when creating the editor.\r\n         * \"checkFileInfo\" method is always call just before the \"change\" event.\r\n         * @private\r\n         */\r\n        _fileInfoPluginsCheck: null,\r\n\r\n        /**\r\n         * @description Array of \"resetFileInfo\" functions with the core bound\r\n         * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n         * \"checkFileInfo\" method is always call just before the \"functions.setOptions\" method.\r\n         * @private\r\n         */\r\n        _fileInfoPluginsReset: null,\r\n\r\n        /**\r\n         * @description Variables for file component management\r\n         * @private\r\n         */\r\n        _fileManager: {\r\n            tags: null,\r\n            regExp: null,\r\n            queryString: null,\r\n            pluginRegExp: null,\r\n            pluginMap: null\r\n        },\r\n\r\n        /**\r\n         * @description Elements that need to change text or className for each selection change\r\n         * After creating the editor, \"activePlugins\" are added.\r\n         * @property {Element} STRONG bold button\r\n         * @property {Element} U underline button\r\n         * @property {Element} EM italic button\r\n         * @property {Element} DEL strike button\r\n         * @property {Element} SUB subscript button\r\n         * @property {Element} SUP superscript button\r\n         * @property {Element} OUTDENT outdent button\r\n         * @property {Element} INDENT indent button\r\n         */\r\n        commandMap: null,\r\n\r\n        /**\r\n         * @description CSS properties related to style tags \r\n         * @private\r\n         */\r\n        _commandMapStyles: {\r\n            STRONG: ['font-weight'],\r\n            U: ['text-decoration'],\r\n            EM: ['font-style'],\r\n            DEL: ['text-decoration']\r\n        },\r\n\r\n        /**\r\n         * @description Style button related to edit area\r\n         * @property {Element} fullScreen fullScreen button element\r\n         * @property {Element} showBlocks showBlocks button element\r\n         * @property {Element} codeView codeView button element\r\n         * @private\r\n         */\r\n        _styleCommandMap: null,\r\n\r\n        /**\r\n         * @private\r\n         */\r\n        _cleanStyleRegExp: {\r\n            span: new _w.RegExp('\\\\s*[^-a-zA-Z](font-family|font-size|color|background-color)\\\\s*:[^;]+(?!;)*', 'ig'),\r\n            format: new _w.RegExp('\\\\s*[^-a-zA-Z](text-align|margin-left|margin-right)\\\\s*:[^;]+(?!;)*', 'ig'),\r\n            fontSizeUnit: new _w.RegExp('\\\\d+' + options.fontSizeUnit + '$', 'i'),\r\n        },\r\n\r\n        /**\r\n         * @description Variables used internally in editor operation\r\n         * @property {Boolean} isCodeView State of code view\r\n         * @property {Boolean} isFullScreen State of full screen\r\n         * @property {Number} innerHeight_fullScreen InnerHeight in editor when in full screen\r\n         * @property {Number} resizeClientY Remember the vertical size of the editor before resizing the editor (Used when calculating during resize operation)\r\n         * @property {Number} tabSize Indent size of tab (4)\r\n         * @property {Number} codeIndent Indent size of Code view mode (2)\r\n         * @property {Number} minResizingSize Minimum size of editing area when resized {Number} (.se-wrapper-inner {min-height: 65px;} || 65)\r\n         * @property {Array} currentNodes  An array of the current cursor's node structure\r\n         * @private\r\n         */\r\n        _variable: {\r\n            isChanged: false,\r\n            isCodeView: false,\r\n            isFullScreen: false,\r\n            innerHeight_fullScreen: 0,\r\n            resizeClientY: 0,\r\n            tabSize: 4,\r\n            codeIndent: 2,\r\n            minResizingSize: util.getNumber((context.element.wysiwygFrame.style.minHeight || '65'), 0),\r\n            currentNodes: [],\r\n            currentNodesMap: [],\r\n            _range: null,\r\n            _selectionNode: null,\r\n            _originCssText: context.element.topArea.style.cssText,\r\n            _bodyOverflow: '',\r\n            _editorAreaOriginCssText: '',\r\n            _wysiwygOriginCssText: '',\r\n            _codeOriginCssText: '',\r\n            _fullScreenAttrs: {sticky: false, balloon: false, inline: false},\r\n            _lineBreakComp: null,\r\n            _lineBreakDir: ''\r\n        },\r\n\r\n        /**\r\n         * @description Save the current buttons states to \"allCommandButtons\" object\r\n         * @private\r\n         */\r\n         _saveButtonStates: function () {\r\n            if (!this.allCommandButtons) this.allCommandButtons = {};\r\n\r\n            const currentButtons = this.context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]');\r\n            for (let i = 0, element, command; i < currentButtons.length; i++) {\r\n                element = currentButtons[i];\r\n                command = element.getAttribute('data-command');\r\n\r\n                this.allCommandButtons[command] = element;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Recover the current buttons states from \"allCommandButtons\" object\r\n         * @private\r\n         */\r\n        _recoverButtonStates: function () {\r\n            if (this.allCommandButtons) {\r\n                const currentButtons = this.context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]'); \r\n                for (let i = 0, button, command, oldButton; i < currentButtons.length; i++) {\r\n                    button = currentButtons[i]; \r\n                    command = button.getAttribute('data-command');\r\n\r\n                    oldButton = this.allCommandButtons[command];\r\n                    if (oldButton) {\r\n                        button.parentElement.replaceChild(oldButton, button);\r\n                        if (this.context.tool[command]) this.context.tool[command] = oldButton;\r\n                    }\r\n                }   \r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description If the plugin is not added, add the plugin and call the 'add' function.\r\n         * If the plugin is added call callBack function.\r\n         * @param {String} pluginName The name of the plugin to call\r\n         * @param {function} callBackFunction Function to be executed immediately after module call\r\n         * @param {Element|null} _target Plugin target button (This is not necessary if you have a button list when creating the editor)\r\n         */\r\n        callPlugin: function (pluginName, callBackFunction, _target) {\r\n            _target = _target || pluginCallButtons[pluginName];\r\n\r\n            if (!this.plugins[pluginName]) {\r\n                throw Error('[SUNEDITOR.core.callPlugin.fail] The called plugin does not exist or is in an invalid format. (pluginName:\"' + pluginName + '\")');\r\n            } else if (!this.initPlugins[pluginName]) {\r\n                this.plugins[pluginName].add(this, _target);\r\n                this.initPlugins[pluginName] = true;\r\n            } else if (typeof this._targetPlugins[pluginName] === 'object' && !!_target) {\r\n                this.initMenuTarget(pluginName, _target, this._targetPlugins[pluginName]);\r\n            }\r\n\r\n            if (this.plugins[pluginName].active && !this.commandMap[pluginName] && !!_target) {\r\n                this.commandMap[pluginName] = _target;\r\n                this.activePlugins.push(pluginName);\r\n            }\r\n                \r\n            if (typeof callBackFunction === 'function') callBackFunction();\r\n        },\r\n\r\n        /**\r\n         * @description If the module is not added, add the module and call the 'add' function\r\n         * @param {Array} moduleArray module object's Array [dialog, resizing]\r\n         */\r\n        addModule: function (moduleArray) {\r\n            for (let i = 0, len = moduleArray.length, moduleName; i < len; i++) {\r\n                moduleName = moduleArray[i].name;\r\n                if (!this.plugins[moduleName]) {\r\n                    this.plugins[moduleName] = moduleArray[i];\r\n                }\r\n                if (!this.initPlugins[moduleName]) {\r\n                    this.initPlugins[moduleName] = true;\r\n                    if (typeof this.plugins[moduleName].add === 'function') this.plugins[moduleName].add(this);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Gets the current editor-relative scroll offset.\r\n         * @returns {Object} {top, left}\r\n         */\r\n        getGlobalScrollOffset: function () {\r\n            let t = 0, l = 0;\r\n            let el = context.element.topArea;\r\n            while (el) {\r\n                t += el.scrollTop;\r\n                l += el.scrollLeft;\r\n                el = el.parentElement;\r\n            }\r\n            \r\n            el = this._shadowRoot ? this._shadowRoot.host : null;\r\n            while (el) {\r\n                t += el.scrollTop;\r\n                l += el.scrollLeft;\r\n                el = el.parentElement;\r\n            }\r\n\r\n            return {\r\n                top: t,\r\n                left: l\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Method for managing submenu element.\r\n         * You must add the \"submenu\" element using the this method at custom plugin.\r\n         * @param {String} pluginName Plugin name\r\n         * @param {Element|null} target Target button\r\n         * @param {Element} menu Submenu element\r\n         */\r\n        initMenuTarget: function (pluginName, target, menu) {\r\n            if (!target) {\r\n                this._targetPlugins[pluginName] = menu;\r\n            } else {\r\n                context.element._menuTray.appendChild(menu);\r\n                this._targetPlugins[pluginName] = true;\r\n                this._menuTray[target.getAttribute('data-command')] = menu;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Enable submenu\r\n         * @param {Element} element Submenu's button element to call\r\n         */\r\n        submenuOn: function (element) {\r\n            if (this._bindedSubmenuOff) this._bindedSubmenuOff();\r\n            if (this._bindControllersOff) this.controllersOff();\r\n\r\n            const submenuName = this._submenuName = element.getAttribute('data-command');\r\n            const menu = this.submenu = this._menuTray[submenuName];\r\n            this.submenuActiveButton = element;\r\n            this._setMenuPosition(element, menu);\r\n            \r\n            this._bindedSubmenuOff = this.submenuOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindedSubmenuOff, false);\r\n\r\n            if (this.plugins[submenuName].on) this.plugins[submenuName].on.call(this);\r\n            this._antiBlur = true;\r\n        },\r\n\r\n        /**\r\n         * @description Disable submenu\r\n         */\r\n        submenuOff: function () {\r\n            this.removeDocEvent('mousedown', this._bindedSubmenuOff);\r\n            this._bindedSubmenuOff = null;\r\n\r\n            if (this.submenu) {\r\n                this._submenuName = '';\r\n                this.submenu.style.display = 'none';\r\n                this.submenu = null;\r\n                util.removeClass(this.submenuActiveButton, 'on');\r\n                this.submenuActiveButton = null;\r\n                this._notHideToolbar = false;\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Disable more layer\r\n         */\r\n        moreLayerOff: function() {\r\n            if (this._moreLayerActiveButton) {\r\n                const layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\r\n                layer.style.display = 'none';\r\n                util.removeClass(this._moreLayerActiveButton, 'on');\r\n                this._moreLayerActiveButton = null;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Enable container\r\n         * @param {Element} element Container's button element to call\r\n         */\r\n        containerOn: function (element) {\r\n            if (this._bindedContainerOff) this._bindedContainerOff();\r\n\r\n            const containerName = this._containerName = element.getAttribute('data-command');\r\n            const menu = this.container = this._menuTray[containerName];\r\n            this.containerActiveButton = element;\r\n            this._setMenuPosition(element, menu);\r\n            \r\n            this._bindedContainerOff = this.containerOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindedContainerOff, false);\r\n\r\n            if (this.plugins[containerName].on) this.plugins[containerName].on.call(this);\r\n            this._antiBlur = true;\r\n        },\r\n\r\n        /**\r\n         * @description Disable container\r\n         */\r\n        containerOff: function () {\r\n            this.removeDocEvent('mousedown', this._bindedContainerOff);\r\n            this._bindedContainerOff = null;\r\n\r\n            if (this.container) {\r\n                this._containerName = '';\r\n                this.container.style.display = 'none';\r\n                this.container = null;\r\n                util.removeClass(this.containerActiveButton, 'on');\r\n                this.containerActiveButton = null;\r\n                this._notHideToolbar = false;\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Set the menu position. (submenu, container)\r\n         * @param {*} element Button element\r\n         * @param {*} menu Menu element\r\n         * @private\r\n         */\r\n        _setMenuPosition: function (element, menu) {\r\n            menu.style.visibility = 'hidden';\r\n            menu.style.display = 'block';\r\n            menu.style.height = '';\r\n            util.addClass(element, 'on');\r\n\r\n            const toolbar = this.context.element.toolbar;\r\n            const toolbarW = toolbar.offsetWidth;\r\n            const toolbarOffset = event._getEditorOffsets(context.element.toolbar);\r\n            const menuW = menu.offsetWidth;\r\n            const l = element.parentElement.offsetLeft + 3;\r\n\r\n            // rtl\r\n            if (options.rtl) {\r\n                const elementW = element.offsetWidth;\r\n                const rtlW = menuW > elementW ? menuW - elementW : 0;\r\n                const rtlL = rtlW > 0 ? 0 : elementW - menuW;\r\n                menu.style.left = (l - rtlW + rtlL) + 'px';\r\n                if (toolbarOffset.left > event._getEditorOffsets(menu).left) {\r\n                    menu.style.left = '0px';\r\n                }\r\n            } else {\r\n                const overLeft = toolbarW <= menuW ? 0 : toolbarW - (l + menuW);\r\n                if (overLeft < 0) menu.style.left = (l + overLeft) + 'px';\r\n                else menu.style.left = l + 'px';\r\n            }\r\n\r\n            // get element top\r\n            let t = 0;\r\n            let offsetEl = element;\r\n            while (offsetEl && offsetEl !== toolbar) {\r\n                t += offsetEl.offsetTop;\r\n                offsetEl = offsetEl.offsetParent;\r\n            }\r\n\r\n            const bt = t;\r\n            if (this._isBalloon) {\r\n                t += toolbar.offsetTop + element.offsetHeight;\r\n            } else {\r\n                t -= element.offsetHeight;\r\n            }\r\n\r\n            // set menu position\r\n            const toolbarTop = toolbarOffset.top;\r\n            const menuHeight = menu.offsetHeight;\r\n            const scrollTop = this.getGlobalScrollOffset().top;\r\n\r\n            const menuHeight_bottom = _w.innerHeight - (toolbarTop - scrollTop + bt + element.parentElement.offsetHeight);\r\n            if (menuHeight_bottom < menuHeight) {\r\n                let menuTop = -1 * (menuHeight - bt + 3);\r\n                const insTop = toolbarTop - scrollTop + menuTop;\r\n                const menuHeight_top = menuHeight + (insTop < 0 ? insTop : 0);\r\n                \r\n                if (menuHeight_top > menuHeight_bottom) {\r\n                    menu.style.height = menuHeight_top + 'px';\r\n                    menuTop = -1 * (menuHeight_top - bt + 3);\r\n                } else {\r\n                    menu.style.height = menuHeight_bottom + 'px';\r\n                    menuTop = bt + element.parentElement.offsetHeight;\r\n                }\r\n\r\n                menu.style.top = menuTop + 'px';\r\n            } else {\r\n                menu.style.top = (bt + element.parentElement.offsetHeight) + 'px';\r\n            }\r\n\r\n            menu.style.visibility = '';\r\n        },\r\n\r\n        /**\r\n         * @description Show controller at editor area (controller elements, function, \"controller target element(@Required)\", \"controller name(@Required)\", etc..)\r\n         * @param {*} arguments controller elements, functions..\r\n         */\r\n        controllersOn: function () {\r\n            if (this._bindControllersOff) this._bindControllersOff();\r\n            this.controllerArray = [];\r\n\r\n            for (let i = 0, arg; i < arguments.length; i++) {\r\n                arg = arguments[i];\r\n                if (!arg) continue;\r\n                \r\n                if (typeof arg === 'string') {\r\n                    this.currentControllerName = arg;\r\n                    continue;\r\n                }\r\n                if (typeof arg === 'function') {\r\n                    this.controllerArray.push(arg);\r\n                    continue;\r\n                }\r\n                if (!util.hasClass(arg, 'se-controller')) {\r\n                    this.currentControllerTarget = arg;\r\n                    this.currentFileComponentInfo = this.getFileComponent(arg);\r\n                    continue;\r\n                }\r\n                if (arg.style) {\r\n                    arg.style.display = 'block';\r\n                    if (this._shadowRoot && this._shadowRootControllerEventTarget.indexOf(arg) === -1) {\r\n                        arg.addEventListener('mousedown', function (e) { e.preventDefault(); e.stopPropagation(); });\r\n                        this._shadowRootControllerEventTarget.push(arg);\r\n                    }\r\n                }\r\n                this.controllerArray.push(arg);\r\n            }\r\n\r\n            this._bindControllersOff = this.controllersOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindControllersOff, false);\r\n            this.addDocEvent('keydown', this._bindControllersOff, false);\r\n            this._antiBlur = true;\r\n\r\n            if (typeof functions.showController === 'function') functions.showController(this.currentControllerName, this.controllerArray, this);\r\n        },\r\n\r\n        /**\r\n         * @description Hide controller at editor area (link button, image resize button..)\r\n         * @param {KeyboardEvent|MouseEvent|null} e Event object when called from mousedown and keydown events registered in \"core.controllersOn\"\r\n         */\r\n        controllersOff: function (e) {\r\n            this._lineBreaker.style.display = 'none';\r\n            const len = this.controllerArray.length;\r\n\r\n            if (e && e.target && len > 0) {\r\n                for (let i = 0; i < len; i++) {\r\n                    if (typeof this.controllerArray[i].contains === 'function' && this.controllerArray[i].contains(e.target)) return;\r\n                }\r\n            }\r\n            \r\n            if (this._fileManager.pluginRegExp.test(this.currentControllerName) && e && e.type === 'keydown' && e.keyCode !== 27) return;\r\n            context.element.lineBreaker_t.style.display = context.element.lineBreaker_b.style.display = 'none';\r\n            this._variable._lineBreakComp = null;\r\n\r\n            this.currentControllerName = '';\r\n            this.currentControllerTarget = null;\r\n            this.currentFileComponentInfo = null;\r\n            this.effectNode = null;\r\n            if (!this._bindControllersOff) return;\r\n\r\n            this.removeDocEvent('mousedown', this._bindControllersOff);\r\n            this.removeDocEvent('keydown', this._bindControllersOff);\r\n            this._bindControllersOff = null;\r\n\r\n            if (len > 0) {\r\n                for (let i = 0; i < len; i++) {\r\n                    if (typeof this.controllerArray[i] === 'function') this.controllerArray[i]();\r\n                    else this.controllerArray[i].style.display = 'none';\r\n                }\r\n\r\n                this.controllerArray = [];\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Specify the position of the controller.\r\n         * @param {Element} controller Controller element.\r\n         * @param {Element} referEl Element that is the basis of the controller's position.\r\n         * @param {String} position Type of position (\"top\" | \"bottom\")\r\n         * When using the \"top\" position, there should not be an arrow on the controller.\r\n         * When using the \"bottom\" position there should be an arrow on the controller.\r\n         * @param {Object} addOffset These are the left and top values that need to be added specially. \r\n         * This argument is required. - {left: 0, top: 0}\r\n         * Please enter the value based on ltr mode.\r\n         * Calculated automatically in rtl mode.\r\n         */\r\n        setControllerPosition: function (controller, referEl, position, addOffset) {\r\n            if (options.rtl) addOffset.left *= -1;\r\n\r\n            const offset = util.getOffset(referEl, context.element.wysiwygFrame);\r\n            controller.style.visibility = 'hidden';\r\n            controller.style.display = 'block';\r\n\r\n            // Height value of the arrow element is 11px\r\n            const topMargin = position === 'top' ? -(controller.offsetHeight + 2) : (referEl.offsetHeight + 12);\r\n            controller.style.top = (offset.top + topMargin + addOffset.top) + 'px';\r\n\r\n            const l = offset.left - context.element.wysiwygFrame.scrollLeft + addOffset.left;\r\n            const controllerW = controller.offsetWidth;\r\n            const referElW = referEl.offsetWidth;\r\n            \r\n            const allow = util.hasClass(controller.firstElementChild, 'se-arrow') ? controller.firstElementChild : null;\r\n\r\n            // rtl (Width value of the arrow element is 22px)\r\n            if (options.rtl) {\r\n                const rtlW = (controllerW > referElW) ? controllerW - referElW : 0;\r\n                const rtlL = rtlW > 0 ? 0 : referElW - controllerW;\r\n                controller.style.left = (l - rtlW + rtlL) + 'px';\r\n                \r\n                if (rtlW > 0) {\r\n                    if (allow) allow.style.left = ((controllerW - 14 < 10 + rtlW) ? (controllerW - 14) : (10 + rtlW)) + 'px';\r\n                }\r\n                \r\n                const overSize = context.element.wysiwygFrame.offsetLeft - controller.offsetLeft;\r\n                if (overSize > 0) {\r\n                    controller.style.left = '0px';\r\n                    if (allow) allow.style.left = overSize + 'px';\r\n                }\r\n            } else {\r\n                controller.style.left = l + 'px';\r\n\r\n                const overSize = context.element.wysiwygFrame.offsetWidth - (controller.offsetLeft + controllerW);\r\n                if (overSize < 0) {\r\n                    controller.style.left = (controller.offsetLeft + overSize) + 'px';\r\n                    if (allow) allow.style.left = (20 - overSize) + 'px';\r\n                } else {\r\n                    if (allow) allow.style.left = '20px';\r\n                }\r\n            }\r\n\r\n            controller.style.visibility = '';\r\n        },\r\n\r\n        /**\r\n         * @description javascript execCommand\r\n         * @param {String} command javascript execCommand function property\r\n         * @param {Boolean|undefined} showDefaultUI javascript execCommand function property\r\n         * @param {String|undefined} value javascript execCommand function property\r\n         */\r\n        execCommand: function (command, showDefaultUI, value) {\r\n            this._wd.execCommand(command, showDefaultUI, (command === 'formatBlock' ? '<' + value + '>' : value));\r\n            // history stack\r\n            this.history.push(true);\r\n        },\r\n\r\n        /**\r\n         * @description Focus to wysiwyg area using \"native focus function\"\r\n         */\r\n        nativeFocus: function () {\r\n            this.__focus();\r\n            this._editorRange();\r\n        },\r\n\r\n        /**\r\n         * @description Focus method\r\n         * @private\r\n         */\r\n        __focus: function () {\r\n            const caption = util.getParentElement(this.getSelectionNode(), 'figcaption');\r\n            if (caption) {\r\n                caption.focus();\r\n            } else {\r\n                context.element.wysiwyg.focus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Focus to wysiwyg area\r\n         */\r\n        focus: function () {\r\n            if (context.element.wysiwygFrame.style.display === 'none') return;\r\n\r\n            if (options.iframe) {\r\n                this.nativeFocus();\r\n            } else {\r\n                try {\r\n                    const range = this.getRange();\r\n                    if (range.startContainer === range.endContainer && util.isWysiwygDiv(range.startContainer)) {\r\n                        const currentNode = range.commonAncestorContainer.children[range.startOffset];\r\n                        if (!util.isFormatElement(currentNode) && !util.isComponent(currentNode)) {\r\n                            const format = util.createElement(options.defaultTag);\r\n                            const br = util.createElement('BR');\r\n                            format.appendChild(br);\r\n                            context.element.wysiwyg.insertBefore(format, currentNode);\r\n                            this.setRange(br, 0, br, 0);\r\n                            return;\r\n                        }\r\n                    }\r\n                    this.setRange(range.startContainer, range.startOffset, range.endContainer, range.endOffset);\r\n                } catch (e) {\r\n                    this.nativeFocus();\r\n                }\r\n            }\r\n\r\n            event._applyTagEffects();\r\n            if (this._isBalloon) event._toggleToolbarBalloon();\r\n        },\r\n\r\n        /**\r\n         * @description If \"focusEl\" is a component, then that component is selected; if it is a format element, the last text is selected\r\n         * If \"focusEdge\" is null, then selected last element\r\n         * @param {Element|null} focusEl Focus element\r\n         */\r\n        focusEdge: function (focusEl) {\r\n            if (!focusEl) focusEl = context.element.wysiwyg.lastElementChild;\r\n\r\n            const fileComponentInfo = this.getFileComponent(focusEl);\r\n            if (fileComponentInfo) {\r\n                this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n            } else if (focusEl) {\r\n                focusEl = util.getChildElement(focusEl, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, true);\r\n                if (!focusEl) this.nativeFocus();\r\n                else this.setRange(focusEl, focusEl.textContent.length, focusEl, focusEl.textContent.length);\r\n            } else {\r\n                this.focus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Focusout to wysiwyg area (.blur())\r\n         */\r\n        blur: function () {\r\n            if (options.iframe) {\r\n                context.element.wysiwygFrame.blur();\r\n            } else {\r\n                context.element.wysiwyg.blur();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set current editor's range object and return.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @returns {Object} Range object.\r\n         */\r\n        setRange: function (startCon, startOff, endCon, endOff) {\r\n            if (!startCon || !endCon) return;\r\n            if (startOff > startCon.textContent.length) startOff = startCon.textContent.length;\r\n            if (endOff > endCon.textContent.length) endOff = endCon.textContent.length;\r\n            if (util.isFormatElement(startCon)) {\r\n                startCon = startCon.childNodes[startOff] || startCon.childNodes[startOff - 1] || startCon;\r\n                startOff = startOff > 0 ? startCon.nodeType === 1 ? 1 : startCon.textContent ? startCon.textContent.length : 0 : 0;\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon.childNodes[endOff - 1] || endCon;\r\n                endOff = endOff > 0 ? endCon.nodeType === 1 ? 1 : endCon.textContent ? endCon.textContent.length : 0 : 0;\r\n            }\r\n            \r\n            const range = this._wd.createRange();\r\n\r\n            try {\r\n                range.setStart(startCon, startOff);\r\n                range.setEnd(endCon, endOff);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.core.focus.error] ' + error);\r\n                this.nativeFocus();\r\n                return;\r\n            }\r\n\r\n            const selection = this.getSelection();\r\n\r\n            if (selection.removeAllRanges) {\r\n                selection.removeAllRanges();\r\n            }\r\n\r\n            selection.addRange(range);\r\n            this._rangeInfo(range, this.getSelection());\r\n            if (options.iframe) this.__focus();\r\n\r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Remove range object and button effect\r\n         */\r\n        removeRange: function () {\r\n            this._variable._range = null;\r\n            this._variable._selectionNode = null;\r\n            if (this.hasFocus) this.getSelection().removeAllRanges();\r\n            this._setKeyEffect([]);\r\n        },\r\n\r\n        /**\r\n         * @description Get current editor's range object\r\n         * @returns {Object}\r\n         */\r\n        getRange: function () {\r\n            const range = this._variable._range || this._createDefaultRange();\r\n            const selection = this.getSelection();\r\n            if (range.collapsed === selection.isCollapsed || !context.element.wysiwyg.contains(selection.focusNode)) return range;\r\n            \r\n            if (selection.rangeCount > 0) {\r\n                this._variable._range = selection.getRangeAt(0);\r\n                return this._variable._range;\r\n            } else {\r\n                const sc = selection.anchorNode, ec = selection.focusNode, so = selection.anchorOffset, eo = selection.focusOffset;\r\n                const compareValue = util.compareElements(sc, ec);\r\n                const rightDir = compareValue.ancestor && (compareValue.result === 0 ? so <= eo : compareValue.result > 1 ? true : false);\r\n                return this.setRange(\r\n                    rightDir ? sc : ec,\r\n                    rightDir ? so : eo,\r\n                    rightDir ? ec : sc,\r\n                    rightDir ? eo : so\r\n                );\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description If the \"range\" object is a non-editable area, add a line at the top of the editor and update the \"range\" object.\r\n         * Returns a new \"range\" or argument \"range\".\r\n         * @param {Object} range core.getRange()\r\n         * @param {Element|null} container If there is \"container\" argument, it creates a line in front of the container.\r\n         * @returns {Object} range\r\n         */\r\n        getRange_addLine: function (range, container) {\r\n            if (this._selectionVoid(range)) {\r\n                const wysiwyg = context.element.wysiwyg;\r\n                const op = util.createElement(options.defaultTag);\r\n                op.innerHTML = '<br>';\r\n                wysiwyg.insertBefore(op, container && container !== wysiwyg ? container.nextElementSibling : wysiwyg.firstElementChild);\r\n                this.setRange(op.firstElementChild, 0, op.firstElementChild, 1);\r\n                range = this._variable._range;\r\n            }\r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Get window selection obejct\r\n         * @returns {Object}\r\n         */\r\n        getSelection: function () {\r\n            return this._shadowRoot && this._shadowRoot.getSelection ? this._shadowRoot.getSelection() : this._ww.getSelection();\r\n        },\r\n\r\n        /**\r\n         * @description Get current select node\r\n         * @returns {Node}\r\n         */\r\n        getSelectionNode: function () {\r\n            if(!context.element.wysiwyg.contains(this._variable._selectionNode))this._editorRange();\r\n            if (!this._variable._selectionNode) {\r\n                const selectionNode = util.getChildElement(context.element.wysiwyg.firstChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, false);\r\n                if (!selectionNode){\r\n                    this._editorRange();\r\n                } else {\r\n                    this._variable._selectionNode = selectionNode;\r\n                    return selectionNode;\r\n                }\r\n            }\r\n            return this._variable._selectionNode;\r\n        },\r\n\r\n        /**\r\n         * @description Saving the range object and the currently selected node of editor\r\n         * @private\r\n         */\r\n        _editorRange: function () {\r\n            const selection = this.getSelection();\r\n            if (!selection) return null;\r\n            let range = null;\r\n\r\n            if (selection.rangeCount > 0) {\r\n                range = selection.getRangeAt(0);\r\n            } else {\r\n                range = this._createDefaultRange();\r\n            }\r\n\r\n            if (util.isFormatElement(range.endContainer) && range.endOffset === 0) {\r\n                range = this.setRange(range.startContainer, range.startOffset, range.startContainer, range.startContainer.length);\r\n            }\r\n\r\n            this._rangeInfo(range, selection);\r\n        },\r\n\r\n        /**\r\n         * @description Set \"range\" and \"selection\" info.\r\n         * @param {Object} range range object.\r\n         * @param {Object} selection selection object.\r\n         */\r\n        _rangeInfo: function (range, selection) {\r\n            let selectionNode = null;\r\n            this._variable._range = range;\r\n\r\n            if (range.collapsed) {\r\n                if (util.isWysiwygDiv(range.commonAncestorContainer)) selectionNode = range.commonAncestorContainer.children[range.startOffset] || range.commonAncestorContainer;\r\n                else selectionNode = range.commonAncestorContainer;\r\n            } else {\r\n                selectionNode = selection.extentNode || selection.anchorNode;\r\n            }\r\n\r\n            this._variable._selectionNode = selectionNode;\r\n        },\r\n\r\n        /**\r\n         * @description Return the range object of editor's first child node\r\n         * @returns {Object}\r\n         * @private\r\n         */\r\n        _createDefaultRange: function () {\r\n            const wysiwyg = context.element.wysiwyg;\r\n            wysiwyg.focus();\r\n            const range = this._wd.createRange();\r\n\r\n            let focusEl = wysiwyg.firstElementChild;\r\n            if (!focusEl) {\r\n                focusEl = util.createElement(options.defaultTag);\r\n                focusEl.innerHTML = '<br>';\r\n                wysiwyg.appendChild(focusEl);\r\n            }\r\n\r\n            range.setStart(focusEl, 0);\r\n            range.setEnd(focusEl, 0);\r\n            \r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Returns true if there is no valid \"selection\".\r\n         * @param {Object} range core.getRange()\r\n         * @returns {Object} range\r\n         * @private\r\n         */\r\n        _selectionVoid: function (range) {\r\n            const comm = range.commonAncestorContainer;\r\n            return (util.isWysiwygDiv(range.startContainer) && util.isWysiwygDiv(range.endContainer)) || /FIGURE/i.test(comm.nodeName) || this._fileManager.regExp.test(comm.nodeName) || util.isMediaComponent(comm);\r\n        },\r\n\r\n        /**\r\n         * @description Reset range object to text node selected status.\r\n         * @returns {Boolean} Returns false if there is no valid selection.\r\n         * @private\r\n         */\r\n        _resetRangeToTextNode: function () {\r\n            const range = this.getRange();\r\n            if (this._selectionVoid(range)) return false;\r\n            \r\n            let startCon = range.startContainer;\r\n            let startOff = range.startOffset;\r\n            let endCon = range.endContainer;\r\n            let endOff = range.endOffset;\r\n            let tempCon, tempOffset, tempChild;\r\n\r\n            if (util.isFormatElement(startCon)) {\r\n                if (!startCon.childNodes[startOff]) {\r\n                    startCon = startCon.lastChild || startCon;\r\n                    startOff = startCon.textContent.length;\r\n                } else {\r\n                    startCon = startCon.childNodes[startOff] || startCon;\r\n                    startOff = 0;\r\n                }\r\n                while (startCon && startCon.nodeType === 1 && startCon.firstChild) {\r\n                    startCon = startCon.firstChild || startCon;\r\n                    startOff = 0;\r\n                }\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon.lastChild || endCon;\r\n                while (endCon && endCon.nodeType === 1 && endCon.lastChild) {\r\n                    endCon = endCon.lastChild;\r\n                }\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            // startContainer\r\n            tempCon = util.isWysiwygDiv(startCon) ? context.element.wysiwyg.firstChild : startCon;\r\n            tempOffset = startOff;\r\n\r\n            if (util.isBreak(tempCon) || (tempCon.nodeType === 1 && tempCon.childNodes.length > 0)) {\r\n                const onlyBreak = util.isBreak(tempCon);\r\n                if (!onlyBreak) {\r\n                    while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\r\n                        tempCon = tempCon.childNodes[tempOffset] || tempCon.nextElementSibling || tempCon.nextSibling;\r\n                        tempOffset = 0;\r\n                    }\r\n    \r\n                    let format = util.getFormatElement(tempCon, null);\r\n                    if (format === util.getRangeFormatElement(format, null)) {\r\n                        format = util.createElement(util.getParentElement(tempCon, util.isCell) ? 'DIV' : options.defaultTag);\r\n                        tempCon.parentNode.insertBefore(format, tempCon);\r\n                        format.appendChild(tempCon);\r\n                    }\r\n                }\r\n\r\n                if (util.isBreak(tempCon)) {\r\n                    const emptyText = util.createTextNode(util.zeroWidthSpace);\r\n                    tempCon.parentNode.insertBefore(emptyText, tempCon);\r\n                    tempCon = emptyText;\r\n                    if (onlyBreak) {\r\n                        if (startCon === endCon) {\r\n                            endCon = tempCon;\r\n                            endOff = 1;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // set startContainer\r\n            startCon = tempCon;\r\n            startOff = tempOffset;\r\n\r\n            // endContainer\r\n            tempCon = util.isWysiwygDiv(endCon) ? context.element.wysiwyg.lastChild : endCon;\r\n            tempOffset = endOff;\r\n\r\n            if (util.isBreak(tempCon) || (tempCon.nodeType === 1 && tempCon.childNodes.length > 0)) {\r\n                const onlyBreak = util.isBreak(tempCon);\r\n                if (!onlyBreak) {\r\n                    while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\r\n                        tempChild = tempCon.childNodes;\r\n                        if (tempChild.length === 0) break;\r\n                        tempCon = tempChild[tempOffset > 0 ? tempOffset - 1 : tempOffset] || !/FIGURE/i.test(tempChild[0].nodeName) ? tempChild[0] : (tempCon.previousElementSibling || tempCon.previousSibling || startCon);\r\n                        tempOffset = tempOffset > 0 ? tempCon.textContent.length : tempOffset;\r\n                    }\r\n    \r\n                    let format = util.getFormatElement(tempCon, null);\r\n                    if (format === util.getRangeFormatElement(format, null)) {\r\n                        format = util.createElement(util.isCell(format) ? 'DIV' : options.defaultTag);\r\n                        tempCon.parentNode.insertBefore(format, tempCon);\r\n                        format.appendChild(tempCon);\r\n                    }\r\n                }\r\n\r\n                if (util.isBreak(tempCon)) {\r\n                    const emptyText = util.createTextNode(util.zeroWidthSpace);\r\n                    tempCon.parentNode.insertBefore(emptyText, tempCon);\r\n                    tempCon = emptyText;\r\n                    tempOffset = 1;\r\n                    if (onlyBreak && !tempCon.previousSibling) {\r\n                        util.removeItem(endCon);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // set endContainer\r\n            endCon = tempCon;\r\n            endOff = tempOffset;\r\n\r\n            // set Range\r\n            this.setRange(startCon, startOff, endCon, endOff);\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description Returns a \"formatElement\"(util.isFormatElement) array from the currently selected range.\r\n         * @param {Function|null} validation The validation function. (Replaces the default validation function-util.isFormatElement(current))\r\n         * @returns {Array}\r\n         */\r\n        getSelectedElements: function (validation) {\r\n            if (!this._resetRangeToTextNode()) return [];\r\n            let range = this.getRange();\r\n\r\n            if (util.isWysiwygDiv(range.startContainer)) {\r\n                const children = context.element.wysiwyg.children;\r\n                if (children.length === 0) return [];\r\n                this.setRange(children[0], 0, children[children.length - 1], children[children.length - 1].textContent.trim().length);\r\n                range = this.getRange();\r\n            }\r\n\r\n            const startCon = range.startContainer;\r\n            const endCon = range.endContainer;\r\n            const commonCon = range.commonAncestorContainer;\r\n\r\n            // get line nodes\r\n            const lineNodes = util.getListChildren(commonCon, function (current) {\r\n                return validation ? validation(current) : util.isFormatElement(current);\r\n            });\r\n\r\n            if (!util.isWysiwygDiv(commonCon) && !util.isRangeFormatElement(commonCon)) lineNodes.unshift(util.getFormatElement(commonCon, null));\r\n            if (startCon === endCon || lineNodes.length === 1) return lineNodes;\r\n\r\n            let startLine = util.getFormatElement(startCon, null);\r\n            let endLine = util.getFormatElement(endCon, null);\r\n            let startIdx = null;\r\n            let endIdx = null;\r\n            \r\n            const onlyTable = function (current) {\r\n                return util.isTable(current) ? /^TABLE$/i.test(current.nodeName) : true;\r\n            };\r\n\r\n            let startRangeEl = util.getRangeFormatElement(startLine, onlyTable);\r\n            let endRangeEl = util.getRangeFormatElement(endLine, onlyTable);\r\n            if (util.isTable(startRangeEl) && util.isListCell(startRangeEl.parentNode)) startRangeEl = startRangeEl.parentNode;\r\n            if (util.isTable(endRangeEl) && util.isListCell(endRangeEl.parentNode)) endRangeEl = endRangeEl.parentNode;\r\n            \r\n            const sameRange = startRangeEl === endRangeEl;\r\n            for (let i = 0, len = lineNodes.length, line; i < len; i++) {\r\n                line = lineNodes[i];\r\n\r\n                if (startLine === line || (!sameRange && line === startRangeEl)) {\r\n                    startIdx = i;\r\n                    continue;\r\n                }\r\n\r\n                if (endLine === line || (!sameRange && line === endRangeEl)) {\r\n                    endIdx = i;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (startIdx === null) startIdx = 0;\r\n            if (endIdx === null) endIdx = lineNodes.length - 1;\r\n\r\n            return lineNodes.slice(startIdx, endIdx + 1);\r\n        },\r\n\r\n        /**\r\n         * @description Get format elements and components from the selected area. (P, DIV, H[1-6], OL, UL, TABLE..)\r\n         * If some of the component are included in the selection, get the entire that component.\r\n         * @param {Boolean} removeDuplicate If true, if there is a parent and child tag among the selected elements, the child tag is excluded.\r\n         * @returns {Array}\r\n         */\r\n        getSelectedElementsAndComponents: function (removeDuplicate) {\r\n            const commonCon = this.getRange().commonAncestorContainer;\r\n            const myComponent = util.getParentElement(commonCon, util.isComponent);\r\n            const selectedLines = util.isTable(commonCon) ? \r\n                this.getSelectedElements(null) :\r\n                this.getSelectedElements(function (current) {\r\n                    const component = this.getParentElement(current, this.isComponent);\r\n                    return (this.isFormatElement(current) && (!component || component === myComponent)) || (this.isComponent(current) && !this.getFormatElement(current));\r\n                }.bind(util));\r\n            \r\n            if (removeDuplicate) {\r\n                for (let i = 0, len = selectedLines.length; i < len; i++) {\r\n                    for (let j = i - 1; j >= 0; j--) {\r\n                        if (selectedLines[j].contains(selectedLines[i])) {\r\n                            selectedLines.splice(i, 1);\r\n                            i--; len--;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            return selectedLines;\r\n        },\r\n\r\n        /**\r\n         * @description Determine if this offset is the edge offset of container\r\n         * @param {Node} container The node of the selection object. (range.startContainer..)\r\n         * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n         * @param {String|undefined} dir Select check point - Both edge, Front edge or End edge. (\"front\": Front edge, \"end\": End edge, undefined: Both edge)\r\n         * @returns {Boolean}\r\n         */\r\n        isEdgePoint: function (container, offset, dir) {\r\n            return (dir !== 'end' && offset === 0) || ((!dir || dir !== 'front') && !container.nodeValue && offset === 1) || ((!dir || dir === 'end') && !!container.nodeValue && offset === container.nodeValue.length);\r\n        },\r\n\r\n        /**\r\n         * @description Check if the container and offset values are the edges of the format tag\r\n         * @param {Node} container The node of the selection object. (range.startContainer..)\r\n         * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n         * @param {String} dir Select check point - \"front\": Front edge, \"end\": End edge, undefined: Both edge.\r\n         * @returns {Array|null}\r\n         * @private\r\n         */\r\n        _isEdgeFormat: function (node, offset, dir) {\r\n            if (!this.isEdgePoint(node, offset, dir)) return false;\r\n\r\n            const result = [];\r\n            dir = dir === 'front' ? 'previousSibling' : 'nextSibling';\r\n            while (node && !util.isFormatElement(node) && !util.isWysiwygDiv(node)) {\r\n                if (!node[dir] || (util.isBreak(node[dir]) && !node[dir][dir])) {\r\n                    if (node.nodeType === 1) result.push(node.cloneNode(false));\r\n                    node = node.parentNode;\r\n                } else {\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        /**\r\n         * @description Show loading box\r\n         */\r\n        showLoading: function () {\r\n            context.element.loading.style.display = 'block';\r\n        },\r\n\r\n        /**\r\n         * @description Close loading box\r\n         */\r\n        closeLoading: function () {\r\n            context.element.loading.style.display = 'none';\r\n        },\r\n\r\n        /**\r\n         * @description Append format element to sibling node of argument element.\r\n         * If the \"formatNodeName\" argument value is present, the tag of that argument value is inserted,\r\n         * If not, the currently selected format tag is inserted.\r\n         * @param {Element} element Insert as siblings of that element\r\n         * @param {String|Element|null} formatNode Node name or node obejct to be inserted\r\n         * @returns {Element}\r\n         */\r\n        appendFormatTag: function (element, formatNode) {\r\n            if (!element || !element.parentNode) return null;\r\n\r\n            const currentFormatEl = util.getFormatElement(this.getSelectionNode(), null);\r\n            let oFormat = null;\r\n            if (!util.isFormatElement(element) && util.isFreeFormatElement(currentFormatEl || element.parentNode)) {\r\n                oFormat = util.createElement('BR');\r\n            } else {\r\n                const oFormatName = formatNode ? (typeof formatNode === 'string' ? formatNode : formatNode.nodeName) : (util.isFormatElement(currentFormatEl) && !util.isRangeFormatElement(currentFormatEl) && !util.isFreeFormatElement(currentFormatEl)) ? currentFormatEl.nodeName : options.defaultTag;\r\n                oFormat = util.createElement(oFormatName);\r\n                oFormat.innerHTML = '<br>';\r\n                if ((formatNode && typeof formatNode !== 'string') || (!formatNode && util.isFormatElement(currentFormatEl))) {\r\n                    util.copyTagAttributes(oFormat, formatNode || currentFormatEl);\r\n                }\r\n            }\r\n\r\n            if (util.isCell(element)) element.insertBefore(oFormat, element.nextElementSibling);\r\n            else element.parentNode.insertBefore(oFormat, element.nextElementSibling);\r\n\r\n            return oFormat;\r\n        },\r\n\r\n        /**\r\n         * @description The method to insert a element and return. (used elements : table, hr, image, video)\r\n         * If \"element\" is \"HR\", insert and return the new line.\r\n         * @param {Element} element Element to be inserted\r\n         * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @param {Boolean} notSelect If true, Do not automatically select the inserted component.\r\n         * @returns {Element}\r\n         */\r\n        insertComponent: function (element, notHistoryPush, checkCharCount, notSelect) {\r\n            if (this.isReadOnly || (checkCharCount && !this.checkCharCount(element, null))) {\r\n                return null;\r\n            }\r\n\r\n            const r = this.removeNode();\r\n            this.getRange_addLine(this.getRange(), r.container);\r\n            let oNode = null;\r\n            let selectionNode = this.getSelectionNode();\r\n            let formatEl = util.getFormatElement(selectionNode, null);\r\n\r\n            if (util.isListCell(formatEl)) {\r\n                this.insertNode(element, selectionNode === formatEl ? null : r.container.nextSibling, false);\r\n                if (!element.nextSibling) element.parentNode.appendChild(util.createElement('BR'));\r\n            } else {\r\n                if (this.getRange().collapsed && (r.container.nodeType === 3 || util.isBreak(r.container))) {\r\n                    const depthFormat = util.getParentElement(r.container, function (current) { return this.isRangeFormatElement(current); }.bind(util));\r\n                    oNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                    if (oNode) formatEl = oNode.previousSibling;\r\n                }\r\n                this.insertNode(element, util.isRangeFormatElement(formatEl) ? null : formatEl, false);\r\n                if (formatEl && util.onlyZeroWidthSpace(formatEl)) util.removeItem(formatEl);\r\n            }\r\n\r\n            if (!notSelect) {\r\n                this.setRange(element, 0, element, 0);\r\n                \r\n                const fileComponentInfo = this.getFileComponent(element);\r\n                if (fileComponentInfo) {\r\n                    this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n                } else if (oNode) {\r\n                    oNode = util.getEdgeChildNodes(oNode, null).sc || oNode;\r\n                    this.setRange(oNode, 0, oNode, 0);\r\n                }\r\n            }\r\n\r\n            // history stack\r\n            if (!notHistoryPush) this.history.push(1);\r\n\r\n            return oNode || element;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the file component and that plugin name\r\n         * return: {target, component, pluginName} | null\r\n         * @param {Element} element Target element (figure tag, component div, file tag)\r\n         * @returns {Object|null}\r\n         */\r\n        getFileComponent: function (element) {\r\n            if (!this._fileManager.queryString || !element) return null;\r\n\r\n            let target, pluginName;\r\n            if (/^FIGURE$/i.test(element.nodeName) || /se-component/.test(element.className)) {\r\n                target = element.querySelector(this._fileManager.queryString);\r\n            }\r\n            if (!target && element.nodeName && this._fileManager.regExp.test(element.nodeName)) {\r\n                target = element;\r\n            }\r\n\r\n            if (target) {\r\n                pluginName = this._fileManager.pluginMap[target.nodeName.toLowerCase()];\r\n                if (pluginName) {\r\n                    return {\r\n                        target: target,\r\n                        component: util.getParentElement(target, util.isComponent),\r\n                        pluginName: pluginName\r\n                    };\r\n                }\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        /**\r\n         * @description The component(image, video) is selected and the resizing module is called.\r\n         * @param {Element} element Element tag (img, iframe, video)\r\n         * @param {String} pluginName Plugin name (image, video)\r\n         */\r\n        selectComponent: function (element, pluginName) {\r\n            if (util.isUneditableComponent(util.getParentElement(element, util.isComponent)) || util.isUneditableComponent(element)) return false;\r\n            if (!this.hasFocus) this.focus();\r\n            const plugin = this.plugins[pluginName];\r\n            if (!plugin) return;\r\n            _w.setTimeout(function () {\r\n                if (typeof plugin.select === 'function') this.callPlugin(pluginName, plugin.select.bind(this, element), null);\r\n                this._setComponentLineBreaker(element);\r\n            }.bind(this));\r\n        },\r\n\r\n        /**\r\n         * @description Set line breaker of component\r\n         * @param {Element} element Element tag (img, iframe, video)\r\n         * @private\r\n         */\r\n        _setComponentLineBreaker: function (element) {\r\n            // line breaker\r\n            this._lineBreaker.style.display = 'none';\r\n            const container = util.getParentElement(element, util.isComponent);\r\n            const t_style = context.element.lineBreaker_t.style;\r\n            const b_style = context.element.lineBreaker_b.style;\r\n            const target = this.context.resizing.resizeContainer.style.display === 'block' ? this.context.resizing.resizeContainer : element;\r\n\r\n            const isList = util.isListCell(container.parentNode);\r\n            let componentTop, wScroll, w;\r\n            // top\r\n            if (isList ? !container.previousSibling : !util.isFormatElement(container.previousElementSibling)) {\r\n                this._variable._lineBreakComp = container;\r\n                wScroll = context.element.wysiwyg.scrollTop;\r\n                componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\r\n                w = (target.offsetWidth / 2) / 2;\r\n\r\n                t_style.top = (componentTop - wScroll - 12) + 'px';\r\n                t_style.left = (util.getOffset(target).left + w) + 'px';\r\n                t_style.display = 'block';\r\n            } else {\r\n                t_style.display = 'none';\r\n            }\r\n            // bottom\r\n            if (isList ? !container.nextSibling : !util.isFormatElement(container.nextElementSibling)) {\r\n                if (!componentTop) {\r\n                    this._variable._lineBreakComp = container;\r\n                    wScroll = context.element.wysiwyg.scrollTop;\r\n                    componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\r\n                    w = (target.offsetWidth / 2) / 2;\r\n                }\r\n\r\n                b_style.top = (componentTop + target.offsetHeight - wScroll - 12) + 'px';\r\n                b_style.left = (util.getOffset(target).left + target.offsetWidth - w - 24) + 'px';\r\n                b_style.display = 'block';\r\n            } else {\r\n                b_style.display = 'none';\r\n            }\r\n        },\r\n\r\n        _checkDuplicateNode: function (oNode, parentNode) {\r\n            (function recursionFunc(current) {\r\n                core._dupleCheck(current, parentNode);\r\n                const childNodes = current.childNodes;\r\n                for (let i = 0, len = childNodes.length; i < len; i++) {\r\n                    recursionFunc(childNodes[i]);\r\n                }\r\n            })(oNode);\r\n        },\r\n\r\n        _dupleCheck: function (oNode, parentNode) {\r\n            if (!util.isTextStyleElement(oNode)) return;\r\n            \r\n            const oStyles = (oNode.style.cssText.match(/[^;]+;/g) || []).map(function(v){ return v.trim(); });\r\n            const nodeName = oNode.nodeName;\r\n            if (/^span$/i.test(nodeName) && oStyles.length === 0) return oNode;\r\n\r\n            let duple = false;\r\n            (function recursionFunc(ancestor) {\r\n                if (util.isWysiwygDiv(ancestor) || !util.isTextStyleElement(ancestor)) return;\r\n                if (ancestor.nodeName === nodeName) {\r\n                    duple = true;\r\n                    const styles = ancestor.style.cssText.match(/[^;]+;/g) || [];\r\n                    for (let i = 0, len = styles.length, j; i < len; i++) {\r\n                        if ((j = oStyles.indexOf(styles[i].trim())) > -1) {\r\n                            oStyles.splice(j, 1);\r\n                        }\r\n                    }\r\n                    for (let i = 0, len = ancestor.classList.length; i < len; i++) {\r\n                        oNode.classList.remove(ancestor.classList[i]);\r\n                    }\r\n                }\r\n\r\n                recursionFunc(ancestor.parentElement);\r\n            })(parentNode);\r\n\r\n            if (duple) {\r\n                if (!(oNode.style.cssText = oStyles.join(' '))) {\r\n                    oNode.setAttribute('style', '');\r\n                    oNode.removeAttribute('style');\r\n                }\r\n                if (!oNode.attributes.length) {\r\n                    oNode.setAttribute('data-se-duple', 'true');\r\n                }\r\n            }\r\n\r\n            return oNode;\r\n        },\r\n\r\n        /**\r\n         * @description Delete selected node and insert argument value node and return.\r\n         * If the \"afterNode\" exists, it is inserted after the \"afterNode\"\r\n         * Inserting a text node merges with both text nodes on both sides and returns a new \"{ container, startOffset, endOffset }\".\r\n         * @param {Node} oNode Element to be inserted\r\n         * @param {Node|null} afterNode If the node exists, it is inserted after the node\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @returns {Object|Node|null}\r\n         */\r\n        insertNode: function (oNode, afterNode, checkCharCount) {\r\n            if (this.isReadOnly || (checkCharCount && !this.checkCharCount(oNode, null))) {\r\n                return null;\r\n            }\r\n\r\n            let range = this.getRange();\r\n            let line = util.isListCell(range.commonAncestorContainer) ? range.commonAncestorContainer : util.getFormatElement(this.getSelectionNode(), null);\r\n            let insertListCell = util.isListCell(line) && (util.isListCell(oNode) || util.isList(oNode));\r\n            \r\n            let parentNode, originAfter, tempAfterNode, tempParentNode = null;\r\n            const freeFormat = util.isFreeFormatElement(line);\r\n            const isFormats = (!freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) || util.isComponent(oNode);\r\n\r\n            if (insertListCell) {\r\n                tempAfterNode = afterNode || util.isList(oNode) ? line.lastChild : line.nextElementSibling;\r\n                tempParentNode = util.isList(oNode) ? line : (tempAfterNode || line).parentNode;\r\n            }\r\n\r\n            if (!afterNode && (isFormats || util.isComponent(oNode) || util.isMedia(oNode))) {\r\n                const isEdge = this.isEdgePoint(range.endContainer, range.endOffset, 'end');\r\n                const r = this.removeNode();\r\n                const container = r.container;\r\n                const prevContainer = (container === r.prevContainer && range.collapsed) ? null : r.prevContainer;\r\n\r\n                if (insertListCell && prevContainer) {\r\n                    tempParentNode = prevContainer.nodeType === 3 ? prevContainer.parentNode : prevContainer;\r\n                    if (tempParentNode.contains(container)) {\r\n                        let sameParent = true;\r\n                        tempAfterNode = container;\r\n                        while (tempAfterNode.parentNode && tempAfterNode.parentNode !== tempParentNode) {\r\n                            tempAfterNode = tempAfterNode.parentNode;\r\n                            sameParent = false;\r\n                        }\r\n                        if (sameParent && container === prevContainer) tempAfterNode = tempAfterNode.nextSibling;\r\n                    } else {\r\n                        tempAfterNode = null;\r\n                    }\r\n                } else if (insertListCell && util.isListCell(container) && !line.parentElement) {\r\n                    line = util.createElement('LI');\r\n                    tempParentNode.appendChild(line);\r\n                    container.appendChild(tempParentNode);\r\n                    tempAfterNode = null;\r\n                } else if (container.nodeType === 3 || util.isBreak(container) || insertListCell) {\r\n                    const depthFormat = util.getParentElement(container, function (current) { return this.isRangeFormatElement(current) || this.isListCell(current); }.bind(util));\r\n                    afterNode = util.splitElement(container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                    if (afterNode) {\r\n                        if (insertListCell) {\r\n                            if (line.contains(container)) {\r\n                                const subList = util.isList(line.lastElementChild);\r\n                                let newCell = null;\r\n                                if (!isEdge) {\r\n                                    newCell = line.cloneNode(false);\r\n                                    newCell.appendChild(afterNode.textContent.trim() ? afterNode : util.createTextNode(util.zeroWidthSpace));\r\n                                }\r\n                                if (subList) {\r\n                                    if (!newCell) {\r\n                                        newCell = line.cloneNode(false);\r\n                                        newCell.appendChild(util.createTextNode(util.zeroWidthSpace));\r\n                                    }\r\n                                    newCell.appendChild(line.lastElementChild);\r\n                                }\r\n                                if (newCell) {\r\n                                    line.parentNode.insertBefore(newCell, line.nextElementSibling);\r\n                                    tempAfterNode = afterNode = newCell;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            afterNode = afterNode.previousSibling;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            range = (!afterNode && !isFormats) ? this.getRange_addLine(this.getRange(), null) : this.getRange();\r\n            const commonCon = range.commonAncestorContainer;\r\n            const startOff = range.startOffset;\r\n            const endOff = range.endOffset;\r\n            const formatRange = range.startContainer === commonCon && util.isFormatElement(commonCon);\r\n            const startCon = formatRange ? (commonCon.childNodes[startOff] || commonCon.childNodes[0] || range.startContainer) : range.startContainer;\r\n            const endCon = formatRange ? (commonCon.childNodes[endOff] || commonCon.childNodes[commonCon.childNodes.length - 1] || range.endContainer) : range.endContainer;\r\n\r\n            if (!insertListCell) {\r\n                if (!afterNode) {\r\n                    parentNode = startCon;\r\n                    if (startCon.nodeType === 3) {\r\n                        parentNode = startCon.parentNode;\r\n                    }\r\n    \r\n                    /** No Select range node */\r\n                    if (range.collapsed) {\r\n                        if (commonCon.nodeType === 3) {\r\n                            if (commonCon.textContent.length > endOff) afterNode = commonCon.splitText(endOff);\r\n                            else afterNode = commonCon.nextSibling;\r\n                        } else {\r\n                            if (!util.isBreak(parentNode)) {\r\n                                let c = parentNode.childNodes[startOff];\r\n                                const focusNode = (c && c.nodeType === 3 && util.onlyZeroWidthSpace(c) && util.isBreak(c.nextSibling)) ? c.nextSibling : c;\r\n                                if (focusNode) {\r\n                                    if (!focusNode.nextSibling && util.isBreak(focusNode)) {\r\n                                        parentNode.removeChild(focusNode);\r\n                                        afterNode = null;\r\n                                    } else {\r\n                                        afterNode = (util.isBreak(focusNode) && !util.isBreak(oNode)) ? focusNode : focusNode.nextSibling;\r\n                                    }\r\n                                } else {\r\n                                    afterNode = null;\r\n                                }\r\n                            } else {\r\n                                afterNode = parentNode;\r\n                                parentNode = parentNode.parentNode;\r\n                            }\r\n                        }\r\n                    } else { /** Select range nodes */\r\n                        const isSameContainer = startCon === endCon;\r\n                        if (isSameContainer) {\r\n                            if (this.isEdgePoint(endCon, endOff)) afterNode = endCon.nextSibling;\r\n                            else afterNode = endCon.splitText(endOff);\r\n    \r\n                            let removeNode = startCon;\r\n                            if (!this.isEdgePoint(startCon, startOff)) removeNode = startCon.splitText(startOff);\r\n    \r\n                            parentNode.removeChild(removeNode);\r\n                            if (parentNode.childNodes.length === 0 && isFormats) {\r\n                                parentNode.innerHTML = '<br>';\r\n                            }\r\n                        }\r\n                        else {\r\n                            const removedTag = this.removeNode();\r\n                            const container = removedTag.container;\r\n                            const prevContainer = removedTag.prevContainer;\r\n\r\n                            if (container && container.childNodes.length === 0 && isFormats) {\r\n                                if (util.isFormatElement(container)) {\r\n                                    container.innerHTML = '<br>';\r\n                                } else if (util.isRangeFormatElement(container)) {\r\n                                    container.innerHTML = '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n                                }\r\n                            }\r\n    \r\n                            if (util.isListCell(container) && oNode.nodeType === 3) {\r\n                                parentNode = container;\r\n                                afterNode = null;\r\n                            } else if (!isFormats && prevContainer) {\r\n                                parentNode = prevContainer.nodeType === 3 ? prevContainer.parentNode : prevContainer;\r\n                                if (parentNode.contains(container)) {\r\n                                    let sameParent = true;\r\n                                    afterNode = container;\r\n                                    while (afterNode.parentNode && afterNode.parentNode !== parentNode) {\r\n                                        afterNode = afterNode.parentNode;\r\n                                        sameParent = false;\r\n                                    }\r\n                                    if (sameParent && container === prevContainer) afterNode = afterNode.nextSibling;\r\n                                } else {\r\n                                    afterNode = null;\r\n                                }\r\n                            } else {\r\n                                afterNode = isFormats ? endCon : container === prevContainer ? container.nextSibling : container;\r\n                                parentNode = (!afterNode || !afterNode.parentNode) ? commonCon : afterNode.parentNode;\r\n                            }\r\n    \r\n                            while (afterNode && !util.isFormatElement(afterNode) && afterNode.parentNode !== commonCon) {\r\n                                afterNode = afterNode.parentNode;\r\n                            }\r\n                        }\r\n                    }\r\n                } else { // has afterNode\r\n                    parentNode = afterNode.parentNode;\r\n                    afterNode = afterNode.nextSibling;\r\n                    originAfter = true;\r\n                }\r\n            }\r\n\r\n            try {\r\n                // set node\r\n                if (!insertListCell) {\r\n                    if (util.isWysiwygDiv(afterNode) || parentNode === context.element.wysiwyg.parentNode) {\r\n                        parentNode = context.element.wysiwyg;\r\n                        afterNode = null;\r\n                    }\r\n    \r\n                    if (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode) || (!util.isListCell(parentNode) && util.isComponent(oNode))) {\r\n                        const oldParent = parentNode;\r\n                        if (util.isList(afterNode)) {\r\n                            parentNode = afterNode;\r\n                            afterNode = null;\r\n                        } else if (util.isListCell(afterNode)) {\r\n                            parentNode = afterNode.previousElementSibling || afterNode;\r\n                        } else if (!originAfter && !afterNode) {\r\n                            const r = this.removeNode();\r\n                            const container = r.container.nodeType === 3 ? (util.isListCell(util.getFormatElement(r.container, null)) ? r.container : (util.getFormatElement(r.container, null) || r.container.parentNode)) : r.container;\r\n                            const rangeCon = util.isWysiwygDiv(container) || util.isRangeFormatElement(container);\r\n                            parentNode = rangeCon ? container : container.parentNode;\r\n                            afterNode = rangeCon ? null : container.nextSibling;\r\n                        }\r\n    \r\n                        if (oldParent.childNodes.length === 0 && parentNode !== oldParent) util.removeItem(oldParent);\r\n                    }\r\n    \r\n                    if (isFormats && !freeFormat && !util.isRangeFormatElement(parentNode) && !util.isListCell(parentNode) && !util.isWysiwygDiv(parentNode)) {\r\n                        afterNode = parentNode.nextElementSibling;\r\n                        parentNode = parentNode.parentNode;\r\n                    }\r\n    \r\n                    if (util.isWysiwygDiv(parentNode) && (oNode.nodeType === 3 || util.isBreak(oNode))) {\r\n                        const fNode = util.createElement(options.defaultTag);\r\n                        fNode.appendChild(oNode);\r\n                        oNode = fNode;\r\n                    }\r\n                }\r\n\r\n                // insert--\r\n                if (insertListCell) {\r\n                    if (!tempParentNode.parentNode) {\r\n                        parentNode = context.element.wysiwyg;\r\n                        afterNode = null;\r\n                    } else {\r\n                        parentNode = tempParentNode;\r\n                        afterNode = tempAfterNode;\r\n                    }\r\n                } else {\r\n                    afterNode = parentNode === afterNode ? parentNode.lastChild : afterNode;\r\n                }\r\n\r\n                if (util.isListCell(oNode) && !util.isList(parentNode)) {\r\n                    if (util.isListCell(parentNode)) {\r\n                        afterNode = parentNode.nextElementSibling;\r\n                        parentNode = parentNode.parentNode;\r\n                    } else {\r\n                        const ul = util.createElement('ol');\r\n                        parentNode.insertBefore(ul, afterNode);\r\n                        parentNode = ul;\r\n                        afterNode = null;\r\n                    }\r\n                    insertListCell = true;\r\n                }\r\n\r\n                this._checkDuplicateNode(oNode, parentNode);\r\n                parentNode.insertBefore(oNode, afterNode);\r\n\r\n                if (insertListCell) {\r\n                    if (util.onlyZeroWidthSpace(line.textContent.trim())) {\r\n                        util.removeItem(line);\r\n                        oNode = oNode.lastChild;\r\n                    } else {\r\n                        const chList = util.getArrayItem(line.children, util.isList);\r\n                        if (chList) {\r\n                            if (oNode !== chList) {\r\n                                oNode.appendChild(chList);\r\n                                oNode = chList.previousSibling;\r\n                            } else {\r\n                                parentNode.appendChild(oNode);\r\n                                oNode = parentNode;\r\n                            }\r\n\r\n                            if (util.onlyZeroWidthSpace(line.textContent.trim())) {\r\n                                util.removeItem(line);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                parentNode.appendChild(oNode);\r\n                console.warn('[SUNEDITOR.insertNode.warn] ' + error);\r\n            } finally {\r\n                const dupleNodes = parentNode.querySelectorAll('[data-se-duple]');\r\n                if (dupleNodes.length > 0) {\r\n                    for (let i = 0, len = dupleNodes.length, d, c, ch, parent; i < len; i++) {\r\n                        d = dupleNodes[i];\r\n                        ch = d.childNodes;\r\n                        parent = d.parentNode;\r\n\r\n                        while (ch[0]) {\r\n                            c = ch[0];\r\n                            parent.insertBefore(c, d);\r\n                        }\r\n\r\n                        if (d === oNode) oNode = c;\r\n                        util.removeItem(d);\r\n                    }\r\n                }\r\n\r\n                if ((util.isFormatElement(oNode) || util.isComponent(oNode)) && startCon === endCon) {\r\n                    const cItem = util.getFormatElement(commonCon, null);\r\n                    if (cItem && cItem.nodeType === 1 && util.isEmptyLine(cItem)) {\r\n                        util.removeItem(cItem);\r\n                    }\r\n                }\r\n\r\n                if (freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) {\r\n                    oNode = this._setIntoFreeFormat(oNode);\r\n                }\r\n\r\n                if (!util.isComponent(oNode)) {\r\n                    let offset = 1;\r\n                    if (oNode.nodeType === 3) {\r\n                        const previous = oNode.previousSibling;\r\n                        const next = oNode.nextSibling;\r\n                        const previousText = (!previous ||  previous.nodeType === 1 || util.onlyZeroWidthSpace(previous)) ? '' : previous.textContent;\r\n                        const nextText = (!next || next.nodeType === 1 || util.onlyZeroWidthSpace(next)) ? '' : next.textContent;\r\n        \r\n                        if (previous && previousText.length > 0) {\r\n                            oNode.textContent = previousText + oNode.textContent;\r\n                            util.removeItem(previous);\r\n                        }\r\n        \r\n                        if (next && next.length > 0) {\r\n                            oNode.textContent += nextText;\r\n                            util.removeItem(next);\r\n                        }\r\n\r\n                        const newRange = {\r\n                            container: oNode,\r\n                            startOffset: previousText.length,\r\n                            endOffset: oNode.textContent.length - nextText.length\r\n                        };\r\n\r\n                        this.setRange(oNode, newRange.startOffset, oNode, newRange.endOffset);\r\n    \r\n                        return newRange;\r\n                    } else if (!util.isBreak(oNode) && !util.isListCell(oNode) && util.isFormatElement(parentNode)) {\r\n                        let zeroWidth = null;\r\n                        if (!oNode.previousSibling || util.isBreak(oNode.previousSibling)) {\r\n                            zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                            oNode.parentNode.insertBefore(zeroWidth, oNode);\r\n                        }\r\n                        \r\n                        if (!oNode.nextSibling || util.isBreak(oNode.nextSibling)) {\r\n                            zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                            oNode.parentNode.insertBefore(zeroWidth, oNode.nextSibling);\r\n                        }\r\n    \r\n                        if (util._isIgnoreNodeChange(oNode)) {\r\n                            oNode = oNode.nextSibling;\r\n                            offset = 0;\r\n                        }\r\n                    }\r\n    \r\n                    this.setRange(oNode, offset, oNode, offset);\r\n                }\r\n\r\n                // history stack\r\n                this.history.push(true);\r\n\r\n                return oNode;\r\n            }\r\n        },\r\n\r\n        _setIntoFreeFormat: function (oNode) {\r\n            const parentNode = oNode.parentNode;\r\n            let oNodeChildren, lastONode;\r\n            \r\n            while (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) {\r\n                oNodeChildren = oNode.childNodes;\r\n                lastONode = null;\r\n                \r\n                while (oNodeChildren[0]) {\r\n                    lastONode = oNodeChildren[0];\r\n                    if (util.isFormatElement(lastONode) || util.isRangeFormatElement(lastONode)) {\r\n                        this._setIntoFreeFormat(lastONode);\r\n                        if (!oNode.parentNode) break;\r\n                        oNodeChildren = oNode.childNodes;\r\n                        continue;\r\n                    }\r\n                    \r\n                    parentNode.insertBefore(lastONode, oNode);\r\n                }\r\n                \r\n                if (oNode.childNodes.length === 0) util.removeItem(oNode);\r\n                oNode = util.createElement('BR');\r\n                parentNode.insertBefore(oNode, lastONode.nextSibling);\r\n            }\r\n\r\n            return oNode;\r\n        },\r\n\r\n        /**\r\n         * @description Delete the currently selected nodes and reset selection range\r\n         * Returns {container: \"the last element after deletion\", offset: \"offset\", prevContainer: \"previousElementSibling Of the deleted area\"}\r\n         * @returns {Object}\r\n         */\r\n        removeNode: function () {\r\n            this._resetRangeToTextNode();\r\n\r\n            const range = this.getRange();\r\n            let container, offset = 0;\r\n            let startCon = range.startContainer;\r\n            let endCon = range.endContainer;\r\n            let startOff = range.startOffset;\r\n            let endOff = range.endOffset;\r\n            const commonCon = (range.commonAncestorContainer.nodeType === 3 && range.commonAncestorContainer.parentNode === startCon.parentNode) ? startCon.parentNode : range.commonAncestorContainer;\r\n            if (commonCon === startCon && commonCon === endCon) {\r\n                startCon = commonCon.children[startOff];\r\n                endCon = commonCon.children[endOff];\r\n                startOff = endOff = 0;\r\n            }\r\n\r\n            if (startCon === endCon && range.collapsed) {\r\n                if (startCon.textContent && util.onlyZeroWidthSpace(startCon.textContent.substr(startOff))) {\r\n                    return {\r\n                        container: startCon,\r\n                        offset: offset,\r\n                        prevContainer: startCon && startCon.parentNode ? startCon : null\r\n                    };\r\n                }\r\n            }\r\n\r\n            let beforeNode = null;\r\n            let afterNode = null;\r\n\r\n            const childNodes = util.getListChildNodes(commonCon, null);\r\n            let startIndex = util.getArrayIndex(childNodes, startCon);\r\n            let endIndex = util.getArrayIndex(childNodes, endCon);\r\n\r\n            if (childNodes.length > 0 && startIndex > -1 && endIndex > -1) {\r\n                for (let i = startIndex + 1, startNode = startCon; i >= 0; i--) {\r\n                    if (childNodes[i] === startNode.parentNode && childNodes[i].firstChild === startNode && startOff === 0) {\r\n                        startIndex = i;\r\n                        startNode = startNode.parentNode;\r\n                    }\r\n                }\r\n    \r\n                for (let i = endIndex - 1, endNode = endCon; i > startIndex; i--) {\r\n                    if (childNodes[i] === endNode.parentNode && childNodes[i].nodeType === 1) {\r\n                        childNodes.splice(i, 1);\r\n                        endNode = endNode.parentNode;\r\n                        --endIndex;\r\n                    }\r\n                }\r\n            } else {\r\n                if (childNodes.length === 0) {\r\n                    if (util.isFormatElement(commonCon) || util.isRangeFormatElement(commonCon) || util.isWysiwygDiv(commonCon) || util.isBreak(commonCon) || util.isMedia(commonCon)) {\r\n                        return {\r\n                            container: commonCon,\r\n                            offset: 0\r\n                        };\r\n                    } else if (commonCon.nodeType === 3) {\r\n                        return {\r\n                            container: commonCon,\r\n                            offset: endOff\r\n                        };\r\n                    }\r\n                    childNodes.push(commonCon);\r\n                    startCon = endCon = commonCon;\r\n                } else {\r\n                    startCon = endCon = childNodes[0];\r\n                    if (util.isBreak(startCon) || util.onlyZeroWidthSpace(startCon)) {\r\n                        return {\r\n                            container: util.isMedia(commonCon) ? commonCon : startCon,\r\n                            offset: 0\r\n                        };\r\n                    }\r\n                }\r\n\r\n                startIndex = endIndex = 0;\r\n            }\r\n\r\n            for (let i = startIndex; i <= endIndex; i++) {\r\n                const item = childNodes[i];\r\n\r\n                if (item.length === 0 || (item.nodeType === 3 && item.data === undefined)) {\r\n                    this._nodeRemoveListItem(item);\r\n                    continue;\r\n                }\r\n\r\n                if (item === startCon) {\r\n                    if (startCon.nodeType === 1) {\r\n                        if (util.isComponent(startCon)) continue;\r\n                        else beforeNode = util.createTextNode(startCon.textContent);\r\n                    } else {\r\n                        if (item === endCon) {\r\n                            beforeNode = util.createTextNode(startCon.substringData(0, startOff) + endCon.substringData(endOff, (endCon.length - endOff)));\r\n                            offset = startOff;\r\n                        } else {\r\n                            beforeNode = util.createTextNode(startCon.substringData(0, startOff));\r\n                        }\r\n                    }\r\n\r\n                    if (beforeNode.length > 0) {\r\n                        startCon.data = beforeNode.data;\r\n                    } else {\r\n                        this._nodeRemoveListItem(startCon);\r\n                    }\r\n\r\n                    if (item === endCon) break;\r\n                    continue;\r\n                }\r\n\r\n                if (item === endCon) {\r\n                    if (endCon.nodeType === 1) {\r\n                        if (util.isComponent(endCon)) continue;\r\n                        else afterNode = util.createTextNode(endCon.textContent);\r\n                    } else {\r\n                        afterNode = util.createTextNode(endCon.substringData(endOff, (endCon.length - endOff)));\r\n                    }\r\n\r\n                    if (afterNode.length > 0) {\r\n                        endCon.data = afterNode.data;\r\n                    } else {\r\n                        this._nodeRemoveListItem(endCon);\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                this._nodeRemoveListItem(item);\r\n            }\r\n\r\n            const endUl = util.getParentElement(endCon, 'ul');\r\n            const startLi = util.getParentElement(startCon, 'li');\r\n            if (endUl && startLi && startLi.contains(endUl)) {\r\n                container = endUl.previousSibling;\r\n                offset = container.textContent.length;\r\n            } else {\r\n                container = endCon && endCon.parentNode ? endCon : startCon && startCon.parentNode ? startCon : (range.endContainer || range.startContainer);\r\n            }\r\n            \r\n            if (!util.isWysiwygDiv(container) && container.childNodes.length === 0) {\r\n                const rc = util.removeItemAllParents(container, null, null);\r\n                if (rc) container = rc.sc || rc.ec || context.element.wysiwyg;\r\n            }\r\n\r\n            // set range\r\n            this.setRange(container, offset, container, offset);\r\n            // history stack\r\n            this.history.push(true);\r\n\r\n            return {\r\n                container: container,\r\n                offset: offset,\r\n                prevContainer: startCon && startCon.parentNode ? startCon : null\r\n            };\r\n        },\r\n\r\n        _nodeRemoveListItem: function (item) {\r\n            const format = util.getFormatElement(item, null);\r\n            util.removeItem(item);\r\n\r\n            if(!util.isListCell(format)) return;\r\n            \r\n            util.removeItemAllParents(format, null, null);\r\n\r\n            if (format && util.isList(format.firstChild)) {\r\n                format.insertBefore(util.createTextNode(util.zeroWidthSpace), format.firstChild);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Appended all selected format Element to the argument element and insert\r\n         * @param {Element} rangeElement Element of wrap the arguments (BLOCKQUOTE...)\r\n         */\r\n        applyRangeFormatElement: function (rangeElement) {\r\n            this.getRange_addLine(this.getRange(), null);\r\n            const rangeLines = this.getSelectedElementsAndComponents(false);\r\n            if (!rangeLines || rangeLines.length === 0) return;\r\n\r\n            linesLoop:\r\n            for (let i = 0, len = rangeLines.length, line, nested, fEl, lEl, f, l; i < len; i++) {\r\n                line = rangeLines[i];\r\n                if (!util.isListCell(line)) continue;\r\n\r\n                nested = line.lastElementChild;\r\n                if (nested && util.isListCell(line.nextElementSibling) && rangeLines.indexOf(line.nextElementSibling) > -1) {\r\n                    lEl = nested.lastElementChild;\r\n                    if (rangeLines.indexOf(lEl) > -1) {\r\n                        let list = null;\r\n                        while ((list = lEl.lastElementChild)) {\r\n                            if (util.isList(list)) {\r\n                                if (rangeLines.indexOf(list.lastElementChild) > -1) {\r\n                                    lEl = list.lastElementChild;\r\n                                } else {\r\n                                    continue linesLoop;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        fEl = nested.firstElementChild;\r\n                        f = rangeLines.indexOf(fEl);\r\n                        l = rangeLines.indexOf(lEl);\r\n                        rangeLines.splice(f, (l - f) + 1);\r\n                        len = rangeLines.length;\r\n                        continue;\r\n                    }\r\n                }\r\n            }\r\n\r\n            let last  = rangeLines[rangeLines.length - 1];\r\n            let standTag, beforeTag, pElement;\r\n\r\n            if (util.isRangeFormatElement(last) || util.isFormatElement(last)) {\r\n                standTag = last;\r\n            } else {\r\n                standTag = util.getRangeFormatElement(last, null) || util.getFormatElement(last, null);\r\n            }\r\n\r\n            if (util.isCell(standTag)) {\r\n                beforeTag = null;\r\n                pElement = standTag;\r\n            } else {\r\n                beforeTag = standTag.nextSibling;\r\n                pElement = standTag.parentNode;\r\n            }\r\n            \r\n            let parentDepth = util.getElementDepth(standTag);\r\n            let listParent = null;\r\n            const lineArr = [];\r\n            const removeItems = function (parent, origin, before) {\r\n                let cc = null;\r\n                if (parent !== origin && !util.isTable(origin)) {\r\n                    if (origin && util.getElementDepth(parent) === util.getElementDepth(origin)) return before;\r\n                    cc = util.removeItemAllParents(origin, null, parent);\r\n                }\r\n\r\n                return cc ? cc.ec : before;\r\n            };\r\n            \r\n            for (let i = 0, len = rangeLines.length, line, originParent, depth, before, nextLine, nextList, nested; i < len; i++) {\r\n                line = rangeLines[i];\r\n                originParent = line.parentNode;\r\n                if (!originParent || rangeElement.contains(originParent)) continue;\r\n\r\n                depth = util.getElementDepth(line);\r\n\r\n                if (util.isList(originParent)) {\r\n                    if (listParent === null) {\r\n                        if (nextList) {\r\n                            listParent = nextList;\r\n                            nested = true;\r\n                            nextList = null;\r\n                        } else {\r\n                            listParent = originParent.cloneNode(false);\r\n                        }\r\n                    }\r\n\r\n                    lineArr.push(line);\r\n                    nextLine = rangeLines[i + 1];\r\n\r\n                    if (i === len - 1 || (nextLine && nextLine.parentNode !== originParent)) {\r\n                        // nested list\r\n                        if (nextLine && line.contains(nextLine.parentNode)) {\r\n                            nextList = nextLine.parentNode.cloneNode(false);\r\n                        }\r\n\r\n                        let list = originParent.parentNode, p;\r\n                        while (util.isList(list)) {\r\n                            p = util.createElement(list.nodeName);\r\n                            p.appendChild(listParent);\r\n                            listParent = p;\r\n                            list = list.parentNode;\r\n                        }\r\n\r\n                        const edge = this.detachRangeFormatElement(originParent, lineArr, null, true, true);\r\n\r\n                        if (parentDepth >= depth) {\r\n                            parentDepth = depth;\r\n                            pElement = edge.cc;\r\n                            beforeTag = removeItems(pElement, originParent, edge.ec);\r\n                            if (beforeTag) pElement = beforeTag.parentNode;\r\n                        } else if (pElement === edge.cc) {\r\n                            beforeTag = edge.ec;\r\n                        }\r\n\r\n                        if (pElement !== edge.cc) {\r\n                            before = removeItems(pElement, edge.cc, before);\r\n                            if (before !== undefined) beforeTag = before;\r\n                            else beforeTag = edge.cc;\r\n                        }\r\n\r\n                        for (let c = 0, cLen = edge.removeArray.length; c < cLen; c++) {\r\n                            listParent.appendChild(edge.removeArray[c]);\r\n                        }\r\n\r\n                        if (!nested) rangeElement.appendChild(listParent);\r\n                        if (nextList) edge.removeArray[edge.removeArray.length - 1].appendChild(nextList);\r\n                        listParent = null;\r\n                        nested = false;\r\n                    }\r\n                } else {\r\n                    if (parentDepth >= depth) {\r\n                        parentDepth = depth;\r\n                        pElement = originParent;\r\n                        beforeTag = line.nextSibling;\r\n                    }\r\n                    \r\n                    rangeElement.appendChild(line);\r\n\r\n                    if (pElement !== originParent) {\r\n                        before = removeItems(pElement, originParent);\r\n                        if (before !== undefined) beforeTag = before;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.effectNode = null;\r\n            util.mergeSameTags(rangeElement, null, false);\r\n            util.mergeNestedTags(rangeElement, function (current) { return this.isList(current); }.bind(util));\r\n\r\n            // Nested list\r\n            if (beforeTag && util.getElementDepth(beforeTag) > 0 && (util.isList(beforeTag.parentNode) || util.isList(beforeTag.parentNode.parentNode))) {\r\n                const depthFormat = util.getParentElement(beforeTag, function (current) { return this.isRangeFormatElement(current) && !this.isList(current); }.bind(util));\r\n                const splitRange = util.splitElement(beforeTag, null, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                splitRange.parentNode.insertBefore(rangeElement, splitRange);\r\n            } else { // basic\r\n                pElement.insertBefore(rangeElement, beforeTag);\r\n                removeItems(rangeElement, beforeTag);\r\n            }\r\n\r\n            const edge = util.getEdgeChildNodes(rangeElement.firstElementChild, rangeElement.lastElementChild);\r\n            if (rangeLines.length > 1) {\r\n                this.setRange(edge.sc, 0, edge.ec, edge.ec.textContent.length);\r\n            } else {\r\n                this.setRange(edge.ec, edge.ec.textContent.length, edge.ec, edge.ec.textContent.length);\r\n            }\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description The elements of the \"selectedFormats\" array are detached from the \"rangeElement\" element. (\"LI\" tags are converted to \"P\" tags)\r\n         * When \"selectedFormats\" is null, all elements are detached and return {cc: parentNode, sc: nextSibling, ec: previousSibling, removeArray: [Array of removed elements]}.\r\n         * @param {Element} rangeElement Range format element (PRE, BLOCKQUOTE, OL, UL...)\r\n         * @param {Array|null} selectedFormats Array of format elements (P, DIV, LI...) to remove.\r\n         * If null, Applies to all elements and return {cc: parentNode, sc: nextSibling, ec: previousSibling}\r\n         * @param {Element|null} newRangeElement The node(rangeElement) to replace the currently wrapped node.\r\n         * @param {Boolean} remove If true, deleted without detached.\r\n         * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n         * @returns {Object}\r\n         */\r\n        detachRangeFormatElement: function (rangeElement, selectedFormats, newRangeElement, remove, notHistoryPush) {\r\n            const range = this.getRange();\r\n            const so = range.startOffset;\r\n            const eo = range.endOffset;\r\n\r\n            let children = util.getListChildNodes(rangeElement, function (current) { return current.parentNode === rangeElement; });\r\n            let parent = rangeElement.parentNode;\r\n            let firstNode = null;\r\n            let lastNode = null;\r\n            let rangeEl = rangeElement.cloneNode(false);\r\n            \r\n            const removeArray = [];\r\n            const newList = util.isList(newRangeElement);\r\n            let insertedNew = false;\r\n            let reset = false;\r\n            let moveComplete = false;\r\n\r\n            function appendNode (parent, insNode, sibling, originNode) {\r\n                if (util.onlyZeroWidthSpace(insNode)) insNode.innerHTML = util.zeroWidthSpace;\r\n\r\n                if (insNode.nodeType === 3) {\r\n                    parent.insertBefore(insNode, sibling);\r\n                    return insNode;\r\n                }\r\n                \r\n                const insChildren = (moveComplete ? insNode : originNode).childNodes;\r\n                let format = insNode.cloneNode(false);\r\n                let first = null;\r\n                let c = null;\r\n\r\n                while (insChildren[0]) {\r\n                    c = insChildren[0];\r\n                    if (util._notTextNode(c) && !util.isBreak(c) && !util.isListCell(format)) {\r\n                        if (format.childNodes.length > 0) {\r\n                            if (!first) first = format;\r\n                            parent.insertBefore(format, sibling);\r\n                            format = insNode.cloneNode(false);\r\n                        }\r\n                        parent.insertBefore(c, sibling);\r\n                        if (!first) first = c;\r\n                    } else {\r\n                        format.appendChild(c);\r\n                    }\r\n                }\r\n\r\n                if (format.childNodes.length > 0) {\r\n                    if (util.isListCell(parent) && util.isListCell(format) && util.isList(sibling)) {\r\n                        if (newList) {\r\n                            first = sibling;\r\n                            while(sibling) {\r\n                                format.appendChild(sibling);\r\n                                sibling = sibling.nextSibling;\r\n                            }\r\n                            parent.parentNode.insertBefore(format, parent.nextElementSibling);\r\n                        } else {\r\n                            const originNext = originNode.nextElementSibling;\r\n                            const detachRange = util.detachNestedList(originNode, false);\r\n                            if ((rangeElement !== detachRange) || (originNext !== originNode.nextElementSibling)) {\r\n                                const fChildren = format.childNodes;\r\n                                while (fChildren[0]) {\r\n                                    originNode.appendChild(fChildren[0]);\r\n                                }\r\n\r\n                                rangeElement = detachRange;\r\n                                reset = true;\r\n                            }\r\n                        }\r\n                    } else {\r\n                        parent.insertBefore(format, sibling);\r\n                    }\r\n\r\n                    if (!first) first = format;\r\n                }\r\n\r\n                return first;\r\n            }\r\n\r\n            // detach loop\r\n            for (let i = 0, len = children.length, insNode, lineIndex, next; i < len; i++) {\r\n                insNode = children[i];\r\n                if (insNode.nodeType === 3 && util.isList(rangeEl)) continue;\r\n                \r\n                moveComplete = false;\r\n                if (remove && i === 0) {\r\n                    if (!selectedFormats || selectedFormats.length === len || selectedFormats[0] === insNode) {\r\n                        firstNode = rangeElement.previousSibling;\r\n                    } else {\r\n                        firstNode = rangeEl;\r\n                    }\r\n                }\r\n\r\n                if (selectedFormats) lineIndex = selectedFormats.indexOf(insNode);\r\n                if (selectedFormats && lineIndex === -1) {\r\n                    if (!rangeEl) rangeEl = rangeElement.cloneNode(false);\r\n                    rangeEl.appendChild(insNode);\r\n                } else {\r\n                    if (selectedFormats) next = selectedFormats[lineIndex + 1];\r\n                    if (rangeEl && rangeEl.children.length > 0) {\r\n                        parent.insertBefore(rangeEl, rangeElement);\r\n                        rangeEl = null;\r\n                    }\r\n\r\n                    if (!newList && util.isListCell(insNode)) {\r\n                        if (next && util.getElementDepth(insNode) !== util.getElementDepth(next) && (util.isListCell(parent) || util.getArrayItem(insNode.children, util.isList, false))) {\r\n                            const insNext = insNode.nextElementSibling;\r\n                            const detachRange = util.detachNestedList(insNode, false);\r\n                            if ((rangeElement !== detachRange) || insNext !== insNode.nextElementSibling) {\r\n                                rangeElement = detachRange;\r\n                                reset = true;\r\n                            }\r\n                        } else {\r\n                            const inner = insNode;\r\n                            insNode = util.createElement(remove ? inner.nodeName : (util.isList(rangeElement.parentNode) || util.isListCell(rangeElement.parentNode)) ? 'LI' : util.isCell(rangeElement.parentNode) ? 'DIV' : options.defaultTag);\r\n                            const isCell = util.isListCell(insNode);\r\n                            const innerChildren = inner.childNodes;\r\n                            while (innerChildren[0]) {\r\n                                if (util.isList(innerChildren[0]) && !isCell) break;\r\n                                insNode.appendChild(innerChildren[0]);\r\n                            }\r\n                            util.copyFormatAttributes(insNode, inner);\r\n                            moveComplete = true;\r\n                        }\r\n                    } else {\r\n                        insNode = insNode.cloneNode(false);\r\n                    }\r\n\r\n                    if (!reset) {\r\n                        if (!remove) {\r\n                            if (newRangeElement) {\r\n                                if (!insertedNew) {\r\n                                    parent.insertBefore(newRangeElement, rangeElement);\r\n                                    insertedNew = true;\r\n                                }\r\n                                insNode = appendNode(newRangeElement, insNode, null, children[i]);\r\n                            } else {\r\n                                insNode = appendNode(parent, insNode, rangeElement, children[i]);\r\n                            }\r\n    \r\n                            if (!reset) {\r\n                                if (selectedFormats) {\r\n                                    lastNode = insNode;\r\n                                    if (!firstNode) {\r\n                                        firstNode = insNode;\r\n                                    }\r\n                                } else if (!firstNode) {\r\n                                    firstNode = lastNode = insNode;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            removeArray.push(insNode);\r\n                            util.removeItem(children[i]);\r\n                        }\r\n\r\n                        if (reset) {\r\n                            reset = moveComplete = false;\r\n                            children = util.getListChildNodes(rangeElement, function (current) { return current.parentNode === rangeElement; });\r\n                            rangeEl = rangeElement.cloneNode(false);\r\n                            parent = rangeElement.parentNode;\r\n                            i = -1;\r\n                            len = children.length;\r\n                            continue;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            const rangeParent = rangeElement.parentNode;\r\n            let rangeRight = rangeElement.nextSibling;\r\n            if (rangeEl && rangeEl.children.length > 0) {\r\n                rangeParent.insertBefore(rangeEl, rangeRight);\r\n            }\r\n            \r\n            if (newRangeElement) firstNode = newRangeElement.previousSibling;\r\n            else if (!firstNode) firstNode = rangeElement.previousSibling;\r\n            rangeRight = rangeElement.nextSibling !== rangeEl ? rangeElement.nextSibling : rangeEl ? rangeEl.nextSibling : null;\r\n\r\n            if (rangeElement.children.length === 0 || rangeElement.textContent.length === 0) {\r\n                util.removeItem(rangeElement);\r\n            } else {\r\n                util.removeEmptyNode(rangeElement, null);\r\n            }\r\n\r\n            let edge = null;\r\n            if (remove) {\r\n                edge = {\r\n                    cc: rangeParent,\r\n                    sc: firstNode,\r\n                    ec: rangeRight,\r\n                    removeArray: removeArray\r\n                };\r\n            } else {\r\n                if (!firstNode) firstNode = lastNode;\r\n                if (!lastNode) lastNode = firstNode;\r\n                const childEdge = util.getEdgeChildNodes(firstNode, (lastNode.parentNode ? firstNode : lastNode));\r\n                edge = {\r\n                    cc: (childEdge.sc || childEdge.ec).parentNode,\r\n                    sc: childEdge.sc,\r\n                    ec: childEdge.ec\r\n                };\r\n            }\r\n\r\n            this.effectNode = null;\r\n            if (notHistoryPush) return edge;\r\n            \r\n            if (!remove && edge) {\r\n                if (!selectedFormats) {\r\n                    this.setRange(edge.sc, 0, edge.sc, 0);\r\n                } else {\r\n                    this.setRange(edge.sc, so, edge.ec, eo);\r\n                }\r\n            }\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description \"selectedFormats\" array are detached from the list element.\r\n         * The return value is applied when the first and last lines of \"selectedFormats\" are \"LI\" respectively.\r\n         * @param {Array} selectedFormats Array of format elements (LI, P...) to remove.\r\n         * @param {Boolean} remove If true, deleted without detached.\r\n         * @returns {Object} {sc: <LI>, ec: <LI>}.\r\n         */\r\n        detachList: function (selectedFormats, remove) {\r\n            let rangeArr = {};\r\n            let listFirst = false;\r\n            let listLast = false;\r\n            let first = null;\r\n            let last = null;\r\n            const passComponent = function (current) { return !this.isComponent(current); }.bind(util);\r\n\r\n            for (let i = 0, len = selectedFormats.length, r, o, lastIndex, isList; i < len; i++) {\r\n                lastIndex = i === len - 1;\r\n                o = util.getRangeFormatElement(selectedFormats[i], passComponent);\r\n                isList = util.isList(o);\r\n                if (!r && isList) {\r\n                    r = o;\r\n                    rangeArr = {r: r, f: [util.getParentElement(selectedFormats[i], 'LI')]};\r\n                    if (i === 0) listFirst = true;\r\n                } else if (r && isList) {\r\n                    if (r !== o) {\r\n                        const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\r\n                        o = selectedFormats[i].parentNode;\r\n                        if (listFirst) {\r\n                            first = edge.sc;\r\n                            listFirst = false;\r\n                        }\r\n                        if (lastIndex) last = edge.ec;\r\n\r\n                        if (isList) {\r\n                            r = o;\r\n                            rangeArr = {r: r, f: [util.getParentElement(selectedFormats[i], 'LI')]};\r\n                            if (lastIndex) listLast = true;\r\n                        } else {\r\n                            r = null;\r\n                        }\r\n                    } else {\r\n                        rangeArr.f.push(util.getParentElement(selectedFormats[i], 'LI'));\r\n                        if (lastIndex) listLast = true;\r\n                    }\r\n                }\r\n\r\n                if (lastIndex && util.isList(r)) {\r\n                    const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\r\n                    if (listLast || len === 1) last = edge.ec;\r\n                    if (listFirst) first = edge.sc || last;\r\n                }\r\n            }\r\n\r\n            return {\r\n                sc: first,\r\n                ec: last\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Add, update, and delete nodes from selected text.\r\n         * 1. If there is a node in the \"appendNode\" argument, a node with the same tags and attributes as \"appendNode\" is added to the selection text.\r\n         * 2. If it is in the same tag, only the tag's attributes are changed without adding a tag.\r\n         * 3. If the \"appendNode\" argument is null, the node of the selection is update or remove without adding a new node.\r\n         * 4. The same style as the style attribute of the \"styleArray\" argument is deleted.\r\n         *    (Styles should be put with attribute names from css. [\"background-color\"])\r\n         * 5. The same class name as the class attribute of the \"styleArray\" argument is deleted.\r\n         *    (The class name is preceded by \".\" [\".className\"])\r\n         * 6. Use a list of styles and classes of \"appendNode\" in \"styleArray\" to avoid duplicate property values.\r\n         * 7. If a node with all styles and classes removed has the same tag name as \"appendNode\" or \"removeNodeArray\", or \"appendNode\" is null, that node is deleted.\r\n         * 8. Regardless of the style and class of the node, the tag with the same name as the \"removeNodeArray\" argument value is deleted.\r\n         * 9. If the \"strictRemove\" argument is true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n         *10. It won't work if the parent node has the same class and same value style.\r\n         *    However, if there is a value in \"removeNodeArray\", it works and the text node is separated even if there is no node to replace.\r\n         * @param {Element|null} appendNode The element to be added to the selection. If it is null, only delete the node.\r\n         * @param {Array|null} styleArray The style or className attribute name Array to check (['font-size'], ['.className'], ['font-family', 'color', '.className']...])\r\n         * @param {Array|null} removeNodeArray An array of node names to remove types from, remove all formats when \"appendNode\" is null and there is an empty array or null value. (['span'], ['strong', 'em'] ...])\r\n         * @param {Boolean|null} strictRemove If true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n         */\r\n        nodeChange: function (appendNode, styleArray, removeNodeArray, strictRemove) {\r\n            this._resetRangeToTextNode();\r\n            let range = this.getRange_addLine(this.getRange(), null);\r\n            styleArray = styleArray && styleArray.length > 0 ? styleArray : false;\r\n            removeNodeArray = removeNodeArray && removeNodeArray.length > 0 ? removeNodeArray : false;\r\n            \r\n            const isRemoveNode = !appendNode;\r\n            const isRemoveFormat = isRemoveNode && !removeNodeArray && !styleArray;\r\n            let startCon = range.startContainer;\r\n            let startOff = range.startOffset;\r\n            let endCon = range.endContainer;\r\n            let endOff = range.endOffset;\r\n\r\n            if ((isRemoveFormat && range.collapsed && util.isFormatElement(startCon.parentNode)) || (startCon === endCon && startCon.nodeType === 1 && util.isNonEditable(startCon))) {\r\n                const format = startCon.parentNode;\r\n                if (!util.isListCell(format) || !util.getValues(format.style).some(function(k) { return this._listKebab.indexOf(k) > -1; }.bind(this))) return;\r\n            }\r\n\r\n            if (range.collapsed && !isRemoveFormat) {\r\n                if (startCon.nodeType === 1 && !util.isBreak(startCon) && !util.isComponent(startCon)) {\r\n                    let afterNode = null;\r\n                    const focusNode = startCon.childNodes[startOff];\r\n\r\n                    if (focusNode) {\r\n                        if (!focusNode.nextSibling) {\r\n                            afterNode = null;\r\n                        } else {\r\n                            afterNode = util.isBreak(focusNode) ? focusNode : focusNode.nextSibling;\r\n                        }\r\n                    }\r\n\r\n                    const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                    startCon.insertBefore(zeroWidth, afterNode);\r\n                    this.setRange(zeroWidth, 1, zeroWidth, 1);\r\n\r\n                    range = this.getRange();\r\n                    startCon = range.startContainer;\r\n                    startOff = range.startOffset;\r\n                    endCon = range.endContainer;\r\n                    endOff = range.endOffset;\r\n                }\r\n            }\r\n\r\n            if (util.isFormatElement(startCon)) {\r\n                startCon = startCon.childNodes[startOff] || startCon.firstChild;\r\n                startOff = 0;\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon.lastChild;\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            if (isRemoveNode) {\r\n                appendNode = util.createElement('DIV');\r\n            }\r\n\r\n            const wRegExp = _w.RegExp;\r\n            const newNodeName = appendNode.nodeName;\r\n\r\n            /* checked same style property */\r\n            if (!isRemoveFormat && startCon === endCon && !removeNodeArray && appendNode) {\r\n                let sNode = startCon;\r\n                let checkCnt = 0;\r\n                const checkAttrs = [];\r\n                \r\n                const checkStyles = appendNode.style;\r\n                for (let i = 0, len = checkStyles.length; i < len; i++) {\r\n                    checkAttrs.push(checkStyles[i]);\r\n                }\r\n\r\n                const ckeckClasses = appendNode.classList;\r\n                for (let i = 0, len = ckeckClasses.length; i < len; i++) {\r\n                    checkAttrs.push('.' + ckeckClasses[i]);\r\n                }\r\n\r\n                if (checkAttrs.length > 0) {\r\n                    while(!util.isFormatElement(sNode) && !util.isWysiwygDiv(sNode)) {\r\n                        for (let i = 0; i < checkAttrs.length; i++) {\r\n                            if (sNode.nodeType === 1) {\r\n                                const s = checkAttrs[i];\r\n                                const classReg = /^\\./.test(s) ? new wRegExp('\\\\s*' + s.replace(/^\\./, '') + '(\\\\s+|$)', 'ig') : false;\r\n    \r\n                                const styleCheck = isRemoveNode ? !!sNode.style[s] : (!!sNode.style[s] && !!appendNode.style[s] && sNode.style[s] === appendNode.style[s]);\r\n                                const classCheck = classReg === false ? false : isRemoveNode ? !!sNode.className.match(classReg) : !!sNode.className.match(classReg) && !!appendNode.className.match(classReg);\r\n                                if (styleCheck || classCheck) {\r\n                                    checkCnt++;\r\n                                }\r\n                            }\r\n                        }\r\n                        sNode = sNode.parentNode;\r\n                    }\r\n    \r\n                    if (checkCnt >= checkAttrs.length) return;\r\n                }\r\n            }\r\n\r\n            let start = {}, end = {};\r\n            let newNode, styleRegExp = '', classRegExp = '', removeNodeRegExp = '';\r\n\r\n            if (styleArray) {\r\n                for (let i = 0, len = styleArray.length, s; i < len; i++) {\r\n                    s = styleArray[i];\r\n                    if (/^\\./.test(s)) {\r\n                        classRegExp += (classRegExp ? '|' : '\\\\s*(?:') + s.replace(/^\\./, '');\r\n                    } else {\r\n                        styleRegExp += (styleRegExp ? '|' : '(?:;|^|\\\\s)(?:') + s;\r\n                    }\r\n                }\r\n\r\n                if (styleRegExp) {\r\n                    styleRegExp += ')\\\\s*:[^;]*\\\\s*(?:;|$)';\r\n                    styleRegExp = new wRegExp(styleRegExp, 'ig');\r\n                }\r\n\r\n                if (classRegExp) {\r\n                    classRegExp += ')(?=\\\\s+|$)';\r\n                    classRegExp = new wRegExp(classRegExp, 'ig');\r\n                }\r\n            }\r\n\r\n            if (removeNodeArray) {\r\n                removeNodeRegExp = '^(?:' + removeNodeArray[0];\r\n                for (let i = 1; i < removeNodeArray.length; i++) {\r\n                    removeNodeRegExp += '|' + removeNodeArray[i];\r\n                }\r\n                removeNodeRegExp += ')$';\r\n                removeNodeRegExp = new wRegExp(removeNodeRegExp, 'i');\r\n            }\r\n\r\n            /** validation check function*/\r\n            const wBoolean = _w.Boolean;\r\n            const _removeCheck = {v: false};\r\n            const validation = function (checkNode) {\r\n                const vNode = checkNode.cloneNode(false);\r\n\r\n                // all path\r\n                if (vNode.nodeType === 3 || util.isBreak(vNode)) return vNode;\r\n                // all remove\r\n                if (isRemoveFormat) return null;\r\n\r\n                // remove node check\r\n                const tagRemove = (!removeNodeRegExp && isRemoveNode) || (removeNodeRegExp && removeNodeRegExp.test(vNode.nodeName));\r\n\r\n                // tag remove\r\n                if (tagRemove && !strictRemove) {\r\n                    _removeCheck.v = true;\r\n                    return null;\r\n                }\r\n\r\n                // style regexp\r\n                const originStyle = vNode.style.cssText;\r\n                let style = '';\r\n                if (styleRegExp && originStyle.length > 0) {\r\n                    style = originStyle.replace(styleRegExp, '').trim();\r\n                    if (style !== originStyle) _removeCheck.v = true;\r\n                }\r\n\r\n                // class check\r\n                const originClasses = vNode.className;\r\n                let classes = '';\r\n                if (classRegExp && originClasses.length > 0) {\r\n                    classes = originClasses.replace(classRegExp, '').trim();\r\n                    if (classes !== originClasses) _removeCheck.v = true;\r\n                }\r\n\r\n                // remove only\r\n                if (isRemoveNode) {\r\n                    if ((classRegExp || !originClasses) && (styleRegExp || !originStyle) && !style && !classes && tagRemove) {\r\n                        _removeCheck.v = true;\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // change\r\n                if (style || classes || vNode.nodeName !== newNodeName || (wBoolean(styleRegExp) !== wBoolean(originStyle)) || (wBoolean(classRegExp) !== wBoolean(originClasses))) {\r\n                    if (styleRegExp && originStyle.length > 0) vNode.style.cssText = style;\r\n                    if (!vNode.style.cssText) {\r\n                        vNode.removeAttribute('style');\r\n                    }\r\n\r\n                    if (classRegExp && originClasses.length > 0) vNode.className = classes.trim();\r\n                    if (!vNode.className.trim()) {\r\n                        vNode.removeAttribute('class');\r\n                    }\r\n\r\n                    if (!vNode.style.cssText && !vNode.className && (vNode.nodeName === newNodeName || tagRemove)) {\r\n                        _removeCheck.v = true;\r\n                        return null;\r\n                    }\r\n\r\n                    return vNode;\r\n                }\r\n\r\n                _removeCheck.v = true;\r\n                return null;\r\n            };\r\n\r\n            // get line nodes\r\n            const lineNodes = this.getSelectedElements(null);\r\n            range = this.getRange();\r\n            startCon = range.startContainer;\r\n            startOff = range.startOffset;\r\n            endCon = range.endContainer;\r\n            endOff = range.endOffset;\r\n\r\n            if (!util.getFormatElement(startCon, null)) {\r\n                startCon = util.getChildElement(lineNodes[0], function (current) { return current.nodeType === 3; }, false);\r\n                startOff = 0;\r\n            }\r\n\r\n            if (!util.getFormatElement(endCon, null)) {\r\n                endCon = util.getChildElement(lineNodes[lineNodes.length - 1], function (current) { return current.nodeType === 3; }, false);\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            \r\n            const oneLine = util.getFormatElement(startCon, null) === util.getFormatElement(endCon, null);\r\n            const endLength = lineNodes.length - (oneLine ? 0 : 1);\r\n\r\n            // node Changes\r\n            newNode = appendNode.cloneNode(false);\r\n\r\n            const isRemoveAnchor = isRemoveFormat || (isRemoveNode && (function (arr) {\r\n                for (let n = 0, len = arr.length; n < len; n++) {\r\n                    if (util._isMaintainedNode(arr[n]) || util._isSizeNode(arr[n])) return true;\r\n                }\r\n                return false;\r\n            })(removeNodeArray));\r\n\r\n            const isSizeNode = isRemoveNode || util._isSizeNode(newNode);\r\n            const _getMaintainedNode = this._util_getMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\r\n            const _isMaintainedNode = this._util_isMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\r\n\r\n            // one line\r\n            if (oneLine) {\r\n                if (this._resetCommonListCell(lineNodes[0], styleArray)) range = this.setRange(startCon, startOff, endCon, endOff);\r\n\r\n                const newRange = this._nodeChange_oneLine(lineNodes[0], newNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, range.collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode);\r\n                start.container = newRange.startContainer;\r\n                start.offset = newRange.startOffset;\r\n                end.container = newRange.endContainer;\r\n                end.offset = newRange.endOffset;\r\n                \r\n                if (start.container === end.container && util.onlyZeroWidthSpace(start.container)) {\r\n                    start.offset = end.offset = 1;\r\n                }\r\n                this._setCommonListStyle(newRange.ancestor, null);\r\n            } else { // multi line \r\n                let appliedCommonList = false;\r\n                if (endLength > 0 && this._resetCommonListCell(lineNodes[endLength], styleArray)) appliedCommonList = true;\r\n                if (this._resetCommonListCell(lineNodes[0], styleArray)) appliedCommonList = true;\r\n                if (appliedCommonList) this.setRange(startCon, startOff, endCon, endOff);\r\n\r\n                // end\r\n                if (endLength > 0) {\r\n                    newNode = appendNode.cloneNode(false);\r\n                    end = this._nodeChange_endLine(lineNodes[endLength], newNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode);\r\n                }\r\n\r\n                // mid\r\n                for (let i = endLength - 1, newRange; i > 0; i--) {\r\n                    this._resetCommonListCell(lineNodes[i], styleArray);\r\n                    newNode = appendNode.cloneNode(false);\r\n                    newRange = this._nodeChange_middleLine(lineNodes[i], newNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, end.container);\r\n                    if (newRange.endContainer && newRange.ancestor.contains(newRange.endContainer)) {\r\n                        end.ancestor = null;\r\n                        end.container = newRange.endContainer;\r\n                    }\r\n                    this._setCommonListStyle(newRange.ancestor, null);\r\n                }\r\n\r\n                // start\r\n                newNode = appendNode.cloneNode(false);\r\n                start = this._nodeChange_startLine(lineNodes[0], newNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, end.container);\r\n\r\n                if (start.endContainer) {\r\n                    end.ancestor = null;\r\n                    end.container = start.endContainer;\r\n                }\r\n\r\n                if (endLength <= 0) {\r\n                    end = start;\r\n                } else if (!end.container) {\r\n                    end.ancestor = null;\r\n                    end.container = start.container;\r\n                    end.offset = start.container.textContent.length;\r\n                }\r\n\r\n                this._setCommonListStyle(start.ancestor, null);\r\n                this._setCommonListStyle(end.ancestor || util.getFormatElement(end.container), null);\r\n            }\r\n\r\n            // set range\r\n            this.controllersOff();\r\n            this.setRange(start.container, start.offset, end.container, end.offset);\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Reset common style of list cell\r\n         * @param {Element} el List cell element. <li>\r\n         * @param {Array|null} styleArray Style array\r\n         * @private\r\n         */\r\n        _resetCommonListCell: function (el, styleArray) {\r\n            if (!util.isListCell(el)) return;\r\n            if (!styleArray) styleArray = this._listKebab;\r\n\r\n            const children = util.getArrayItem((el).childNodes, function (current) { return !util.isBreak(current); }, true);\r\n            const elStyles = el.style;\r\n            \r\n            const ec = [], ek = [], elKeys = util.getValues(elStyles);\r\n            for (let i = 0, len = this._listKebab.length; i < len; i++) {\r\n                if (elKeys.indexOf(this._listKebab[i]) > -1 && styleArray.indexOf(this._listKebab[i]) > -1) {\r\n                    ec.push(this._listCamel[i]);\r\n                    ek.push(this._listKebab[i]);\r\n                }\r\n            }\r\n\r\n            if (!ec.length) return;\r\n\r\n            // reset cell style---\r\n            const refer = util.createElement('SPAN');\r\n            for (let i = 0, len = ec.length; i < len; i++) {\r\n                refer.style[ec[i]] = elStyles[ek[i]];\r\n                elStyles.removeProperty(ek[i]);\r\n            }\r\n\r\n            let sel = refer.cloneNode(false);\r\n            let r = null, appliedEl = false;\r\n            for (let i = 0, len = children.length, c, s; i < len; i++) {\r\n                c = children[i];\r\n                if (options._textTagsMap[c.nodeName.toLowerCase()]) continue;\r\n\r\n                s = util.getValues(c.style);\r\n                if (s.length === 0 || (ec.some(function (k) {return s.indexOf(k) === -1;}) && s.some(function(k) {ec.indexOf(k) > -1;}))) {\r\n                    r = c.nextSibling;\r\n                    sel.appendChild(c);\r\n                } else if (sel.childNodes.length > 0) {\r\n                    el.insertBefore(sel, r);\r\n                    sel = refer.cloneNode(false);\r\n                    r = null;\r\n                    appliedEl = true;\r\n                }\r\n            }\r\n            \r\n            if (sel.childNodes.length > 0) {\r\n                el.insertBefore(sel, r);\r\n                appliedEl = true;\r\n            }\r\n            if (!elStyles.length) {\r\n                el.removeAttribute('style');\r\n            }\r\n\r\n            return appliedEl;\r\n        },\r\n\r\n        /**\r\n         * @description If certain styles are applied to all child nodes of the list cell, the style of the list cell is also changed. (bold, color, size)\r\n         * @param {Element} el List cell element. <li>\r\n         * @param {Element|null} child Variable for recursive call. (\"null\" on the first call)\r\n         * @private\r\n         */\r\n        _setCommonListStyle: function (el, child) {\r\n            if (!util.isListCell(el)) return;\r\n            \r\n            const children = util.getArrayItem((child || el).childNodes, function (current) { return !util.isBreak(current); }, true);\r\n            child = children[0];\r\n            \r\n            if (!child || children.length > 1 || child.nodeType !== 1) return;\r\n            \r\n            // set cell style---\r\n            const childStyle = child.style;\r\n            const elStyle = el.style;\r\n            const nodeName = child.nodeName.toLowerCase();\r\n            let appliedEl = false;\r\n\r\n            // bold, italic\r\n            if (options._textTagsMap[nodeName] === options._defaultCommand.bold.toLowerCase()) elStyle.fontWeight = 'bold';\r\n            if (options._textTagsMap[nodeName] === options._defaultCommand.italic.toLowerCase()) elStyle.fontStyle = 'italic';\r\n\r\n            // styles\r\n            const cKeys = util.getValues(childStyle);\r\n            if (cKeys.length > 0) {\r\n                for (let i = 0, len = this._listCamel.length; i < len; i++) {\r\n                    if (cKeys.indexOf(this._listKebab[i]) > -1) {\r\n                        elStyle[this._listCamel[i]] = childStyle[this._listCamel[i]];\r\n                        childStyle.removeProperty(this._listKebab[i]);\r\n                        appliedEl = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this._setCommonListStyle(el, child);\r\n            if (!appliedEl) return;\r\n\r\n            // common style\r\n            if (!childStyle.length) {\r\n                const ch = child.childNodes;\r\n                const p = child.parentNode;\r\n                const n = child.nextSibling;\r\n                while (ch.length > 0) {\r\n                    p.insertBefore(ch[0], n);\r\n                }\r\n                util.removeItem(child);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Strip remove node\r\n         * @param {Node} removeNode The remove node\r\n         * @private\r\n         */\r\n        _stripRemoveNode: function (removeNode) {\r\n            const element = removeNode.parentNode;\r\n            if (!removeNode || removeNode.nodeType === 3 || !element) return;\r\n            \r\n            const children = removeNode.childNodes;\r\n            while (children[0]) {\r\n                element.insertBefore(children[0], removeNode);\r\n            }\r\n\r\n            element.removeChild(removeNode);\r\n        },\r\n\r\n        /**\r\n         * @description Return the parent maintained tag. (bind and use a util object)\r\n         * @param {Element} element Element\r\n         * @returns {Element}\r\n         * @private\r\n         */\r\n        _util_getMaintainedNode: function (_isRemove, _isSizeNode, element) {\r\n            if (!element || _isRemove) return null;\r\n            return this.getParentElement(element, this._isMaintainedNode.bind(this)) || (!_isSizeNode ? this.getParentElement(element, this._isSizeNode.bind(this)) : null);\r\n        },\r\n\r\n        /**\r\n         * @description Check if element is a tag that should be persisted. (bind and use a util object)\r\n         * @param {Element} element Element\r\n         * @returns {Element}\r\n         * @private\r\n         */\r\n        _util_isMaintainedNode: function (_isRemove, _isSizeNode, element) {\r\n            if (!element || _isRemove || element.nodeType !== 1) return false;\r\n            const anchor = this._isMaintainedNode(element);\r\n            return this.getParentElement(element, this._isMaintainedNode.bind(this)) ? anchor : (anchor || (!_isSizeNode ? this._isSizeNode(element) : false));\r\n        },\r\n\r\n        /**\r\n         * @description wraps text nodes of line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @param {Boolean} collapsed range.collapsed\r\n         * @returns {{ancestor: *, startContainer: *, startOffset: *, endContainer: *, endOffset: *}}\r\n         * @private\r\n         */\r\n        _nodeChange_oneLine: function (element, newInnerNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\r\n            // not add tag\r\n            let parentCon = startCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n\r\n            if (!isRemoveNode && parentCon === endCon.parentNode && parentCon.nodeName === newInnerNode.nodeName) {\r\n                if (util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff)) && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\r\n                    const children = parentCon.childNodes;\r\n                    let sameTag = true;\r\n    \r\n                    for (let i = 0, len = children.length, c, s, e, z; i < len; i++) {\r\n                        c = children[i];\r\n                        z = !util.onlyZeroWidthSpace(c);\r\n                        if (c === startCon) {\r\n                            s = true;\r\n                            continue;\r\n                        }\r\n                        if (c === endCon) {\r\n                            e = true;\r\n                            continue;\r\n                        }\r\n                        if ((!s && z) || (s && e && z)) {\r\n                            sameTag = false;\r\n                            break;\r\n                        }\r\n                    }\r\n    \r\n                    if (sameTag) {\r\n                        util.copyTagAttributes(parentCon, newInnerNode);\r\n        \r\n                        return {\r\n                            ancestor: element,\r\n                            startContainer: startCon,\r\n                            startOffset: startOff,\r\n                            endContainer: endCon,\r\n                            endOffset: endOff\r\n                        };\r\n                    }\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n            const isSameNode = startCon === endCon;\r\n            let startContainer = startCon;\r\n            let startOffset = startOff;\r\n            let endContainer = endCon;\r\n            let endOffset = endOff;\r\n            let startPass = false;\r\n            let endPass = false;\r\n            let pCurrent, newNode, appendNode, cssText, anchorNode;\r\n\r\n            const wRegExp = _w.RegExp;\r\n            function checkCss (vNode) {\r\n                const regExp = new wRegExp('(?:;|^|\\\\s)(?:' + cssText + 'null)\\\\s*:[^;]*\\\\s*(?:;|$)', 'ig');\r\n                let style = '';\r\n\r\n                if (regExp && vNode.style.cssText.length > 0) {\r\n                    style = regExp.test(vNode.style.cssText);\r\n                }\r\n            \r\n                return !style;\r\n            }\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode; i < len; i++) {\r\n                    let child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n                    let cloneNode;\r\n\r\n                    // startContainer\r\n                    if (!startPass && child === startContainer) {\r\n                        let line = pNode;\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const prevNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(0, startOffset));\r\n                        const textNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(startOffset, \r\n                                isSameNode ? \r\n                                (endOffset >= startOffset ? endOffset - startOffset : startContainer.data.length - startOffset) : \r\n                                startContainer.data.length - startOffset)\r\n                            );\r\n\r\n                        if (anchorNode) {\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== line) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== line) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.appendChild(a);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        }\r\n                        \r\n                        if (!util.onlyZeroWidthSpace(prevNode)) {\r\n                            ancestor.appendChild(prevNode);\r\n                        }\r\n\r\n                        const prevAnchorNode = _getMaintainedNode(ancestor);\r\n                        if (!!prevAnchorNode) anchorNode = prevAnchorNode;\r\n                        if (anchorNode) line = anchorNode;\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        while (newNode !== line && newNode !== el && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                pCurrent.push(vNode);\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || textNode;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        newInnerNode.appendChild(childNode);\r\n                        line.appendChild(newInnerNode);\r\n\r\n                        if (anchorNode && !_getMaintainedNode(endContainer)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        startContainer = textNode;\r\n                        startOffset = 0;\r\n                        startPass = true;\r\n\r\n                        if (newNode !== textNode) newNode.appendChild(startContainer);\r\n                        if (!isSameNode) continue;\r\n                    }\r\n\r\n                    // endContainer\r\n                    if (!endPass && child === endContainer) {\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const afterNode = util.createTextNode(endContainer.nodeType === 1 ? '' : endContainer.substringData(endOffset, (endContainer.length - endOffset)));\r\n                        const textNode = util.createTextNode(isSameNode || endContainer.nodeType === 1 ? '' : endContainer.substringData(0, endOffset));\r\n\r\n                        if (anchorNode) {\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(afterNode)) {\r\n                            newNode = child;\r\n                            cssText = '';\r\n                            pCurrent = [];\r\n                            const anchors = [];\r\n                            while (newNode !== pNode && newNode !== el && newNode !== null) {\r\n                                if (newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                    if (_isMaintainedNode(newNode)) anchors.push(newNode.cloneNode(false));\r\n                                    else pCurrent.push(newNode.cloneNode(false));\r\n                                    cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                                }\r\n                                newNode = newNode.parentNode;\r\n                            }\r\n                            pCurrent = pCurrent.concat(anchors);\r\n\r\n                            cloneNode = appendNode = newNode = pCurrent.pop() || afterNode;\r\n                            while (pCurrent.length > 0) {\r\n                                newNode = pCurrent.pop();\r\n                                appendNode.appendChild(newNode);\r\n                                appendNode = newNode;\r\n                            }\r\n\r\n                            pNode.appendChild(cloneNode);\r\n                            newNode.textContent = afterNode.data;\r\n                        }\r\n\r\n                        if (anchorNode && cloneNode) {\r\n                            const afterAnchorNode = _getMaintainedNode(cloneNode);\r\n                            if (afterAnchorNode) {\r\n                                anchorNode = afterAnchorNode;\r\n                            }\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        while (newNode !== pNode && newNode !== el && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                pCurrent.push(vNode);\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || textNode;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            newInnerNode.appendChild(childNode);\r\n                            anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\r\n                            pNode.appendChild(anchorNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                            anchorNode = null;\r\n                        } else {\r\n                            newInnerNode.appendChild(childNode);\r\n                        }\r\n\r\n                        endContainer = textNode;\r\n                        endOffset = textNode.data.length;\r\n                        endPass = true;\r\n\r\n                        if (!isRemoveFormat && collapsed) {\r\n                            newInnerNode = textNode;\r\n                            textNode.textContent = util.zeroWidthSpace;\r\n                        }\r\n\r\n                        if (newNode !== textNode) newNode.appendChild(endContainer);\r\n                        continue;\r\n                    }\r\n\r\n                    // other\r\n                    if (startPass) {\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                pNode.appendChild(child.cloneNode(true));\r\n                                if (!collapsed) {\r\n                                    newInnerNode = newInnerNode.cloneNode(false);\r\n                                    pNode.appendChild(newInnerNode);\r\n                                    nNodeArray.push(newInnerNode);\r\n                                }\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = endPass ? newNode.cloneNode(false) : validation(newNode);\r\n                            if (newNode.nodeType === 1 && !util.isBreak(child) && vNode && checkCss(newNode)) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n                        \r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode) && !util.onlyZeroWidthSpace(newInnerNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n                        \r\n                        if (!endPass && !anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.appendChild(childNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                            if (newInnerNode.children.length > 0) ancestor = newNode;\r\n                            else ancestor = newInnerNode;\r\n                        } else if (childNode === child) {\r\n                            if (!endPass) ancestor = newInnerNode;\r\n                            else ancestor = pNode;\r\n                        } else if (endPass) {\r\n                            pNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.appendChild(newInnerNode);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    cloneNode = child.cloneNode(false);\r\n                    ancestor.appendChild(cloneNode);\r\n                    if (child.nodeType === 1 && !util.isBreak(child)) coverNode = cloneNode;\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    startContainer: startCon,\r\n                    startOffset: startOff,\r\n                    endContainer: endCon,\r\n                    endOffset: endOff\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    let textNode, textNode_s, textNode_e;\r\n                    \r\n                    if (collapsed) {\r\n                        textNode = util.createTextNode(util.zeroWidthSpace);\r\n                        pNode.replaceChild(textNode, removeNode);\r\n                    } else {\r\n                        const rChildren = removeNode.childNodes;\r\n                        textNode_s = rChildren[0];\r\n                        while (rChildren[0]) {\r\n                            textNode_e = rChildren[0];\r\n                            pNode.insertBefore(textNode_e, removeNode);\r\n                        }\r\n                        util.removeItem(removeNode);\r\n                    }\r\n\r\n                    if (i === 0) {\r\n                        if (collapsed) {\r\n                            startContainer = endContainer = textNode;\r\n                        } else {\r\n                            startContainer = textNode_s;\r\n                            endContainer = textNode_e;\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                if (isRemoveNode) {\r\n                    for (let i = 0; i < nNodeArray.length; i++) {\r\n                        this._stripRemoveNode(nNodeArray[i]);\r\n                    }\r\n                }\r\n                \r\n                if (collapsed) {\r\n                    startContainer = endContainer = newInnerNode;\r\n                }\r\n            }\r\n\r\n            util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n            if (collapsed) {\r\n                startOffset = startContainer.textContent.length;\r\n                endOffset = endContainer.textContent.length;\r\n            }\r\n\r\n            // endContainer reset\r\n            const endConReset = isRemoveFormat || endContainer.textContent.length === 0;\r\n\r\n            if (!util.isBreak(endContainer) && endContainer.textContent.length === 0) {\r\n                util.removeItem(endContainer);\r\n                endContainer = startContainer;\r\n            }\r\n            endOffset = endConReset ? endContainer.textContent.length : endOffset;\r\n\r\n            // node change\r\n            const newStartOffset = {s: 0, e: 0};\r\n            const startPath = util.getNodePath(startContainer, pNode, newStartOffset);\r\n\r\n            const mergeEndCon = !endContainer.parentNode;\r\n            if (mergeEndCon) endContainer = startContainer;\r\n            const newEndOffset = {s: 0, e: 0};\r\n            const endPath = util.getNodePath(endContainer , pNode, (!mergeEndCon && !endConReset) ? newEndOffset : null);\r\n\r\n            startOffset += newStartOffset.s;\r\n            endOffset = (collapsed ? startOffset : mergeEndCon ? startContainer.textContent.length : endConReset ? endOffset + newStartOffset.s : endOffset + newEndOffset.s);\r\n\r\n            // tag merge\r\n            const newOffsets = util.mergeSameTags(pNode, [startPath, endPath], true);\r\n\r\n            element.parentNode.replaceChild(pNode, element);\r\n\r\n            startContainer = util.getNodeFromPath(startPath, pNode);\r\n            endContainer = util.getNodeFromPath(endPath, pNode);\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                startContainer: startContainer,\r\n                startOffset: startOffset + newOffsets[0],\r\n                endContainer: endContainer,\r\n                endOffset: endOffset + newOffsets[1]\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description wraps first line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @returns {null|Node} If end container is renewed, returned renewed node\r\n         * @returns {Object} { ancestor, container, offset, endContainer }\r\n         * @private\r\n         */\r\n        _nodeChange_startLine: function (element, newInnerNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, _endContainer) {\r\n            // not add tag\r\n            let parentCon = startCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n\r\n            if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.nextSibling && util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff))) {\r\n                let sameTag = true;\r\n                let s = startCon.previousSibling;\r\n                while (s) {\r\n                    if (!util.onlyZeroWidthSpace(s)) {\r\n                        sameTag = false;\r\n                        break;\r\n                    }\r\n                    s = s.previousSibling;\r\n                }\r\n\r\n                if (sameTag) {\r\n                    util.copyTagAttributes(parentCon, newInnerNode);\r\n    \r\n                    return {\r\n                        ancestor: element,\r\n                        container: startCon,\r\n                        offset: startOff\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n\r\n            let container = startCon;\r\n            let offset = startOff;\r\n            let passNode = false;\r\n            let pCurrent, newNode, appendNode, anchorNode;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\r\n                    const child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (passNode && !util.isBreak(child)) {\r\n                        if (child.nodeType === 1) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                newInnerNode = newInnerNode.cloneNode(false);\r\n                                cloneChild = child.cloneNode(true);\r\n                                pNode.appendChild(cloneChild);\r\n                                pNode.appendChild(newInnerNode);\r\n                                nNodeArray.push(newInnerNode);\r\n\r\n                                // end container\r\n                                if (_endContainer && child.contains(_endContainer)) {\r\n                                    const endPath = util.getNodePath(_endContainer, child);\r\n                                    _endContainer = util.getNodeFromPath(endPath, cloneChild);\r\n                                }\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = validation(newNode);\r\n                            if (newNode.nodeType === 1 && vNode) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const isTopNode = pCurrent.length > 0;\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n                        \r\n                        if (!anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.appendChild(childNode);\r\n                            ancestor = !_isMaintainedNode(newNode) ? newNode : newInnerNode;\r\n                            nNodeArray.push(newInnerNode);\r\n                        } else if (isTopNode) {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.appendChild(newInnerNode);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // startContainer\r\n                    if (!passNode && child === container) {\r\n                        let line = pNode;\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const prevNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\r\n                        const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, (container.length - offset)));\r\n\r\n                        if (anchorNode) {\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== line) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== line) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.appendChild(a);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(prevNode)) {\r\n                            ancestor.appendChild(prevNode);\r\n                        }\r\n\r\n                        const prevAnchorNode = _getMaintainedNode(ancestor);\r\n                        if (!!prevAnchorNode) anchorNode = prevAnchorNode;\r\n                        if (anchorNode) line = anchorNode;\r\n\r\n                        newNode = ancestor;\r\n                        pCurrent = [];\r\n                        while (newNode !== line && newNode !== null) {\r\n                            vNode = validation(newNode);\r\n                            if (newNode.nodeType === 1 && vNode) {\r\n                                pCurrent.push(vNode);\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || ancestor;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (childNode !== ancestor) {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\r\n                        line.appendChild(newInnerNode);\r\n\r\n                        container = textNode;\r\n                        offset = 0;\r\n                        passNode = true;\r\n\r\n                        ancestor.appendChild(container);\r\n                        continue;\r\n                    }\r\n\r\n                    vNode = !passNode ? child.cloneNode(false) : validation(child);\r\n                    if (vNode) {\r\n                        ancestor.appendChild(vNode);\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\r\n                    }\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    container: startCon,\r\n                    offset: startOff,\r\n                    endContainer: _endContainer\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n\r\n                    const rChildren = removeNode.childNodes;\r\n                    const textNode = rChildren[0];\r\n                    while (rChildren[0]) {\r\n                        pNode.insertBefore(rChildren[0], removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n\r\n                    if (i === 0) container = textNode;\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            if (!isRemoveFormat && pNode.childNodes.length === 0) {\r\n                if (element.childNodes) {\r\n                    container = element.childNodes[0];\r\n                } else {\r\n                    container = util.createTextNode(util.zeroWidthSpace);\r\n                    element.appendChild(container);\r\n                }\r\n            } else {\r\n                util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n                if (util.onlyZeroWidthSpace(pNode.textContent)) {\r\n                    container = pNode.firstChild;\r\n                    offset = 0;\r\n                }\r\n\r\n                // node change\r\n                const offsets = {s: 0, e: 0};\r\n                const path = util.getNodePath(container, pNode, offsets);\r\n                offset += offsets.s;\r\n\r\n                // tag merge\r\n                const newOffsets = util.mergeSameTags(pNode, [path], true);\r\n\r\n                element.parentNode.replaceChild(pNode, element);\r\n\r\n                container = util.getNodeFromPath(path, pNode);\r\n                offset += newOffsets[0];\r\n            }\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                container: container,\r\n                offset: offset,\r\n                endContainer: _endContainer\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description wraps mid lines selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @param {Node} _endContainer Offset node of last line already modified (end.container)\r\n         * @returns {Object} { ancestor, endContainer: \"If end container is renewed, returned renewed node\" }\r\n         * @private\r\n         */\r\n        _nodeChange_middleLine: function (element, newInnerNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, _endContainer) {\r\n            // not add tag\r\n            if (!isRemoveNode) {\r\n                // end container path\r\n                let endPath = null;\r\n                if (_endContainer && element.contains(_endContainer)) endPath = util.getNodePath(_endContainer, element);\r\n\r\n                const tempNode = element.cloneNode(true);\r\n                const newNodeName = newInnerNode.nodeName;\r\n                const newCssText = newInnerNode.style.cssText;\r\n                const newClass = newInnerNode.className;\r\n\r\n                let children = tempNode.childNodes;\r\n                let i = 0, len = children.length;\r\n                for (let child; i < len; i++) {\r\n                    child = children[i];\r\n                    if (child.nodeType === 3) break;\r\n                    if (child.nodeName === newNodeName) {\r\n                        child.style.cssText += newCssText;\r\n                        util.addClass(child, newClass);\r\n                    } else if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\r\n                        continue;\r\n                    } else if (len === 1) {\r\n                        children = child.childNodes;\r\n                        len = children.length;\r\n                        i = -1;\r\n                        continue;\r\n                    } else {\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (len > 0 && i === len) {\r\n                    element.innerHTML = tempNode.innerHTML;\r\n                    return {\r\n                        ancestor: element,\r\n                        endContainer: endPath ? util.getNodeFromPath(endPath, element) : null\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const pNode = element.cloneNode(false);\r\n            const nNodeArray = [newInnerNode];\r\n            let noneChange = true;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\r\n                    let child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\r\n                        if (newInnerNode.childNodes.length > 0) {\r\n                            pNode.appendChild(newInnerNode);\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                        }\r\n                        \r\n                        cloneChild = child.cloneNode(true);\r\n                        pNode.appendChild(cloneChild);\r\n                        pNode.appendChild(newInnerNode);\r\n                        nNodeArray.push(newInnerNode);\r\n                        ancestor = newInnerNode;\r\n\r\n                        // end container\r\n                        if (_endContainer && child.contains(_endContainer)) {\r\n                            const endPath = util.getNodePath(_endContainer, child);\r\n                            _endContainer = util.getNodeFromPath(endPath, cloneChild);\r\n                        }\r\n\r\n                        continue;\r\n                    } else {\r\n                        vNode = validation(child);\r\n                        if (vNode) {\r\n                            noneChange = false;\r\n                            ancestor.appendChild(vNode);\r\n                            if (child.nodeType === 1) coverNode = vNode;\r\n                        }\r\n                    }\r\n\r\n                    if (!util.isBreak(child)) recursionFunc(child, coverNode);\r\n                }\r\n            })(element, newInnerNode);\r\n\r\n            // not remove tag\r\n            if (noneChange || (isRemoveNode && !isRemoveFormat && !_removeCheck.v)) return { ancestor: element, endContainer: _endContainer };\r\n\r\n            pNode.appendChild(newInnerNode);\r\n\r\n            if (isRemoveFormat && isRemoveNode) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    \r\n                    const rChildren = removeNode.childNodes;\r\n                    while (rChildren[0]) {\r\n                        pNode.insertBefore(rChildren[0], removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            util.removeEmptyNode(pNode, newInnerNode);\r\n            util.mergeSameTags(pNode, null, true);\r\n\r\n            // node change\r\n            element.parentNode.replaceChild(pNode, element);\r\n            return { ancestor: pNode, endContainer: _endContainer };\r\n        },\r\n\r\n        /**\r\n         * @description wraps last line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @returns {Object} { ancestor, container, offset }\r\n         * @private\r\n         */\r\n        _nodeChange_endLine: function (element, newInnerNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\r\n            // not add tag\r\n            let parentCon = endCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n            \r\n            if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.previousSibling && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\r\n                let sameTag = true;\r\n                let e = endCon.nextSibling;\r\n                while (e) {\r\n                    if (!util.onlyZeroWidthSpace(e)) {\r\n                        sameTag = false;\r\n                        break;\r\n                    }\r\n                    e = e.nextSibling;\r\n                }\r\n\r\n                if (sameTag) {\r\n                    util.copyTagAttributes(parentCon, newInnerNode);\r\n    \r\n                    return {\r\n                        ancestor: element,\r\n                        container: endCon,\r\n                        offset: endOff\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n\r\n            let container = endCon;\r\n            let offset = endOff;\r\n            let passNode = false;\r\n            let pCurrent, newNode, appendNode, anchorNode;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = childNodes.length - 1, vNode; 0 <= i; i--) {\r\n                    const child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (passNode && !util.isBreak(child)) {\r\n                        if (child.nodeType === 1) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                newInnerNode = newInnerNode.cloneNode(false);\r\n                                const cloneChild = child.cloneNode(true);\r\n                                pNode.insertBefore(cloneChild, ancestor);\r\n                                pNode.insertBefore(newInnerNode, cloneChild);\r\n                                nNodeArray.push(newInnerNode);\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const isTopNode = pCurrent.length > 0;\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.insertBefore(childNode, pNode.firstChild);\r\n                            nNodeArray.push(newInnerNode);\r\n                            if (newInnerNode.children.length > 0) ancestor = newNode;\r\n                            else ancestor = newInnerNode;\r\n                        } else if (isTopNode) {\r\n                            newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // endContainer\r\n                    if (!passNode && child === container) {\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const afterNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, (container.length - offset)));\r\n                        const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\r\n\r\n                        if (anchorNode) {\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== pNode) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== pNode) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.insertBefore(a, m.parentNode.firstChild);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(afterNode)) {\r\n                            ancestor.insertBefore(afterNode, ancestor.firstChild);\r\n                        }\r\n\r\n                        newNode = ancestor;\r\n                        pCurrent = [];\r\n                        while (newNode !== pNode && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1) {\r\n                                pCurrent.push(vNode);\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || ancestor;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (childNode !== ancestor) {\r\n                            newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\r\n                        \r\n                        if (anchorNode) {\r\n                            anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\r\n                            pNode.insertBefore(anchorNode, pNode.firstChild);\r\n                            anchorNode = null;\r\n                        } else {\r\n                            pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                        }\r\n\r\n                        container = textNode;\r\n                        offset = textNode.data.length;\r\n                        passNode = true;\r\n\r\n                        ancestor.insertBefore(container, ancestor.firstChild);\r\n                        continue;\r\n                    }\r\n\r\n                    vNode = !passNode ? child.cloneNode(false) : validation(child);\r\n                    if (vNode) {\r\n                        ancestor.insertBefore(vNode, ancestor.firstChild);\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\r\n                    }\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    container: endCon,\r\n                    offset: endOff\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    \r\n                    const rChildren = removeNode.childNodes;\r\n                    let textNode = null;\r\n                    while (rChildren[0]) {\r\n                        textNode = rChildren[0];\r\n                        pNode.insertBefore(textNode, removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n\r\n                    if (i === nNodeArray.length - 1) {\r\n                        container = textNode;\r\n                        offset = textNode.textContent.length;\r\n                    }\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            if (!isRemoveFormat && pNode.childNodes.length === 0) {\r\n                if (element.childNodes) {\r\n                    container = element.childNodes[0];\r\n                } else {\r\n                    container = util.createTextNode(util.zeroWidthSpace);\r\n                    element.appendChild(container);\r\n                }\r\n            } else {\r\n                if (!isRemoveNode && newInnerNode.textContent.length === 0) {\r\n                    util.removeEmptyNode(pNode, null);\r\n                    return {\r\n                        ancestor: null,\r\n                        container: null,\r\n                        offset: 0\r\n                    };\r\n                }\r\n\r\n                util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n                if (util.onlyZeroWidthSpace(pNode.textContent)) {\r\n                    container = pNode.firstChild;\r\n                    offset = container.textContent.length;\r\n                } else if (util.onlyZeroWidthSpace(container)) {\r\n                    container = newInnerNode;\r\n                    offset = 1;\r\n                }\r\n                \r\n                // node change\r\n                const offsets = {s: 0, e: 0};\r\n                const path = util.getNodePath(container, pNode, offsets);\r\n                offset += offsets.s;\r\n\r\n                // tag merge\r\n                const newOffsets = util.mergeSameTags(pNode, [path], true);\r\n\r\n                element.parentNode.replaceChild(pNode, element);\r\n\r\n                container = util.getNodeFromPath(path, pNode);\r\n                offset += newOffsets[0];\r\n            }\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                container: container,\r\n                offset: container.nodeType === 1 && offset === 1 ? container.childNodes.length : offset\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Run plugin calls and basic commands.\r\n         * @param {String} command Command string\r\n         * @param {String} display Display type string ('command', 'submenu', 'dialog', 'container')\r\n         * @param {Element} target The element of command button\r\n         */\r\n        actionCall: function (command, display, target) {\r\n            // call plugins\r\n            if (display) {\r\n                if (/more/i.test(display)) {\r\n                    if (target !== this._moreLayerActiveButton) {\r\n                        const layer = context.element.toolbar.querySelector('.' + command);\r\n                        if (layer) {\r\n                            if (this._moreLayerActiveButton) this.moreLayerOff();\r\n\r\n                            this._moreLayerActiveButton = target;\r\n                            layer.style.display = 'block';\r\n\r\n                            event._showToolbarBalloon();\r\n                            event._showToolbarInline();\r\n                        }\r\n                        util.addClass(target, 'on');\r\n                    } else {\r\n                        const layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\r\n                        if (layer) {\r\n                            this.moreLayerOff();\r\n\r\n                            event._showToolbarBalloon();\r\n                            event._showToolbarInline();\r\n                        }        \r\n                    }\r\n                    return;\r\n                }\r\n                \r\n                if (/container/.test(display) && (this._menuTray[command] === null || target !== this.containerActiveButton)) {\r\n                    this.callPlugin(command, this.containerOn.bind(this, target), target);\r\n                    return;\r\n                } \r\n                \r\n                if (this.isReadOnly && util.arrayIncludes(this.resizingDisabledButtons, target)) return;\r\n                if (/submenu/.test(display) && (this._menuTray[command] === null || target !== this.submenuActiveButton)) {\r\n                    this.callPlugin(command, this.submenuOn.bind(this, target), target);\r\n                    return;\r\n                } else if (/dialog/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].open.bind(this), target);\r\n                    return;\r\n                } else if (/command/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].action.bind(this), target);\r\n                } else if (/fileBrowser/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].open.bind(this, null), target);\r\n                }\r\n            } // default command\r\n            else if (command) {\r\n                this.commandHandler(target, command);\r\n            }\r\n\r\n            if (/submenu/.test(display)) {\r\n                this.submenuOff();\r\n            } else if (!/command/.test(display)) {\r\n                this.submenuOff();\r\n                this.containerOff();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Execute command of command button(All Buttons except submenu and dialog)\r\n         * (selectAll, codeView, fullScreen, indent, outdent, undo, redo, removeFormat, print, preview, showBlocks, save, bold, underline, italic, strike, subscript, superscript, copy, cut, paste)\r\n         * @param {Element|null} target The element of command button\r\n         * @param {String} command Property of command button (data-value)\r\n         */\r\n        commandHandler: function (target, command) {\r\n            if (core.isReadOnly && !/copy|cut|selectAll|codeView|fullScreen|print|preview|showBlocks/.test(command)) return;\r\n            switch (command) {\r\n                case 'copy':\r\n                case 'cut':\r\n                    this.execCommand(command);\r\n                    break;\r\n                case 'paste':\r\n                    break;\r\n                case 'selectAll':\r\n                    this.containerOff();\r\n                    const wysiwyg = context.element.wysiwyg;\r\n                    let first = util.getChildElement(wysiwyg.firstChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, false) || wysiwyg.firstChild;\r\n                    let last = util.getChildElement(wysiwyg.lastChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, true) || wysiwyg.lastChild;\r\n                    if (!first || !last) return;\r\n                    if (util.isMedia(first)) {\r\n                        const info = this.getFileComponent(first);\r\n                        const br = util.createElement('BR');\r\n                        const format = util.createElement(options.defaultTag);\r\n                        format.appendChild(br);\r\n                        first = info ? info.component : first;\r\n                        first.parentNode.insertBefore(format, first);\r\n                        first = br;\r\n                    }\r\n                    if (util.isMedia(last)) {\r\n                        const br = util.createElement('BR');\r\n                        const format = util.createElement(options.defaultTag);\r\n                        format.appendChild(br);\r\n                        wysiwyg.appendChild(format);\r\n                        last = br;\r\n                    }\r\n                    event._showToolbarBalloon(this.setRange(first, 0, last, last.textContent.length));\r\n                    break;\r\n                case 'codeView':\r\n                    this.toggleCodeView();\r\n                    break;\r\n                case 'fullScreen':\r\n                    this.toggleFullScreen(target);\r\n                    break;\r\n                case 'indent':\r\n                case 'outdent':\r\n                    this.indent(command);\r\n                    break;\r\n                case 'undo':\r\n                    this.history.undo();\r\n                    break;\r\n                case 'redo':\r\n                    this.history.redo();\r\n                    break;\r\n                case 'removeFormat':\r\n                    this.removeFormat();\r\n                    this.focus();\r\n                    break;\r\n                case 'print':\r\n                    this.print();\r\n                    break;\r\n                case 'preview':\r\n                    this.preview();\r\n                    break;\r\n                case 'showBlocks':\r\n                    this.toggleDisplayBlocks();\r\n                    break;\r\n                case 'dir':\r\n                    this.setDir(options.rtl ? 'ltr' : 'rtl');\r\n                    break;\r\n                case 'dir_ltr':\r\n                    this.setDir('ltr');\r\n                    break;\r\n                case 'dir_rtl':\r\n                    this.setDir('rtl');\r\n                    break;\r\n                case 'save':\r\n                    if (typeof options.callBackSave === 'function') {\r\n                        options.callBackSave(this.getContents(false), this._variable.isChanged);\r\n                    } else if (this._variable.isChanged && typeof functions.save === 'function') {\r\n                        functions.save();\r\n                    } else {\r\n                        throw Error('[SUNEDITOR.core.commandHandler.fail] Please register call back function in creation option. (callBackSave : Function)');\r\n                    }\r\n\r\n                    this._variable.isChanged = false;\r\n                    if (context.tool.save) context.tool.save.setAttribute('disabled', true);\r\n                    break;\r\n                default : // 'STRONG', 'U', 'EM', 'DEL', 'SUB', 'SUP'..\r\n                    command = options._defaultCommand[command.toLowerCase()] || command;\r\n                    if (!this.commandMap[command]) this.commandMap[command] = target;\r\n\r\n                    const nodesMap = this._variable.currentNodesMap;\r\n                    const cmd = nodesMap.indexOf(command) > -1 ? null : util.createElement(command);\r\n                    let removeNode = command;\r\n\r\n                    if (/^SUB$/i.test(command) && nodesMap.indexOf('SUP') > -1) {\r\n                        removeNode = 'SUP';\r\n                    } else if (/^SUP$/i.test(command) && nodesMap.indexOf('SUB') > -1) {\r\n                        removeNode = 'SUB';\r\n                    }\r\n\r\n                    this.nodeChange(cmd, this._commandMapStyles[command] || null, [removeNode], false);\r\n                    this.focus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Remove format of the currently selected range\r\n         */\r\n        removeFormat: function () {\r\n            this.nodeChange(null, null, null, null);\r\n        },\r\n\r\n        /**\r\n         * @description This method implements indentation to selected range.\r\n         * Setted \"margin-left\" to \"25px\" in the top \"P\" tag of the parameter node.\r\n         * @param {String} command Separator (\"indent\" or \"outdent\")\r\n         */\r\n        indent: function (command) {\r\n            const range = this.getRange();\r\n            const rangeLines = this.getSelectedElements(null);\r\n            const cells = [];\r\n            const shift = 'indent' !== command;\r\n            const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\r\n            let sc = range.startContainer;\r\n            let ec = range.endContainer;\r\n            let so = range.startOffset;\r\n            let eo = range.endOffset;\r\n\r\n            for (let i = 0, len = rangeLines.length, f, margin; i < len; i++) {\r\n                f = rangeLines[i];\r\n                if (!util.isListCell(f) || !this.plugins.list) {\r\n                    margin = /\\d+/.test(f.style[marginDir]) ? util.getNumber(f.style[marginDir], 0) : 0;\r\n                    if (shift) {\r\n                        margin -= 25;\r\n                    } else {\r\n                        margin += 25;\r\n                    }\r\n                    util.setStyle(f, marginDir, (margin <= 0 ? '' : margin + 'px'));\r\n                } else {\r\n                    if (shift || f.previousElementSibling) {\r\n                        cells.push(f);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // list cells\r\n            if (cells.length > 0) {\r\n                this.plugins.list.editInsideList.call(this, shift, cells);\r\n            }\r\n\r\n            this.effectNode = null;\r\n            this.setRange(sc, so, ec, eo);\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Add or remove the class name of \"body\" so that the code block is visible\r\n         */\r\n        toggleDisplayBlocks: function () {\r\n            const wysiwyg = context.element.wysiwyg;\r\n            util.toggleClass(wysiwyg, 'se-show-block');\r\n            if (util.hasClass(wysiwyg, 'se-show-block')) {\r\n                util.addClass(this._styleCommandMap.showBlocks, 'active');\r\n            } else {\r\n                util.removeClass(this._styleCommandMap.showBlocks, 'active');\r\n            }\r\n            this._resourcesStateChange();\r\n        },\r\n\r\n        /**\r\n         * @description Changes to code view or wysiwyg view\r\n         */\r\n        toggleCodeView: function () {\r\n            const isCodeView = this._variable.isCodeView;\r\n            this.controllersOff();\r\n            util.setDisabledButtons(!isCodeView, this.codeViewDisabledButtons);\r\n\r\n            if (isCodeView) {\r\n                if (!util.isNonEditable(context.element.wysiwygFrame)) this._setCodeDataToEditor();\r\n                context.element.wysiwygFrame.scrollTop = 0;\r\n                context.element.code.style.display = 'none';\r\n                context.element.wysiwygFrame.style.display = 'block';\r\n\r\n                this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\r\n                this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\r\n\r\n                if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = '0px';\r\n                \r\n                this._variable.isCodeView = false;\r\n                \r\n                if (!this._variable.isFullScreen) {\r\n                    this._notHideToolbar = false;\r\n                    if (/balloon|balloon-always/i.test(options.mode)) {\r\n                        context.element._arrow.style.display = '';\r\n                        this._isInline = false;\r\n                        this._isBalloon = true;\r\n                        event._hideToolbar();    \r\n                    }\r\n                }\r\n\r\n                this.nativeFocus();\r\n                util.removeClass(this._styleCommandMap.codeView, 'active');\r\n\r\n                // history stack\r\n                if (!util.isNonEditable(context.element.wysiwygFrame)) {\r\n                    this.history.push(false);\r\n                    this.history._resetCachingButton();\r\n                }\r\n            } else {\r\n                this._setEditorDataToCodeView();\r\n                this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\r\n                this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\r\n\r\n                if (this._variable.isFullScreen) context.element.code.style.height = '100%';\r\n                else if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = context.element.code.scrollHeight > 0 ? (context.element.code.scrollHeight + 'px') : 'auto';\r\n                \r\n                if (options.codeMirrorEditor) options.codeMirrorEditor.refresh();\r\n                \r\n                this._variable.isCodeView = true;\r\n\r\n                if (!this._variable.isFullScreen) {\r\n                    this._notHideToolbar = true;\r\n                    if (this._isBalloon) {\r\n                        context.element._arrow.style.display = 'none';\r\n                        context.element.toolbar.style.left = '';\r\n                        this._isInline = true;\r\n                        this._isBalloon = false;\r\n                        event._showToolbarInline();\r\n                    }\r\n                }\r\n                \r\n                this._variable._range = null;\r\n                context.element.code.focus();\r\n                util.addClass(this._styleCommandMap.codeView, 'active');\r\n            }\r\n\r\n            this._checkPlaceholder();\r\n            if (this.isReadOnly) util.setDisabledButtons(true, this.resizingDisabledButtons);\r\n\r\n            // user event\r\n            if (typeof functions.toggleCodeView === 'function') functions.toggleCodeView(this._variable.isCodeView, this);\r\n        },\r\n\r\n        /**\r\n         * @description Convert the data of the code view and put it in the WYSIWYG area.\r\n         * @private\r\n         */\r\n        _setCodeDataToEditor: function () {\r\n            const code_html = this._getCodeView();\r\n\r\n            if (options.fullPage) {\r\n                const parseDocument = this._parser.parseFromString(code_html, 'text/html');\r\n                const headChildren = parseDocument.head.children;\r\n\r\n                for (let i = 0, len = headChildren.length; i < len; i++) {\r\n                    if (/^script$/i.test(headChildren[i].tagName)) {\r\n                        parseDocument.head.removeChild(headChildren[i]);\r\n                        i--, len--;\r\n                    }\r\n                }\r\n\r\n                let headers = parseDocument.head.innerHTML;\r\n                if (!parseDocument.head.querySelector('link[rel=\"stylesheet\"]') || (this.options.height === 'auto' && !parseDocument.head.querySelector('style'))) {\r\n                    headers += util._setIframeCssTags(this.options);\r\n                }\r\n\r\n                this._wd.head.innerHTML = headers;\r\n                this._wd.body.innerHTML = this.convertContentsForEditor(parseDocument.body.innerHTML);\r\n\r\n                const attrs = parseDocument.body.attributes;\r\n                for (let i = 0, len = attrs.length; i < len; i++) {\r\n                    if (attrs[i].name === 'contenteditable') continue;\r\n                    this._wd.body.setAttribute(attrs[i].name, attrs[i].value);\r\n                }\r\n                if (!util.hasClass(this._wd.body, 'sun-editor-editable')) {\r\n                    const editableClasses = options._editableClass.split(' ');\r\n                    for (let i = 0; i < editableClasses.length; i++) {\r\n                        util.addClass(this._wd.body, options._editableClass[i]);\r\n                    }\r\n                }\r\n            } else {\r\n                context.element.wysiwyg.innerHTML = code_html.length > 0 ? this.convertContentsForEditor(code_html) : '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Convert the data of the WYSIWYG area and put it in the code view area.\r\n         * @private\r\n         */\r\n        _setEditorDataToCodeView: function () {\r\n            const codeContents = this.convertHTMLForCodeView(context.element.wysiwyg, false);\r\n            let codeValue = '';\r\n\r\n            if (options.fullPage) {\r\n                const attrs = util.getAttributesToString(this._wd.body, null);\r\n                codeValue = '<!DOCTYPE html>\\n<html>\\n' + this._wd.head.outerHTML.replace(/>(?!\\n)/g, '>\\n') + '<body ' + attrs + '>\\n' + codeContents + '</body>\\n</html>';\r\n            } else {\r\n                codeValue = codeContents;\r\n            }\r\n\r\n            context.element.code.style.display = 'block';\r\n            context.element.wysiwygFrame.style.display = 'none';\r\n\r\n            this._setCodeView(codeValue);\r\n        },\r\n\r\n        /**\r\n         * @description Changes to full screen or default screen\r\n         * @param {Element|null} element full screen button\r\n         */\r\n        toggleFullScreen: function (element) {\r\n            const topArea = context.element.topArea;\r\n            const toolbar = context.element.toolbar;\r\n            const editorArea = context.element.editorArea;\r\n            const wysiwygFrame = context.element.wysiwygFrame;\r\n            const code = context.element.code;\r\n            const _var = this._variable;\r\n            this.controllersOff();\r\n            \r\n            const wasToolbarHidden = (toolbar.style.display === 'none' || (this._isInline && !this._inlineToolbarAttr.isShow));\r\n\r\n            if (!_var.isFullScreen) {\r\n                _var.isFullScreen = true;\r\n                \r\n                _var._fullScreenAttrs.inline = this._isInline;\r\n                _var._fullScreenAttrs.balloon = this._isBalloon;\r\n\r\n                if (this._isInline || this._isBalloon) {\r\n                    this._isInline = false;\r\n                    this._isBalloon = false;\r\n                }\r\n                \r\n                if (!!options.toolbarContainer) context.element.relative.insertBefore(toolbar, editorArea);\r\n\r\n                topArea.style.position = 'fixed';\r\n                topArea.style.top = '0';\r\n                topArea.style.left = '0';\r\n                topArea.style.width = '100%';\r\n                topArea.style.maxWidth = '100%';\r\n                topArea.style.height = '100%';\r\n                topArea.style.zIndex = '2147483647';\r\n\r\n                if (context.element._stickyDummy.style.display !== ('none' && '')) {\r\n                    _var._fullScreenAttrs.sticky = true;\r\n                    context.element._stickyDummy.style.display = 'none';\r\n                    util.removeClass(toolbar, 'se-toolbar-sticky');\r\n                }\r\n\r\n                _var._bodyOverflow = _d.body.style.overflow;\r\n                _d.body.style.overflow = 'hidden';\r\n\r\n                _var._editorAreaOriginCssText = editorArea.style.cssText;\r\n                _var._wysiwygOriginCssText = wysiwygFrame.style.cssText;\r\n                _var._codeOriginCssText = code.style.cssText;\r\n\r\n                editorArea.style.cssText = toolbar.style.cssText = '';\r\n                wysiwygFrame.style.cssText = (wysiwygFrame.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0] + options.defaultStyle;\r\n                code.style.cssText = (code.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\r\n                toolbar.style.width = wysiwygFrame.style.height = code.style.height = '100%';\r\n                toolbar.style.position = 'relative';\r\n                toolbar.style.display = 'block';\r\n\r\n                _var.innerHeight_fullScreen = (_w.innerHeight - toolbar.offsetHeight);\r\n                editorArea.style.height = (_var.innerHeight_fullScreen - options.fullScreenOffset) + 'px';\r\n\r\n                if (element) util.changeElement(element.firstElementChild, icons.reduction);\r\n\r\n                if (options.iframe && options.height === 'auto') {\r\n                    editorArea.style.overflow = 'auto';\r\n                    this._iframeAutoHeight();\r\n                }\r\n\r\n                context.element.topArea.style.marginTop = options.fullScreenOffset + 'px';\r\n                util.addClass(this._styleCommandMap.fullScreen, 'active');\r\n            } else {\r\n                _var.isFullScreen = false;\r\n\r\n                wysiwygFrame.style.cssText = _var._wysiwygOriginCssText;\r\n                code.style.cssText = _var._codeOriginCssText;\r\n                toolbar.style.cssText = '';\r\n                editorArea.style.cssText = _var._editorAreaOriginCssText;\r\n                topArea.style.cssText = _var._originCssText;\r\n                _d.body.style.overflow = _var._bodyOverflow;\r\n\r\n                if (options.height === 'auto' && !options.codeMirrorEditor) event._codeViewAutoHeight();\r\n\r\n                if (!!options.toolbarContainer) options.toolbarContainer.appendChild(toolbar);\r\n\r\n                if (options.stickyToolbar > -1) {\r\n                    util.removeClass(toolbar, 'se-toolbar-sticky');\r\n                }\r\n\r\n                if (_var._fullScreenAttrs.sticky && !options.toolbarContainer) {\r\n                    _var._fullScreenAttrs.sticky = false;\r\n                    context.element._stickyDummy.style.display = 'block';\r\n                    util.addClass(toolbar, \"se-toolbar-sticky\");\r\n                }\r\n\r\n                this._isInline = _var._fullScreenAttrs.inline;\r\n                this._isBalloon = _var._fullScreenAttrs.balloon;\r\n                if (this._isInline) event._showToolbarInline();\r\n                if (!!options.toolbarContainer) util.removeClass(toolbar, 'se-toolbar-balloon');\r\n\r\n                event.onScroll_window();\r\n                if (element) util.changeElement(element.firstElementChild, icons.expansion);\r\n\r\n                context.element.topArea.style.marginTop = '';\r\n                util.removeClass(this._styleCommandMap.fullScreen, 'active');\r\n            }\r\n\r\n            if (wasToolbarHidden) functions.toolbar.hide();\r\n\r\n            // user event\r\n            if (typeof functions.toggleFullScreen === 'function') functions.toggleFullScreen(this._variable.isFullScreen, this);\r\n        },\r\n\r\n        /**\r\n         * @description Prints the current contents of the editor.\r\n         */\r\n        print: function () {\r\n            const iframe = util.createElement('IFRAME');\r\n            iframe.style.display = 'none';\r\n            _d.body.appendChild(iframe);\r\n\r\n            const contentsHTML = options.printTemplate ? options.printTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\r\n            const printDocument = util.getIframeDocument(iframe);\r\n            const wDoc = this._wd;\r\n\r\n            if (options.iframe) {\r\n                const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\r\n\r\n                printDocument.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    wDoc.head.innerHTML +\r\n                    '</head>' +\r\n                    '<body ' + arrts + '>' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            } else {\r\n                const links = _d.head.getElementsByTagName('link');\r\n                const styles = _d.head.getElementsByTagName('style');\r\n                let linkHTML = '';\r\n                for (let i = 0, len = links.length; i < len; i++) {\r\n                    linkHTML += links[i].outerHTML;\r\n                }\r\n                for (let i = 0, len = styles.length; i < len; i++) {\r\n                    linkHTML += styles[i].outerHTML;\r\n                }\r\n\r\n                printDocument.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    linkHTML +\r\n                    '</head>' +\r\n                    '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\">' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            }\r\n\r\n            this.showLoading();\r\n            _w.setTimeout(function () {\r\n                try {\r\n                    iframe.focus();\r\n                    // IE or Edge, Chromium\r\n                    if (util.isIE_Edge || util.isChromium || !!_d.documentMode || !!_w.StyleMedia) {\r\n                        try {\r\n                            iframe.contentWindow.document.execCommand('print', false, null);\r\n                        } catch (e) {\r\n                            iframe.contentWindow.print();\r\n                        }\r\n                    } else {\r\n                        // Other browsers\r\n                        iframe.contentWindow.print();\r\n                    }\r\n                } catch (error) {\r\n                    throw Error('[SUNEDITOR.core.print.fail] error: ' + error);\r\n                } finally {\r\n                    core.closeLoading();\r\n                    util.removeItem(iframe);\r\n                }\r\n            }, 1000);\r\n        },\r\n\r\n        /**\r\n         * @description Open the preview window.\r\n         */\r\n        preview: function () {\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            core.controllersOff();\r\n            \r\n            const contentsHTML = options.previewTemplate ? options.previewTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\r\n            const windowObject = _w.open('', '_blank');\r\n            windowObject.mimeType = 'text/html';\r\n            const wDoc = this._wd;\r\n\r\n            if (options.iframe) {\r\n                const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\r\n\r\n                windowObject.document.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    wDoc.head.innerHTML +\r\n                    '<style>body {overflow:auto !important; margin: 10px auto !important; height:auto !important; outline:1px dashed #ccc;}</style>' +\r\n                    '</head>' +\r\n                    '<body ' + arrts + '>' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            } else {\r\n                const links = _d.head.getElementsByTagName('link');\r\n                const styles = _d.head.getElementsByTagName('style');\r\n                let linkHTML = '';\r\n                for (let i = 0, len = links.length; i < len; i++) {\r\n                    linkHTML += links[i].outerHTML;\r\n                }\r\n                for (let i = 0, len = styles.length; i < len; i++) {\r\n                    linkHTML += styles[i].outerHTML;\r\n                }\r\n                \r\n                windowObject.document.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    '<meta charset=\"utf-8\" />' +\r\n                    '<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1\">' +\r\n                    '<title>' + lang.toolbar.preview + '</title>' +\r\n                    linkHTML +\r\n                    '</head>' +\r\n                    '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\" style=\"margin:10px auto !important; height:auto !important; outline:1px dashed #ccc;\">' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set direction to \"rtl\" or \"ltr\".\r\n         * @param {String} dir \"rtl\" or \"ltr\"\r\n         */\r\n        setDir: function (dir) {\r\n            const rtl = dir === 'rtl';\r\n            const changeDir = this._prevRtl !== rtl;\r\n            this._prevRtl = options.rtl = rtl;\r\n\r\n            if (changeDir) {\r\n                // align buttons\r\n                if (this.plugins.align) {\r\n                    this.plugins.align.exchangeDir.call(this);\r\n                }\r\n                // indent buttons\r\n                if (context.tool.indent) util.changeElement(context.tool.indent.firstElementChild, icons.indent);\r\n                if (context.tool.outdent) util.changeElement(context.tool.outdent.firstElementChild, icons.outdent);\r\n            }\r\n\r\n            const el = context.element;\r\n            if (rtl) {\r\n                util.addClass(el.topArea, 'se-rtl');\r\n                util.addClass(el.wysiwygFrame, 'se-rtl');\r\n            } else {\r\n                util.removeClass(el.topArea, 'se-rtl');\r\n                util.removeClass(el.wysiwygFrame, 'se-rtl');\r\n            }\r\n\r\n            const lineNodes = util.getListChildren(el.wysiwyg, function (current) {\r\n                return util.isFormatElement(current) && (current.style.marginRight || current.style.marginLeft || current.style.textAlign);\r\n            });\r\n\r\n            for (let i = 0, len = lineNodes.length, n, l, r; i < len; i++) {\r\n                n = lineNodes[i];\r\n                // indent margin\r\n                r = n.style.marginRight;\r\n                l = n.style.marginLeft;\r\n                if (r || l) {\r\n                    n.style.marginRight = l;\r\n                    n.style.marginLeft = r;\r\n                }\r\n                // text align\r\n                r = n.style.textAlign;\r\n                if (r === 'left') n.style.textAlign = 'right';\r\n                else if (r === 'right') n.style.textAlign = 'left';\r\n            }\r\n\r\n            const tool = context.tool;\r\n            if (tool.dir) {\r\n                util.changeTxt(tool.dir.querySelector('.se-tooltip-text'), lang.toolbar[options.rtl ? 'dir_ltr' : 'dir_rtl']);\r\n                util.changeElement(tool.dir.firstElementChild, icons[options.rtl ? 'dir_ltr' : 'dir_rtl']);\r\n            }\r\n\r\n            if (tool.dir_ltr) {\r\n                if (rtl) util.removeClass(tool.dir_ltr, 'active');\r\n                else util.addClass(tool.dir_ltr, 'active');\r\n            }\r\n\r\n            if (tool.dir_rtl) {\r\n                if (rtl) util.addClass(tool.dir_rtl, 'active');\r\n                else util.removeClass(tool.dir_rtl, 'active');\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Sets the HTML string\r\n         * @param {String|undefined} html HTML string\r\n         */\r\n        setContents: function (html) {\r\n            this.removeRange();\r\n            \r\n            const convertValue = (html === null || html === undefined) ? '' : this.convertContentsForEditor(html);\r\n            this._resetComponents();\r\n\r\n            if (!this._variable.isCodeView) {\r\n                context.element.wysiwyg.innerHTML = convertValue;\r\n                // history stack\r\n                this.history.push(false);\r\n            } else {\r\n                const value = this.convertHTMLForCodeView(convertValue, false);\r\n                this._setCodeView(value);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Sets the contents of the iframe's head tag and body tag when using the \"iframe\" or \"fullPage\" option.\r\n         * @param {Object} ctx { head: HTML string, body: HTML string}\r\n         */\r\n        setIframeContents: function (ctx) {\r\n            if (!options.iframe) return false;\r\n            if (ctx.head) this._wd.head.innerHTML = ctx.head.replace(/<script[\\s\\S]*>[\\s\\S]*<\\/script>/gi, '');\r\n            if (ctx.body) this._wd.body.innerHTML = this.convertContentsForEditor(ctx.body);\r\n        },\r\n\r\n        /**\r\n         * @description Gets the current contents\r\n         * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n         * @returns {Object}\r\n         */\r\n        getContents: function (onlyContents) {\r\n            const contents = this.convertHTMLForCodeView(context.element.wysiwyg, true);\r\n            const renderHTML = util.createElement('DIV');\r\n            renderHTML.innerHTML = contents;\r\n\r\n            const figcaptions = util.getListChildren(renderHTML, function (current) {\r\n                return /FIGCAPTION/i.test(current.nodeName);\r\n            });\r\n\r\n            for (let i = 0, len = figcaptions.length; i < len; i++) {\r\n                figcaptions[i].removeAttribute('contenteditable');\r\n            }\r\n\r\n            if (options.fullPage && !onlyContents) {\r\n                const attrs = util.getAttributesToString(this._wd.body, ['contenteditable']);\r\n                return '<!DOCTYPE html><html>' + this._wd.head.outerHTML + '<body ' + attrs + '>' + renderHTML.innerHTML + '</body></html>';\r\n            } else {\r\n                return renderHTML.innerHTML;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Gets the current contents with containing parent div(div.sun-editor-editable).\r\n         * <div class=\"sun-editor-editable\">{contents}</div>\r\n         * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n         * @returns {String}\r\n         */\r\n        getFullContents: function (onlyContents) {\r\n            return '<div class=\"sun-editor-editable' + (options.rtl ? ' se-rtl' : '') + '\">' + this.getContents(onlyContents) + '</div>';\r\n        },\r\n\r\n        /**\r\n         * @description Returns HTML string according to tag type and configuration.\r\n         * Use only \"cleanHTML\"\r\n         * @param {Node} node Node\r\n         * @param {Boolean} requireFormat If true, text nodes that do not have a format node is wrapped with the format tag.\r\n         * @private\r\n         */\r\n        _makeLine: function (node, requireFormat) {\r\n            const defaultTag = options.defaultTag;\r\n            // element\r\n            if (node.nodeType === 1) {\r\n                if (util._disallowedTags(node)) return '';\r\n\r\n                const ch = util.getListChildNodes(node, function(current) { return util.isSpanWithoutAttr(current); }) || [];\r\n                for (let i = ch.length - 1; i >= 0; i--) {\r\n                    ch[i].outerHTML = ch[i].innerHTML;\r\n                }\r\n\r\n                if (!requireFormat || (util.isFormatElement(node) || util.isRangeFormatElement(node) || util.isComponent(node) || util.isMedia(node) || (util.isAnchor(node) && util.isMedia(node.firstElementChild)))) {\r\n                    return util.isSpanWithoutAttr(node) ? node.innerHTML : node.outerHTML;\r\n                } else {\r\n                    return '<' + defaultTag + '>' + (util.isSpanWithoutAttr(node) ? node.innerHTML : node.outerHTML) + '</' + defaultTag + '>';\r\n                }\r\n            }\r\n            // text\r\n            if (node.nodeType === 3) {\r\n                if (!requireFormat) return util._HTMLConvertor(node.textContent);\r\n                const textArray = node.textContent.split(/\\n/g);\r\n                let html = '';\r\n                for (let i = 0, tLen = textArray.length, text; i < tLen; i++) {\r\n                    text = textArray[i].trim();\r\n                    if (text.length > 0) html += '<' + defaultTag + '>' + util._HTMLConvertor(text) + '</' + defaultTag + '>';\r\n                }\r\n                return html;\r\n            }\r\n            // comments\r\n            if (node.nodeType === 8 && this._allowHTMLComments) {\r\n                return '<!--' + node.textContent.trim() + '-->';\r\n            }\r\n\r\n            return '';\r\n        },\r\n\r\n        /**\r\n         * @description Removes attribute values such as style and converts tags that do not conform to the \"html5\" standard.\r\n         * @param {String} text \r\n         * @returns {String} HTML string\r\n         * @private\r\n         */\r\n        _tagConvertor: function (text) {\r\n            if (!this._disallowedTextTagsRegExp) return text;\r\n\r\n            const ec = options._textTagsMap;\r\n            return text.replace(this._disallowedTextTagsRegExp, function (m, t, n, p) {\r\n                return t + (typeof ec[n] === 'string' ? ec[n] : n) + (p ? ' ' + p : '');\r\n            });\r\n        },\r\n\r\n        /**\r\n         * @description Delete disallowed tags\r\n         * @param {String} html HTML string\r\n         * @returns {String}\r\n         * @private\r\n         */\r\n        _deleteDisallowedTags: function (html) {\r\n            return html\r\n                .replace(/\\n/g, '')\r\n                .replace(/<(script|style)[\\s\\S]*>[\\s\\S]*<\\/(script|style)>/gi, '')\r\n                .replace(/<[a-z0-9]+\\:[a-z0-9]+[^>^\\/]*>[^>]*<\\/[a-z0-9]+\\:[a-z0-9]+>/gi, '')\r\n                .replace(this.editorTagsWhitelistRegExp, '')\r\n                .replace(this.editorTagsBlacklistRegExp, '');\r\n        },\r\n\r\n        _convertFontSize: function (to, size) {\r\n            const value = size.match(/(\\d+(?:\\.\\d+)?)(.+)/);\r\n            const sizeNum = value[1] * 1;\r\n            const from = value[2];\r\n            let pxSize = sizeNum;\r\n            \r\n            if (/em/.test(from)) {\r\n                pxSize = this.round(sizeNum / 0.0625);\r\n            } else if (from === 'pt') {\r\n                pxSize = this.round(sizeNum * 1.333);\r\n            } else if (from === '%') {\r\n                pxSize = sizeNum / 100;\r\n            }\r\n\r\n            switch (to) {\r\n                case 'em':\r\n                case 'rem':\r\n                case '%':\r\n                    return (pxSize * 0.0625).toFixed(2) + to;\r\n                case 'pt':\r\n                    return this.floor(pxSize / 1.333) + to;\r\n                default: // px\r\n                    return pxSize + to;\r\n            }\r\n        },\r\n\r\n        _cleanStyle: function (m, v, name) {\r\n            const sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\r\n            if (sv) {\r\n                if (!v) v = [];\r\n                const style = sv[0].replace(/&quot;/g, '').match(this._cleanStyleRegExp[name]);\r\n                if (style) {\r\n                    const allowedStyle = [];\r\n                    for (let i = 0, len = style.length, r; i < len; i++) {\r\n                        r = style[i].match(/([a-zA-Z0-9-]+)(:)([^:]+$)/);\r\n                        if (r && !/inherit|initial/i.test(r[3])) {\r\n                            const k = util.kebabToCamelCase(r[1].trim());\r\n                            const v = this.wwComputedStyle[k].replace(/\"/g, '');\r\n                            const c = r[3].trim();\r\n                            switch (k) {\r\n                                case 'fontFamily':\r\n                                    if (!options.plugins.font || options.font.indexOf(c) === -1) continue;\r\n                                    break;\r\n                                case 'fontSize':\r\n                                    if (!options.plugins.fontSize) continue;\r\n                                    if (!this._cleanStyleRegExp.fontSizeUnit.test(r[0])) {\r\n                                        r[0] = r[0].replace(this._w.RegExp('\\\\d+' + r[0].match(/\\d+(.+$)/)[1]), this._convertFontSize.bind(this._w.Math, options.fontSizeUnit));\r\n                                    }\r\n                                    break;\r\n                                case 'color':\r\n                                    if (!options.plugins.fontColor || /rgba\\(([0-9]+\\s*,\\s*){3}0\\)|windowtext/i.test(c)) continue;\r\n                                    break;\r\n                                case 'backgroundColor':\r\n                                    if (!options.plugins.hiliteColor || /rgba\\(([0-9]+\\s*,\\s*){3}0\\)|windowtext/i.test(c)) continue;\r\n                                    break;\r\n                            }\r\n                            \r\n                            if (v !== c) {\r\n                                allowedStyle.push(r[0]);\r\n                            }\r\n                        }\r\n                    }\r\n                    if (allowedStyle.length > 0) v.push('style=\"' + allowedStyle.join(';') + '\"');\r\n                }\r\n            }\r\n\r\n            return v;\r\n        },\r\n\r\n        /**\r\n         * @description Tag and tag attribute check RegExp function. (used by \"cleanHTML\" and \"convertContentsForEditor\")\r\n         * @param {Boolean} lowLevelCheck Row level check\r\n         * @param {String} m RegExp value\r\n         * @param {String} t RegExp value\r\n         * @returns {String}\r\n         * @private\r\n         */\r\n        _cleanTags: function (lowLevelCheck, m, t) {\r\n            if (/^<[a-z0-9]+\\:[a-z0-9]+/i.test(m)) return m;\r\n\r\n            let v = null;\r\n            const tagName = t.match(/(?!<)[a-zA-Z0-9\\-]+/)[0].toLowerCase();\r\n\r\n            // blacklist\r\n            const bAttr = this._attributesTagsBlacklist[tagName];\r\n            m = m.replace(/\\s(?:on[a-z]+)\\s*=\\s*(\")[^\"]*\\1/ig, '');\r\n            if (bAttr) m = m.replace(bAttr, '');\r\n            else m = m.replace(this._attributesBlacklistRegExp, '');\r\n\r\n            // whitelist\r\n            const wAttr = this._attributesTagsWhitelist[tagName];\r\n            if (wAttr) v = m.match(wAttr);\r\n            else v = m.match(lowLevelCheck ? this._attributesWhitelistRegExp : this._attributesWhitelistRegExp_all_data);\r\n\r\n            // attribute\r\n            if (lowLevelCheck) {\r\n                if (tagName === 'a') {\r\n                    const sv = m.match(/(?:(?:id|name)\\s*=\\s*(?:\"|')[^\"']*(?:\"|'))/g);\r\n                    if (sv) {\r\n                        if (!v) v = [];\r\n                        v.push(sv[0]);\r\n                    }\r\n                } else if (!v || !/style=/i.test(v.toString())) {\r\n                    if (tagName === 'span') {\r\n                        v = this._cleanStyle(m, v, 'span');\r\n                    } else if (/^(P|DIV|H[1-6]|PRE)$/i.test(tagName)) {\r\n                        v = this._cleanStyle(m, v, 'format');\r\n                    }\r\n                }\r\n            } else {\r\n                const sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\r\n                if (sv && !v) v = [sv[0]];\r\n                else if (sv && !v.some(function (v) { return /^style/.test(v.trim()); })) v.push(sv[0]);\r\n            }\r\n\r\n            // img\r\n            if (tagName === 'img') {\r\n                let w = '', h = '';\r\n                const sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\r\n                if (!v) v = [];\r\n                if (sv) {\r\n                    w = sv[0].match(/width:(.+);/);\r\n                    w = util.getNumber(w ? w[1] : '', -1) || '';\r\n                    h = sv[0].match(/height:(.+);/);\r\n                    h = util.getNumber(h ? h[1] : '', -1) || '';\r\n                } \r\n                \r\n                if (!w || !h) {\r\n                    const avw = m.match(/width\\s*=\\s*((?:\"|')[^\"']*(?:\"|'))/);\r\n                    const avh = m.match(/height\\s*=\\s*((?:\"|')[^\"']*(?:\"|'))/);\r\n                    if (avw || avh) {\r\n                        w = !w ? util.getNumber(avw ? avw[1] : '') || '' : w;\r\n                        h = !h ? util.getNumber(avh ? avh[1] : '') || '' : h;\r\n                    }\r\n                }\r\n                v.push('data-origin=\"' + (w + ',' + h) + '\"');\r\n            }\r\n\r\n            if (v) {\r\n                for (let i = 0, len = v.length; i < len; i++) {\r\n                    if (lowLevelCheck && /^class=\"(?!(__se__|se-|katex))/.test(v[i].trim())) continue;\r\n                    t += ' ' + (/^(?:href|src)\\s*=\\s*('|\"|\\s)*javascript\\s*\\:/i.test(v[i].trim()) ? '' : v[i]);\r\n                }\r\n            }\r\n\r\n            return t;\r\n        },\r\n\r\n        /**\r\n         * @description Determines if formatting is required and returns a domTree\r\n         * @param {Element} dom documentFragment\r\n         * @returns {Element}\r\n         * @private\r\n         */\r\n        _editFormat: function (dom) {\r\n            let value = '', f;\r\n            const tempTree = dom.childNodes;\r\n            for (let i = 0, len = tempTree.length, n; i < len; i++) {\r\n                n = tempTree[i];\r\n                if (!util.isFormatElement(n) && !util.isRangeFormatElement(n) && !util.isComponent(n) && !/meta/i.test(n.nodeName)) {\r\n                    if (!f) f = util.createElement(options.defaultTag);\r\n                    f.appendChild(n);\r\n                    i--; len--;\r\n                } else {\r\n                    if (f) {\r\n                        value += f.outerHTML;\r\n                        f = null;\r\n                    }\r\n                    value += n.outerHTML;\r\n                }\r\n            }\r\n\r\n            if (f) value += f.outerHTML;\r\n\r\n            return _d.createRange().createContextualFragment(value);\r\n        },\r\n\r\n        _convertListCell: function (domTree) {\r\n            let html = '';\r\n\r\n            for (let i = 0, len = domTree.length, node; i < len; i++) {\r\n                node = domTree[i];\r\n                if (node.nodeType === 1) {\r\n                    if (util.isList(node)) {\r\n                        html += node.innerHTML;\r\n                    } else if (util.isListCell(node)) {\r\n                        html += node.outerHTML;\r\n                    } else if (util.isFormatElement(node)) {\r\n                        html += '<li>' +(node.innerHTML.trim() || '<br>') + '</li>';\r\n                    } else if (util.isRangeFormatElement(node) && !util.isTable(node)) {\r\n                        html += this._convertListCell(node);\r\n                    } else {\r\n                        html += '<li>' + node.outerHTML + '</li>';\r\n                    }\r\n                } else {\r\n                    html += '<li>' + (node.textContent || '<br>') + '</li>';\r\n                }\r\n            }\r\n\r\n            return html;\r\n        },\r\n\r\n        _isFormatData: function (domTree) {\r\n            let requireFormat = false;\r\n\r\n            for (let i = 0, len = domTree.length, t; i < len; i++) {\r\n                t = domTree[i];\r\n                if (t.nodeType === 1 && !util.isTextStyleElement(t) && !util.isBreak(t) && !util._disallowedTags(t)) {\r\n                    requireFormat = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            return requireFormat;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the clean HTML code for editor\r\n         * @param {String} html HTML string\r\n         * @param {String|RegExp|null} whitelist Regular expression of allowed tags.\r\n         * RegExp object is create by util.createTagsWhitelist method. (core.pasteTagsWhitelistRegExp)\r\n         * @param {String|RegExp|null} blacklist Regular expression of disallowed tags.\r\n         * RegExp object is create by util.createTagsBlacklist method. (core.pasteTagsBlacklistRegExp)\r\n         * @returns {String}\r\n         */\r\n        cleanHTML: function (html, whitelist, blacklist) {\r\n            html = this._deleteDisallowedTags(this._parser.parseFromString(html, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, true));\r\n\r\n            const dom = _d.createRange().createContextualFragment(html);\r\n            try {\r\n                util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, this._htmlCheckBlacklistRegExp, true);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.cleanHTML.consistencyCheck.fail] ' + error);\r\n            }\r\n            \r\n            if (this.managedTagsInfo && this.managedTagsInfo.query) {\r\n                const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\r\n                for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\r\n                    classList = [].slice.call(textCompList[i].classList);\r\n                    for (let c = 0, cLen = classList.length; c < cLen; c++) {\r\n                        initMethod = this.managedTagsInfo.map[classList[c]];\r\n                        if (initMethod) {\r\n                            initMethod(textCompList[i]);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            let domTree = dom.childNodes;\r\n            let cleanHTML = '';\r\n            const requireFormat = this._isFormatData(domTree);\r\n\r\n            if(requireFormat) {\r\n                domTree = this._editFormat(dom).childNodes;\r\n            }\r\n\r\n            for (let i = 0, len = domTree.length; i < len; i++) {\r\n                cleanHTML += this._makeLine(domTree[i], requireFormat);\r\n            }\r\n\r\n            cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\r\n            if (!cleanHTML) {\r\n                cleanHTML = html;\r\n            } else {\r\n                if (whitelist) cleanHTML = cleanHTML.replace(typeof whitelist === 'string' ? util.createTagsWhitelist(whitelist) : whitelist, '');\r\n                if (blacklist) cleanHTML = cleanHTML.replace(typeof blacklist === 'string' ? util.createTagsBlacklist(blacklist) : blacklist, '');\r\n            }\r\n\r\n            return this._tagConvertor(cleanHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Converts contents into a format that can be placed in an editor\r\n         * @param {String} contents contents\r\n         * @returns {String}\r\n         */\r\n        convertContentsForEditor: function (contents) {\r\n            contents = this._deleteDisallowedTags(this._parser.parseFromString(contents, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, false));\r\n            const dom = _d.createRange().createContextualFragment(contents);\r\n\r\n            try {\r\n                util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, this._htmlCheckBlacklistRegExp, false);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.convertContentsForEditor.consistencyCheck.fail] ' + error);\r\n            }\r\n\r\n            if (this.managedTagsInfo && this.managedTagsInfo.query) {\r\n                const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\r\n                for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\r\n                    classList = [].slice.call(textCompList[i].classList);\r\n                    for (let c = 0, cLen = classList.length; c < cLen; c++) {\r\n                        initMethod = this.managedTagsInfo.map[classList[c]];\r\n                        if (initMethod) {\r\n                            initMethod(textCompList[i]);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            const domTree = dom.childNodes;\r\n            let cleanHTML = '', p = null;\r\n            for (let i = 0, t; i < domTree.length; i++) {\r\n                t = domTree[i];\r\n\r\n                if (!util.isFormatElement(t) && !util.isRangeFormatElement(t) && !util.isComponent(t) && !util.isMedia(t) && t.nodeType !== 8) {\r\n                    if (!p) p = util.createElement(options.defaultTag);\r\n                    p.appendChild(t);\r\n                    i--;\r\n                    if (domTree[i + 1] && !util.isFormatElement(domTree[i + 1])) {\r\n                        continue;\r\n                    } else {\r\n                        t = p;\r\n                        p = null;\r\n                    }\r\n                }\r\n\r\n                if (p) {\r\n                    cleanHTML += this._makeLine(p, true);\r\n                    p = null;\r\n                }\r\n                cleanHTML += this._makeLine(t, true);\r\n            }\r\n            if (p) cleanHTML += this._makeLine(p, true);\r\n\r\n            if (cleanHTML.length === 0) return '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n\r\n            cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\r\n            return this._tagConvertor(cleanHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Converts wysiwyg area element into a format that can be placed in an editor of code view mode\r\n         * @param {Element|String} html WYSIWYG element (context.element.wysiwyg) or HTML string.\r\n         * @param {Boolean} comp If true, does not line break and indentation of tags.\r\n         * @returns {String}\r\n         */\r\n        convertHTMLForCodeView: function (html, comp) {\r\n            let returnHTML = '';\r\n            const wRegExp = _w.RegExp;\r\n            const brReg = new wRegExp('^(BLOCKQUOTE|PRE|TABLE|THEAD|TBODY|TR|TH|TD|OL|UL|IMG|IFRAME|VIDEO|AUDIO|FIGURE|FIGCAPTION|HR|BR|CANVAS|SELECT)$', 'i');\r\n            const wDoc = typeof html === 'string' ? _d.createRange().createContextualFragment(html) : html;\r\n            const isFormat = function (current) { return this.isFormatElement(current) || this.isComponent(current); }.bind(util);\r\n            const brChar = comp ? '' : '\\n';\r\n\r\n            let indentSize = comp ? 0 : this._variable.codeIndent * 1;\r\n            indentSize = indentSize > 0 ? new _w.Array(indentSize + 1).join(' ') : '';\r\n\r\n            (function recursionFunc (element, indent) {\r\n                const children = element.childNodes;\r\n                const elementRegTest = brReg.test(element.nodeName);\r\n                const elementIndent = (elementRegTest ? indent : '');\r\n\r\n                for (let i = 0, len = children.length, node, br, lineBR, nodeRegTest, tag, tagIndent; i < len; i++) {\r\n                    node = children[i];\r\n                    nodeRegTest = brReg.test(node.nodeName);\r\n                    br = nodeRegTest ? brChar : '';\r\n                    lineBR = isFormat(node) && !elementRegTest && !/^(TH|TD)$/i.test(element.nodeName) ? brChar : '';\r\n\r\n                    if (node.nodeType === 8) {\r\n                        returnHTML += '\\n<!-- ' + node.textContent.trim() + ' -->' + br;\r\n                        continue;\r\n                    }\r\n                    if (node.nodeType === 3) {\r\n                        if (!util.isList(node.parentElement)) returnHTML += util._HTMLConvertor(/^\\n+$/.test(node.data) ? '' : node.data);\r\n                        continue;\r\n                    }\r\n                    if (node.childNodes.length === 0) {\r\n                        returnHTML += (/^HR$/i.test(node.nodeName) ? brChar : '') + (/^PRE$/i.test(node.parentElement.nodeName) && /^BR$/i.test(node.nodeName) ? '' : elementIndent) + node.outerHTML + br;\r\n                        continue;\r\n                    }\r\n\r\n                    if (!node.outerHTML) { // IE\r\n                        returnHTML += new _w.XMLSerializer().serializeToString(node);\r\n                    } else {\r\n                        tag = node.nodeName.toLowerCase();\r\n                        tagIndent = elementIndent || nodeRegTest ? indent : '';\r\n                        returnHTML += (lineBR || (elementRegTest ? '' : br)) + tagIndent + node.outerHTML.match(wRegExp('<' + tag + '[^>]*>', 'i'))[0] + br;\r\n                        recursionFunc(node, indent + indentSize, '');\r\n                        returnHTML += (/\\n$/.test(returnHTML) ? tagIndent : '') + '</' + tag + '>' + (lineBR || br || elementRegTest ? brChar : '' || /^(TH|TD)$/i.test(node.nodeName) ? brChar : '');\r\n                    }\r\n                }\r\n            }(wDoc, ''));\r\n\r\n            return returnHTML.trim() + brChar;\r\n        },\r\n\r\n        /**\r\n         * @description Add an event to document.\r\n         * When created as an Iframe, the same event is added to the document in the Iframe.\r\n         * @param {String} type Event type\r\n         * @param {Function} listener Event listener\r\n         * @param {Boolean} useCapture Use event capture\r\n         */\r\n        addDocEvent: function (type, listener, useCapture) {\r\n            _d.addEventListener(type, listener, useCapture);\r\n            if (options.iframe) {\r\n                this._wd.addEventListener(type, listener);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Remove events from document.\r\n        * When created as an Iframe, the event of the document inside the Iframe is also removed.\r\n         * @param {String} type Event type\r\n         * @param {Function} listener Event listener\r\n         */\r\n        removeDocEvent: function (type, listener) {\r\n            _d.removeEventListener(type, listener);\r\n            if (options.iframe) {\r\n                this._wd.removeEventListener(type, listener);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description The current number of characters is counted and displayed.\r\n         * @param {String} inputText Text added.\r\n         * @returns {Boolean}\r\n         * @private\r\n         */\r\n        _charCount: function (inputText) {\r\n            const maxCharCount = options.maxCharCount;\r\n            const countType = options.charCounterType;\r\n            let nextCharCount = 0;\r\n            if (!!inputText) nextCharCount = this.getCharLength(inputText, countType);\r\n\r\n            this._setCharCount();\r\n\r\n            if (maxCharCount > 0) {\r\n                let over = false;\r\n                const count = functions.getCharCount(countType);\r\n                \r\n                if (count > maxCharCount) {\r\n                    over = true;\r\n                    if (nextCharCount > 0) {\r\n                        this._editorRange();\r\n                        const range = this.getRange();\r\n                        const endOff = range.endOffset - 1;\r\n                        const text = this.getSelectionNode().textContent;\r\n                        const slicePosition = range.endOffset - (count - maxCharCount);\r\n    \r\n                        this.getSelectionNode().textContent = text.slice(0, slicePosition < 0 ? 0 : slicePosition) + text.slice(range.endOffset, text.length);\r\n                        this.setRange(range.endContainer, endOff, range.endContainer, endOff);\r\n                    }\r\n                } else if ((count + nextCharCount) > maxCharCount) {\r\n                    over = true;\r\n                }\r\n\r\n                if (over) {\r\n                    this._callCounterBlink();\r\n                    if (nextCharCount > 0) return false;\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description When \"element\" is added, if it is greater than \"options.maxCharCount\", false is returned.\r\n         * @param {Node|String} element Element node or String.\r\n         * @param {String|null} charCounterType charCounterType. If it is null, the options.charCounterType\r\n         * @returns {Boolean}\r\n         */\r\n        checkCharCount: function (element, charCounterType) {\r\n            if (options.maxCharCount) {\r\n                const countType = charCounterType || options.charCounterType;\r\n                const length = this.getCharLength((typeof element === 'string' ? element : (this._charTypeHTML && element.nodeType === 1) ? element.outerHTML : element.textContent), countType);\r\n                if (length > 0 && length + functions.getCharCount(countType) > options.maxCharCount) {\r\n                    this._callCounterBlink();\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description Get the length of the content.\r\n         * Depending on the option, the length of the character is taken. (charCounterType)\r\n         * @param {String} content Content to count\r\n         * @param {String} charCounterType options.charCounterType\r\n         * @returns {Number}\r\n         */\r\n        getCharLength: function (content, charCounterType) {\r\n            return /byte/.test(charCounterType) ? util.getByteLength(content) : content.length;\r\n        },\r\n\r\n        /**\r\n         * @description Reset buttons of the responsive toolbar.\r\n         */\r\n        resetResponsiveToolbar: function () {\r\n            core.controllersOff();\r\n\r\n            const responsiveSize = event._responsiveButtonSize;\r\n            if (responsiveSize) {\r\n                let w = 0;\r\n                if ((core._isBalloon || core._isInline) && options.toolbarWidth === 'auto') {\r\n                    w = context.element.topArea.offsetWidth;\r\n                } else {\r\n                    w = context.element.toolbar.offsetWidth;\r\n                }\r\n\r\n                let responsiveWidth = 'default';\r\n                for (let i = 1, len = responsiveSize.length; i < len; i++) {\r\n                    if (w < responsiveSize[i]) {\r\n                        responsiveWidth = responsiveSize[i] + '';\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (event._responsiveCurrentSize !== responsiveWidth) {\r\n                    event._responsiveCurrentSize = responsiveWidth;\r\n                    functions.setToolbarButtons(event._responsiveButtons[responsiveWidth]);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set the char count to charCounter element textContent.\r\n         * @private\r\n         */\r\n        _setCharCount: function () {\r\n            if (context.element.charCounter) {\r\n                _w.setTimeout(function () { context.element.charCounter.textContent = functions.getCharCount(options.charCounterType); });\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description The character counter blinks.\r\n         * @private\r\n         */\r\n        _callCounterBlink: function () {\r\n            const charWrapper = context.element.charWrapper;\r\n            if (charWrapper && !util.hasClass(charWrapper, 'se-blink')) {\r\n                util.addClass(charWrapper, 'se-blink');\r\n                _w.setTimeout(function () {\r\n                    util.removeClass(charWrapper, 'se-blink');\r\n                }, 600);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Check the components such as image and video and modify them according to the format.\r\n         * @private\r\n         */\r\n        _checkComponents: function () {\r\n            for (let i = 0, len = this._fileInfoPluginsCheck.length; i < len; i++) {\r\n                this._fileInfoPluginsCheck[i]();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Initialize the information of the components.\r\n         * @private\r\n         */\r\n        _resetComponents: function () {\r\n            for (let i = 0, len = this._fileInfoPluginsReset.length; i < len; i++) {\r\n                this._fileInfoPluginsReset[i]();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set method in the code view area\r\n         * @param {String} value HTML string\r\n         * @private\r\n         */\r\n        _setCodeView: function (value) {\r\n            if (options.codeMirrorEditor) {\r\n                options.codeMirrorEditor.getDoc().setValue(value);\r\n            } else {\r\n                context.element.code.value = value;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Get method in the code view area\r\n         * @private\r\n         */\r\n        _getCodeView: function () {\r\n            return options.codeMirrorEditor ? options.codeMirrorEditor.getDoc().getValue() : context.element.code.value;\r\n        },\r\n\r\n        /**\r\n         * @description remove class, display text.\r\n         * @param {Array|null} ignoredList Igonred button list\r\n         */\r\n        _setKeyEffect: function (ignoredList) {\r\n            const commandMap = this.commandMap;\r\n            const activePlugins = this.activePlugins;\r\n\r\n            for (let key in commandMap) {\r\n                if (ignoredList.indexOf(key) > -1 || !util.hasOwn(commandMap, key)) continue;\r\n                if (activePlugins.indexOf(key) > -1) {\r\n                    plugins[key].active.call(this, null);\r\n                } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\r\n                    if (!util.isImportantDisabled(commandMap.OUTDENT)) commandMap.OUTDENT.setAttribute('disabled', true);\r\n                } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\r\n                    if (!util.isImportantDisabled(commandMap.INDENT)) commandMap.INDENT.removeAttribute('disabled');\r\n                } else {\r\n                    util.removeClass(commandMap[key], 'active');\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Initializ core variable\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _init: function (reload, _initHTML) {\r\n            const wRegExp = _w.RegExp;\r\n            this._ww = options.iframe ? context.element.wysiwygFrame.contentWindow : _w;\r\n            this._wd = _d;\r\n            this._charTypeHTML = options.charCounterType === 'byte-html';\r\n            this.wwComputedStyle = _w.getComputedStyle(context.element.wysiwyg);\r\n            this._editorHeight = context.element.wysiwygFrame.offsetHeight;\r\n            this._editorHeightPadding = util.getNumber(this.wwComputedStyle.getPropertyValue('padding-top')) + util.getNumber(this.wwComputedStyle.getPropertyValue('padding-bottom'));\r\n\r\n            if (!options.iframe && typeof _w.ShadowRoot === 'function') {\r\n                let child = context.element.wysiwygFrame;\r\n                while (child) {\r\n                    if (child.shadowRoot) {\r\n                        this._shadowRoot = child.shadowRoot;\r\n                        break;\r\n                    } else if (child instanceof _w.ShadowRoot) {\r\n                        this._shadowRoot = child;\r\n                        break;\r\n                    }\r\n                    child = child.parentNode;\r\n                }\r\n                if (this._shadowRoot) this._shadowRootControllerEventTarget = [];\r\n            }\r\n\r\n            // set disallow text nodes\r\n            const disallowTextTags = _w.Object.keys(options._textTagsMap);\r\n            const allowTextTags = !options.addTagsWhitelist ? [] : options.addTagsWhitelist.split('|').filter(function (v) { return /b|i|ins|s|strike/i.test(v); });\r\n            for (let i = 0; i < allowTextTags.length; i++) {\r\n                disallowTextTags.splice(disallowTextTags.indexOf(allowTextTags[i].toLowerCase()), 1);\r\n            }\r\n            this._disallowedTextTagsRegExp = disallowTextTags.length === 0 ? null : new wRegExp('(<\\\\/?)(' + disallowTextTags.join('|') + ')\\\\b\\\\s*([^>^<]+)?\\\\s*(?=>)', 'gi');\r\n\r\n            // set whitelist\r\n            const getRegList = function (str, str2) { return !str ? '^' : (str === '*' ? '[a-z-]+' : (!str2 ? str : (str + '|' + str2))); };\r\n            // tags\r\n            const defaultAttr = 'contenteditable|colspan|rowspan|target|href|download|rel|src|alt|class|type|controls|origin-size';\r\n            const dataAttr = 'data-format|data-size|data-file-size|data-file-name|data-origin|data-align|data-image-link|data-rotate|data-proportion|data-percentage|data-exp|data-font-size';\r\n            this._allowHTMLComments = options._editorTagsWhitelist.indexOf('//') > -1 || options._editorTagsWhitelist === '*';\r\n            // html check\r\n            this._htmlCheckWhitelistRegExp = new wRegExp('^(' + getRegList(options._editorTagsWhitelist.replace('|//', ''), '') + ')$', 'i');\r\n            this._htmlCheckBlacklistRegExp = new wRegExp('^(' + (options.tagsBlacklist || '^') + ')$', 'i');\r\n            // tags\r\n            this.editorTagsWhitelistRegExp = util.createTagsWhitelist(getRegList(options._editorTagsWhitelist.replace('|//', '|<!--|-->'), ''));\r\n            this.editorTagsBlacklistRegExp = util.createTagsBlacklist(options.tagsBlacklist.replace('|//', '|<!--|-->'));\r\n            // paste tags\r\n            this.pasteTagsWhitelistRegExp = util.createTagsWhitelist(getRegList(options.pasteTagsWhitelist, ''));\r\n            this.pasteTagsBlacklistRegExp = util.createTagsBlacklist(options.pasteTagsBlacklist);\r\n            // attributes\r\n            const regEndStr = '\\\\s*=\\\\s*(\\\")[^\\\"]*\\\\1';\r\n            const _wAttr = options.attributesWhitelist;\r\n            let tagsAttr = {};\r\n            let allAttr = '';\r\n            if (!!_wAttr) {\r\n                for (let k in _wAttr) {\r\n                    if (!util.hasOwn(_wAttr, k) || /^on[a-z]+$/i.test(_wAttr[k])) continue;\r\n                    if (k === 'all') {\r\n                        allAttr = getRegList(_wAttr[k], defaultAttr);\r\n                    } else {\r\n                        tagsAttr[k] = new wRegExp('\\\\s(?:' + getRegList(_wAttr[k], '') + ')' + regEndStr, 'ig');\r\n                    }\r\n                }\r\n            }\r\n            \r\n            this._attributesWhitelistRegExp = new wRegExp('\\\\s(?:' + (allAttr || defaultAttr + '|' + dataAttr) + ')' + regEndStr, 'ig');\r\n            this._attributesWhitelistRegExp_all_data = new wRegExp('\\\\s(?:' + ((allAttr || defaultAttr) + '|data-[a-z0-9\\\\-]+') + ')' + regEndStr, 'ig');\r\n            this._attributesTagsWhitelist = tagsAttr;\r\n\r\n            // blacklist\r\n            const _bAttr = options.attributesBlacklist;\r\n            tagsAttr = {};\r\n            allAttr = '';\r\n            if (!!_bAttr) {\r\n                for (let k in _bAttr) {\r\n                    if (!util.hasOwn(_bAttr, k)) continue;\r\n                    if (k === 'all') {\r\n                        allAttr = getRegList(_bAttr[k], '');\r\n                    } else {\r\n                        tagsAttr[k] = new wRegExp('\\\\s(?:' + getRegList(_bAttr[k], '') + ')' + regEndStr, 'ig');\r\n                    }\r\n                }\r\n            }\r\n\r\n            this._attributesBlacklistRegExp = new wRegExp('\\\\s(?:' + (allAttr || '^') + ')' + regEndStr, 'ig');\r\n            this._attributesTagsBlacklist = tagsAttr;\r\n\r\n            // set modes\r\n            this._isInline = /inline/i.test(options.mode);\r\n            this._isBalloon = /balloon|balloon-always/i.test(options.mode);\r\n            this._isBalloonAlways = /balloon-always/i.test(options.mode);\r\n\r\n            // caching buttons\r\n            this._cachingButtons();\r\n\r\n            // file components\r\n            this._fileInfoPluginsCheck = [];\r\n            this._fileInfoPluginsReset = [];\r\n\r\n            // text components\r\n            this.managedTagsInfo = { query: '', map: {} };\r\n            const managedClass = [];\r\n\r\n            // Command and file plugins registration\r\n            this.activePlugins = [];\r\n            this._fileManager.tags = [];\r\n            this._fileManager.pluginMap = {};\r\n\r\n            let filePluginRegExp = [];\r\n            let plugin, button;\r\n            for (let key in plugins) {\r\n                if (!util.hasOwn(plugins, key)) continue;\r\n                plugin = plugins[key];\r\n                button = pluginCallButtons[key];\r\n                if ((plugin.active || plugin.action) && button) {\r\n                    this.callPlugin(key, null, button);\r\n                }\r\n                if (typeof plugin.checkFileInfo === 'function' && typeof plugin.resetFileInfo === 'function') {\r\n                    this.callPlugin(key, null, button);\r\n                    this._fileInfoPluginsCheck.push(plugin.checkFileInfo.bind(this));\r\n                    this._fileInfoPluginsReset.push(plugin.resetFileInfo.bind(this));\r\n                }\r\n                if (_w.Array.isArray(plugin.fileTags)) {\r\n                    const fileTags = plugin.fileTags;\r\n                    this.callPlugin(key, null, button);\r\n                    this._fileManager.tags = this._fileManager.tags.concat(fileTags);\r\n                    filePluginRegExp.push(key);\r\n                    for (let tag = 0, tLen = fileTags.length; tag < tLen; tag++) {\r\n                        this._fileManager.pluginMap[fileTags[tag].toLowerCase()] = key;\r\n                    }\r\n                }\r\n                if (plugin.managedTags) {\r\n                    const info = plugin.managedTags();\r\n                    managedClass.push('.' + info.className);\r\n                    this.managedTagsInfo.map[info.className] = info.method.bind(this);\r\n                }\r\n            }\r\n\r\n            this.managedTagsInfo.query = managedClass.toString();\r\n            this._fileManager.queryString = this._fileManager.tags.join(',');\r\n            this._fileManager.regExp = new wRegExp('^(' +  (this._fileManager.tags.join('|') || '^') + ')$', 'i');\r\n            this._fileManager.pluginRegExp = new wRegExp('^(' +  (filePluginRegExp.length === 0 ? '^' : filePluginRegExp.join('|')) + ')$', 'i');\r\n            \r\n            // cache editor's element\r\n            this._variable._originCssText = context.element.topArea.style.cssText;\r\n            this._placeholder = context.element.placeholder;\r\n            this._lineBreaker = context.element.lineBreaker;\r\n            this._lineBreakerButton = this._lineBreaker.querySelector('button');\r\n\r\n            // Excute history function\r\n            this.history = _history(this, this._onChange_historyStack.bind(this));\r\n\r\n            // register notice module\r\n            this.addModule([_notice]);\r\n\r\n            // Init, validate\r\n            if (options.iframe) {\r\n                this._wd = context.element.wysiwygFrame.contentDocument;\r\n                context.element.wysiwyg = this._wd.body;\r\n                if (options._editorStyles.editor) context.element.wysiwyg.style.cssText = options._editorStyles.editor;\r\n                if (options.height === 'auto') this._iframeAuto = this._wd.body;\r\n            }\r\n            \r\n            this._initWysiwygArea(reload, _initHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Caching basic buttons to use\r\n         * @private\r\n         */\r\n        _cachingButtons: function () {\r\n            this.codeViewDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-code-view-enabled\"]):not([data-display=\"MORE\"])');\r\n            this.resizingDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-resizing-enabled\"]):not([data-display=\"MORE\"])');\r\n\r\n            this._saveButtonStates();\r\n\r\n            const tool = context.tool;\r\n            this.commandMap = {\r\n                OUTDENT: tool.outdent,\r\n                INDENT: tool.indent\r\n            };\r\n            this.commandMap[options.textTags.bold.toUpperCase()] = tool.bold;\r\n            this.commandMap[options.textTags.underline.toUpperCase()] = tool.underline;\r\n            this.commandMap[options.textTags.italic.toUpperCase()] = tool.italic;\r\n            this.commandMap[options.textTags.strike.toUpperCase()] = tool.strike;\r\n            this.commandMap[options.textTags.sub.toUpperCase()] = tool.subscript;\r\n            this.commandMap[options.textTags.sup.toUpperCase()] = tool.superscript;\r\n            \r\n            this._styleCommandMap = {\r\n                fullScreen: tool.fullScreen,\r\n                showBlocks: tool.showBlocks,\r\n                codeView: tool.codeView\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Initializ wysiwyg area (Only called from core._init)\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _initWysiwygArea: function (reload, _initHTML) {\r\n            context.element.wysiwyg.innerHTML = reload ? _initHTML : this.convertContentsForEditor(typeof _initHTML === 'string' ? _initHTML : context.element.originElement.value);\r\n        },\r\n\r\n        /**\r\n         * @description Called when there are changes to tags in the wysiwyg region.\r\n         * @private\r\n         */\r\n        _resourcesStateChange: function () {\r\n            this._iframeAutoHeight();\r\n            this._checkPlaceholder();\r\n        },\r\n\r\n        /**\r\n         * @description Called when after execute \"history.push\"\r\n         * @private\r\n         */\r\n        _onChange_historyStack: function () {\r\n            if (this.hasFocus) event._applyTagEffects();\r\n            this._variable.isChanged = true;\r\n            if (context.tool.save) context.tool.save.removeAttribute('disabled');\r\n            // user event\r\n            if (functions.onChange) functions.onChange(this.getContents(true), this);\r\n            if (context.element.toolbar.style.display === 'block') event._showToolbarBalloon();\r\n        },\r\n\r\n        /**\r\n         * @description Modify the height value of the iframe when the height of the iframe is automatic.\r\n         * @private\r\n         */\r\n        _iframeAutoHeight: function () {\r\n            if (this._iframeAuto) {\r\n                _w.setTimeout(function () { \r\n                    const h = core._iframeAuto.offsetHeight;\r\n                    context.element.wysiwygFrame.style.height = h + 'px';\r\n                    if (util.isIE) core.__callResizeFunction(h, null);\r\n                });\r\n            } else if (util.isIE) {\r\n                core.__callResizeFunction(context.element.wysiwygFrame.offsetHeight, null);\r\n            }\r\n        },\r\n\r\n        __callResizeFunction: function (h, resizeObserverEntry) {\r\n            h = h === -1 ? (resizeObserverEntry.borderBoxSize && resizeObserverEntry.borderBoxSize[0] ? resizeObserverEntry.borderBoxSize[0].blockSize : (resizeObserverEntry.contentRect.height + this._editorHeightPadding)) : h;\r\n            if (this._editorHeight !== h) {\r\n                if (typeof functions.onResizeEditor === 'function') functions.onResizeEditor(h, this._editorHeight, core, resizeObserverEntry);\r\n                this._editorHeight = h;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set display property when there is placeholder.\r\n         * @private\r\n         */\r\n        _checkPlaceholder: function () {\r\n            if (this._placeholder) {\r\n                if (this._variable.isCodeView) {\r\n                    this._placeholder.style.display = 'none';\r\n                    return;\r\n                }\r\n\r\n                const wysiwyg = context.element.wysiwyg;\r\n                if (!util.onlyZeroWidthSpace(wysiwyg.textContent) || wysiwyg.querySelector(util._allowedEmptyNodeList) || (wysiwyg.innerText.match(/\\n/g) || '').length > 1) {\r\n                    this._placeholder.style.display = 'none';\r\n                } else {\r\n                    this._placeholder.style.display = 'block';\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description If there is no default format, add a format and move \"selection\".\r\n         * @param {String|null} formatName Format tag name (default: 'P')\r\n         * @returns {undefined|null}\r\n         * @private\r\n         */\r\n        _setDefaultFormat: function (formatName) {\r\n            if (this._fileManager.pluginRegExp.test(this.currentControllerName)) return;\r\n\r\n            const range = this.getRange();\r\n            const commonCon = range.commonAncestorContainer;\r\n            const startCon = range.startContainer;\r\n            const rangeEl = util.getRangeFormatElement(commonCon, null);\r\n            let focusNode, offset, format;\r\n\r\n            const fileComponent = util.getParentElement(commonCon, util.isComponent);\r\n            if (fileComponent && !util.isTable(fileComponent)) {\r\n                return;\r\n            } else if (commonCon.nodeType === 1 && commonCon.getAttribute('data-se-embed') === 'true') {\r\n                let el = commonCon.nextElementSibling;\r\n                if (!util.isFormatElement(el)) el = this.appendFormatTag(commonCon, options.defaultTag);\r\n                this.setRange(el.firstChild, 0, el.firstChild, 0);\r\n                return;\r\n            }\r\n\r\n            if ((util.isRangeFormatElement(startCon) || util.isWysiwygDiv(startCon)) && (util.isComponent(startCon.children[range.startOffset]) || util.isComponent(startCon.children[range.startOffset - 1]))) return;\r\n            if (util.getParentElement(commonCon, util.isNotCheckingNode)) return null;\r\n\r\n            if (rangeEl) {\r\n                format = util.createElement(formatName || options.defaultTag);\r\n                format.innerHTML = rangeEl.innerHTML;\r\n                if (format.childNodes.length === 0) format.innerHTML = util.zeroWidthSpace;\r\n\r\n                rangeEl.innerHTML = format.outerHTML;\r\n                format = rangeEl.firstChild;\r\n                focusNode = util.getEdgeChildNodes(format, null).sc;\r\n\r\n                if (!focusNode) {\r\n                    focusNode = util.createTextNode(util.zeroWidthSpace);\r\n                    format.insertBefore(focusNode, format.firstChild);\r\n                }\r\n                \r\n                offset = focusNode.textContent.length;\r\n                this.setRange(focusNode, offset, focusNode, offset);\r\n                return;\r\n            }\r\n\r\n            if(util.isRangeFormatElement(commonCon) && (commonCon.childNodes.length <= 1)) {\r\n                let br = null;\r\n                if (commonCon.childNodes.length === 1 && util.isBreak(commonCon.firstChild)) {\r\n                    br = commonCon.firstChild;\r\n                } else {\r\n                    br = util.createTextNode(util.zeroWidthSpace);\r\n                    commonCon.appendChild(br);\r\n                }\r\n\r\n                this.setRange(br, 1, br, 1);\r\n                return;\r\n            }\r\n\r\n            this.execCommand('formatBlock', false, (formatName || options.defaultTag));\r\n            focusNode = util.getEdgeChildNodes(commonCon, commonCon);\r\n            focusNode = focusNode ? focusNode.ec : commonCon;\r\n\r\n            format = util.getFormatElement(focusNode, null);\r\n            if (!format) {\r\n                this.removeRange();\r\n                this._editorRange();\r\n                return;\r\n            }\r\n            \r\n            if (util.isBreak(format.nextSibling)) util.removeItem(format.nextSibling);\r\n            if (util.isBreak(format.previousSibling)) util.removeItem(format.previousSibling);\r\n            if (util.isBreak(focusNode)) {\r\n                const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                focusNode.parentNode.insertBefore(zeroWidth, focusNode);\r\n                focusNode = zeroWidth;\r\n            }\r\n\r\n            this.effectNode = null;\r\n            this.nativeFocus();\r\n        },\r\n\r\n        /**\r\n         * @description Initialization after \"setOptions\"\r\n         * @param {Object} el context.element\r\n         * @param {String} _initHTML Initial html string\r\n         * @private\r\n         */\r\n        _setOptionsInit: function (el, _initHTML) {\r\n            this.context = context = _Context(el.originElement, this._getConstructed(el), options);\r\n            this._componentsInfoReset = true;\r\n            this._editorInit(true, _initHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Initializ editor\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _editorInit: function (reload, _initHTML) {\r\n            // initialize core and add event listeners\r\n            this._init(reload, _initHTML);\r\n            event._addEvent();\r\n            this._setCharCount();\r\n            event._offStickyToolbar();\r\n            event.onResize_window();\r\n\r\n            // toolbar visibility\r\n            context.element.toolbar.style.visibility = '';\r\n            // wisywig attributes\r\n            const attr = options.frameAttrbutes;\r\n            for (let k in attr) {\r\n                context.element.wysiwyg.setAttribute(k, attr[k]);\r\n            }\r\n\r\n            this._checkComponents();\r\n            this._componentsInfoInit = false;\r\n            this._componentsInfoReset = false;\r\n\r\n            this.history.reset(true);\r\n            \r\n            _w.setTimeout(function () {\r\n                // observer\r\n                if (event._resizeObserver) event._resizeObserver.observe(context.element.wysiwygFrame);\r\n                if (event._toolbarObserver) event._toolbarObserver.observe(context.element._toolbarShadow);\r\n                // resource state\r\n                core._resourcesStateChange();\r\n                // user event\r\n                if (typeof functions.onload === 'function') functions.onload(core, reload);\r\n            });\r\n        },\r\n\r\n        /**\r\n         * @description Create and return an object to cache the new context.\r\n         * @param {Element} contextEl context.element\r\n         * @returns {Object}\r\n         * @private\r\n         */\r\n        _getConstructed: function (contextEl) {\r\n            return {\r\n                _top: contextEl.topArea,\r\n                _relative: contextEl.relative,\r\n                _toolBar: contextEl.toolbar,\r\n                _toolbarShadow: contextEl._toolbarShadow,\r\n                _menuTray: contextEl._menuTray,\r\n                _editorArea: contextEl.editorArea,\r\n                _wysiwygArea: contextEl.wysiwygFrame,\r\n                _codeArea: contextEl.code,\r\n                _placeholder: contextEl.placeholder,\r\n                _resizingBar: contextEl.resizingBar,\r\n                _navigation: contextEl.navigation,\r\n                _charCounter: contextEl.charCounter,\r\n                _charWrapper: contextEl.charWrapper,\r\n                _loading: contextEl.loading,\r\n                _lineBreaker: contextEl.lineBreaker,\r\n                _lineBreaker_t: contextEl.lineBreaker_t,\r\n                _lineBreaker_b: contextEl.lineBreaker_b,\r\n                _resizeBack: contextEl.resizeBackground,\r\n                _stickyDummy: contextEl._stickyDummy,\r\n                _arrow: contextEl._arrow\r\n            };\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @description event function\r\n     */\r\n    const event = {\r\n        _IEisComposing: false, // In IE, there is no \"e.isComposing\" in the key-up event.\r\n        _lineBreakerBind: null,\r\n        _responsiveCurrentSize: 'default',\r\n        _responsiveButtonSize: null,\r\n        _responsiveButtons: null,\r\n        _directionKeyCode: new _w.RegExp('^(8|13|3[2-9]|40|46)$'),\r\n        _nonTextKeyCode: new _w.RegExp('^(8|13|1[6-9]|20|27|3[3-9]|40|45|46|11[2-9]|12[0-3]|144|145)$'),\r\n        _historyIgnoreKeyCode: new _w.RegExp('^(1[6-9]|20|27|3[3-9]|40|45|11[2-9]|12[0-3]|144|145)$'),\r\n        _onButtonsCheck: new _w.RegExp('^(' + _w.Object.keys(options._textTagsMap).join('|') + ')$', 'i'),\r\n        _frontZeroWidthReg: new _w.RegExp(util.zeroWidthSpace + '+', ''),\r\n        _keyCodeShortcut: {\r\n            65: 'A',\r\n            66: 'B',\r\n            83: 'S',\r\n            85: 'U',\r\n            73: 'I',\r\n            89: 'Y',\r\n            90: 'Z',\r\n            219: '[',\r\n            221: ']'\r\n        },\r\n\r\n        _shortcutCommand: function (keyCode, shift) {\r\n            let command = null;\r\n            const keyStr = event._keyCodeShortcut[keyCode];\r\n\r\n            switch (keyStr) {\r\n                case 'A':\r\n                    command = 'selectAll';\r\n                    break;\r\n                case 'B':\r\n                    if (options.shortcutsDisable.indexOf('bold') === -1) {\r\n                        command = 'bold';\r\n                    }\r\n                    break;\r\n                case 'S':\r\n                    if (shift && options.shortcutsDisable.indexOf('strike') === -1) {\r\n                        command = 'strike';\r\n                    } else if (!shift && options.shortcutsDisable.indexOf('save') === -1) {\r\n                        command = 'save';\r\n                    }\r\n                    break;\r\n                case 'U':\r\n                    if (options.shortcutsDisable.indexOf('underline') === -1) {\r\n                        command = 'underline';\r\n                    }\r\n                    break;\r\n                case 'I':\r\n                    if (options.shortcutsDisable.indexOf('italic') === -1) {\r\n                        command = 'italic';\r\n                    }\r\n                    break;\r\n                case 'Z':\r\n                    if (options.shortcutsDisable.indexOf('undo') === -1) {\r\n                        if (shift) {\r\n                            command = 'redo';\r\n                        } else {\r\n                            command = 'undo';\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'Y':\r\n                    if (options.shortcutsDisable.indexOf('undo') === -1) {\r\n                        command = 'redo';\r\n                    }\r\n                    break;\r\n                case '[':\r\n                    if (options.shortcutsDisable.indexOf('indent') === -1) {\r\n                        command = options.rtl ? 'indent' : 'outdent';\r\n                    }\r\n                    break;\r\n                case ']':\r\n                    if (options.shortcutsDisable.indexOf('indent') === -1) {\r\n                        command = options.rtl ? 'outdent' : 'indent';\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            if (!command) return !!keyStr;\r\n\r\n            core.commandHandler(core.commandMap[command], command);\r\n            return true;\r\n        },\r\n\r\n        _applyTagEffects: function () {\r\n            let selectionNode = core.getSelectionNode();\r\n            if (selectionNode === core.effectNode) return;\r\n            core.effectNode = selectionNode;\r\n\r\n            const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\r\n            const commandMap = core.commandMap;\r\n            const classOnCheck = event._onButtonsCheck;\r\n            const commandMapNodes = [];\r\n            const currentNodes = [];\r\n\r\n            const activePlugins = core.activePlugins;\r\n            const cLen = activePlugins.length;\r\n            let nodeName = '';\r\n\r\n            while (selectionNode.firstChild) {\r\n                selectionNode = selectionNode.firstChild;\r\n            }\r\n\r\n            for (let element = selectionNode; !util.isWysiwygDiv(element); element = element.parentNode) {\r\n                if (!element) break;\r\n                if (element.nodeType !== 1 || util.isBreak(element)) continue;\r\n                nodeName = element.nodeName.toUpperCase();\r\n                currentNodes.push(nodeName);\r\n\r\n                /* Active plugins */\r\n                if (!core.isReadOnly) {\r\n                    for (let c = 0, name; c < cLen; c++) {\r\n                        name = activePlugins[c];\r\n                        if (commandMapNodes.indexOf(name) === -1 && plugins[name].active.call(core, element)) {\r\n                            commandMapNodes.push(name);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (util.isFormatElement(element)) {\r\n                    /* Outdent */\r\n                    if (commandMapNodes.indexOf('OUTDENT') === -1 && commandMap.OUTDENT && !util.isImportantDisabled(commandMap.OUTDENT)) {\r\n                        if (util.isListCell(element) || (element.style[marginDir] && util.getNumber(element.style[marginDir], 0) > 0)) {\r\n                            commandMapNodes.push('OUTDENT');\r\n                            commandMap.OUTDENT.removeAttribute('disabled');\r\n                        }\r\n                    }\r\n\r\n                    /* Indent */\r\n                    if (commandMapNodes.indexOf('INDENT') === -1 && commandMap.INDENT && !util.isImportantDisabled(commandMap.INDENT)) {\r\n                        commandMapNodes.push('INDENT');\r\n                        if (util.isListCell(element) && !element.previousElementSibling) {\r\n                            commandMap.INDENT.setAttribute('disabled', true);\r\n                        } else {\r\n                            commandMap.INDENT.removeAttribute('disabled');\r\n                        }\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                /** default active buttons [strong, ins, em, del, sub, sup] */\r\n                if (classOnCheck && classOnCheck.test(nodeName)) {\r\n                    commandMapNodes.push(nodeName);\r\n                    util.addClass(commandMap[nodeName], 'active');\r\n                }\r\n            }\r\n\r\n            core._setKeyEffect(commandMapNodes);\r\n\r\n            /** save current nodes */\r\n            core._variable.currentNodes = currentNodes.reverse();\r\n            core._variable.currentNodesMap = commandMapNodes;\r\n\r\n            /**  Displays the current node structure to resizingBar */\r\n            if (options.showPathLabel) context.element.navigation.textContent = core._variable.currentNodes.join(' > ');\r\n        },\r\n\r\n        _cancelCaptionEdit: function () {\r\n            this.setAttribute('contenteditable', false);\r\n            this.removeEventListener('blur', event._cancelCaptionEdit);\r\n        },\r\n\r\n        _buttonsEventHandler: function (e) {\r\n            let target = e.target;\r\n            if (core._bindControllersOff) e.stopPropagation();\r\n\r\n            if (/^(input|textarea|select|option)$/i.test(target.nodeName)) {\r\n                core._antiBlur = false;\r\n            } else {\r\n                e.preventDefault();\r\n            }\r\n\r\n            if (util.getParentElement(target, '.se-submenu')) {\r\n                e.stopPropagation();\r\n                core._notHideToolbar = true;\r\n            } else {\r\n                let command = target.getAttribute('data-command');\r\n                let className = target.className;\r\n    \r\n                while (!command && !/se-menu-list/.test(className) && !/sun-editor-common/.test(className)) {\r\n                    target = target.parentNode;\r\n                    command = target.getAttribute('data-command');\r\n                    className = target.className;\r\n                }\r\n    \r\n                if (command === core._submenuName || command === core._containerName) {\r\n                    e.stopPropagation();\r\n                }\r\n            }\r\n        },\r\n\r\n        onClick_toolbar: function (e) {\r\n            let target = e.target;\r\n            let display = target.getAttribute('data-display');\r\n            let command = target.getAttribute('data-command');\r\n            let className = target.className;\r\n            core.controllersOff();\r\n\r\n            while (target.parentNode && !command && !/se-menu-list/.test(className) && !/se-toolbar/.test(className)) {\r\n                target = target.parentNode;\r\n                command = target.getAttribute('data-command');\r\n                display = target.getAttribute('data-display');\r\n                className = target.className;\r\n            }\r\n\r\n            if (!command && !display) return;\r\n            if (target.disabled) return;\r\n\r\n            core.actionCall(command, display, target);\r\n        },\r\n\r\n        onMouseDown_wysiwyg: function (e) {\r\n            if (core.isReadOnly || util.isNonEditable(context.element.wysiwyg)) return;\r\n\r\n            // user event\r\n            if (typeof functions.onMouseDown === 'function' && functions.onMouseDown(e, core) === false) return;\r\n            \r\n            const tableCell = util.getParentElement(e.target, util.isCell);\r\n            if (tableCell) {\r\n                const tablePlugin = core.plugins.table;\r\n                if (tablePlugin && tableCell !== tablePlugin._fixedCell && !tablePlugin._shift) {\r\n                    core.callPlugin('table', function () {\r\n                        tablePlugin.onTableCellMultiSelect.call(core, tableCell, false);\r\n                    }, null);\r\n                }\r\n            }\r\n\r\n            if (core._isBalloon) {\r\n                event._hideToolbar();\r\n            }\r\n\r\n            if (/FIGURE/i.test(e.target.nodeName)) e.preventDefault();\r\n        },\r\n\r\n        onClick_wysiwyg: function (e) {\r\n            const targetElement = e.target;\r\n\r\n            if (core.isReadOnly) {\r\n                e.preventDefault();\r\n                if (util.isAnchor(targetElement)){\r\n                    _w.open(targetElement.href, targetElement.target);\r\n                }\r\n                return false;\r\n            }\r\n\r\n            if (util.isNonEditable(context.element.wysiwyg)) return;\r\n\r\n            // user event\r\n            if (typeof functions.onClick === 'function' && functions.onClick(e, core) === false) return;\r\n\r\n            const fileComponentInfo = core.getFileComponent(targetElement);\r\n            if (fileComponentInfo) {\r\n                e.preventDefault();\r\n                core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n                return;\r\n            }\r\n\r\n            const figcaption = util.getParentElement(targetElement, 'FIGCAPTION');\r\n            if (figcaption && (util.isNonEditable(figcaption) || !figcaption.getAttribute(\"contenteditable\"))) {\r\n                e.preventDefault();\r\n                figcaption.setAttribute('contenteditable', true);\r\n                figcaption.focus();\r\n\r\n                if (core._isInline && !core._inlineToolbarAttr.isShow) {\r\n                    event._showToolbarInline();\r\n\r\n                    const hideToolbar = function () {\r\n                        event._hideToolbar();\r\n                        figcaption.removeEventListener('blur', hideToolbar);\r\n                    };\r\n\r\n                    figcaption.addEventListener('blur', hideToolbar);\r\n                }\r\n            }\r\n\r\n            _w.setTimeout(core._editorRange.bind(core));\r\n            core._editorRange();\r\n\r\n            const selectionNode = core.getSelectionNode();\r\n            const formatEl = util.getFormatElement(selectionNode, null);\r\n            const rangeEl = util.getRangeFormatElement(selectionNode, null);\r\n            if (!formatEl && !util.isNonEditable(targetElement) && !util.isList(rangeEl)) {\r\n                const range = core.getRange();\r\n                if (util.getFormatElement(range.startContainer) === util.getFormatElement(range.endContainer)) {\r\n                    if (util.isList(rangeEl)) {\r\n                        e.preventDefault();\r\n                        const oLi = util.createElement('LI');\r\n                        const prevLi = selectionNode.nextElementSibling;\r\n                        oLi.appendChild(selectionNode);\r\n                        rangeEl.insertBefore(oLi, prevLi);\r\n                        core.focus();\r\n                    } else if (!util.isWysiwygDiv(selectionNode) && !util.isComponent(selectionNode) && (!util.isTable(selectionNode) || util.isCell(selectionNode)) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\r\n                        e.preventDefault();\r\n                        core.focus();\r\n                    } else {\r\n                        event._applyTagEffects();\r\n                    }\r\n                }\r\n            } else {\r\n                event._applyTagEffects();\r\n            }\r\n\r\n            if (core._isBalloon) _w.setTimeout(event._toggleToolbarBalloon);\r\n        },\r\n\r\n        _balloonDelay: null,\r\n        _showToolbarBalloonDelay: function () {\r\n            if (event._balloonDelay) {\r\n                _w.clearTimeout(event._balloonDelay);\r\n            }\r\n\r\n            event._balloonDelay = _w.setTimeout(function () {\r\n                _w.clearTimeout(this._balloonDelay);\r\n                this._balloonDelay = null;\r\n                this._showToolbarBalloon();\r\n            }.bind(event), 350);\r\n        },\r\n\r\n        _toggleToolbarBalloon: function () {\r\n            core._editorRange();\r\n            const range = core.getRange();\r\n            if (core._bindControllersOff || (!core._isBalloonAlways && range.collapsed)) event._hideToolbar();\r\n            else event._showToolbarBalloon(range);\r\n        },\r\n\r\n        _showToolbarBalloon: function (rangeObj) {\r\n            if (!core._isBalloon) return;\r\n\r\n            const range = rangeObj || core.getRange();\r\n            const toolbar = context.element.toolbar;\r\n            const topArea = context.element.topArea;\r\n            const selection = core.getSelection();\r\n\r\n            let isDirTop;\r\n            if (core._isBalloonAlways && range.collapsed) {\r\n                isDirTop = true;\r\n            } else if (selection.focusNode === selection.anchorNode) {\r\n                isDirTop = selection.focusOffset < selection.anchorOffset;\r\n            } else {\r\n                const childNodes = util.getListChildNodes(range.commonAncestorContainer, null);\r\n                isDirTop = util.getArrayIndex(childNodes, selection.focusNode) < util.getArrayIndex(childNodes, selection.anchorNode);\r\n            }\r\n\r\n            let rects = range.getClientRects();\r\n            rects = rects[isDirTop ? 0 : rects.length - 1];\r\n\r\n            const globalScroll = core.getGlobalScrollOffset();\r\n            let scrollLeft = globalScroll.left;\r\n            let scrollTop = globalScroll.top;\r\n\r\n            const editorWidth = topArea.offsetWidth;\r\n            const offsets = event._getEditorOffsets(null);\r\n            const stickyTop = offsets.top;\r\n            const editorLeft = offsets.left;\r\n            \r\n            toolbar.style.top = '-10000px';\r\n            toolbar.style.visibility = 'hidden';\r\n            toolbar.style.display = 'block';\r\n\r\n            if (!rects) {\r\n                const node = core.getSelectionNode();\r\n                if (util.isFormatElement(node)) {\r\n                    const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                    core.insertNode(zeroWidth, null, false);\r\n                    core.setRange(zeroWidth, 1, zeroWidth, 1);\r\n                    core._editorRange();\r\n                    rects = core.getRange().getClientRects();\r\n                    rects = rects[isDirTop ? 0 : rects.length - 1];\r\n                }\r\n\r\n                if (!rects) {\r\n                    const nodeOffset = util.getOffset(node, context.element.wysiwygFrame);\r\n                    rects = {\r\n                        left: nodeOffset.left,\r\n                        top: nodeOffset.top,\r\n                        right: nodeOffset.left,\r\n                        bottom: nodeOffset.top + node.offsetHeight,\r\n                        noText: true\r\n                    };\r\n                    scrollLeft = 0;\r\n                    scrollTop = 0;\r\n                }\r\n\r\n                isDirTop = true;\r\n            }\r\n\r\n            const arrowMargin = _w.Math.round(context.element._arrow.offsetWidth / 2);\r\n            const toolbarWidth = toolbar.offsetWidth;\r\n            const toolbarHeight = toolbar.offsetHeight;\r\n            const iframeRects = /iframe/i.test(context.element.wysiwygFrame.nodeName) ? context.element.wysiwygFrame.getClientRects()[0] : null;\r\n            if (iframeRects) {\r\n                rects = {\r\n                    left: rects.left + iframeRects.left,\r\n                    top: rects.top + iframeRects.top,\r\n                    right: rects.right + iframeRects.right - iframeRects.width,\r\n                    bottom: rects.bottom + iframeRects.bottom - iframeRects.height\r\n                };\r\n            }\r\n            \r\n            event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\r\n            if (toolbarWidth !== toolbar.offsetWidth || toolbarHeight !== toolbar.offsetHeight) {\r\n                event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\r\n            }\r\n\r\n            if (options.toolbarContainer) {\r\n                const editorParent = topArea.parentElement;\r\n\r\n                let container = options.toolbarContainer;\r\n                let left = container.offsetLeft;\r\n                let top = container.offsetTop;\r\n\r\n                while(!container.parentElement.contains(editorParent) || !/^(BODY|HTML)$/i.test(container.parentElement.nodeName)) {\r\n                    container = container.offsetParent;\r\n                    left += container.offsetLeft;\r\n                    top += container.offsetTop;\r\n                }\r\n\r\n                toolbar.style.left = (toolbar.offsetLeft - left + topArea.offsetLeft) + 'px';\r\n                toolbar.style.top = (toolbar.offsetTop - top + topArea.offsetTop) + 'px';\r\n            }\r\n\r\n            toolbar.style.visibility = '';\r\n        },\r\n\r\n        _setToolbarOffset: function (isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin) {\r\n            const padding = 1;\r\n            const toolbarWidth = toolbar.offsetWidth;\r\n            const toolbarHeight = rects.noText && !isDirTop ? 0 : toolbar.offsetHeight;\r\n\r\n            const absoluteLeft = (isDirTop ? rects.left : rects.right) - editorLeft - (toolbarWidth / 2) + scrollLeft;\r\n            const overRight = absoluteLeft + toolbarWidth - editorWidth;\r\n            \r\n            let t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\r\n            let l = absoluteLeft < 0 ? padding : overRight < 0 ? absoluteLeft : absoluteLeft - overRight - padding - 1;\r\n\r\n            let resetTop = false;\r\n            const space = t + (isDirTop ? (event._getEditorOffsets(null).top) : (toolbar.offsetHeight - context.element.wysiwyg.offsetHeight));\r\n            if (!isDirTop && space > 0 && event._getPageBottomSpace() < space) {\r\n                isDirTop = true;\r\n                resetTop = true;\r\n            } else if (isDirTop && _d.documentElement.offsetTop > space) {\r\n                isDirTop = false;\r\n                resetTop = true;\r\n            }\r\n\r\n            if (resetTop) t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\r\n\r\n            toolbar.style.left = _w.Math.floor(l) + 'px';\r\n            toolbar.style.top = _w.Math.floor(t) + 'px';\r\n\r\n            if (isDirTop) {\r\n                util.removeClass(context.element._arrow, 'se-arrow-up');\r\n                util.addClass(context.element._arrow, 'se-arrow-down');\r\n                context.element._arrow.style.top = toolbarHeight + 'px';\r\n            } else {\r\n                util.removeClass(context.element._arrow, 'se-arrow-down');\r\n                util.addClass(context.element._arrow, 'se-arrow-up');\r\n                context.element._arrow.style.top = -arrowMargin + 'px';\r\n            }\r\n\r\n            const arrow_left = _w.Math.floor((toolbarWidth / 2) + (absoluteLeft - l));\r\n            context.element._arrow.style.left = (arrow_left + arrowMargin > toolbar.offsetWidth ? toolbar.offsetWidth - arrowMargin : arrow_left < arrowMargin ? arrowMargin : arrow_left) + 'px';\r\n        },\r\n\r\n        _showToolbarInline: function () {\r\n            if (!core._isInline) return;\r\n\r\n            const toolbar = context.element.toolbar;\r\n            if (options.toolbarContainer) toolbar.style.position = 'relative';\r\n            else toolbar.style.position = 'absolute';\r\n            \r\n            toolbar.style.visibility = 'hidden';\r\n            toolbar.style.display = 'block';\r\n            core._inlineToolbarAttr.width = toolbar.style.width = options.toolbarWidth;\r\n            core._inlineToolbarAttr.top = toolbar.style.top = (options.toolbarContainer ? 0 : (-1 - toolbar.offsetHeight)) + 'px';\r\n            \r\n            if (typeof functions.showInline === 'function') functions.showInline(toolbar, context, core);\r\n\r\n            event.onScroll_window();\r\n            core._inlineToolbarAttr.isShow = true;\r\n            toolbar.style.visibility = '';\r\n        },\r\n\r\n        _hideToolbar: function () {\r\n            if (!core._notHideToolbar && !core._variable.isFullScreen) {\r\n                context.element.toolbar.style.display = 'none';\r\n                core._inlineToolbarAttr.isShow = false;\r\n            }\r\n        },\r\n\r\n        onInput_wysiwyg: function (e) {\r\n            if (core.isReadOnly || core.isDisabled) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                core.history.go(core.history.getCurrentIndex());\r\n                return false;\r\n            }\r\n\r\n            core._editorRange();\r\n\r\n            const data = (e.data === null ? '' : e.data === undefined ? ' ' : e.data) || '';       \r\n            if (!core._charCount(data)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            // user event\r\n            if (typeof functions.onInput === 'function' && functions.onInput(e, core) === false) return;\r\n\r\n            // history stack\r\n            core.history.push(true);\r\n        },\r\n\r\n        _isUneditableNode: function (range, isFront) {\r\n            const container = isFront ? range.startContainer : range.endContainer;\r\n            const offset = isFront ? range.startOffset : range.endOffset;\r\n            const siblingKey = isFront ? 'previousSibling' : 'nextSibling';\r\n            const isElement = container.nodeType === 1;\r\n            let siblingNode;\r\n\r\n            if (isElement) {\r\n                siblingNode = event._isUneditableNode_getSibling(container.childNodes[offset], siblingKey, container);\r\n                return siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\r\n            } else {\r\n                siblingNode = event._isUneditableNode_getSibling(container, siblingKey, container);\r\n                return core.isEdgePoint(container, offset, isFront ? 'front' : 'end') && (siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false');\r\n            }\r\n        },\r\n\r\n        _isUneditableNode_getSibling: function (selectNode, siblingKey, container) {\r\n            if (!selectNode) return null;\r\n            let siblingNode = selectNode[siblingKey];\r\n\r\n            if (!siblingNode) {\r\n                siblingNode = util.getFormatElement(container);\r\n                siblingNode = siblingNode ? siblingNode[siblingKey] : null;\r\n                if (siblingNode && !util.isComponent(siblingNode)) siblingNode = siblingKey === 'previousSibling' ? siblingNode.firstElementChild : siblingNode.lastElementChild;\r\n                else return null;\r\n            }\r\n\r\n            return siblingNode;\r\n        },\r\n\r\n        _onShortcutKey: false,\r\n        onKeyDown_wysiwyg: function (e) {\r\n            const keyCode = e.keyCode;\r\n            const shift = e.shiftKey;\r\n            const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\r\n            const alt = e.altKey;\r\n            event._IEisComposing = keyCode === 229;\r\n\r\n            if (!ctrl && core.isReadOnly && !event._directionKeyCode.test(keyCode)) {\r\n                e.preventDefault();\r\n                return false;\r\n            }\r\n\r\n            core.submenuOff();\r\n\r\n            if (core._isBalloon) {\r\n                event._hideToolbar();\r\n            }\r\n\r\n            // user event\r\n            if (typeof functions.onKeyDown === 'function' && functions.onKeyDown(e, core) === false) return;\r\n\r\n            /** Shortcuts */\r\n            if (ctrl && event._shortcutCommand(keyCode, shift)) {\r\n                event._onShortcutKey = true;\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            } else if (event._onShortcutKey) {\r\n                event._onShortcutKey = false;\r\n            }\r\n\r\n            /** default key action */\r\n            let selectionNode = core.getSelectionNode();\r\n            const range = core.getRange();\r\n            const selectRange = !range.collapsed || range.startContainer !== range.endContainer;\r\n            const fileComponentName = core._fileManager.pluginRegExp.test(core.currentControllerName) ? core.currentControllerName : '';\r\n            let formatEl = util.getFormatElement(selectionNode, null) || selectionNode;\r\n            let rangeEl = util.getRangeFormatElement(formatEl, null);\r\n\r\n            switch (keyCode) {\r\n                case 8: /** backspace key */\r\n                    if (!selectRange) {\r\n                        if (fileComponentName) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            core.plugins[fileComponentName].destroy.call(core);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (selectRange && event._hardDelete()) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    if (!util.isFormatElement(formatEl) && !context.element.wysiwyg.firstElementChild && !util.isComponent(selectionNode) && core._setDefaultFormat(options.defaultTag) !== null) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        return false;\r\n                    }\r\n\r\n                    if (!selectRange && !formatEl.previousElementSibling && (range.startOffset === 0 && !selectionNode.previousSibling && !util.isListCell(formatEl) && \r\n                     (util.isFormatElement(formatEl) && (!util.isFreeFormatElement(formatEl) || util.isClosureFreeFormatElement(formatEl))))) {\r\n                        // closure range\r\n                        if (util.isClosureRangeFormatElement(formatEl.parentNode)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            return false;\r\n                        }\r\n                        // maintain default format\r\n                        if (util.isWysiwygDiv(formatEl.parentNode) && formatEl.childNodes.length <= 1 && (!formatEl.firstChild || util.onlyZeroWidthSpace(formatEl.textContent))) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n\r\n                            if (formatEl.nodeName.toUpperCase() === options.defaultTag.toUpperCase()) {\r\n                                formatEl.innerHTML = '<br>';\r\n                                const attrs = formatEl.attributes;\r\n                                while (attrs[0]) {\r\n                                    formatEl.removeAttribute(attrs[0].name);\r\n                                }\r\n                            } else {\r\n                                const defaultFormat = util.createElement(options.defaultTag);\r\n                                defaultFormat.innerHTML = '<br>';\r\n                                formatEl.parentElement.replaceChild(defaultFormat, formatEl);\r\n                            }\r\n\r\n                            core.nativeFocus();\r\n                            return false;\r\n                        }\r\n                    }\r\n\r\n                    // clean remove tag\r\n                    if (formatEl && range.startContainer === range.endContainer && selectionNode.nodeType === 3 && !util.isFormatElement(selectionNode.parentNode)) {\r\n                        if (range.collapsed ? selectionNode.textContent.length === 1 : (range.endOffset - range.startOffset) === selectionNode.textContent.length) {\r\n                            e.preventDefault();\r\n\r\n                            let offset = null;\r\n                            let prev = selectionNode.parentNode.previousSibling;\r\n                            const next = selectionNode.parentNode.nextSibling;\r\n                            if (!prev) {\r\n                                if (!next) {\r\n                                    prev = util.createElement('BR');\r\n                                    formatEl.appendChild(prev);\r\n                                } else {\r\n                                    prev = next;\r\n                                    offset = 0;\r\n                                }\r\n                            }\r\n\r\n                            selectionNode.textContent = '';\r\n                            util.removeItemAllParents(selectionNode, null, formatEl);\r\n                            offset = typeof offset === 'number' ? offset : prev.nodeType === 3 ? prev.textContent.length : 1;\r\n                            core.setRange(prev, offset, prev, offset);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    // tag[contenteditable=\"false\"]\r\n                    if (event._isUneditableNode(range, true)) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // nested list\r\n                    const commonCon = range.commonAncestorContainer;\r\n                    formatEl = util.getFormatElement(range.startContainer, null);\r\n                    rangeEl = util.getRangeFormatElement(formatEl, null);\r\n                    if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\r\n                        if (util.isListCell(formatEl) && util.isList(rangeEl) && (util.isListCell(rangeEl.parentNode) || formatEl.previousElementSibling) && (selectionNode === formatEl || (selectionNode.nodeType === 3 && (!selectionNode.previousSibling || util.isList(selectionNode.previousSibling)))) &&\r\n                         (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.startContainer) : (range.startOffset === 0  && range.collapsed))) {\r\n                            if (range.startContainer !== range.endContainer) {\r\n                                e.preventDefault();\r\n\r\n                                core.removeNode();\r\n                                if (range.startContainer.nodeType === 3) {\r\n                                    core.setRange(range.startContainer, range.startContainer.textContent.length, range.startContainer, range.startContainer.textContent.length);\r\n                                }\r\n                                // history stack\r\n                                core.history.push(true);\r\n                            } else {\r\n                                let prev = formatEl.previousElementSibling || rangeEl.parentNode;\r\n                                if (util.isListCell(prev)) {\r\n                                    e.preventDefault();\r\n\r\n                                    let prevLast = prev;\r\n                                    if (!prev.contains(formatEl) && util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\r\n                                        prevLast = prevLast.lastElementChild.lastElementChild;\r\n                                        while (util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\r\n                                            prevLast = prevLast.lastElementChild && prevLast.lastElementChild.lastElementChild;\r\n                                        }\r\n                                        prev = prevLast;\r\n                                    }\r\n\r\n                                    let con = prev === rangeEl.parentNode ? rangeEl.previousSibling : prev.lastChild;\r\n                                    if (!con) {\r\n                                        con = util.createTextNode(util.zeroWidthSpace);\r\n                                        rangeEl.parentNode.insertBefore(con, rangeEl.parentNode.firstChild);\r\n                                    }\r\n                                    const offset = con.nodeType === 3 ? con.textContent.length : 1;\r\n                                    const children = formatEl.childNodes;\r\n                                    let after = con;\r\n                                    let child = children[0];\r\n                                    while ((child = children[0])) {\r\n                                        prev.insertBefore(child, after.nextSibling);\r\n                                        after = child;\r\n                                    }\r\n\r\n                                    util.removeItem(formatEl);\r\n                                    if (rangeEl.children.length === 0) util.removeItem(rangeEl);\r\n\r\n                                    core.setRange(con, offset, con, offset);\r\n                                    // history stack\r\n                                    core.history.push(true);\r\n                                }\r\n                            }\r\n                            \r\n                            break;\r\n                        }\r\n\r\n                        // detach range\r\n                        if (!selectRange && range.startOffset === 0) {\r\n                            let detach = true;\r\n                            let comm = commonCon;\r\n                            while (comm && comm !== rangeEl && !util.isWysiwygDiv(comm)) {\r\n                                if (comm.previousSibling) {\r\n                                    if (comm.previousSibling.nodeType === 1 || !util.onlyZeroWidthSpace(comm.previousSibling.textContent.trim())) {\r\n                                        detach = false;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                                comm = comm.parentNode;\r\n                            }\r\n    \r\n                            if (detach && rangeEl.parentNode) {\r\n                                e.preventDefault();\r\n                                core.detachRangeFormatElement(rangeEl, (util.isListCell(formatEl) ? [formatEl] : null), null, false, false);\r\n                                // history stack\r\n                                core.history.push(true);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // component\r\n                    if (!selectRange && formatEl && (range.startOffset === 0 || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\r\n                        const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] : selectionNode;\r\n                        const prev = formatEl.previousSibling;\r\n                        // select file component\r\n                        const ignoreZWS = (commonCon.nodeType === 3 || util.isBreak(commonCon)) && !commonCon.previousSibling && range.startOffset === 0;\r\n                        if (!sel.previousSibling && (util.isComponent(commonCon.previousSibling) || (ignoreZWS && util.isComponent(prev)))) {\r\n                            const fileComponentInfo = core.getFileComponent(prev);\r\n                            if (fileComponentInfo) {\r\n                                e.preventDefault();\r\n                                e.stopPropagation();\r\n                                if (formatEl.textContent.length === 0) util.removeItem(formatEl);\r\n                                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\r\n                            } else if (util.isComponent(prev)) {\r\n                                e.preventDefault();\r\n                                e.stopPropagation();\r\n                                util.removeItem(prev);\r\n                            }\r\n                            break;\r\n                        }\r\n                        // delete nonEditable\r\n                        if (util.isNonEditable(sel.previousSibling)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            util.removeItem(sel.previousSibling);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    break;\r\n                case 46: /** delete key */\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        core.plugins[fileComponentName].destroy.call(core);\r\n                        break;\r\n                    }\r\n\r\n                    if (selectRange && event._hardDelete()) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // tag[contenteditable=\"false\"]\r\n                    if (event._isUneditableNode(range, false)) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // component\r\n                    if ((util.isFormatElement(selectionNode) || selectionNode.nextSibling === null || (util.onlyZeroWidthSpace(selectionNode.nextSibling) && selectionNode.nextSibling.nextSibling === null)) && range.startOffset === selectionNode.textContent.length) {\r\n                        const nextEl = formatEl.nextElementSibling;\r\n                        if (!nextEl) break;\r\n                        if (util.isComponent(nextEl)) {\r\n                            e.preventDefault();\r\n\r\n                            if (util.onlyZeroWidthSpace(formatEl)) {\r\n                                util.removeItem(formatEl);\r\n                                // table component\r\n                                if (util.isTable(nextEl)) {\r\n                                    let cell = util.getChildElement(nextEl, util.isCell, false);\r\n                                    cell = cell.firstElementChild || cell;\r\n                                    core.setRange(cell, 0, cell, 0);\r\n                                    break;\r\n                                }\r\n                            }\r\n\r\n                            // select file component\r\n                            const fileComponentInfo = core.getFileComponent(nextEl);\r\n                            if (fileComponentInfo) {\r\n                                e.stopPropagation();\r\n                                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\r\n                            } else if (util.isComponent(nextEl)) {\r\n                                e.stopPropagation();\r\n                                util.removeItem(nextEl);\r\n                            }\r\n\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (!selectRange && (core.isEdgePoint(range.endContainer, range.endOffset) || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\r\n                        const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] || selectionNode : selectionNode;\r\n                        // delete nonEditable\r\n                        if (sel && util.isNonEditable(sel.nextSibling)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            util.removeItem(sel.nextSibling);\r\n                            break;\r\n                        } else if (util.isComponent(sel)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            util.removeItem(sel);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    // nested list\r\n                    formatEl = util.getFormatElement(range.startContainer, null);\r\n                    rangeEl = util.getRangeFormatElement(formatEl, null);\r\n                    if (util.isListCell(formatEl) && util.isList(rangeEl) && (selectionNode === formatEl || (selectionNode.nodeType === 3 && (!selectionNode.nextSibling || util.isList(selectionNode.nextSibling)) &&\r\n                     (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.endContainer) : (range.endOffset === selectionNode.textContent.length && range.collapsed))))) {\r\n                        if (range.startContainer !== range.endContainer) core.removeNode();\r\n                        \r\n                        let next = util.getArrayItem(formatEl.children, util.isList, false);\r\n                        next = next || formatEl.nextElementSibling || rangeEl.parentNode.nextElementSibling;\r\n                        if (next && (util.isList(next) || util.getArrayItem(next.children, util.isList, false))) {\r\n                            e.preventDefault();\r\n\r\n                            let con, children;\r\n                            if (util.isList(next)) {\r\n                                const child = next.firstElementChild;\r\n                                children = child.childNodes;\r\n                                con = children[0];\r\n                                while (children[0]) {\r\n                                    formatEl.insertBefore(children[0], next);\r\n                                }\r\n                                util.removeItem(child);\r\n                            } else {\r\n                                con = next.firstChild;\r\n                                children = next.childNodes;\r\n                                while (children[0]) {\r\n                                    formatEl.appendChild(children[0]);\r\n                                }\r\n                                util.removeItem(next);\r\n                            }\r\n                            core.setRange(con, 0, con, 0);\r\n                            // history stack\r\n                            core.history.push(true);\r\n                        }\r\n                        break;\r\n                    }\r\n\r\n                    break;\r\n                case 9: /** tab key */\r\n                    if (fileComponentName || options.tabDisable) break;\r\n                    e.preventDefault();\r\n                    if (ctrl || alt || util.isWysiwygDiv(selectionNode)) break;\r\n\r\n                    const isEdge = (!range.collapsed || core.isEdgePoint(range.startContainer, range.startOffset));            \r\n                    const selectedFormats = core.getSelectedElements(null);\r\n                    selectionNode = core.getSelectionNode();\r\n                    const cells = [];\r\n                    let lines = [];\r\n                    let fc = util.isListCell(selectedFormats[0]), lc = util.isListCell(selectedFormats[selectedFormats.length - 1]);\r\n                    let r = {sc: range.startContainer, so: range.startOffset, ec: range.endContainer, eo: range.endOffset};\r\n                    for (let i = 0, len = selectedFormats.length, f; i < len; i++) {\r\n                        f = selectedFormats[i];\r\n                        if (util.isListCell(f)) {\r\n                            if (!f.previousElementSibling && !shift) {\r\n                                continue;\r\n                            } else {\r\n                                cells.push(f);\r\n                            }\r\n                        } else {\r\n                            lines.push(f);\r\n                        }\r\n                    }\r\n                    \r\n                    // Nested list\r\n                    if (cells.length > 0 && isEdge && core.plugins.list) {\r\n                        r = core.plugins.list.editInsideList.call(core, shift, cells);\r\n                    } else {\r\n                        // table\r\n                        const tableCell = util.getParentElement(selectionNode, util.isCell);\r\n                        if (tableCell && isEdge) {\r\n                            const table = util.getParentElement(tableCell, 'table');\r\n                            const cells = util.getListChildren(table, util.isCell);\r\n                            let idx = shift ? util.prevIdx(cells, tableCell) : util.nextIdx(cells, tableCell);\r\n\r\n                            if (idx === cells.length && !shift) idx = 0;\r\n                            if (idx === -1 && shift) idx = cells.length - 1;\r\n\r\n                            let moveCell = cells[idx];\r\n                            if (!moveCell) break;\r\n                            moveCell = moveCell.firstElementChild || moveCell;\r\n                            core.setRange(moveCell, 0, moveCell, 0);\r\n                            break;\r\n                        }\r\n\r\n                        lines = lines.concat(cells);\r\n                        fc = lc = null;\r\n                    }\r\n\r\n                    // Lines tab(4)\r\n                    if (lines.length > 0) {\r\n                        if (!shift) {\r\n                            const tabText = util.createTextNode(new _w.Array(core._variable.tabSize + 1).join('\\u00A0'));\r\n                            if (lines.length === 1) {\r\n                                const textRange = core.insertNode(tabText, null, true);\r\n                                if (!textRange) return false;\r\n                                if (!fc) {\r\n                                    r.sc = tabText;\r\n                                    r.so = textRange.endOffset;\r\n                                }\r\n                                if (!lc) {\r\n                                    r.ec = tabText;\r\n                                    r.eo = textRange.endOffset;\r\n                                }\r\n                            } else {\r\n                                const len = lines.length - 1;\r\n                                for (let i = 0, child; i <= len; i++) {\r\n                                    child = lines[i].firstChild;\r\n                                    if (!child) continue;\r\n    \r\n                                    if (util.isBreak(child)) {\r\n                                        lines[i].insertBefore(tabText.cloneNode(false), child);\r\n                                    } else {\r\n                                        child.textContent = tabText.textContent + child.textContent;\r\n                                    }\r\n                                }\r\n    \r\n                                const firstChild = util.getChildElement(lines[0], 'text', false);\r\n                                const endChild = util.getChildElement(lines[len], 'text', true);\r\n                                if (!fc && firstChild) {\r\n                                    r.sc = firstChild;\r\n                                    r.so = 0;\r\n                                }\r\n                                if (!lc && endChild) {\r\n                                    r.ec = endChild;\r\n                                    r.eo = endChild.textContent.length;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            const len = lines.length - 1;\r\n                            for (let i = 0, line; i <= len; i++) {\r\n                                line = lines[i].childNodes;\r\n                                for (let c = 0, cLen = line.length, child; c < cLen; c++) {\r\n                                    child = line[c];\r\n                                    if (!child) break;\r\n                                    if (util.onlyZeroWidthSpace(child)) continue;\r\n        \r\n                                    if (/^\\s{1,4}$/.test(child.textContent)) {\r\n                                        util.removeItem(child);\r\n                                    } else if (/^\\s{1,4}/.test(child.textContent)) {\r\n                                        child.textContent = child.textContent.replace(/^\\s{1,4}/, '');\r\n                                    }\r\n                                    \r\n                                    break;\r\n                                }\r\n                            }\r\n    \r\n                            const firstChild = util.getChildElement(lines[0], 'text', false);\r\n                            const endChild = util.getChildElement(lines[len], 'text', true);\r\n                            if (!fc && firstChild) {\r\n                                r.sc = firstChild;\r\n                                r.so = 0;\r\n                            }\r\n                            if (!lc && endChild) {\r\n                                r.ec = endChild;\r\n                                r.eo = endChild.textContent.length;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    core.setRange(r.sc, r.so, r.ec, r.eo);\r\n                    // history stack\r\n                    core.history.push(false);\r\n                    \r\n                    break;\r\n                case 13: /** enter key */\r\n                    const freeFormatEl = util.getFreeFormatElement(selectionNode, null);\r\n\r\n                    if (core._charTypeHTML) {\r\n                        let enterHTML = '';\r\n                        if ((!shift && freeFormatEl) || shift) {\r\n                            enterHTML = '<br>';\r\n                        } else {\r\n                            enterHTML = '<' + formatEl.nodeName + '><br></' + formatEl.nodeName + '>';\r\n                        }\r\n\r\n                        if (!core.checkCharCount(enterHTML, 'byte-html')) {\r\n                            e.preventDefault();\r\n                            return false;\r\n                        }\r\n                    }\r\n\r\n                    if (!shift) {\r\n                        const formatInners = core._isEdgeFormat(range.endContainer, range.endOffset, 'end');\r\n                        if ((formatInners && /^H[1-6]$/i.test(formatEl.nodeName)) || /^HR$/i.test(formatEl.nodeName)) {\r\n                            e.preventDefault();\r\n                            let temp = null;\r\n                            const newFormat = core.appendFormatTag(formatEl, options.defaultTag);\r\n\r\n                            if (formatInners && formatInners.length > 0) {\r\n                                temp = formatInners.pop();\r\n                                const innerNode = temp;\r\n                                while(formatInners.length > 0) {\r\n                                    temp = temp.appendChild(formatInners.pop());\r\n                                }\r\n                                newFormat.appendChild(innerNode);\r\n                            }\r\n\r\n                            temp = !temp ? newFormat.firstChild : temp.appendChild(newFormat.firstChild);\r\n                            core.setRange(temp, 0, temp, 0);\r\n                            break;\r\n                        } else if (options.lineAttrReset && formatEl && !util.isListCell(formatEl)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n\r\n                            let newEl;\r\n                            if (!range.collapsed) {\r\n                                const isMultiLine = util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null);\r\n                                const r = core.removeNode();\r\n                                if (isMultiLine) {\r\n                                    newEl = util.getFormatElement(r.container, null);\r\n\r\n                                    if (!r.prevContainer) {\r\n                                        const newFormat = formatEl.cloneNode(false);\r\n                                        newFormat.innerHTML = '<br>';\r\n                                        newEl.parentNode.insertBefore(newFormat, newEl);\r\n                                    } else if (newEl !== formatEl && newEl.nextElementSibling === formatEl) {\r\n                                        newEl = formatEl;\r\n                                    }\r\n                                } else {\r\n                                    newEl = util.splitElement(r.container, r.offset, 0);\r\n                                }\r\n                            } else {\r\n                                if (util.onlyZeroWidthSpace(formatEl)) newEl = core.appendFormatTag(formatEl, formatEl.cloneNode(false));\r\n                                else newEl = util.splitElement(range.endContainer, range.endOffset, 0);\r\n                            }\r\n\r\n                            const resetAttr = options.lineAttrReset === '*' ? null : options.lineAttrReset;\r\n                            const attrs = newEl.attributes;\r\n                            let i = 0;\r\n                            while (attrs[i]) {\r\n                                if (resetAttr && resetAttr.test(attrs[i].name)) {\r\n                                    i++;\r\n                                    continue;\r\n                                }\r\n                                newEl.removeAttribute(attrs[i].name);\r\n                            }\r\n                            core.setRange(newEl.firstChild, 0, newEl.firstChild, 0);\r\n\r\n                            break;\r\n                        }\r\n\r\n                        if (freeFormatEl) {\r\n                            e.preventDefault();\r\n                            const selectionFormat = selectionNode === freeFormatEl;\r\n                            const wSelection = core.getSelection();\r\n                            const children = selectionNode.childNodes, offset = wSelection.focusOffset, prev = selectionNode.previousElementSibling, next = selectionNode.nextSibling;\r\n    \r\n                            if (!util.isClosureFreeFormatElement(freeFormatEl) && !!children && ((selectionFormat && range.collapsed && children.length - 1 <= offset + 1 && util.isBreak(children[offset]) && (!children[offset + 1] || ((!children[offset + 2] || util.onlyZeroWidthSpace(children[offset + 2].textContent)) && children[offset + 1].nodeType === 3 && util.onlyZeroWidthSpace(children[offset + 1].textContent))) &&  offset > 0 && util.isBreak(children[offset - 1])) ||\r\n                              (!selectionFormat && util.onlyZeroWidthSpace(selectionNode.textContent) && util.isBreak(prev) && (util.isBreak(prev.previousSibling) || !util.onlyZeroWidthSpace(prev.previousSibling.textContent)) && (!next || (!util.isBreak(next) && util.onlyZeroWidthSpace(next.textContent)))))) {\r\n                                if (selectionFormat) util.removeItem(children[offset - 1]);\r\n                                else util.removeItem(selectionNode);\r\n                                const newEl = core.appendFormatTag(freeFormatEl, (util.isFormatElement(freeFormatEl.nextElementSibling) && !util.isRangeFormatElement(freeFormatEl.nextElementSibling)) ? freeFormatEl.nextElementSibling : null);\r\n                                util.copyFormatAttributes(newEl, freeFormatEl);\r\n                                core.setRange(newEl, 1, newEl, 1);\r\n                                break;\r\n                            }\r\n                            \r\n                            if (selectionFormat) {\r\n                                functions.insertHTML(((range.collapsed && util.isBreak(range.startContainer.childNodes[range.startOffset - 1])) ? '<br>' : '<br><br>'), true, false);\r\n    \r\n                                let focusNode = wSelection.focusNode;\r\n                                const wOffset = wSelection.focusOffset;\r\n                                if (freeFormatEl === focusNode) {\r\n                                    focusNode = focusNode.childNodes[wOffset - offset > 1 ? wOffset - 1 : wOffset];\r\n                                }\r\n    \r\n                                core.setRange(focusNode, 1, focusNode, 1);\r\n                            } else {\r\n                                const focusNext = wSelection.focusNode.nextSibling;\r\n                                const br = util.createElement('BR');\r\n                                core.insertNode(br, null, false);\r\n    \r\n                                const brPrev = br.previousSibling, brNext = br.nextSibling;\r\n                                if (!util.isBreak(focusNext) && !util.isBreak(brPrev) && (!brNext || util.onlyZeroWidthSpace(brNext))) {\r\n                                    br.parentNode.insertBefore(br.cloneNode(false), br);\r\n                                    core.setRange(br, 1, br, 1);\r\n                                } else {\r\n                                    core.setRange(brNext, 0, brNext, 0);\r\n                                }\r\n                            }\r\n    \r\n                            event._onShortcutKey = true;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (selectRange) break;\r\n                    \r\n                    if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\r\n                        const range = core.getRange();\r\n                        if(core.isEdgePoint(range.endContainer, range.endOffset) && util.isList(selectionNode.nextSibling)) {\r\n                            e.preventDefault();\r\n                            const newEl = util.createElement('LI');\r\n                            const br = util.createElement('BR');\r\n                            newEl.appendChild(br);\r\n\r\n                            formatEl.parentNode.insertBefore(newEl, formatEl.nextElementSibling);\r\n                            newEl.appendChild(selectionNode.nextSibling);\r\n                            \r\n                            core.setRange(br, 1, br, 1);\r\n                            break;\r\n                        }\r\n\r\n                        if ((range.commonAncestorContainer.nodeType === 3 ? !range.commonAncestorContainer.nextElementSibling : true) && util.onlyZeroWidthSpace(formatEl.innerText.trim())) {\r\n                            e.preventDefault();\r\n                            let newEl = null;\r\n\r\n                            if (util.isListCell(rangeEl.parentNode)) {\r\n                                rangeEl = formatEl.parentNode.parentNode.parentNode;\r\n                                newEl = util.splitElement(formatEl, null, util.getElementDepth(formatEl) - 2);\r\n                                if (!newEl) {\r\n                                    const newListCell = util.createElement('LI');\r\n                                    newListCell.innerHTML = '<br>';\r\n                                    rangeEl.insertBefore(newListCell, newEl);\r\n                                    newEl = newListCell;\r\n                                }\r\n                            } else {\r\n                                const newFormat = util.isCell(rangeEl.parentNode) ? 'DIV' : util.isList(rangeEl.parentNode) ? 'LI' : (util.isFormatElement(rangeEl.nextElementSibling) && !util.isRangeFormatElement(rangeEl.nextElementSibling)) ? rangeEl.nextElementSibling.nodeName : (util.isFormatElement(rangeEl.previousElementSibling) && !util.isRangeFormatElement(rangeEl.previousElementSibling)) ? rangeEl.previousElementSibling.nodeName : options.defaultTag;\r\n                                newEl = util.createElement(newFormat);\r\n                                const edge = core.detachRangeFormatElement(rangeEl, [formatEl], null, true, true);\r\n                                edge.cc.insertBefore(newEl, edge.ec);\r\n                            }\r\n                            \r\n                            newEl.innerHTML = '<br>';\r\n                            util.removeItemAllParents(formatEl, null, null);\r\n                            core.setRange(newEl, 1, newEl, 1);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (rangeEl && util.getParentElement(rangeEl, 'FIGCAPTION') && util.getParentElement(rangeEl, util.isList)) {\r\n                        e.preventDefault();\r\n                        formatEl = core.appendFormatTag(formatEl, null);\r\n                        core.setRange(formatEl, 0, formatEl, 0);\r\n                    }\r\n\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        const compContext = context[fileComponentName];\r\n                        const container = compContext._container;\r\n                        const sibling = container.previousElementSibling || container.nextElementSibling;\r\n\r\n                        let newEl = null;\r\n                        if (util.isListCell(container.parentNode)) {\r\n                            newEl = util.createElement('BR');\r\n                        } else {\r\n                            newEl = util.createElement((util.isFormatElement(sibling) && !util.isRangeFormatElement(sibling)) ? sibling.nodeName : options.defaultTag);\r\n                            newEl.innerHTML = '<br>';\r\n                        }\r\n\r\n                        container.parentNode.insertBefore(newEl, container);\r\n                        \r\n                        core.callPlugin(fileComponentName, function () {\r\n                            if (core.selectComponent(compContext._element, fileComponentName) === false) core.blur();\r\n                        }, null);\r\n                    }\r\n                    \r\n                    break;\r\n                case 27:\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        core.controllersOff();\r\n                        return false;\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            if (shift && keyCode === 16) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                const tablePlugin = core.plugins.table;\r\n                if (tablePlugin && !tablePlugin._shift && !tablePlugin._ref) {\r\n                    const cell = util.getParentElement(formatEl, util.isCell);\r\n                    if (cell) {\r\n                        tablePlugin.onTableCellMultiSelect.call(core, cell, true);\r\n                        return;\r\n                    }\r\n                }\r\n            } else if (shift && (util.isOSX_IOS ? alt : ctrl) && keyCode === 32) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                const nbsp = core.insertNode(util.createTextNode('\\u00a0'));\r\n                if (nbsp && nbsp.container) {\r\n                    core.setRange(nbsp.container, nbsp.endOffset, nbsp.container, nbsp.endOffset);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            if (util.isIE && !ctrl && !alt && !selectRange && !event._nonTextKeyCode.test(keyCode) && util.isBreak(range.commonAncestorContainer)) {\r\n                const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                core.insertNode(zeroWidth, null, false);\r\n                core.setRange(zeroWidth, 1, zeroWidth, 1);\r\n            }\r\n        },\r\n\r\n        onKeyUp_wysiwyg: function (e) {\r\n            if (event._onShortcutKey) return;\r\n\r\n            core._editorRange();\r\n            const keyCode = e.keyCode;\r\n            const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\r\n            const alt = e.altKey;\r\n\r\n            if (core.isReadOnly) {\r\n                if (!ctrl && event._directionKeyCode.test(keyCode)) event._applyTagEffects();\r\n                return;\r\n            }\r\n\r\n            const range = core.getRange();\r\n            let selectionNode = core.getSelectionNode();\r\n\r\n            if (core._isBalloon && ((core._isBalloonAlways && keyCode !== 27) || !range.collapsed)) {\r\n                if (core._isBalloonAlways) {\r\n                    if (keyCode !== 27) event._showToolbarBalloonDelay();\r\n                } else {\r\n                    event._showToolbarBalloon();\r\n                    return;\r\n                }\r\n            }\r\n\r\n            /** when format tag deleted */\r\n            if (keyCode === 8 && util.isWysiwygDiv(selectionNode) && selectionNode.textContent === '' && selectionNode.children.length === 0) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n\r\n                selectionNode.innerHTML = '';\r\n\r\n                const oFormatTag = util.createElement(util.isFormatElement(core._variable.currentNodes[0]) ? core._variable.currentNodes[0] : options.defaultTag);\r\n                oFormatTag.innerHTML = '<br>';\r\n\r\n                selectionNode.appendChild(oFormatTag);\r\n                core.setRange(oFormatTag, 0, oFormatTag, 0);\r\n                event._applyTagEffects();\r\n\r\n                core.history.push(false);\r\n                return;\r\n            }\r\n\r\n            const formatEl = util.getFormatElement(selectionNode, null);\r\n            const rangeEl = util.getRangeFormatElement(selectionNode, null);\r\n            if (!formatEl && range.collapsed && !util.isComponent(selectionNode) && !util.isList(selectionNode) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\r\n                selectionNode = core.getSelectionNode();\r\n            }\r\n\r\n            if (event._directionKeyCode.test(keyCode)) {\r\n                event._applyTagEffects();\r\n            }\r\n\r\n            const textKey = !ctrl && !alt && !event._nonTextKeyCode.test(keyCode);\r\n            if (textKey && selectionNode.nodeType === 3 && util.zeroWidthRegExp.test(selectionNode.textContent) && !(e.isComposing !== undefined ? e.isComposing : event._IEisComposing)) {\r\n                let so = range.startOffset, eo = range.endOffset;\r\n                const frontZeroWidthCnt = (selectionNode.textContent.substring(0, eo).match(event._frontZeroWidthReg) || '').length;\r\n                so = range.startOffset - frontZeroWidthCnt;\r\n                eo = range.endOffset - frontZeroWidthCnt;\r\n                selectionNode.textContent = selectionNode.textContent.replace(util.zeroWidthRegExp, '');\r\n                core.setRange(selectionNode, so < 0 ? 0 : so, selectionNode, eo < 0 ? 0 : eo);\r\n            }\r\n\r\n            core._charCount('');\r\n\r\n            // user event\r\n            if (typeof functions.onKeyUp === 'function' && functions.onKeyUp(e, core) === false) return;\r\n\r\n            // history stack\r\n            if (!ctrl && !alt && !event._historyIgnoreKeyCode.test(keyCode)) {\r\n                core.history.push(true);\r\n            }\r\n        },\r\n\r\n        onScroll_wysiwyg: function (e) {\r\n            core.controllersOff();\r\n            if (core._isBalloon) event._hideToolbar();\r\n\r\n            // user event\r\n            if (typeof functions.onScroll === 'function') functions.onScroll(e, core);\r\n        },\r\n\r\n        onFocus_wysiwyg: function (e) {\r\n            if (core._antiBlur) return;\r\n            core.hasFocus = true;\r\n            _w.setTimeout(event._applyTagEffects);\r\n            \r\n            if (core._isInline) event._showToolbarInline();\r\n\r\n            // user event\r\n            if (typeof functions.onFocus === 'function') functions.onFocus(e, core);\r\n        },\r\n\r\n        onBlur_wysiwyg: function (e) {\r\n            if (core._antiBlur || core._variable.isCodeView) return;\r\n            core.hasFocus = false;\r\n            core.effectNode = null;\r\n            core.controllersOff();\r\n            if (core._isInline || core._isBalloon) event._hideToolbar();\r\n\r\n            core._setKeyEffect([]);\r\n\r\n            core._variable.currentNodes = [];\r\n            core._variable.currentNodesMap = [];\r\n            if (options.showPathLabel) context.element.navigation.textContent = '';\r\n\r\n            // user event\r\n            if (typeof functions.onBlur === 'function') functions.onBlur(e, core);\r\n        },\r\n\r\n        onMouseDown_resizingBar: function (e) {\r\n            e.stopPropagation();\r\n\r\n            core.submenuOff();\r\n            core.controllersOff();\r\n\r\n            core._variable.resizeClientY = e.clientY;\r\n            context.element.resizeBackground.style.display = 'block';\r\n\r\n            function closureFunc() {\r\n                context.element.resizeBackground.style.display = 'none';\r\n                _d.removeEventListener('mousemove', event._resize_editor);\r\n                _d.removeEventListener('mouseup', closureFunc);\r\n            }\r\n\r\n            _d.addEventListener('mousemove', event._resize_editor);\r\n            _d.addEventListener('mouseup', closureFunc);\r\n        },\r\n\r\n        _resize_editor: function (e) {\r\n            const resizeInterval = context.element.editorArea.offsetHeight + (e.clientY - core._variable.resizeClientY);\r\n            const h = (resizeInterval < core._variable.minResizingSize ? core._variable.minResizingSize : resizeInterval);\r\n            context.element.wysiwygFrame.style.height = context.element.code.style.height = h + 'px';\r\n            core._variable.resizeClientY = e.clientY;\r\n            if (util.isIE) core.__callResizeFunction(h, null);\r\n        },\r\n\r\n        onResize_window: function () {\r\n            if (util.isIE) core.resetResponsiveToolbar();\r\n\r\n            if (context.element.toolbar.offsetWidth === 0) return;\r\n\r\n            if (context.fileBrowser && context.fileBrowser.area.style.display === 'block') {\r\n                context.fileBrowser.body.style.maxHeight = (_w.innerHeight - context.fileBrowser.header.offsetHeight - 50) + 'px';\r\n            }\r\n\r\n            if (core.submenuActiveButton && core.submenu) {\r\n                core._setMenuPosition(core.submenuActiveButton, core.submenu);\r\n            }\r\n\r\n            if (core._variable.isFullScreen) {\r\n                core._variable.innerHeight_fullScreen += (_w.innerHeight - context.element.toolbar.offsetHeight) - core._variable.innerHeight_fullScreen;\r\n                context.element.editorArea.style.height = core._variable.innerHeight_fullScreen + 'px';\r\n                return;\r\n            }\r\n\r\n            if (core._variable.isCodeView && core._isInline) {\r\n                event._showToolbarInline();\r\n                return;\r\n            }\r\n            \r\n            core._iframeAutoHeight();\r\n\r\n            if (core._sticky) {\r\n                context.element.toolbar.style.width = (context.element.topArea.offsetWidth - 2) + 'px';\r\n                event.onScroll_window();\r\n            }\r\n        },\r\n\r\n        onScroll_window: function () {\r\n            if (core._variable.isFullScreen || context.element.toolbar.offsetWidth === 0 || options.stickyToolbar < 0) return;\r\n\r\n            const element = context.element;\r\n            const editorHeight = element.editorArea.offsetHeight;\r\n            const y = (this.scrollY || _d.documentElement.scrollTop) + options.stickyToolbar;\r\n            const editorTop = event._getEditorOffsets(options.toolbarContainer).top - (core._isInline ? element.toolbar.offsetHeight : 0);\r\n            const inlineOffset = core._isInline && (y - editorTop) > 0 ? y - editorTop - context.element.toolbar.offsetHeight : 0;\r\n            \r\n            if (y < editorTop) {\r\n                event._offStickyToolbar();\r\n            }\r\n            else if (y + core._variable.minResizingSize >= editorHeight + editorTop) {\r\n                if (!core._sticky) event._onStickyToolbar(inlineOffset);\r\n                element.toolbar.style.top = (inlineOffset + editorHeight + editorTop + options.stickyToolbar - y - core._variable.minResizingSize) + 'px';\r\n            }\r\n            else if (y >= editorTop) {\r\n                event._onStickyToolbar(inlineOffset);\r\n            }\r\n        },\r\n\r\n        _getEditorOffsets: function (container) {\r\n            let offsetEl = container || context.element.topArea;\r\n            let t = 0, l = 0, s = 0;\r\n\r\n            while (offsetEl) {\r\n                t += offsetEl.offsetTop;\r\n                l += offsetEl.offsetLeft;\r\n                s += offsetEl.scrollTop;\r\n                offsetEl = offsetEl.offsetParent;\r\n            }\r\n\r\n            return {\r\n                top: t,\r\n                left: l,\r\n                scroll: s\r\n            };\r\n        },\r\n\r\n        _getPageBottomSpace: function () {\r\n            return _d.documentElement.scrollHeight - (event._getEditorOffsets(null).top + context.element.topArea.offsetHeight);\r\n        },\r\n\r\n        _onStickyToolbar: function (inlineOffset) {\r\n            const element = context.element;\r\n\r\n            if (!core._isInline && !options.toolbarContainer) {\r\n                element._stickyDummy.style.height = element.toolbar.offsetHeight + 'px';\r\n                element._stickyDummy.style.display = 'block';\r\n            }\r\n\r\n            element.toolbar.style.top = (options.stickyToolbar + inlineOffset) + 'px';\r\n            element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : element.toolbar.offsetWidth + 'px';\r\n            util.addClass(element.toolbar, 'se-toolbar-sticky');\r\n            core._sticky = true;\r\n        },\r\n\r\n        _offStickyToolbar: function () {\r\n            const element = context.element;\r\n\r\n            element._stickyDummy.style.display = 'none';\r\n            element.toolbar.style.top = core._isInline ? core._inlineToolbarAttr.top : '';\r\n            element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : '';\r\n            element.editorArea.style.marginTop = '';\r\n\r\n            util.removeClass(element.toolbar, 'se-toolbar-sticky');\r\n            core._sticky = false;\r\n        },\r\n\r\n        _codeViewAutoHeight: function () {\r\n            if (core._variable.isFullScreen) return;\r\n            context.element.code.style.height = context.element.code.scrollHeight + 'px';\r\n        },\r\n\r\n        // FireFox - table delete, Chrome - image, video, audio\r\n        _hardDelete: function () {\r\n            const range = core.getRange();\r\n            const sc = range.startContainer;\r\n            const ec = range.endContainer;\r\n            \r\n            // table\r\n            const sCell = util.getRangeFormatElement(sc);\r\n            const eCell = util.getRangeFormatElement(ec);\r\n            const sIsCell = util.isCell(sCell);\r\n            const eIsCell = util.isCell(eCell);\r\n            const ancestor = range.commonAncestorContainer;\r\n            if (((sIsCell && !sCell.previousElementSibling && !sCell.parentElement.previousElementSibling) || (eIsCell && !eCell.nextElementSibling && !eCell.parentElement.nextElementSibling)) && sCell !== eCell) {\r\n                if (!sIsCell) {\r\n                    util.removeItem(util.getParentElement(eCell, function(current) {return ancestor === current.parentNode;}));\r\n                } else if (!eIsCell) {\r\n                    util.removeItem(util.getParentElement(sCell, function(current) {return ancestor === current.parentNode;}));\r\n                } else {\r\n                    util.removeItem(util.getParentElement(sCell, function(current) {return ancestor === current.parentNode;}));\r\n                    core.nativeFocus();\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            // component\r\n            const sComp = sc.nodeType === 1 ? util.getParentElement(sc, '.se-component') : null;\r\n            const eComp = ec.nodeType === 1 ? util.getParentElement(ec, '.se-component') : null;\r\n            if (sComp) util.removeItem(sComp);\r\n            if (eComp) util.removeItem(eComp);\r\n\r\n            return false;\r\n        },\r\n\r\n        onPaste_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n            if (!clipboardData) return true;\r\n            return event._dataTransferAction('paste', e, clipboardData);\r\n        },\r\n\r\n        _setClipboardComponent: function (e, info, clipboardData) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            clipboardData.setData('text/html', info.component.outerHTML);\r\n        },\r\n\r\n        onCopy_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n            \r\n            // user event\r\n            if (typeof functions.onCopy === 'function' && !functions.onCopy(e, clipboardData, core)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            const info = core.currentFileComponentInfo;\r\n            if (info && !util.isIE) {\r\n                event._setClipboardComponent(e, info, clipboardData);\r\n                util.addClass(info.component, 'se-component-copy');\r\n                // copy effect\r\n                _w.setTimeout(function () {\r\n                    util.removeClass(info.component, 'se-component-copy');\r\n                }, 150);\r\n            }\r\n        },\r\n\r\n        onSave_wysiwyg: function (content) {\r\n            // user event\r\n            if (typeof functions.onSave === 'function') {\r\n                functions.onSave(content, core);\r\n                return;\r\n            }\r\n        },\r\n\r\n        onCut_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n\r\n            // user event\r\n            if (typeof functions.onCut === 'function' && !functions.onCut(e, clipboardData, core)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            const info = core.currentFileComponentInfo;\r\n            if (info && !util.isIE) {\r\n                event._setClipboardComponent(e, info, clipboardData);\r\n                util.removeItem(info.component);\r\n                core.controllersOff();\r\n            }\r\n\r\n            _w.setTimeout(function () {\r\n                // history stack\r\n                core.history.push(false);\r\n            });\r\n        },\r\n\r\n        onDrop_wysiwyg: function (e) {\r\n            if (core.isReadOnly || util.isIE) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            const dataTransfer = e.dataTransfer;\r\n            if (!dataTransfer) return true;\r\n\r\n            core.removeNode();\r\n            event._setDropLocationSelection(e);\r\n            return event._dataTransferAction('drop', e, dataTransfer);\r\n        },\r\n\r\n        _setDropLocationSelection: function (e) {\r\n            if (e.rangeParent) {\r\n                core.setRange(e.rangeParent, e.rangeOffset, e.rangeParent, e.rangeOffset);\r\n            } else if (core._wd.caretRangeFromPoint) {\r\n                const r = core._wd.caretRangeFromPoint(e.clientX, e.clientY);\r\n                core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\r\n            } else {\r\n                const r = core.getRange();\r\n                core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\r\n            }\r\n        },\r\n\r\n        _dataTransferAction: function (type, e, data) {\r\n            let plainText, cleanData;\r\n            if (util.isIE) {\r\n                plainText = data.getData('Text');\r\n                \r\n                const range = core.getRange();\r\n                const tempDiv = util.createElement('DIV');\r\n                const tempRange = {\r\n                    sc: range.startContainer,\r\n                    so: range.startOffset,\r\n                    ec: range.endContainer,\r\n                    eo: range.endOffset\r\n                };\r\n\r\n                tempDiv.setAttribute('contenteditable', true);\r\n                tempDiv.style.cssText = 'position:absolute; top:0; left:0; width:1px; height:1px; overflow:hidden;';\r\n                \r\n                context.element.relative.appendChild(tempDiv);\r\n                tempDiv.focus();\r\n\r\n                _w.setTimeout(function () {\r\n                    cleanData = tempDiv.innerHTML;\r\n                    util.removeItem(tempDiv);\r\n                    core.setRange(tempRange.sc, tempRange.so, tempRange.ec, tempRange.eo);\r\n                    event._setClipboardData(type, e, plainText, cleanData, data);\r\n                });\r\n\r\n                return true;\r\n            } else {\r\n                plainText = data.getData('text/plain');\r\n                cleanData = data.getData('text/html');\r\n                if (event._setClipboardData(type, e, plainText, cleanData, data) === false) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    return false;\r\n                }\r\n            }\r\n        },\r\n\r\n        _setClipboardData: function (type, e, plainText, cleanData, data) {\r\n            // MS word, OneNode, Excel\r\n            const MSData = /class=[\"']*Mso(Normal|List)/i.test(cleanData) || /content=[\"']*Word.Document/i.test(cleanData) || /content=[\"']*OneNote.File/i.test(cleanData) || /content=[\"']*Excel.Sheet/i.test(cleanData);\r\n            const onlyText = !cleanData;\r\n\r\n            if (!onlyText) {\r\n                cleanData = cleanData.replace(/^<html>\\r?\\n?<body>\\r?\\n?\\x3C!--StartFragment--\\>|\\x3C!--EndFragment-->\\r?\\n?<\\/body\\>\\r?\\n?<\\/html>$/g, '');\r\n                if (MSData) {\r\n                    cleanData = cleanData.replace(/\\n/g, ' ');\r\n                    plainText = plainText.replace(/\\n/g, ' ');\r\n                } else {\r\n                    cleanData = (plainText === cleanData ? plainText : cleanData).replace(/\\n/g, '<br>');\r\n                }\r\n                cleanData = core.cleanHTML(cleanData, core.pasteTagsWhitelistRegExp, core.pasteTagsBlacklistRegExp);\r\n            } else {\r\n                cleanData = util._HTMLConvertor(plainText).replace(/\\n/g, '<br>');\r\n            }\r\n\r\n            const maxCharCount = core._charCount(core._charTypeHTML ? cleanData : plainText);\r\n            // user event - paste\r\n            if (type === 'paste' && typeof functions.onPaste === 'function') {\r\n                const value = functions.onPaste(e, cleanData, maxCharCount, core);\r\n                if (!value) return false;\r\n                if (typeof value === 'string') cleanData = value;\r\n            }\r\n            // user event - drop\r\n            if (type === 'drop' && typeof functions.onDrop === 'function') {\r\n                const value = functions.onDrop(e, cleanData, maxCharCount, core);\r\n                if (!value) return false;\r\n                if (typeof value === 'string') cleanData = value;\r\n            }\r\n\r\n            // files\r\n            const files = data.files;\r\n            if (files.length > 0 && !MSData) {\r\n                if (/^image/.test(files[0].type) && core.plugins.image) {\r\n                    functions.insertImage(files);\r\n                }\r\n                return false;\r\n            }\r\n\r\n            if (!maxCharCount) {\r\n                return false;\r\n            }\r\n\r\n            if (cleanData) {\r\n                functions.insertHTML(cleanData, true, false);\r\n                return false;\r\n            }\r\n        },\r\n\r\n        onMouseMove_wysiwyg: function (e) {\r\n            if (core.isDisabled || core.isReadOnly) return false;\r\n            const component = util.getParentElement(e.target, util.isComponent);\r\n            const lineBreakerStyle = core._lineBreaker.style;\r\n            \r\n            if (component && !core.currentControllerName) {\r\n                const ctxEl = context.element;\r\n                let scrollTop = 0;\r\n                let el = ctxEl.wysiwyg;\r\n                do {\r\n                    scrollTop += el.scrollTop;\r\n                    el = el.parentElement;\r\n                } while (el && !/^(BODY|HTML)$/i.test(el.nodeName));\r\n\r\n                const wScroll = ctxEl.wysiwyg.scrollTop;\r\n                const offsets = event._getEditorOffsets(null);\r\n                const componentTop = util.getOffset(component, ctxEl.wysiwygFrame).top + wScroll;\r\n                const y = e.pageY + scrollTop + (options.iframe && !options.toolbarContainer ? ctxEl.toolbar.offsetHeight : 0);\r\n                const c = componentTop + (options.iframe ? scrollTop : offsets.top);\r\n\r\n                const isList = util.isListCell(component.parentNode);\r\n                let dir = '', top = '';\r\n                if ((isList ? !component.previousSibling : !util.isFormatElement(component.previousElementSibling)) && y < (c + 20)) {\r\n                    top = componentTop;\r\n                    dir = 't';\r\n                } else if ((isList ? !component.nextSibling : !util.isFormatElement(component.nextElementSibling)) && y > (c + component.offsetHeight - 20)) {\r\n                    top = componentTop + component.offsetHeight;\r\n                    dir = 'b';\r\n                } else {\r\n                    lineBreakerStyle.display = 'none';\r\n                    return;\r\n                }\r\n\r\n                core._variable._lineBreakComp = component;\r\n                core._variable._lineBreakDir = dir;\r\n                lineBreakerStyle.top = (top - wScroll) + 'px';\r\n                core._lineBreakerButton.style.left = (util.getOffset(component).left + (component.offsetWidth / 2) - 15) + 'px';\r\n                lineBreakerStyle.display = 'block';\r\n            } // off line breaker\r\n            else if (lineBreakerStyle.display !== 'none') {\r\n                lineBreakerStyle.display = 'none';\r\n            }\r\n        },\r\n\r\n        _onMouseDown_lineBreak: function (e) {\r\n            e.preventDefault();\r\n        },\r\n\r\n        _onLineBreak: function (e) {\r\n            e.preventDefault();\r\n            \r\n            const component = core._variable._lineBreakComp;\r\n            const dir = !this ? core._variable._lineBreakDir : this;\r\n            const isList = util.isListCell(component.parentNode);\r\n\r\n            const format = util.createElement(isList ? 'BR' : util.isCell(component.parentNode) ? 'DIV' : options.defaultTag);\r\n            if (!isList) format.innerHTML = '<br>';\r\n\r\n            if (core._charTypeHTML && !core.checkCharCount(format.outerHTML, 'byte-html')) return;\r\n\r\n            component.parentNode.insertBefore(format, dir === 't' ? component : component.nextSibling);\r\n            core._lineBreaker.style.display = 'none';\r\n            core._variable._lineBreakComp = null;\r\n\r\n            const focusEl = isList ? format : format.firstChild;\r\n            core.setRange(focusEl, 1, focusEl, 1);\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        _resizeObserver: null,\r\n        _toolbarObserver: null,\r\n        _addEvent: function () {\r\n            const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\r\n            if (!util.isIE) {\r\n                this._resizeObserver = new _w.ResizeObserver(function(entries) {\r\n                    core.__callResizeFunction(-1, entries[0]);\r\n                });\r\n            }\r\n\r\n            /** toolbar event */\r\n            context.element.toolbar.addEventListener('mousedown', event._buttonsEventHandler, false);\r\n            context.element._menuTray.addEventListener('mousedown', event._buttonsEventHandler, false);\r\n            context.element.toolbar.addEventListener('click', event.onClick_toolbar, false);\r\n            /** editor area */\r\n            eventWysiwyg.addEventListener('mousedown', event.onMouseDown_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('click', event.onClick_wysiwyg, false);\r\n            eventWysiwyg.addEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('keydown', event.onKeyDown_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('keyup', event.onKeyUp_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('paste', event.onPaste_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('copy', event.onCopy_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('cut', event.onCut_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('drop', event.onDrop_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('scroll', event.onScroll_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('focus', event.onFocus_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('blur', event.onBlur_wysiwyg, false);\r\n\r\n            /** line breaker */\r\n            event._lineBreakerBind = { a: event._onLineBreak.bind(''), t: event._onLineBreak.bind('t'), b: event._onLineBreak.bind('b') };\r\n            eventWysiwyg.addEventListener('mousemove', event.onMouseMove_wysiwyg, false);\r\n            core._lineBreakerButton.addEventListener('mousedown', event._onMouseDown_lineBreak, false);\r\n            core._lineBreakerButton.addEventListener('click', event._lineBreakerBind.a, false);\r\n            context.element.lineBreaker_t.addEventListener('mousedown', event._lineBreakerBind.t, false);\r\n            context.element.lineBreaker_b.addEventListener('mousedown', event._lineBreakerBind.b, false);\r\n\r\n            /** Events are registered only when there is a table plugin.  */\r\n            if (core.plugins.table) {\r\n                eventWysiwyg.addEventListener('touchstart', event.onMouseDown_wysiwyg, {passive: true, useCapture: false});\r\n            }\r\n            \r\n            /** code view area auto line */\r\n            if (options.height === 'auto' && !options.codeMirrorEditor) {\r\n                context.element.code.addEventListener('keydown', event._codeViewAutoHeight, false);\r\n                context.element.code.addEventListener('keyup', event._codeViewAutoHeight, false);\r\n                context.element.code.addEventListener('paste', event._codeViewAutoHeight, false);\r\n            }\r\n\r\n            /** resizingBar */\r\n            if (context.element.resizingBar) {\r\n                if (/\\d+/.test(options.height) && options.resizeEnable) {\r\n                    context.element.resizingBar.addEventListener('mousedown', event.onMouseDown_resizingBar, false);\r\n                } else {\r\n                    util.addClass(context.element.resizingBar, 'se-resizing-none');\r\n                }\r\n            }\r\n            \r\n            /** set response toolbar */\r\n            event._setResponsiveToolbar();\r\n\r\n            /** responsive toolbar observer */\r\n            if (!util.isIE) this._toolbarObserver = new _w.ResizeObserver(core.resetResponsiveToolbar);\r\n            \r\n            /** window event */\r\n            _w.addEventListener('resize', event.onResize_window, false);\r\n            if (options.stickyToolbar > -1) {\r\n                _w.addEventListener('scroll', event.onScroll_window, false);\r\n            }\r\n        },\r\n\r\n        _removeEvent: function () {\r\n            const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\r\n\r\n            context.element.toolbar.removeEventListener('mousedown', event._buttonsEventHandler);\r\n            context.element._menuTray.removeEventListener('mousedown', event._buttonsEventHandler);\r\n            context.element.toolbar.removeEventListener('click', event.onClick_toolbar);\r\n\r\n            eventWysiwyg.removeEventListener('mousedown', event.onMouseDown_wysiwyg);\r\n            eventWysiwyg.removeEventListener('click', event.onClick_wysiwyg);\r\n            eventWysiwyg.removeEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg);\r\n            eventWysiwyg.removeEventListener('keydown', event.onKeyDown_wysiwyg);\r\n            eventWysiwyg.removeEventListener('keyup', event.onKeyUp_wysiwyg);\r\n            eventWysiwyg.removeEventListener('paste', event.onPaste_wysiwyg);\r\n            eventWysiwyg.removeEventListener('copy', event.onCopy_wysiwyg);\r\n            eventWysiwyg.removeEventListener('cut', event.onCut_wysiwyg);\r\n            eventWysiwyg.removeEventListener('drop', event.onDrop_wysiwyg);\r\n            eventWysiwyg.removeEventListener('scroll', event.onScroll_wysiwyg);\r\n\r\n            eventWysiwyg.removeEventListener('mousemove', event.onMouseMove_wysiwyg);\r\n            core._lineBreakerButton.removeEventListener('mousedown', event._onMouseDown_lineBreak);\r\n            core._lineBreakerButton.removeEventListener('click', event._lineBreakerBind.a);\r\n            context.element.lineBreaker_t.removeEventListener('mousedown', event._lineBreakerBind.t);\r\n            context.element.lineBreaker_b.removeEventListener('mousedown', event._lineBreakerBind.b);\r\n            event._lineBreakerBind = null;\r\n            \r\n            eventWysiwyg.removeEventListener('touchstart', event.onMouseDown_wysiwyg, {passive: true, useCapture: false});\r\n            eventWysiwyg.removeEventListener('focus', event.onFocus_wysiwyg);\r\n            eventWysiwyg.removeEventListener('blur', event.onBlur_wysiwyg);\r\n\r\n            context.element.code.removeEventListener('keydown', event._codeViewAutoHeight);\r\n            context.element.code.removeEventListener('keyup', event._codeViewAutoHeight);\r\n            context.element.code.removeEventListener('paste', event._codeViewAutoHeight);\r\n            \r\n            if (context.element.resizingBar) {\r\n                context.element.resizingBar.removeEventListener('mousedown', event.onMouseDown_resizingBar);\r\n            }\r\n            \r\n            if (event._resizeObserver) {\r\n                event._resizeObserver.unobserve(context.element.wysiwygFrame);\r\n                event._resizeObserver = null;\r\n            }\r\n\r\n            if (event._toolbarObserver) {\r\n                event._toolbarObserver.unobserve(context.element._toolbarShadow);\r\n                event._toolbarObserver = null;\r\n            }\r\n\r\n            _w.removeEventListener('resize', event.onResize_window);\r\n            _w.removeEventListener('scroll', event.onScroll_window);\r\n        },\r\n\r\n        _setResponsiveToolbar: function () {\r\n            if (_responsiveButtons.length === 0) {\r\n                _responsiveButtons = null;\r\n                return;\r\n            }\r\n\r\n            event._responsiveCurrentSize = 'default';\r\n            const sizeArray = event._responsiveButtonSize = [];\r\n            const buttonsObj = event._responsiveButtons = {default: _responsiveButtons[0]};\r\n            for (let i = 1, len = _responsiveButtons.length, size, buttonGroup; i < len; i++) {\r\n                buttonGroup = _responsiveButtons[i];\r\n                size = buttonGroup[0] * 1;\r\n                sizeArray.push(size);\r\n                buttonsObj[size] = buttonGroup[1];\r\n            }\r\n\r\n            sizeArray.sort(function (a, b) { return a - b; }).unshift('default');\r\n        }\r\n    };\r\n\r\n    /** functions */\r\n    const functions = {\r\n        /**\r\n         * @description Core, Util object\r\n         */\r\n        core: core,\r\n        util: util,\r\n\r\n        /**\r\n         * @description Event functions\r\n         * @param {Object} e Event Object\r\n         * @param {Object} core Core object\r\n         */\r\n        onload: null,\r\n        onScroll: null,\r\n        onMouseDown: null,\r\n        onClick: null,\r\n        onInput: null,\r\n        onKeyDown: null,\r\n        onKeyUp: null,\r\n        onCopy: null,\r\n        onCut: null,\r\n        onFocus: null,\r\n        onBlur: null,\r\n\r\n        /**\r\n         * @description Event functions\r\n         * @param {String} contents Current contents\r\n         * @param {Object} core Core object\r\n         */\r\n        onChange: null,\r\n\r\n        /**\r\n         * @description Event functions\r\n         * @param {String} contents Current contents\r\n         * @param {Object} core Core object\r\n         */\r\n        onSave: null,\r\n\r\n        /**\r\n         * @description Event functions (drop, paste)\r\n         * When false is returned, the default behavior is stopped.\r\n         * If the string is returned, the cleanData value is modified to the return value.\r\n         * @param {Object} e Event object.\r\n         * @param {String} cleanData HTML string modified for editor format.\r\n         * @param {Boolean} maxChartCount option (true if max character is exceeded)\r\n         * @param {Object} core Core object\r\n         * @returns {Boolean|String}\r\n         */\r\n        onDrop: null,\r\n        onPaste: null,\r\n\r\n        /**\r\n         * @description Called just before the inline toolbar is positioned and displayed on the screen.\r\n         * @param {Element} toolbar Toolbar Element\r\n         * @param {Object} context The editor's context object (editor.getContext())\r\n         * @param {Object} core Core object\r\n         */\r\n        showInline: null,\r\n\r\n        /**\r\n         * @description Called just after the controller is positioned and displayed on the screen.\r\n         * controller - editing elements displayed on the screen [image resizing, table editor, link editor..]]\r\n         * @param {String} name The name of the plugin that called the controller\r\n         * @param {Array} controllers Array of Controller elements\r\n         * @param {Object} core Core object\r\n         */\r\n        showController: null,\r\n\r\n        /**\r\n         * @description An event when toggling between code view and wysiwyg view.\r\n         * @param {Boolean} isCodeView Whether the current code view mode\r\n         * @param {Object} core Core object\r\n         */\r\n        toggleCodeView: null,\r\n\r\n        /**\r\n         * @description An event when toggling full screen.\r\n         * @param {Boolean} isFullScreen Whether the current full screen mode\r\n         * @param {Object} core Core object\r\n         */\r\n        toggleFullScreen: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the image upload\r\n         * @param {Object} response Response object\r\n         * @param {Object} info Input information\r\n         * - linkValue: Link url value\r\n         * - linkNewWindow: Open in new window Check Value\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update image if true, create image if false\r\n         * - element: If isUpdate is true, the currently selected image.\r\n         * @param {Object} core Core object\r\n         */\r\n        imageUploadHandler: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the video upload\r\n         * @param xmlHttp xmlHttpRequest object\r\n         * @param info Input information\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update video if true, create video if false\r\n         * - element: If isUpdate is true, the currently selected video.\r\n         * @param core Core object\r\n         */\r\n        videoUploadHandler: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the audio upload\r\n         * @param xmlHttp xmlHttpRequest object\r\n         * @param info Input information\r\n         * - isUpdate: Update audio if true, create audio if false\r\n         * - element: If isUpdate is true, the currently selected audio.\r\n         * @param core Core object\r\n         */\r\n        audioUploadHandler: null,\r\n\r\n        /**\r\n         * @description Called before the image is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no image upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - linkValue: Link url value\r\n         * - linkNewWindow: Open in new window Check Value\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update image if true, create image if false\r\n         * - element: If isUpdate is true, the currently selected image.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"imageUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onImageUploadBefore: null,\r\n        /**\r\n         * @description Called before the video is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no video(iframe, video) upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update video if true, create video if false\r\n         * - element: If isUpdate is true, the currently selected video.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"videoUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onVideoUploadBefore: null,\r\n        /**\r\n         * @description Called before the audio is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no audio upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - isUpdate: Update audio if true, create audio if false\r\n         * - element: If isUpdate is true, the currently selected audio.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"audioUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onAudioUploadBefore: null,\r\n\r\n        /**\r\n         * @description Called when the image is uploaded, updated, deleted\r\n         * @param {Element} targetElement Target element\r\n         * @param {Number} index Uploaded index\r\n         * @param {String} state Upload status ('create', 'update', 'delete')\r\n         * @param {Object} info Image info object\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @param {Number} remainingFilesCount Count of remaining files to upload (0 when added as a url)\r\n         * @param {Object} core Core object\r\n         */\r\n        onImageUpload: null,\r\n         /**\r\n         * @description Called when the video(iframe, video) is is uploaded, updated, deleted\r\n         * -- arguments is same \"onImageUpload\" --\r\n         */\r\n        onVideoUpload: null,\r\n         /**\r\n         * @description Called when the audio is is uploaded, updated, deleted\r\n         * -- arguments is same \"onImageUpload\" --\r\n         */\r\n        onAudioUpload: null,\r\n\r\n        /**\r\n         * @description Called when the image is upload failed\r\n         * @param {String} errorMessage Error message\r\n         * @param {Object} result Response Object\r\n         * @param {Object} core Core object\r\n         * @returns {Boolean}\r\n         */\r\n        onImageUploadError: null,\r\n        /**\r\n         * @description Called when the video(iframe, video) upload failed\r\n         * -- arguments is same \"onImageUploadError\" --\r\n         */\r\n        onVideoUploadError: null,\r\n        /**\r\n         * @description Called when the audio upload failed\r\n         * -- arguments is same \"onImageUploadError\" --\r\n         */\r\n        onAudioUploadError: null,\r\n\r\n        /**\r\n         * @description Called when the editor is resized using the bottom bar\r\n         */\r\n        onResizeEditor: null,\r\n\r\n        /**\r\n         * @description Called after the \"setToolbarButtons\" invocation.\r\n         * Can be used to tweak buttons properties (useful for custom buttons)\r\n         * @param {Array} buttonList Button list \r\n         * @param {Object} core Core object\r\n         */\r\n        onSetToolbarButtons: null,\r\n\r\n        /**\r\n         * @description Reset the buttons on the toolbar. (Editor is not reloaded)\r\n         * You cannot set a new plugin for the button.\r\n         * @param {Array} buttonList Button list \r\n         */\r\n        setToolbarButtons: function (buttonList) {\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            core.moreLayerOff();\r\n            \r\n            const newToolbar = _Constructor._createToolBar(_d, buttonList, core.plugins, options);\r\n            _responsiveButtons = newToolbar.responsiveButtons;\r\n            event._setResponsiveToolbar();\r\n\r\n            context.element.toolbar.replaceChild(newToolbar._buttonTray, context.element._buttonTray);\r\n            const newContext = _Context(context.element.originElement, core._getConstructed(context.element), options);\r\n\r\n            context.element = newContext.element;\r\n            context.tool = newContext.tool;\r\n            if (options.iframe) context.element.wysiwyg = core._wd.body;\r\n\r\n            core._recoverButtonStates();\r\n            core._cachingButtons();\r\n            core.history._resetCachingButton();\r\n\r\n            core.effectNode = null;\r\n            if (core.hasFocus) event._applyTagEffects();\r\n            if (core.isReadOnly) util.setDisabledButtons(true, core.resizingDisabledButtons);\r\n            if (typeof functions.onSetToolbarButtons === 'function') functions.onSetToolbarButtons(newToolbar._buttonTray.querySelectorAll('button'), core);\r\n        },\r\n\r\n        /**\r\n         * @description Add or reset option property (Editor is reloaded)\r\n         * @param {Object} _options Options\r\n         */\r\n        setOptions: function (_options) {\r\n            event._removeEvent();\r\n            core._resetComponents();\r\n            \r\n            util.removeClass(core._styleCommandMap.showBlocks, 'active');\r\n            util.removeClass(core._styleCommandMap.codeView, 'active');\r\n            core._variable.isCodeView = false;\r\n            core._iframeAuto = null;\r\n\r\n            core.plugins = _options.plugins || core.plugins;\r\n            const mergeOptions = [options, _options].reduce(function (init, option) {\r\n                for (let key in option) {\r\n                    if (!util.hasOwn(option, key)) continue;\r\n                    if (key === 'plugins' && option[key] && init[key]) {\r\n                        let i = init[key], o = option[key];\r\n                        i = i.length ? i : _w.Object.keys(i).map(function(name) { return i[name]; });\r\n                        o = o.length ? o : _w.Object.keys(o).map(function(name) { return o[name]; });\r\n                        init[key] = (o.filter(function(val) { return i.indexOf(val) === -1; })).concat(i);\r\n                    } else {\r\n                        init[key] = option[key];\r\n                    }\r\n                }\r\n                return init;\r\n            }, {});\r\n\r\n            const el = context.element;\r\n            const _initHTML = el.wysiwyg.innerHTML;\r\n\r\n            // set option\r\n            const cons = _Constructor._setOptions(mergeOptions, context, options);\r\n\r\n            if (cons.callButtons) {\r\n                pluginCallButtons = cons.callButtons;\r\n                core.initPlugins = {};\r\n            }\r\n\r\n            if (cons.plugins) {\r\n                core.plugins = plugins = cons.plugins;\r\n            }\r\n\r\n            // reset context\r\n            if (el._menuTray.children.length === 0) this._menuTray = {};\r\n            _responsiveButtons = cons.toolbar.responsiveButtons;\r\n            core.options = options = mergeOptions;\r\n            core.lang = lang = options.lang;\r\n\r\n            if (options.iframe) {\r\n                el.wysiwygFrame.addEventListener('load', function () {\r\n                    util._setIframeDocument(this, options);\r\n                    core._setOptionsInit(el, _initHTML);\r\n                });\r\n            }\r\n\r\n            el.editorArea.appendChild(el.wysiwygFrame);\r\n\r\n            if (!options.iframe) {\r\n                core._setOptionsInit(el, _initHTML);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set \"options.defaultStyle\" style.\r\n         * Define the style of the edit area\r\n         * It can also be defined with the \"setOptions\" method, but the \"setDefaultStyle\" method does not render the editor again.\r\n         * @param {String} style Style string\r\n         */\r\n        setDefaultStyle: function (style) {\r\n            const newStyles = options._editorStyles = util._setDefaultOptionStyle(options, style);\r\n            const el = context.element;\r\n\r\n            // top area\r\n            el.topArea.style.cssText = newStyles.top;\r\n            // code view\r\n            el.code.style.cssText = options._editorStyles.frame;\r\n            el.code.style.display = 'none';\r\n            if (options.height === 'auto') {\r\n                el.code.style.overflow = 'hidden';\r\n            } else {\r\n                el.code.style.overflow = '';\r\n            }\r\n            // wysiwyg frame\r\n            if (!options.iframe) {\r\n                el.wysiwygFrame.style.cssText = newStyles.frame + newStyles.editor;\r\n            } else {\r\n                el.wysiwygFrame.style.cssText = newStyles.frame;\r\n                el.wysiwyg.style.cssText = newStyles.editor;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Open a notice area\r\n         * @param {String} message Notice message\r\n         */\r\n        noticeOpen: function (message) {\r\n            core.notice.open.call(core, message);\r\n        },\r\n\r\n        /**\r\n         * @description Close a notice area\r\n         */\r\n        noticeClose: function () {\r\n            core.notice.close.call(core);\r\n        },\r\n\r\n        /**\r\n         * @description Copying the contents of the editor to the original textarea and execute onSave callback\r\n         * * not working during enabled codeView mode\r\n         */\r\n        save: function () {\r\n            const contents = core.getContents(false);\r\n            context.element.originElement.value = contents;\r\n            event.onSave_wysiwyg(contents, core);\r\n        },\r\n\r\n        /**\r\n         * @description Gets the suneditor's context object. Contains settings, plugins, and cached element objects\r\n         * @returns {Object}\r\n         */\r\n        getContext: function () {\r\n            return context;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the contents of the suneditor\r\n         * * not working during enabled codeView mode\r\n         * @param {Boolean} onlyContents - Return only the contents of the body without headers when the \"fullPage\" option is true\r\n         * @returns {String}\r\n         */\r\n        getContents: function (onlyContents) {\r\n            return core.getContents(onlyContents);\r\n        },\r\n\r\n        /**\r\n         * @description Gets only the text of the suneditor contents\r\n         * * not working during enabled codeView mode\r\n         * @returns {String}\r\n         */\r\n        getText: function () {\r\n            return context.element.wysiwyg.textContent;\r\n        },\r\n\r\n        /**\r\n         * @description Get the editor's number of characters or binary data size.\r\n         * You can use the \"charCounterType\" option format.\r\n         * @param {String|null} charCounterType options - charCounterType ('char', 'byte', 'byte-html')\r\n         * If argument is no value, the currently set \"charCounterType\" option is used.\r\n         * @returns {Number}\r\n         */\r\n        getCharCount: function (charCounterType) {\r\n            charCounterType = typeof charCounterType === 'string' ? charCounterType : options.charCounterType;\r\n            return core.getCharLength((core._charTypeHTML ? context.element.wysiwyg.innerHTML : context.element.wysiwyg.textContent), charCounterType);\r\n        },\r\n\r\n        /**\r\n         * @description Gets uploaded images informations\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @returns {Array}\r\n         */\r\n        getImagesInfo: function () {\r\n            return context.image ? context.image._infoList : [];\r\n        },\r\n        \r\n        /**\r\n         * @description Gets uploaded files(plugin using fileManager) information list.\r\n         * image: [img], video: [video, iframe], audio: [audio]\r\n         * When the argument value is 'image', it is the same function as \"getImagesInfo\".\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @param {String} pluginName Plugin name (image, video, audio)\r\n         * @returns {Array}\r\n         */\r\n        getFilesInfo: function (pluginName) {\r\n            return context[pluginName] ? context[pluginName]._infoList : [];\r\n        },\r\n\r\n        /**\r\n         * @description Upload images using image plugin\r\n         * @param {FileList} files FileList\r\n         */\r\n        insertImage: function (files) {\r\n            if (!core.plugins.image || !files) return;\r\n\r\n            if (!core.initPlugins.image) core.callPlugin('image', core.plugins.image.submitAction.bind(core, files), null);\r\n            else core.plugins.image.submitAction.call(core, files);\r\n            core.focus();\r\n        },\r\n\r\n        /**\r\n         * @description Inserts an HTML element or HTML string or plain string at the current cursor position\r\n         * @param {Element|String} html HTML Element or HTML string or plain string\r\n         * @param {Boolean} notCleaningData If true, inserts the HTML string without refining it with core.cleanHTML.\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @param {Boolean} rangeSelection If true, range select the inserted node.\r\n         */\r\n        insertHTML: function (html, notCleaningData, checkCharCount, rangeSelection) {\r\n            if (!context.element.wysiwygFrame.contains(core.getSelection().focusNode)) core.focus();\r\n\r\n            if (typeof html === 'string') {\r\n                if (!notCleaningData) html = core.cleanHTML(html, null, null);\r\n                try {\r\n                    if (util.isListCell(util.getFormatElement(core.getSelectionNode(), null))) {\r\n                        const dom = _d.createRange().createContextualFragment(html);\r\n                        const domTree = dom.childNodes;\r\n                        if (core._isFormatData(domTree)) html = core._convertListCell(domTree);\r\n                    }\r\n\r\n                    const dom = _d.createRange().createContextualFragment(html);\r\n                    const domTree = dom.childNodes;\r\n\r\n                    if (checkCharCount) {\r\n                        const type = core._charTypeHTML ? 'outerHTML' : 'textContent';\r\n                        let checkHTML = '';\r\n                        for (let i = 0, len = domTree.length; i < len; i++) {\r\n                            checkHTML += domTree[i][type];\r\n                        }\r\n                        if (!core.checkCharCount(checkHTML, null)) return;\r\n                    }\r\n\r\n                    let c, a, t, prev, firstCon;\r\n                    while ((c = domTree[0])) {\r\n                        if (prev && prev.nodeType === 3 && a && a.nodeType === 1 && util.isBreak(c)) {\r\n                            prev = c;\r\n                            util.removeItem(c);\r\n                            continue;\r\n                        }\r\n                        t = core.insertNode(c, a, false);\r\n                        a = t.container || t;\r\n                        if (!firstCon) firstCon = t;\r\n                        prev = c;\r\n                    }\r\n\r\n                    if (prev.nodeType === 3 && a.nodeType === 1) a = prev;\r\n                    const offset = a.nodeType === 3 ? (t.endOffset || a.textContent.length): a.childNodes.length;\r\n                    if (rangeSelection) core.setRange(firstCon.container || firstCon, firstCon.startOffset || 0, a, offset);\r\n                    else core.setRange(a, offset, a, offset);\r\n                } catch (error) {\r\n                    if (core.isDisabled || core.isReadOnly) return;\r\n                    console.warn('[SUNEDITOR.insertHTML.fail] ' + error);\r\n                    core.execCommand('insertHTML', false, html);\r\n                }\r\n            } else {\r\n                if (util.isComponent(html)) {\r\n                    core.insertComponent(html, false, checkCharCount, false);\r\n                } else {\r\n                    let afterNode = null;\r\n                    if (util.isFormatElement(html) || util.isMedia(html)) {\r\n                        afterNode = util.getFormatElement(core.getSelectionNode(), null);\t\r\n                    }\r\n                    core.insertNode(html, afterNode, checkCharCount);\r\n                }\r\n            }\r\n            \r\n            core.effectNode = null;\r\n            core.focus();\r\n\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Change the contents of the suneditor\r\n         * @param {String|undefined} contents Contents to Input\r\n         */\r\n        setContents: function (contents) {\r\n            core.setContents(contents);\r\n        },\r\n\r\n        /**\r\n         * @description Add contents to the suneditor\r\n         * @param {String} contents Contents to Input\r\n         */\r\n        appendContents: function (contents) {\r\n            const convertValue = core.convertContentsForEditor(contents);\r\n            \r\n            if (!core._variable.isCodeView) {\r\n                const temp = util.createElement('DIV');\r\n                temp.innerHTML = convertValue;\r\n\r\n                const wysiwyg = context.element.wysiwyg;\r\n                const children = temp.children;\r\n                for (let i = 0, len = children.length; i < len; i++) {\r\n                    if (children[i]) {\r\n                        wysiwyg.appendChild(children[i]);         \r\n                    }\r\n                }\r\n            } else {\r\n                core._setCodeView(core._getCodeView() + '\\n' + core.convertHTMLForCodeView(convertValue, false));\r\n            }\r\n\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Switch to or off \"ReadOnly\" mode.\r\n         * @param {Boolean} value \"readOnly\" boolean value.\r\n         */\r\n        readOnly: function (value) {\r\n            core.isReadOnly = value;\r\n            \r\n            util.setDisabledButtons(!!value, core.resizingDisabledButtons);\r\n\r\n            if (value) {\r\n                /** off menus */\r\n                core.controllersOff();\r\n                if (core.submenuActiveButton && core.submenuActiveButton.disabled) core.submenuOff();\r\n                if (core._moreLayerActiveButton && core._moreLayerActiveButton.disabled) core.moreLayerOff();\r\n                if (core.containerActiveButton && core.containerActiveButton.disabled) core.containerOff();\r\n                if (core.modalForm) core.plugins.dialog.close.call(core);\r\n\r\n                context.element.code.setAttribute(\"readOnly\", \"true\");\r\n                util.addClass(context.element.wysiwygFrame, 'se-read-only');\r\n            } else {\r\n                context.element.code.removeAttribute(\"readOnly\");\r\n                util.removeClass(context.element.wysiwygFrame, 'se-read-only');\r\n            }\r\n\r\n            if (options.codeMirrorEditor) options.codeMirrorEditor.setOption('readOnly', !!value);\r\n        },\r\n\r\n        /**\r\n         * @description Disable the suneditor\r\n         */\r\n        disable: function () {\r\n            this.toolbar.disable();\r\n            this.wysiwyg.disable();\r\n        },\r\n\r\n        /**\r\n         * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n         */\r\n         disabled: function () {\r\n            this.disable();\r\n        },\r\n\r\n        /**\r\n         * @description Enable the suneditor\r\n         */\r\n        enable: function () {\r\n            this.toolbar.enable();\r\n            this.wysiwyg.enable();\r\n        },\r\n\r\n        /**\r\n         * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n         */\r\n         enabled: function () {\r\n            this.enable();\r\n        },\r\n\r\n        /**\r\n         * @description Show the suneditor\r\n         */\r\n        show: function () {\r\n            const topAreaStyle = context.element.topArea.style;\r\n            if (topAreaStyle.display === 'none') topAreaStyle.display = options.display;\r\n        },\r\n\r\n        /**\r\n         * @description Hide the suneditor\r\n         */\r\n        hide: function () {\r\n            context.element.topArea.style.display = 'none';\r\n        },\r\n\r\n        /**\r\n         * @description Destroy the suneditor\r\n         */\r\n        destroy: function () {\r\n            /** off menus */\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            core.controllersOff();\r\n            if (core.notice) core.notice.close.call(core);\r\n            if (core.modalForm) core.plugins.dialog.close.call(core);\r\n\r\n            /** remove history */\r\n            core.history._destroy();\r\n\r\n            /** remove event listeners */\r\n            event._removeEvent();\r\n            \r\n            /** remove element */\r\n            util.removeItem(context.element.toolbar);\r\n            util.removeItem(context.element.topArea);\r\n\r\n            /** remove object reference */\r\n            for (let k in core.functions) { if (util.hasOwn(core, k)) delete core.functions[k]; }\r\n            for (let k in core) { if (util.hasOwn(core, k)) delete core[k]; }\r\n            for (let k in event) { if (util.hasOwn(event, k)) delete event[k]; }\r\n            for (let k in context) { if (util.hasOwn(context, k)) delete context[k]; }\r\n            for (let k in pluginCallButtons) { if (util.hasOwn(pluginCallButtons, k)) delete pluginCallButtons[k]; }\r\n            \r\n            /** remove user object */\r\n            for (let k in this) { if (util.hasOwn(this, k)) delete this[k]; }\r\n        },\r\n\r\n        /**\r\n         * @description Toolbar methods\r\n         */\r\n        toolbar: {\r\n            /**\r\n             * @description Disable the toolbar\r\n             */\r\n            disable: function () {\r\n                /** off menus */\r\n                core.submenuOff();\r\n                core.moreLayerOff();\r\n                core.containerOff();\r\n\r\n                context.tool.cover.style.display = 'block';\r\n            },\r\n\r\n            /**\r\n             * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n             */\r\n            disabled: function () {\r\n                this.disable();\r\n            },\r\n\r\n            /**\r\n             * @description Enable the toolbar\r\n             */\r\n            enable: function () {\r\n                context.tool.cover.style.display = 'none';\r\n            },\r\n\r\n            /**\r\n             * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n             */\r\n             enabled: function () {\r\n                this.enable();\r\n            },\r\n\r\n            /**\r\n             * @description Show the toolbar\r\n             */\r\n            show: function () {\r\n                if (core._isInline) {\r\n                    event._showToolbarInline();\r\n                } else {\r\n                    context.element.toolbar.style.display = '';\r\n                    context.element._stickyDummy.style.display = '';\r\n                }\r\n            },\r\n\r\n            /**\r\n             * @description Hide the toolbar\r\n             */\r\n            hide: function () {\r\n                if (core._isInline) {\r\n                    event._hideToolbar();\r\n                } else {\r\n                    context.element.toolbar.style.display = 'none';\r\n                    context.element._stickyDummy.style.display = 'none';\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * @description Wysiwyg methods\r\n         */\r\n         wysiwyg: {\r\n            /**\r\n             * @description Disable the wysiwyg area\r\n             */\r\n            disable: function () {\r\n               /** off menus */\r\n                core.controllersOff();\r\n                if (core.modalForm) core.plugins.dialog.close.call(core);\r\n\r\n                context.element.wysiwyg.setAttribute('contenteditable', false);\r\n                core.isDisabled = true;\r\n\r\n                if (options.codeMirrorEditor) {\r\n                    options.codeMirrorEditor.setOption('readOnly', true);\r\n                } else {\r\n                    context.element.code.setAttribute('disabled', 'disabled');\r\n                }\r\n            },\r\n\r\n            /**\r\n             * @description Enable the wysiwyg area\r\n             */\r\n            enable: function () {\r\n                context.element.wysiwyg.setAttribute('contenteditable', true);\r\n                core.isDisabled = false;\r\n\r\n                if (options.codeMirrorEditor) {\r\n                    options.codeMirrorEditor.setOption('readOnly', false);\r\n                } else {\r\n                    context.element.code.removeAttribute('disabled');\r\n                }\r\n            },\r\n         }\r\n    };\r\n\r\n    /************ Core init ************/\r\n    // functions\r\n    core.functions = functions;\r\n    core.options = options;\r\n\r\n    // Create to sibling node\r\n    let contextEl = context.element;\r\n    let originEl = contextEl.originElement;\r\n    let topEl = contextEl.topArea;\r\n    originEl.style.display = 'none';\r\n    topEl.style.display = 'block';\r\n\r\n    // init\r\n    if (options.iframe) {\r\n        contextEl.wysiwygFrame.addEventListener('load', function () {\r\n            util._setIframeDocument(this, options);\r\n            core._editorInit(false, options.value);\r\n            options.value = null;\r\n        });\r\n    }\r\n\r\n    // insert editor element\r\n    if (typeof originEl.nextElementSibling === 'object') {\r\n        originEl.parentNode.insertBefore(topEl, originEl.nextElementSibling);\r\n    } else {\r\n        originEl.parentNode.appendChild(topEl);\r\n    }\r\n\r\n    contextEl.editorArea.appendChild(contextEl.wysiwygFrame);\r\n    contextEl = originEl = topEl = null;\r\n\r\n    // init\r\n    if (!options.iframe) {\r\n        core._editorInit(false, options.value);\r\n        options.value = null;\r\n    }\r\n\r\n    return functions;\r\n}"],"mappings":"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,EAAE,IAbI;IAcd5H,WAAW,EAAE,IAdC;IAedU,OAAO,EAAE,IAfK;IAgBdqC,OAAO,EAAE,IAhBK;IAiBdgB,SAAS,EAAE,IAjBG;IAkBd2D,OAAO,EAAE,IAlBK;IAmBdmC,MAAM,EAAE,IAnBM;IAoBdI,KAAK,EAAE,IApBO;IAqBdnC,OAAO,EAAE,IArBK;IAsBdE,MAAM,EAAE,IAtBM;;IAwBd;AACR;AACA;AACA;AACA;IACQjM,QAAQ,EAAE,IA7BI;;IA+Bd;AACR;AACA;AACA;AACA;IACQgO,MAAM,EAAE,IApCM;;IAsCd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACQkB,MAAM,EAAE,IAhDM;IAiDdD,OAAO,EAAE,IAjDK;;IAmDd;AACR;AACA;AACA;AACA;AACA;IACQrI,UAAU,EAAE,IAzDE;;IA2Dd;AACR;AACA;AACA;AACA;AACA;AACA;IACQ51B,cAAc,EAAE,IAlEF;;IAoEd;AACR;AACA;AACA;AACA;IACQsd,cAAc,EAAE,IAzEF;;IA2Ed;AACR;AACA;AACA;AACA;IACQC,gBAAgB,EAAE,IAhFJ;;IAkFd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACQmiB,kBAAkB,EAAE,IA/FN;;IAiGd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACQC,kBAAkB,EAAE,IA5GN;;IA8Gd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;IACQC,kBAAkB,EAAE,IAtHN;;IAwHd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACQC,mBAAmB,EAAE,IArJP;;IAsJd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACQC,mBAAmB,EAAE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"},"metadata":{},"sourceType":"module"}