{"ast":null,"code":"/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport selectMenu from './_selectMenu';\nexport default {\n  name: 'anchor',\n  add: function (core) {\n    core.addModule([selectMenu]);\n    core.context.anchor = {\n      caller: {},\n      forms: this.setDialogForm(core),\n      host: (core._w.location.origin + core._w.location.pathname).replace(/\\/$/, ''),\n      callerContext: null\n    };\n  },\n\n  /** dialog */\n  setDialogForm: function (core) {\n    const lang = core.lang;\n    const relList = core.options.linkRel;\n    const defaultRel = (core.options.linkRelDefault.default || '').split(' ');\n    const icons = core.icons;\n    const forms = core.util.createElement('DIV');\n    let html = '<div class=\"se-dialog-body\">' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.linkBox.url + '</label>' + '<div class=\"se-dialog-form-files\">' + '<input class=\"se-input-form se-input-url\" type=\"text\" placeholder=\"' + (core.options.protocol || '') + '\" />' + '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button _se_bookmark_button\" title=\"' + lang.dialogBox.linkBox.bookmark + '\" aria-label=\"' + lang.dialogBox.linkBox.bookmark + '\">' + icons.bookmark + '</button>' + core.plugins.selectMenu.setForm() + '</div>' + '<div class=\"se-anchor-preview-form\">' + '<span class=\"se-svg se-anchor-preview-icon _se_anchor_bookmark_icon\">' + icons.bookmark + '</span>' + '<span class=\"se-svg se-anchor-preview-icon _se_anchor_download_icon\">' + icons.download + '</span>' + '<pre class=\"se-link-preview\"></pre>' + '</div>' + '</div>' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.linkBox.text + '</label><input class=\"se-input-form _se_anchor_text\" type=\"text\" />' + '</div>' + '<div class=\"se-dialog-form-footer\">' + '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_check\" />&nbsp;' + lang.dialogBox.linkBox.newWindowCheck + '</label>' + '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_download\" />&nbsp;' + lang.dialogBox.linkBox.downloadLinkCheck + '</label>';\n\n    if (relList.length > 0) {\n      html += '<div class=\"se-anchor-rel\"><button type=\"button\" class=\"se-btn se-btn-select se-anchor-rel-btn\">&lt;rel&gt;</button>' + '<div class=\"se-anchor-rel-wrapper\"><pre class=\"se-link-preview se-anchor-rel-preview\"></pre></div>' + '<div class=\"se-list-layer\">' + '<div class=\"se-list-inner\">' + '<ul class=\"se-list-basic se-list-checked\">';\n\n      for (let i = 0, len = relList.length, rel; i < len; i++) {\n        rel = relList[i];\n        html += '<li><button type=\"button\" class=\"se-btn-list' + (defaultRel.indexOf(rel) > -1 ? ' se-checked' : '') + '\" data-command=\"' + rel + '\" title=\"' + rel + '\" aria-label=\"' + rel + '\"><span class=\"se-svg\">' + icons.checked + '</span>' + rel + '</button></li>';\n      }\n\n      html += '</ul></div></div></div>';\n    }\n\n    html += '</div></div>';\n    forms.innerHTML = html;\n    return forms;\n  },\n  initEvent: function (pluginName, forms) {\n    const anchorPlugin = this.plugins.anchor;\n    const context = this.context.anchor.caller[pluginName] = {\n      modal: forms,\n      urlInput: null,\n      linkDefaultRel: this.options.linkRelDefault,\n      defaultRel: this.options.linkRelDefault.default || '',\n      currentRel: [],\n      linkAnchor: null,\n      linkValue: '',\n      _change: false,\n      callerName: pluginName\n    };\n    if (typeof context.linkDefaultRel.default === 'string') context.linkDefaultRel.default = context.linkDefaultRel.default.trim();\n    if (typeof context.linkDefaultRel.check_new_window === 'string') context.linkDefaultRel.check_new_window = context.linkDefaultRel.check_new_window.trim();\n    if (typeof context.linkDefaultRel.check_bookmark === 'string') context.linkDefaultRel.check_bookmark = context.linkDefaultRel.check_bookmark.trim();\n    context.urlInput = forms.querySelector('.se-input-url');\n    context.anchorText = forms.querySelector('._se_anchor_text');\n    context.newWindowCheck = forms.querySelector('._se_anchor_check');\n    context.downloadCheck = forms.querySelector('._se_anchor_download');\n    context.download = forms.querySelector('._se_anchor_download_icon');\n    context.preview = forms.querySelector('.se-link-preview');\n    context.bookmark = forms.querySelector('._se_anchor_bookmark_icon');\n    context.bookmarkButton = forms.querySelector('._se_bookmark_button');\n    this.plugins.selectMenu.initEvent.call(this, pluginName, forms);\n    const listContext = this.context.selectMenu.caller[pluginName];\n    /** rel */\n\n    if (this.options.linkRel.length > 0) {\n      context.relButton = forms.querySelector('.se-anchor-rel-btn');\n      context.relList = forms.querySelector('.se-list-layer');\n      context.relPreview = forms.querySelector('.se-anchor-rel-preview');\n      context.relButton.addEventListener('click', anchorPlugin.onClick_relButton.bind(this, context));\n      context.relList.addEventListener('click', anchorPlugin.onClick_relList.bind(this, context));\n    }\n\n    context.newWindowCheck.addEventListener('change', anchorPlugin.onChange_newWindowCheck.bind(this, context));\n    context.downloadCheck.addEventListener('change', anchorPlugin.onChange_downloadCheck.bind(this, context));\n    context.anchorText.addEventListener('input', anchorPlugin.onChangeAnchorText.bind(this, context));\n    context.urlInput.addEventListener('input', anchorPlugin.onChangeUrlInput.bind(this, context));\n    context.urlInput.addEventListener('keydown', anchorPlugin.onKeyDownUrlInput.bind(this, listContext));\n    context.urlInput.addEventListener('focus', anchorPlugin.onFocusUrlInput.bind(this, context, listContext));\n    context.urlInput.addEventListener('blur', anchorPlugin.onBlurUrlInput.bind(this, listContext));\n    context.bookmarkButton.addEventListener('click', anchorPlugin.onClick_bookmarkButton.bind(this, context));\n  },\n  on: function (contextAnchor, update) {\n    const anchorPlugin = this.plugins.anchor;\n\n    if (!update) {\n      anchorPlugin.init.call(this, contextAnchor);\n      contextAnchor.anchorText.value = this.getSelection().toString().trim();\n      contextAnchor.newWindowCheck.checked = this.options.linkTargetNewWindow;\n    } else if (contextAnchor.linkAnchor) {\n      this.context.dialog.updateModal = true;\n      const href = contextAnchor.linkAnchor.getAttribute('href');\n      contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = anchorPlugin.selfPathBookmark.call(this, href) ? href.substr(href.lastIndexOf('#')) : href;\n      contextAnchor.anchorText.value = contextAnchor.linkAnchor.textContent || contextAnchor.linkAnchor.getAttribute('alt');\n      contextAnchor.newWindowCheck.checked = /_blank/i.test(contextAnchor.linkAnchor.target) ? true : false;\n      contextAnchor.downloadCheck.checked = contextAnchor.linkAnchor.download;\n    }\n\n    this.context.anchor.callerContext = contextAnchor;\n    anchorPlugin.setRel.call(this, contextAnchor, update && contextAnchor.linkAnchor ? contextAnchor.linkAnchor.rel : contextAnchor.defaultRel);\n    anchorPlugin.setLinkPreview.call(this, contextAnchor, contextAnchor.linkValue);\n    this.plugins.selectMenu.on.call(this, contextAnchor.callerName, this.plugins.anchor.setHeaderBookmark);\n  },\n  selfPathBookmark: function (path) {\n    const href = this._w.location.href.replace(/\\/$/, '');\n\n    return path.indexOf('#') === 0 || path.indexOf(href) === 0 && path.indexOf('#') === (href.indexOf(\"#\") === -1 ? href.length : href.substr(0, href.indexOf(\"#\")).length);\n  },\n  _closeRelMenu: null,\n  toggleRelList: function (contextAnchor, show) {\n    if (!show) {\n      if (this.plugins.anchor._closeRelMenu) this.plugins.anchor._closeRelMenu();\n    } else {\n      const target = contextAnchor.relButton;\n      const relList = contextAnchor.relList;\n      this.util.addClass(target, 'active');\n      relList.style.visibility = 'hidden';\n      relList.style.display = 'block';\n      if (!this.options.rtl) relList.style.left = target.offsetLeft + target.offsetWidth + 1 + 'px';else relList.style.left = target.offsetLeft - relList.offsetWidth - 1 + 'px';\n      relList.style.top = target.offsetTop + target.offsetHeight / 2 - relList.offsetHeight / 2 + 'px';\n      relList.style.visibility = '';\n\n      this.plugins.anchor._closeRelMenu = function (context, target, e) {\n        if (e && (context.relButton.contains(e.target) || context.relList.contains(e.target))) return;\n        this.util.removeClass(target, 'active');\n        context.relList.style.display = 'none';\n        this.modalForm.removeEventListener('click', this.plugins.anchor._closeRelMenu);\n        this.plugins.anchor._closeRelMenu = null;\n      }.bind(this, contextAnchor, target);\n\n      this.modalForm.addEventListener('click', this.plugins.anchor._closeRelMenu);\n    }\n  },\n  onClick_relButton: function (contextAnchor, e) {\n    this.plugins.anchor.toggleRelList.call(this, contextAnchor, !this.util.hasClass(e.target, 'active'));\n  },\n  onClick_relList: function (contextAnchor, e) {\n    const target = e.target;\n    const cmd = target.getAttribute('data-command');\n    if (!cmd) return;\n    const current = contextAnchor.currentRel;\n    const checked = this.util.toggleClass(target, 'se-checked');\n    const index = current.indexOf(cmd);\n\n    if (checked) {\n      if (index === -1) current.push(cmd);\n    } else {\n      if (index > -1) current.splice(index, 1);\n    }\n\n    contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = current.join(' ');\n  },\n  setRel: function (contextAnchor, relAttr) {\n    const relListEl = contextAnchor.relList;\n    const rels = contextAnchor.currentRel = !relAttr ? [] : relAttr.split(' ');\n    if (!relListEl) return;\n    const checkedRel = relListEl.querySelectorAll('button');\n\n    for (let i = 0, len = checkedRel.length, cmd; i < len; i++) {\n      cmd = checkedRel[i].getAttribute('data-command');\n\n      if (rels.indexOf(cmd) > -1) {\n        this.util.addClass(checkedRel[i], 'se-checked');\n      } else {\n        this.util.removeClass(checkedRel[i], 'se-checked');\n      }\n    }\n\n    contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = rels.join(' ');\n  },\n  createHeaderList: function (contextAnchor, contextList, urlValue) {\n    const headers = this.util.getListChildren(this.context.element.wysiwyg, function (current) {\n      return /h[1-6]/i.test(current.nodeName);\n    });\n    if (headers.length === 0) return;\n    const valueRegExp = new this._w.RegExp('^' + urlValue.replace(/^#/, ''), 'i');\n    const list = [];\n    let html = '';\n\n    for (let i = 0, len = headers.length, h; i < len; i++) {\n      h = headers[i];\n      if (!valueRegExp.test(h.textContent)) continue;\n      list.push(h);\n      html += '<li class=\"se-select-item\" data-index=\"' + i + '\">' + h.textContent + '</li>';\n    }\n\n    if (list.length === 0) {\n      this.plugins.selectMenu.close.call(this, contextList);\n    } else {\n      this.plugins.selectMenu.createList(contextList, list, html);\n      this.plugins.selectMenu.open.call(this, contextList, this.plugins.anchor._setMenuListPosition.bind(this, contextAnchor));\n    }\n  },\n  _setMenuListPosition: function (contextAnchor, list) {\n    list.style.top = contextAnchor.urlInput.offsetHeight + 1 + 'px';\n  },\n  onKeyDownUrlInput: function (contextList, e) {\n    const keyCode = e.keyCode;\n\n    switch (keyCode) {\n      case 38:\n        // up\n        e.preventDefault();\n        e.stopPropagation();\n        this.plugins.selectMenu.moveItem.call(this, contextList, -1);\n        break;\n\n      case 40:\n        // down\n        e.preventDefault();\n        e.stopPropagation();\n        this.plugins.selectMenu.moveItem.call(this, contextList, 1);\n        break;\n\n      case 13:\n        // enter\n        if (contextList.index > -1) {\n          e.preventDefault();\n          e.stopPropagation();\n          this.plugins.anchor.setHeaderBookmark.call(this, this.plugins.selectMenu.getItem(contextList, null));\n        }\n\n        break;\n    }\n  },\n  setHeaderBookmark: function (header) {\n    const contextAnchor = this.context.anchor.callerContext;\n\n    const id = header.id || 'h_' + this._w.Math.random().toString().replace(/.+\\./, '');\n\n    header.id = id;\n    contextAnchor.urlInput.value = '#' + id;\n\n    if (!contextAnchor.anchorText.value.trim() || !contextAnchor._change) {\n      contextAnchor.anchorText.value = header.textContent;\n    }\n\n    this.plugins.anchor.setLinkPreview.call(this, contextAnchor, contextAnchor.urlInput.value);\n    this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n    this.context.anchor.callerContext.urlInput.focus();\n  },\n  onChangeAnchorText: function (contextAnchor, e) {\n    contextAnchor._change = !!e.target.value.trim();\n  },\n  onChangeUrlInput: function (contextAnchor, e) {\n    const value = e.target.value.trim();\n    this.plugins.anchor.setLinkPreview.call(this, contextAnchor, value);\n    if (this.plugins.anchor.selfPathBookmark.call(this, value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, value);else this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n  },\n  onFocusUrlInput: function (contextAnchor, contextLink) {\n    const value = contextAnchor.urlInput.value;\n    if (this.plugins.anchor.selfPathBookmark.call(this, value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, contextLink, value);\n  },\n  onBlurUrlInput: function (contextList) {\n    this.plugins.selectMenu.close.call(this, contextList);\n  },\n  setLinkPreview: function (context, value) {\n    const preview = context.preview;\n    const protocol = this.options.linkProtocol;\n    const noPrefix = this.options.linkNoPrefix;\n    const reservedProtocol = /^(mailto\\:|tel\\:|sms\\:|https*\\:\\/\\/|#)/.test(value);\n    const sameProtocol = !protocol ? false : this._w.RegExp('^' + value.substr(0, protocol.length)).test(protocol);\n    value = context.linkValue = preview.textContent = !value ? '' : noPrefix ? value : protocol && !reservedProtocol && !sameProtocol ? protocol + value : reservedProtocol ? value : /^www\\./.test(value) ? 'http://' + value : this.context.anchor.host + (/^\\//.test(value) ? '' : '/') + value;\n\n    if (this.plugins.anchor.selfPathBookmark.call(this, value)) {\n      context.bookmark.style.display = 'block';\n      this.util.addClass(context.bookmarkButton, 'active');\n    } else {\n      context.bookmark.style.display = 'none';\n      this.util.removeClass(context.bookmarkButton, 'active');\n    }\n\n    if (!this.plugins.anchor.selfPathBookmark.call(this, value) && context.downloadCheck.checked) {\n      context.download.style.display = 'block';\n    } else {\n      context.download.style.display = 'none';\n    }\n  },\n  setCtx: function (anchor, contextAnchor) {\n    if (!anchor) return;\n    contextAnchor.linkAnchor = anchor;\n    contextAnchor.linkValue = anchor.href;\n    contextAnchor.currentRel = anchor.rel.split(\" \");\n  },\n  updateAnchor: function (anchor, url, alt, contextAnchor, notText) {\n    // download\n    if (!this.plugins.anchor.selfPathBookmark.call(this, url) && contextAnchor.downloadCheck.checked) {\n      anchor.setAttribute('download', alt || url);\n    } else {\n      anchor.removeAttribute('download');\n    } // new window\n\n\n    if (contextAnchor.newWindowCheck.checked) anchor.target = '_blank';else anchor.removeAttribute('target'); // rel\n\n    const rel = contextAnchor.currentRel.join(' ');\n    if (!rel) anchor.removeAttribute('rel');else anchor.rel = rel; // est url, alt\n\n    anchor.href = url;\n    anchor.setAttribute('alt', alt);\n\n    if (notText) {\n      if (anchor.children.length === 0) anchor.textContent = '';\n    } else {\n      anchor.textContent = alt;\n    }\n  },\n  createAnchor: function (contextAnchor, notText) {\n    if (contextAnchor.linkValue.length === 0) return null;\n    const url = contextAnchor.linkValue;\n    const anchor = contextAnchor.anchorText;\n    const anchorText = anchor.value.length === 0 ? url : anchor.value;\n    const oA = contextAnchor.linkAnchor || this.util.createElement('A');\n    this.plugins.anchor.updateAnchor.call(this, oA, url, anchorText, contextAnchor, notText);\n    contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.anchorText.value = '';\n    return oA;\n  },\n  onClick_bookmarkButton: function (contextAnchor) {\n    let url = contextAnchor.urlInput.value;\n\n    if (this.plugins.anchor.selfPathBookmark.call(this, url)) {\n      url = url.substr(1);\n      contextAnchor.bookmark.style.display = 'none';\n      this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n      this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n    } else {\n      url = '#' + url;\n      contextAnchor.bookmark.style.display = 'block';\n      this.util.addClass(contextAnchor.bookmarkButton, 'active');\n      contextAnchor.downloadCheck.checked = false;\n      contextAnchor.download.style.display = 'none';\n      this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, url);\n    }\n\n    contextAnchor.urlInput.value = url;\n    this.plugins.anchor.setLinkPreview.call(this, contextAnchor, url);\n    contextAnchor.urlInput.focus();\n  },\n  onChange_newWindowCheck: function (contextAnchor, e) {\n    if (typeof contextAnchor.linkDefaultRel.check_new_window !== 'string') return;\n\n    if (e.target.checked) {\n      this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n    } else {\n      this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n    }\n  },\n  onChange_downloadCheck: function (contextAnchor, e) {\n    if (e.target.checked) {\n      contextAnchor.download.style.display = 'block';\n      contextAnchor.bookmark.style.display = 'none';\n      this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n      contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.urlInput.value.replace(/^\\#+/, '');\n\n      if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n        this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n      }\n    } else {\n      contextAnchor.download.style.display = 'none';\n\n      if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n        this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n      }\n    }\n  },\n  _relMerge: function (contextAnchor, relAttr) {\n    const current = contextAnchor.currentRel;\n    if (!relAttr) return current.join(' ');\n\n    if (/^only\\:/.test(relAttr)) {\n      relAttr = relAttr.replace(/^only\\:/, '').trim();\n      contextAnchor.currentRel = relAttr.split(' ');\n      return relAttr;\n    }\n\n    const rels = relAttr.split(' ');\n\n    for (let i = 0, len = rels.length, index; i < len; i++) {\n      index = current.indexOf(rels[i]);\n      if (index === -1) current.push(rels[i]);\n    }\n\n    return current.join(' ');\n  },\n  _relDelete: function (contextAnchor, relAttr) {\n    if (!relAttr) return contextAnchor.currentRel.join(' ');\n    if (/^only\\:/.test(relAttr)) relAttr = relAttr.replace(/^only\\:/, '').trim();\n    const rels = contextAnchor.currentRel.join(' ').replace(this._w.RegExp(relAttr + '\\\\s*'), '');\n    contextAnchor.currentRel = rels.split(' ');\n    return rels;\n  },\n  init: function (contextAnchor) {\n    contextAnchor.linkAnchor = null;\n    contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = '';\n    contextAnchor.anchorText.value = '';\n    contextAnchor.newWindowCheck.checked = false;\n    contextAnchor.downloadCheck.checked = false;\n    contextAnchor._change = false;\n    this.plugins.anchor.setRel.call(this, contextAnchor, contextAnchor.defaultRel);\n\n    if (contextAnchor.relList) {\n      this.plugins.anchor.toggleRelList.call(this, contextAnchor, false);\n    }\n\n    this.context.anchor.callerContext = null;\n    this.plugins.selectMenu.init.call(this, this.context.selectMenu.callerContext);\n  }\n};","map":{"version":3,"names":["selectMenu","name","add","core","addModule","context","anchor","caller","forms","setDialogForm","host","_w","location","origin","pathname","replace","callerContext","lang","relList","options","linkRel","defaultRel","linkRelDefault","default","split","icons","util","createElement","html","dialogBox","linkBox","url","protocol","bookmark","plugins","setForm","download","text","newWindowCheck","downloadLinkCheck","length","i","len","rel","indexOf","checked","innerHTML","initEvent","pluginName","anchorPlugin","modal","urlInput","linkDefaultRel","currentRel","linkAnchor","linkValue","_change","callerName","trim","check_new_window","check_bookmark","querySelector","anchorText","downloadCheck","preview","bookmarkButton","call","listContext","relButton","relPreview","addEventListener","onClick_relButton","bind","onClick_relList","onChange_newWindowCheck","onChange_downloadCheck","onChangeAnchorText","onChangeUrlInput","onKeyDownUrlInput","onFocusUrlInput","onBlurUrlInput","onClick_bookmarkButton","on","contextAnchor","update","init","value","getSelection","toString","linkTargetNewWindow","dialog","updateModal","href","getAttribute","textContent","selfPathBookmark","substr","lastIndexOf","test","target","setRel","setLinkPreview","setHeaderBookmark","path","_closeRelMenu","toggleRelList","show","addClass","style","visibility","display","rtl","left","offsetLeft","offsetWidth","top","offsetTop","offsetHeight","e","contains","removeClass","modalForm","removeEventListener","hasClass","cmd","current","toggleClass","index","push","splice","title","join","relAttr","relListEl","rels","checkedRel","querySelectorAll","createHeaderList","contextList","urlValue","headers","getListChildren","element","wysiwyg","nodeName","valueRegExp","RegExp","list","h","close","createList","open","_setMenuListPosition","keyCode","preventDefault","stopPropagation","moveItem","getItem","header","id","Math","random","focus","contextLink","linkProtocol","noPrefix","linkNoPrefix","reservedProtocol","sameProtocol","setCtx","updateAnchor","alt","notText","setAttribute","removeAttribute","children","createAnchor","oA","_relMerge","_relDelete"],"sources":["/Users/jirayuyungmeesuk/Desktop/code/client/node_modules/suneditor/src/plugins/modules/_anchor.js"],"sourcesContent":["/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport selectMenu from './_selectMenu';\n\nexport default {\n    name: 'anchor',\n    add: function (core) {\n        core.addModule([selectMenu]);\n        \n        core.context.anchor = {\n            caller: {},\n            forms: this.setDialogForm(core),\n            host: (core._w.location.origin + core._w.location.pathname).replace(/\\/$/, ''),\n            callerContext: null\n        };\n    },\n\n    /** dialog */\n    setDialogForm: function (core) {\n        const lang = core.lang;\n        const relList = core.options.linkRel;\n        const defaultRel = (core.options.linkRelDefault.default || '').split(' ');\n        const icons = core.icons;\n        const forms = core.util.createElement('DIV');\n\n        let html = '<div class=\"se-dialog-body\">' +\n            '<div class=\"se-dialog-form\">' +\n                '<label>' + lang.dialogBox.linkBox.url + '</label>' +\n                '<div class=\"se-dialog-form-files\">' +\n                    '<input class=\"se-input-form se-input-url\" type=\"text\" placeholder=\"' + (core.options.protocol || '') + '\" />' +\n                    '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button _se_bookmark_button\" title=\"' + lang.dialogBox.linkBox.bookmark + '\" aria-label=\"' + lang.dialogBox.linkBox.bookmark + '\">' + icons.bookmark + '</button>' +\n                    core.plugins.selectMenu.setForm() +\n                '</div>' +\n                '<div class=\"se-anchor-preview-form\">' +\n                    '<span class=\"se-svg se-anchor-preview-icon _se_anchor_bookmark_icon\">' + icons.bookmark + '</span>' +\n                    '<span class=\"se-svg se-anchor-preview-icon _se_anchor_download_icon\">' + icons.download + '</span>' +\n                    '<pre class=\"se-link-preview\"></pre>' +\n                '</div>' +\n            '</div>' +\n            '<div class=\"se-dialog-form\">' +\n                '<label>' + lang.dialogBox.linkBox.text + '</label><input class=\"se-input-form _se_anchor_text\" type=\"text\" />' +\n            '</div>' +\n            '<div class=\"se-dialog-form-footer\">' +\n                '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_check\" />&nbsp;' + lang.dialogBox.linkBox.newWindowCheck + '</label>' +\n                '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_download\" />&nbsp;' + lang.dialogBox.linkBox.downloadLinkCheck + '</label>';\n            if (relList.length > 0) {\n                html += '<div class=\"se-anchor-rel\"><button type=\"button\" class=\"se-btn se-btn-select se-anchor-rel-btn\">&lt;rel&gt;</button>' +\n                    '<div class=\"se-anchor-rel-wrapper\"><pre class=\"se-link-preview se-anchor-rel-preview\"></pre></div>' +\n                    '<div class=\"se-list-layer\">' +\n                        '<div class=\"se-list-inner\">' +\n                            '<ul class=\"se-list-basic se-list-checked\">';\n                for (let i = 0, len = relList.length, rel; i < len; i++) {\n                    rel = relList[i];\n                    html += '<li><button type=\"button\" class=\"se-btn-list' + (defaultRel.indexOf(rel) > -1 ? ' se-checked' : '') + '\" data-command=\"' + rel + '\" title=\"' + rel + '\" aria-label=\"' + rel + '\"><span class=\"se-svg\">' + icons.checked + '</span>' + rel + '</button></li>';\n                }\n                html += '</ul></div></div></div>';\n            }\n\n        html += '</div></div>';\n\n        forms.innerHTML = html;\n        return forms;\n    },\n\n    initEvent: function (pluginName, forms) {\n        const anchorPlugin = this.plugins.anchor;\n        const context = this.context.anchor.caller[pluginName] = {\n            modal: forms,\n            urlInput: null,\n            linkDefaultRel: this.options.linkRelDefault,\n            defaultRel: this.options.linkRelDefault.default || '',\n            currentRel: [],\n            linkAnchor: null,\n            linkValue: '',\n            _change: false,\n            callerName: pluginName\n        };\n\n        if (typeof context.linkDefaultRel.default === 'string') context.linkDefaultRel.default = context.linkDefaultRel.default.trim();\n        if (typeof context.linkDefaultRel.check_new_window === 'string') context.linkDefaultRel.check_new_window = context.linkDefaultRel.check_new_window.trim();\n        if (typeof context.linkDefaultRel.check_bookmark === 'string') context.linkDefaultRel.check_bookmark = context.linkDefaultRel.check_bookmark.trim();\n\n        context.urlInput = forms.querySelector('.se-input-url');\n        context.anchorText = forms.querySelector('._se_anchor_text');\n        context.newWindowCheck = forms.querySelector('._se_anchor_check');\n        context.downloadCheck = forms.querySelector('._se_anchor_download');\n        context.download = forms.querySelector('._se_anchor_download_icon');\n        context.preview = forms.querySelector('.se-link-preview');\n        context.bookmark = forms.querySelector('._se_anchor_bookmark_icon');\n        context.bookmarkButton = forms.querySelector('._se_bookmark_button');\n\n        this.plugins.selectMenu.initEvent.call(this, pluginName, forms);\n        const listContext = this.context.selectMenu.caller[pluginName];\n        \n        /** rel */\n        if (this.options.linkRel.length > 0) {\n            context.relButton = forms.querySelector('.se-anchor-rel-btn');\n            context.relList = forms.querySelector('.se-list-layer');\n            context.relPreview = forms.querySelector('.se-anchor-rel-preview');\n            context.relButton.addEventListener('click', anchorPlugin.onClick_relButton.bind(this, context));\n            context.relList.addEventListener('click', anchorPlugin.onClick_relList.bind(this, context));\n        }\n\n        context.newWindowCheck.addEventListener('change', anchorPlugin.onChange_newWindowCheck.bind(this, context));\n        context.downloadCheck.addEventListener('change', anchorPlugin.onChange_downloadCheck.bind(this, context));\n        context.anchorText.addEventListener('input', anchorPlugin.onChangeAnchorText.bind(this, context));\n        context.urlInput.addEventListener('input', anchorPlugin.onChangeUrlInput.bind(this, context));\n        context.urlInput.addEventListener('keydown', anchorPlugin.onKeyDownUrlInput.bind(this, listContext));\n        context.urlInput.addEventListener('focus', anchorPlugin.onFocusUrlInput.bind(this, context, listContext));\n        context.urlInput.addEventListener('blur', anchorPlugin.onBlurUrlInput.bind(this, listContext));\n        context.bookmarkButton.addEventListener('click', anchorPlugin.onClick_bookmarkButton.bind(this, context));\n    },\n\n    on: function (contextAnchor, update) {\n        const anchorPlugin = this.plugins.anchor;\n\n        if (!update) {\n            anchorPlugin.init.call(this, contextAnchor);\n            contextAnchor.anchorText.value = this.getSelection().toString().trim();\n            contextAnchor.newWindowCheck.checked = this.options.linkTargetNewWindow;\n        } else if (contextAnchor.linkAnchor) {\n            this.context.dialog.updateModal = true;\n            const href = contextAnchor.linkAnchor.getAttribute('href');\n            contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = anchorPlugin.selfPathBookmark.call(this, href) ? href.substr(href.lastIndexOf('#')) : href;\n            contextAnchor.anchorText.value = contextAnchor.linkAnchor.textContent || contextAnchor.linkAnchor.getAttribute('alt');\n            contextAnchor.newWindowCheck.checked = (/_blank/i.test(contextAnchor.linkAnchor.target) ? true : false);\n            contextAnchor.downloadCheck.checked = contextAnchor.linkAnchor.download;\n        }\n\n        this.context.anchor.callerContext = contextAnchor;\n        anchorPlugin.setRel.call(this, contextAnchor, (update && contextAnchor.linkAnchor) ? contextAnchor.linkAnchor.rel : contextAnchor.defaultRel);\n        anchorPlugin.setLinkPreview.call(this, contextAnchor, contextAnchor.linkValue);\n        this.plugins.selectMenu.on.call(this, contextAnchor.callerName, this.plugins.anchor.setHeaderBookmark);\n    },\n\n    selfPathBookmark: function(path) {\n        const href = this._w.location.href.replace(/\\/$/, '');\n        return path.indexOf('#') === 0 || (path.indexOf(href) === 0 && path.indexOf('#') === (href.indexOf(\"#\") === -1 ? href.length : href.substr(0, href.indexOf(\"#\")).length));\n    },\n\n    _closeRelMenu: null,\n    toggleRelList: function (contextAnchor, show) {\n        if (!show) {\n            if (this.plugins.anchor._closeRelMenu) this.plugins.anchor._closeRelMenu();\n        } else {\n            const target = contextAnchor.relButton;\n            const relList = contextAnchor.relList;\n            this.util.addClass(target, 'active');\n            relList.style.visibility = 'hidden';\n            relList.style.display = 'block';\n            if (!this.options.rtl) relList.style.left = (target.offsetLeft + target.offsetWidth + 1) + 'px';\n            else relList.style.left = (target.offsetLeft - relList.offsetWidth - 1) + 'px';\n            relList.style.top = (target.offsetTop + (target.offsetHeight / 2) - (relList.offsetHeight / 2)) + 'px';\n            relList.style.visibility = '';\n\n            this.plugins.anchor._closeRelMenu = function (context, target, e) {\n                if (e && (context.relButton.contains(e.target) || context.relList.contains(e.target))) return;\n                this.util.removeClass(target, 'active');\n                context.relList.style.display = 'none';\n                this.modalForm.removeEventListener('click', this.plugins.anchor._closeRelMenu);\n                this.plugins.anchor._closeRelMenu = null;\n            }.bind(this, contextAnchor, target);\n    \n            this.modalForm.addEventListener('click', this.plugins.anchor._closeRelMenu);\n        }\n    },\n\n    onClick_relButton: function (contextAnchor, e) {\n        this.plugins.anchor.toggleRelList.call(this, contextAnchor, !this.util.hasClass(e.target, 'active'));\n    },\n\n    onClick_relList: function (contextAnchor, e) {\n        const target = e.target;\n        const cmd = target.getAttribute('data-command');\n        if (!cmd) return;\n        \n        const current = contextAnchor.currentRel;\n        const checked = this.util.toggleClass(target, 'se-checked');\n        const index = current.indexOf(cmd);\n        if (checked) {\n            if (index === -1) current.push(cmd);\n        } else {\n            if (index > -1) current.splice(index, 1);\n        }\n\n        contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = current.join(' ');\n    },\n\n    setRel: function (contextAnchor, relAttr) {\n        const relListEl = contextAnchor.relList;\n        const rels = contextAnchor.currentRel = !relAttr ? [] : relAttr.split(' ');\n        if (!relListEl) return;\n\n        const checkedRel = relListEl.querySelectorAll('button');\n        for (let i = 0, len = checkedRel.length, cmd; i < len; i++) {\n            cmd = checkedRel[i].getAttribute('data-command');\n            if (rels.indexOf(cmd) > -1) {\n                this.util.addClass(checkedRel[i], 'se-checked');\n            } else {\n                this.util.removeClass(checkedRel[i], 'se-checked');\n            }\n        }\n\n        contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = rels.join(' ');\n    },\n\n    createHeaderList: function (contextAnchor, contextList, urlValue) {\n        const headers = this.util.getListChildren(this.context.element.wysiwyg, function(current) {\n            return /h[1-6]/i.test(current.nodeName);\n        });\n        if (headers.length === 0) return;\n\n        const valueRegExp = new this._w.RegExp('^' + urlValue.replace(/^#/, ''), 'i');\n        const list = [];\n        let html = '';\n        for(let i = 0, len = headers.length, h; i < len; i++) {\n            h = headers[i];\n            if (!valueRegExp.test(h.textContent)) continue;\n            list.push(h);\n            html += '<li class=\"se-select-item\" data-index=\"' + i + '\">' + h.textContent + '</li>';\n        }\n\n        if (list.length === 0) {\n            this.plugins.selectMenu.close.call(this, contextList);\n        } else {\n            this.plugins.selectMenu.createList(contextList, list, html);\n            this.plugins.selectMenu.open.call(this, contextList, this.plugins.anchor._setMenuListPosition.bind(this, contextAnchor));\n        }\n    },\n\n    _setMenuListPosition: function (contextAnchor, list) {\n        list.style.top = (contextAnchor.urlInput.offsetHeight + 1) + 'px';\n    },\n\n    onKeyDownUrlInput: function (contextList, e) {\n        const keyCode = e.keyCode;\n        switch (keyCode) {\n            case 38: // up\n                e.preventDefault();\n                e.stopPropagation();\n                this.plugins.selectMenu.moveItem.call(this, contextList, -1);\n                break;\n            case 40: // down\n                e.preventDefault();\n                e.stopPropagation();\n                this.plugins.selectMenu.moveItem.call(this, contextList, 1);\n                break;\n            case 13: // enter\n                if (contextList.index > -1) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.plugins.anchor.setHeaderBookmark.call(this, this.plugins.selectMenu.getItem(contextList, null));\n                }\n                break;\n        }\n    },\n\n    setHeaderBookmark: function (header) {\n        const contextAnchor = this.context.anchor.callerContext;\n        const id = header.id || 'h_' + this._w.Math.random().toString().replace(/.+\\./, '');\n        header.id = id;\n        contextAnchor.urlInput.value = '#' + id;\n\n        if (!contextAnchor.anchorText.value.trim() || !contextAnchor._change) {\n            contextAnchor.anchorText.value = header.textContent;\n        }\n        \n        this.plugins.anchor.setLinkPreview.call(this, contextAnchor, contextAnchor.urlInput.value);\n        this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n        this.context.anchor.callerContext.urlInput.focus();\n    },\n\n    onChangeAnchorText: function (contextAnchor, e) {\n        contextAnchor._change = !!e.target.value.trim();\n    },\n\n    onChangeUrlInput: function (contextAnchor, e) {\n        const value = e.target.value.trim();\n        this.plugins.anchor.setLinkPreview.call(this, contextAnchor, value);\n\n        if (this.plugins.anchor.selfPathBookmark.call(this, value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, value);\n        else this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n    },\n\n    onFocusUrlInput: function (contextAnchor, contextLink) {\n        const value = contextAnchor.urlInput.value;\n        if (this.plugins.anchor.selfPathBookmark.call(this, value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, contextLink, value);\n    },\n\n    onBlurUrlInput: function (contextList) {\n        this.plugins.selectMenu.close.call(this, contextList);\n    },\n\n    setLinkPreview: function (context, value) {\n        const preview = context.preview;\n        const protocol = this.options.linkProtocol;\n        const noPrefix = this.options.linkNoPrefix;\n        const reservedProtocol  = /^(mailto\\:|tel\\:|sms\\:|https*\\:\\/\\/|#)/.test(value);\n        const sameProtocol = !protocol ? false : this._w.RegExp('^' + value.substr(0, protocol.length)).test(protocol);\n        value = context.linkValue = preview.textContent = !value ? '' : noPrefix ? value : (protocol && !reservedProtocol && !sameProtocol) ? protocol + value : reservedProtocol ? value : /^www\\./.test(value) ? 'http://' + value : this.context.anchor.host + (/^\\//.test(value) ? '' : '/') + value;\n\n        if (this.plugins.anchor.selfPathBookmark.call(this, value)) {\n            context.bookmark.style.display = 'block';\n            this.util.addClass(context.bookmarkButton, 'active');\n        } else {\n            context.bookmark.style.display = 'none';\n            this.util.removeClass(context.bookmarkButton, 'active');\n        }\n\n        if (!this.plugins.anchor.selfPathBookmark.call(this, value) && context.downloadCheck.checked) {\n            context.download.style.display = 'block';\n        } else {\n            context.download.style.display = 'none';\n        }\n    },\n\n    setCtx: function (anchor, contextAnchor) {\n        if (!anchor) return;\n        contextAnchor.linkAnchor = anchor;\n        contextAnchor.linkValue = anchor.href;\n        contextAnchor.currentRel = anchor.rel.split(\" \");\n    },\n\n    updateAnchor: function (anchor, url, alt, contextAnchor, notText) {\n        // download\n        if (!this.plugins.anchor.selfPathBookmark.call(this, url) && contextAnchor.downloadCheck.checked) {\n            anchor.setAttribute('download', alt || url);\n        } else {\n            anchor.removeAttribute('download');\n        }\n\n        // new window\n        if (contextAnchor.newWindowCheck.checked) anchor.target = '_blank';\n        else anchor.removeAttribute('target');\n        \n        // rel\n        const rel = contextAnchor.currentRel.join(' ');\n        if (!rel) anchor.removeAttribute('rel');\n        else anchor.rel = rel;\n\n        // est url, alt\n        anchor.href = url;\n        anchor.setAttribute('alt', alt);\n        if (notText) {\n            if (anchor.children.length === 0) anchor.textContent = '';\n        } else {\n            anchor.textContent = alt;\n        }\n    },\n\n    createAnchor: function (contextAnchor, notText) {\n        if (contextAnchor.linkValue.length === 0) return null;\n        \n        const url = contextAnchor.linkValue;\n        const anchor = contextAnchor.anchorText;\n        const anchorText = anchor.value.length === 0 ? url : anchor.value;\n\n        const oA = contextAnchor.linkAnchor || this.util.createElement('A');\n        this.plugins.anchor.updateAnchor.call(this, oA, url, anchorText, contextAnchor, notText);\n\n        contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.anchorText.value = '';\n\n        return oA;\n    },\n\n    onClick_bookmarkButton: function (contextAnchor) {\n        let url = contextAnchor.urlInput.value;\n        if (this.plugins.anchor.selfPathBookmark.call(this, url)) {\n            url = url.substr(1);\n            contextAnchor.bookmark.style.display = 'none';\n            this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n            this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n        } else {\n            url = '#' + url;\n            contextAnchor.bookmark.style.display = 'block';\n            this.util.addClass(contextAnchor.bookmarkButton, 'active');\n            contextAnchor.downloadCheck.checked = false;\n            contextAnchor.download.style.display = 'none';\n            this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, url);\n        }\n\n        contextAnchor.urlInput.value = url;\n        this.plugins.anchor.setLinkPreview.call(this, contextAnchor, url);\n        contextAnchor.urlInput.focus();\n    },\n\n    onChange_newWindowCheck: function (contextAnchor, e) {\n        if (typeof contextAnchor.linkDefaultRel.check_new_window !== 'string') return;\n        if (e.target.checked) {\n            this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n        } else {\n            this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n        }\n    },\n\n    onChange_downloadCheck: function (contextAnchor, e) {\n        if (e.target.checked) {\n            contextAnchor.download.style.display = 'block';\n            contextAnchor.bookmark.style.display = 'none';\n            this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n            contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.urlInput.value.replace(/^\\#+/, '');\n            if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n                this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n            }\n        } else {\n            contextAnchor.download.style.display = 'none';\n            if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n                this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n            }\n        }\n    },\n\n    _relMerge: function (contextAnchor, relAttr) {\n        const current = contextAnchor.currentRel;\n        if (!relAttr) return current.join(' ');\n        \n        if (/^only\\:/.test(relAttr)) {\n            relAttr = relAttr.replace(/^only\\:/, '').trim();\n            contextAnchor.currentRel = relAttr.split(' ');\n            return relAttr;\n        }\n\n        const rels = relAttr.split(' ');\n        for (let i = 0, len = rels.length, index; i < len; i++) {\n            index = current.indexOf(rels[i]);\n            if (index === -1) current.push(rels[i]);\n        }\n\n        return current.join(' ');\n    },\n\n    _relDelete: function (contextAnchor, relAttr) {\n        if (!relAttr) return contextAnchor.currentRel.join(' ');\n        if (/^only\\:/.test(relAttr)) relAttr = relAttr.replace(/^only\\:/, '').trim();\n\n        const rels = contextAnchor.currentRel.join(' ').replace(this._w.RegExp(relAttr + '\\\\s*'), '');\n        contextAnchor.currentRel = rels.split(' ');\n        return rels;\n    },\n\n    init: function (contextAnchor) {\n        contextAnchor.linkAnchor = null;\n        contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = '';\n        contextAnchor.anchorText.value = '';\n        contextAnchor.newWindowCheck.checked = false;\n        contextAnchor.downloadCheck.checked = false;\n        contextAnchor._change = false;\n        this.plugins.anchor.setRel.call(this, contextAnchor, contextAnchor.defaultRel);\n        if (contextAnchor.relList) {\n            this.plugins.anchor.toggleRelList.call(this, contextAnchor, false);\n        }\n        this.context.anchor.callerContext = null;\n        this.plugins.selectMenu.init.call(this, this.context.selectMenu.callerContext);\n    }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}