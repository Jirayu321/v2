{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/jirayuyungmeesuk/Desktop/ v2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _objectSpread from \"/Users/jirayuyungmeesuk/Desktop/ v2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\n\n/* global document */\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { useEffect, useMemo, useRef, useContext } from 'react';\nimport { applyReactStyle } from '../utils/apply-react-style';\nimport { MapContext } from './map';\nimport { deepEqual } from '../utils/deep-equal'; // Adapted from https://github.com/mapbox/mapbox-gl-js/blob/v1.13.0/src/ui/popup.js\n\nfunction getClassList(className) {\n  return new Set(className ? className.trim().split(/\\s+/) : []);\n}\n/* eslint-disable complexity,max-statements */\n\n\nfunction Popup(props) {\n  var _useContext = useContext(MapContext),\n      map = _useContext.map,\n      mapLib = _useContext.mapLib;\n\n  var container = useMemo(function () {\n    return document.createElement('div');\n  }, []);\n  var thisRef = useRef({\n    props: props\n  });\n  thisRef.current.props = props;\n  var popup = useMemo(function () {\n    var options = _objectSpread({}, props);\n\n    var pp = new mapLib.Popup(options).setLngLat([props.longitude, props.latitude]);\n    pp.once('open', function (e) {\n      var _a, _b;\n\n      (_b = (_a = thisRef.current.props).onOpen) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n    });\n    return pp;\n  }, []);\n  useEffect(function () {\n    var onClose = function onClose(e) {\n      var _a, _b;\n\n      (_b = (_a = thisRef.current.props).onClose) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n    };\n\n    popup.on('close', onClose);\n    popup.setDOMContent(container).addTo(map.getMap());\n    return function () {\n      // https://github.com/visgl/react-map-gl/issues/1825\n      // onClose should not be fired if the popup is removed by unmounting\n      // When using React strict mode, the component is mounted twice.\n      // Firing the onClose callback here would be a false signal to remove the component.\n      popup.off('close', onClose);\n\n      if (popup.isOpen()) {\n        popup.remove();\n      }\n    };\n  }, []);\n  useEffect(function () {\n    applyReactStyle(popup.getElement(), props.style);\n  }, [props.style]);\n\n  if (popup.isOpen()) {\n    if (popup.getLngLat().lng !== props.longitude || popup.getLngLat().lat !== props.latitude) {\n      popup.setLngLat([props.longitude, props.latitude]);\n    } // @ts-ignore\n\n\n    if (props.offset && !deepEqual(popup.options.offset, props.offset)) {\n      popup.setOffset(props.offset);\n    } // @ts-ignore\n\n\n    if (popup.options.anchor !== props.anchor || popup.options.maxWidth !== props.maxWidth) {\n      // @ts-ignore\n      popup.options.anchor = props.anchor;\n      popup.setMaxWidth(props.maxWidth);\n    } // @ts-ignore\n\n\n    if (popup.options.className !== props.className) {\n      // @ts-ignore\n      var prevClassList = getClassList(popup.options.className);\n      var nextClassList = getClassList(props.className);\n\n      var _iterator = _createForOfIteratorHelper(prevClassList),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var c = _step.value;\n\n          if (!nextClassList.has(c)) {\n            popup.removeClassName(c);\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      var _iterator2 = _createForOfIteratorHelper(nextClassList),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var _c = _step2.value;\n\n          if (!prevClassList.has(_c)) {\n            popup.addClassName(_c);\n          }\n        } // @ts-ignore\n\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n\n      popup.options.className = props.className;\n    }\n  }\n\n  return createPortal(props.children, container);\n} // @ts-ignore\n\n\nexport default React.memo(Popup);","map":{"version":3,"sources":["../../../src/components/popup.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/* global document */\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { useEffect, useMemo, useRef, useContext } from 'react';\nimport { applyReactStyle } from '../utils/apply-react-style';\nimport { MapContext } from './map';\nimport { deepEqual } from '../utils/deep-equal';\n// Adapted from https://github.com/mapbox/mapbox-gl-js/blob/v1.13.0/src/ui/popup.js\nfunction getClassList(className) {\n    return new Set(className ? className.trim().split(/\\s+/) : []);\n}\n/* eslint-disable complexity,max-statements */\nfunction Popup(props) {\n    const { map, mapLib } = useContext(MapContext);\n    const container = useMemo(() => {\n        return document.createElement('div');\n    }, []);\n    const thisRef = useRef({ props });\n    thisRef.current.props = props;\n    const popup = useMemo(() => {\n        const options = { ...props };\n        const pp = new mapLib.Popup(options).setLngLat([props.longitude, props.latitude]);\n        pp.once('open', e => {\n            var _a, _b;\n            (_b = (_a = thisRef.current.props).onOpen) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n        });\n        return pp;\n    }, []);\n    useEffect(() => {\n        const onClose = e => {\n            var _a, _b;\n            (_b = (_a = thisRef.current.props).onClose) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n        };\n        popup.on('close', onClose);\n        popup.setDOMContent(container).addTo(map.getMap());\n        return () => {\n            // https://github.com/visgl/react-map-gl/issues/1825\n            // onClose should not be fired if the popup is removed by unmounting\n            // When using React strict mode, the component is mounted twice.\n            // Firing the onClose callback here would be a false signal to remove the component.\n            popup.off('close', onClose);\n            if (popup.isOpen()) {\n                popup.remove();\n            }\n        };\n    }, []);\n    useEffect(() => {\n        applyReactStyle(popup.getElement(), props.style);\n    }, [props.style]);\n    if (popup.isOpen()) {\n        if (popup.getLngLat().lng !== props.longitude || popup.getLngLat().lat !== props.latitude) {\n            popup.setLngLat([props.longitude, props.latitude]);\n        }\n        // @ts-ignore\n        if (props.offset && !deepEqual(popup.options.offset, props.offset)) {\n            popup.setOffset(props.offset);\n        }\n        // @ts-ignore\n        if (popup.options.anchor !== props.anchor || popup.options.maxWidth !== props.maxWidth) {\n            // @ts-ignore\n            popup.options.anchor = props.anchor;\n            popup.setMaxWidth(props.maxWidth);\n        }\n        // @ts-ignore\n        if (popup.options.className !== props.className) {\n            // @ts-ignore\n            const prevClassList = getClassList(popup.options.className);\n            const nextClassList = getClassList(props.className);\n            for (const c of prevClassList) {\n                if (!nextClassList.has(c)) {\n                    popup.removeClassName(c);\n                }\n            }\n            for (const c of nextClassList) {\n                if (!prevClassList.has(c)) {\n                    popup.addClassName(c);\n                }\n            }\n            // @ts-ignore\n            popup.options.className = props.className;\n        }\n    }\n    return createPortal(props.children, container);\n}\n// @ts-ignore\nexport default React.memo(Popup);\n//# sourceMappingURL=popup.js.map"]},"metadata":{},"sourceType":"module"}