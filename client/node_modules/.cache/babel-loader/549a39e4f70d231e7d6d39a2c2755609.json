{"ast":null,"code":"/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport component from '../modules/component';\nimport fileManager from '../modules/fileManager';\nexport default {\n  name: 'audio',\n  display: 'dialog',\n  add: function (core) {\n    core.addModule([dialog, component, fileManager]);\n    const context = core.context;\n    const contextAudio = context.audio = {\n      _infoList: [],\n      // @Override fileManager\n      _infoIndex: 0,\n      // @Override fileManager\n      _uploadFileLength: 0,\n      // @Override fileManager\n      focusElement: null,\n      // @Override dialog // This element has focus when the dialog is opened.\n      targetSelect: null,\n      _origin_w: core.options.audioWidth,\n      _origin_h: core.options.audioHeight,\n      _linkValue: '',\n      // @require @Override component\n      _element: null,\n      _cover: null,\n      _container: null\n    };\n    /** dialog */\n\n    let audio_dialog = this.setDialog(core);\n    contextAudio.modal = audio_dialog;\n    contextAudio.audioInputFile = audio_dialog.querySelector('._se_audio_files');\n    contextAudio.audioUrlFile = audio_dialog.querySelector('.se-input-url');\n    contextAudio.focusElement = contextAudio.audioInputFile || contextAudio.audioUrlFile;\n    contextAudio.preview = audio_dialog.querySelector('.se-link-preview');\n    /** controller */\n\n    let audio_controller = this.setController(core);\n    contextAudio.controller = audio_controller;\n    /** add event listeners */\n\n    audio_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n    if (contextAudio.audioInputFile) audio_dialog.querySelector('.se-dialog-files-edge-button').addEventListener('click', this._removeSelectedFiles.bind(contextAudio.audioInputFile, contextAudio.audioUrlFile, contextAudio.preview));\n    if (contextAudio.audioInputFile && contextAudio.audioUrlFile) contextAudio.audioInputFile.addEventListener('change', this._fileInputChange.bind(contextAudio));\n    audio_controller.addEventListener('click', this.onClick_controller.bind(core));\n    if (contextAudio.audioUrlFile) contextAudio.audioUrlFile.addEventListener('input', this._onLinkPreview.bind(contextAudio.preview, contextAudio, core.options.linkProtocol));\n    /** append html */\n\n    context.dialog.modal.appendChild(audio_dialog);\n    /** append controller */\n\n    context.element.relative.appendChild(audio_controller);\n    /** empty memory */\n\n    audio_dialog = null, audio_controller = null;\n  },\n\n  /** HTML - dialog */\n  setDialog: function (core) {\n    const option = core.options;\n    const lang = core.lang;\n    const dialog = core.util.createElement('DIV');\n    dialog.className = 'se-dialog-content';\n    dialog.style.display = 'none';\n    let html = '' + '<form method=\"post\" enctype=\"multipart/form-data\">' + '<div class=\"se-dialog-header\">' + '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" title=\"' + lang.dialogBox.close + '\" aria-label=\"' + lang.dialogBox.close + '\">' + core.icons.cancel + '</button>' + '<span class=\"se-modal-title\">' + lang.dialogBox.audioBox.title + '</span>' + '</div>' + '<div class=\"se-dialog-body\">';\n\n    if (option.audioFileInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.audioBox.file + '</label>' + '<div class=\"se-dialog-form-files\">' + '<input class=\"se-input-form _se_audio_files\" type=\"file\" accept=\"' + option.audioAccept + '\"' + (option.audioMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' + '<button type=\"button\" data-command=\"filesRemove\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\" aria-label=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' + '</div>' + '</div>';\n    }\n\n    if (option.audioUrlInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.audioBox.url + '</label>' + '<input class=\"se-input-form se-input-url\" type=\"text\" />' + '<pre class=\"se-link-preview\"></pre>' + '</div>';\n    }\n\n    html += '' + '</div>' + '<div class=\"se-dialog-footer\">' + '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\" aria-label=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' + '</div>' + '</form>';\n    dialog.innerHTML = html;\n    return dialog;\n  },\n\n  /** HTML - controller */\n  setController: function (core) {\n    const lang = core.lang;\n    const icons = core.icons;\n    const link_btn = core.util.createElement('DIV');\n    link_btn.className = 'se-controller se-controller-link';\n    link_btn.innerHTML = '' + '<div class=\"se-arrow se-arrow-up\"></div>' + '<div class=\"link-content\">' + '<div class=\"se-btn-group\">' + '<button type=\"button\" data-command=\"update\" tabindex=\"-1\" class=\"se-tooltip\">' + icons.edit + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.edit + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"delete\" tabindex=\"-1\" class=\"se-tooltip\">' + icons.delete + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.remove + '</span></span>' + '</button>' + '</div>' + '</div>';\n    return link_btn;\n  },\n  // Disable url input when uploading files\n  _fileInputChange: function () {\n    if (!this.audioInputFile.value) {\n      this.audioUrlFile.removeAttribute('disabled');\n      this.preview.style.textDecoration = '';\n    } else {\n      this.audioUrlFile.setAttribute('disabled', true);\n      this.preview.style.textDecoration = 'line-through';\n    }\n  },\n  // Disable url input when uploading files\n  _removeSelectedFiles: function (urlInput, preview) {\n    this.value = '';\n\n    if (urlInput) {\n      urlInput.removeAttribute('disabled');\n      preview.style.textDecoration = '';\n    }\n  },\n  // create new audio tag\n  _createAudioTag: function () {\n    const oAudio = this.util.createElement('AUDIO');\n\n    this.plugins.audio._setTagAttrs.call(this, oAudio);\n\n    const w = this.context.audio._origin_w;\n    const h = this.context.audio._origin_h;\n    oAudio.setAttribute('origin-size', w + ',' + h);\n    oAudio.style.cssText = (w ? 'width:' + w + '; ' : '') + (h ? 'height:' + h + ';' : '');\n    return oAudio;\n  },\n  _setTagAttrs: function (element) {\n    element.setAttribute('controls', true);\n    const attrs = this.options.audioTagAttrs;\n    if (!attrs) return;\n\n    for (let key in attrs) {\n      if (!this.util.hasOwn(attrs, key)) continue;\n      element.setAttribute(key, attrs[key]);\n    }\n  },\n  _onLinkPreview: function (context, protocol, e) {\n    const value = e.target.value.trim();\n    context._linkValue = this.textContent = !value ? '' : protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0 ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n  },\n\n  /**\n   * @Required @Override fileManager\n   */\n  fileTags: ['audio'],\n\n  /**\n   * @Override core, fileManager, resizing\n   * @description It is called from core.selectComponent.\n   * @param {Element} element Target element\n   */\n  select: function (element) {\n    this.plugins.audio.onModifyMode.call(this, element);\n  },\n\n  /**\n   * @Override fileManager, resizing \n   */\n  destroy: function (element) {\n    element = element || this.context.audio._element;\n    const container = this.util.getParentElement(element, this.util.isComponent) || element;\n    const dataIndex = element.getAttribute('data-index') * 1;\n    const focusEl = container.previousElementSibling || container.nextElementSibling;\n    const emptyDiv = container.parentNode;\n    this.util.removeItem(container);\n    this.plugins.audio.init.call(this);\n    this.controllersOff();\n    if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) {\n      return current.childNodes.length === 0;\n    }, null); // focus\n\n    this.focusEdge(focusEl); // fileManager event\n\n    this.plugins.fileManager.deleteInfo.call(this, 'audio', dataIndex, this.functions.onAudioUpload); // history stack\n\n    this.history.push(false);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  checkFileInfo: function () {\n    this.plugins.fileManager.checkInfo.call(this, 'audio', ['audio'], this.functions.onAudioUpload, this.plugins.audio.updateCover.bind(this), false);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  resetFileInfo: function () {\n    this.plugins.fileManager.resetInfo.call(this, 'audio', this.functions.onAudioUpload);\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  on: function (update) {\n    const contextAudio = this.context.audio;\n\n    if (!update) {\n      this.plugins.audio.init.call(this);\n      if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.setAttribute('multiple', 'multiple');\n    } else if (contextAudio._element) {\n      this.context.dialog.updateModal = true;\n      contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = contextAudio._element.src;\n      if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.removeAttribute('multiple');\n    } else {\n      if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.removeAttribute('multiple');\n    }\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  open: function () {\n    this.plugins.dialog.open.call(this, 'audio', 'audio' === this.currentControllerName);\n  },\n  submit: function (e) {\n    const contextAudio = this.context.audio;\n    e.preventDefault();\n    e.stopPropagation();\n\n    try {\n      if (contextAudio.audioInputFile && contextAudio.audioInputFile.files.length > 0) {\n        this.showLoading();\n        this.plugins.audio.submitAction.call(this, contextAudio.audioInputFile.files);\n      } else if (contextAudio.audioUrlFile && contextAudio._linkValue.length > 0) {\n        this.showLoading();\n        this.plugins.audio.setupUrl.call(this, contextAudio._linkValue);\n      }\n    } catch (error) {\n      this.closeLoading();\n      throw Error('[SUNEDITOR.audio.submit.fail] cause : \"' + error.message + '\"');\n    } finally {\n      this.plugins.dialog.close.call(this);\n    }\n\n    return false;\n  },\n  submitAction: function (fileList) {\n    if (fileList.length === 0) return;\n    let fileSize = 0;\n    let files = [];\n\n    for (let i = 0, len = fileList.length; i < len; i++) {\n      if (/audio/i.test(fileList[i].type)) {\n        files.push(fileList[i]);\n        fileSize += fileList[i].size;\n      }\n    }\n\n    const limitSize = this.options.audioUploadSizeLimit;\n\n    if (limitSize > 0) {\n      let infoSize = 0;\n      const audiosInfo = this.context.audio._infoList;\n\n      for (let i = 0, len = audiosInfo.length; i < len; i++) {\n        infoSize += audiosInfo[i].size * 1;\n      }\n\n      if (fileSize + infoSize > limitSize) {\n        this.closeLoading();\n        const err = '[SUNEDITOR.audioUpload.fail] Size of uploadable total audios: ' + limitSize / 1000 + 'KB';\n\n        if (typeof this.functions.onAudioUploadError !== 'function' || this.functions.onAudioUploadError(err, {\n          'limitSize': limitSize,\n          'currentSize': infoSize,\n          'uploadSize': fileSize\n        }, this)) {\n          this.functions.noticeOpen(err);\n        }\n\n        return;\n      }\n    }\n\n    const contextAudio = this.context.audio;\n    contextAudio._uploadFileLength = files.length;\n    const info = {\n      isUpdate: this.context.dialog.updateModal,\n      element: contextAudio._element\n    };\n\n    if (typeof this.functions.onAudioUploadBefore === 'function') {\n      const result = this.functions.onAudioUploadBefore(files, info, this, function (data) {\n        if (data && this._w.Array.isArray(data.result)) {\n          this.plugins.audio.register.call(this, info, data);\n        } else {\n          this.plugins.audio.upload.call(this, info, data);\n        }\n      }.bind(this));\n      if (typeof result === 'undefined') return;\n\n      if (!result) {\n        this.closeLoading();\n        return;\n      }\n\n      if (typeof result === 'object' && result.length > 0) files = result;\n    }\n\n    this.plugins.audio.upload.call(this, info, files);\n  },\n  error: function (message, response) {\n    this.closeLoading();\n\n    if (typeof this.functions.onAudioUploadError !== 'function' || this.functions.onAudioUploadError(message, response, this)) {\n      this.functions.noticeOpen(message);\n      throw Error('[SUNEDITOR.plugin.audio.exception] response: ' + message);\n    }\n  },\n  upload: function (info, files) {\n    if (!files) {\n      this.closeLoading();\n      return;\n    }\n\n    if (typeof files === 'string') {\n      this.plugins.audio.error.call(this, files, null);\n      return;\n    }\n\n    const audioUploadUrl = this.options.audioUploadUrl;\n    const filesLen = this.context.dialog.updateModal ? 1 : files.length; // create formData\n\n    const formData = new FormData();\n\n    for (let i = 0; i < filesLen; i++) {\n      formData.append('file-' + i, files[i]);\n    } // server upload\n\n\n    this.plugins.fileManager.upload.call(this, audioUploadUrl, this.options.audioUploadHeader, formData, this.plugins.audio.callBack_upload.bind(this, info), this.functions.onAudioUploadError);\n  },\n  callBack_upload: function (info, xmlHttp) {\n    if (typeof this.functions.audioUploadHandler === 'function') {\n      this.functions.audioUploadHandler(xmlHttp, info, this);\n    } else {\n      const response = JSON.parse(xmlHttp.responseText);\n\n      if (response.errorMessage) {\n        this.plugins.audio.error.call(this, response.errorMessage, response);\n      } else {\n        this.plugins.audio.register.call(this, info, response);\n      }\n    }\n  },\n  register: function (info, response) {\n    const fileList = response.result;\n\n    for (let i = 0, len = fileList.length, file, oAudio; i < len; i++) {\n      if (info.isUpdate) oAudio = info.element;else oAudio = this.plugins.audio._createAudioTag.call(this);\n      file = {\n        name: fileList[i].name,\n        size: fileList[i].size\n      };\n      this.plugins.audio.create_audio.call(this, oAudio, fileList[i].url, file, info.isUpdate);\n    }\n\n    this.closeLoading();\n  },\n  setupUrl: function (src) {\n    try {\n      if (src.length === 0) return false;\n      this.plugins.audio.create_audio.call(this, this.plugins.audio._createAudioTag.call(this), src, null, this.context.dialog.updateModal);\n    } catch (error) {\n      throw Error('[SUNEDITOR.audio.audio.fail] cause : \"' + error.message + '\"');\n    } finally {\n      this.closeLoading();\n    }\n  },\n  create_audio: function (element, src, file, isUpdate) {\n    const contextAudio = this.context.audio; // create new tag\n\n    if (!isUpdate) {\n      element.src = src;\n      const cover = this.plugins.component.set_cover.call(this, element);\n      const container = this.plugins.component.set_container.call(this, cover, '');\n\n      if (!this.insertComponent(container, false, true, !this.options.mediaAutoSelect)) {\n        this.focus();\n        return;\n      }\n\n      if (!this.options.mediaAutoSelect) {\n        const line = this.appendFormatTag(container, null);\n        if (line) this.setRange(line, 0, line, 0);\n      }\n    } // update\n    else {\n      if (contextAudio._element) element = contextAudio._element;\n\n      if (element && element.src !== src) {\n        element.src = src;\n        this.selectComponent(element, 'audio');\n      } else {\n        this.selectComponent(element, 'audio');\n        return;\n      }\n    }\n\n    this.plugins.fileManager.setInfo.call(this, 'audio', element, this.functions.onAudioUpload, file, false);\n    if (isUpdate) this.history.push(false);\n  },\n  updateCover: function (element) {\n    const contextAudio = this.context.audio;\n\n    this.plugins.audio._setTagAttrs.call(this, element); // find component element\n\n\n    let existElement = this.util.isRangeFormatElement(element.parentNode) || this.util.isWysiwygDiv(element.parentNode) ? element : this.util.getFormatElement(element) || element; // clone element\n\n    const prevElement = element;\n    contextAudio._element = element = element.cloneNode(false);\n    const cover = this.plugins.component.set_cover.call(this, element);\n    const container = this.plugins.component.set_container.call(this, cover, 'se-audio-container');\n\n    try {\n      if (this.util.isListCell(existElement)) {\n        const refer = this.util.getParentElement(prevElement, function (current) {\n          return current.parentNode === existElement;\n        });\n        existElement.insertBefore(container, refer);\n        this.util.removeItem(prevElement);\n        this.util.removeEmptyNode(refer, null);\n      } else if (this.util.isFormatElement(existElement)) {\n        const refer = this.util.getParentElement(prevElement, function (current) {\n          return current.parentNode === existElement;\n        });\n        existElement = this.util.splitElement(existElement, refer);\n        existElement.parentNode.insertBefore(container, existElement);\n        this.util.removeItem(prevElement);\n        this.util.removeEmptyNode(existElement, null);\n        if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n      } else {\n        existElement.parentNode.replaceChild(container, existElement);\n      }\n    } catch (error) {\n      console.warn('[SUNEDITOR.audio.error] Maybe the audio tag is nested.', error);\n    }\n\n    this.plugins.fileManager.setInfo.call(this, 'audio', element, this.functions.onAudioUpload, null, false);\n    this.plugins.audio.init.call(this);\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  onModifyMode: function (selectionTag) {\n    const contextAudio = this.context.audio;\n    this.setControllerPosition(contextAudio.controller, selectionTag, 'bottom', {\n      left: 0,\n      top: 0\n    });\n    this.controllersOn(contextAudio.controller, selectionTag, this.plugins.audio.onControllerOff.bind(this, selectionTag), 'audio');\n    this.util.addClass(selectionTag, 'active');\n    contextAudio._element = selectionTag;\n    contextAudio._cover = this.util.getParentElement(selectionTag, 'FIGURE');\n    contextAudio._container = this.util.getParentElement(selectionTag, this.util.isComponent);\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  openModify: function (notOpen) {\n    if (this.context.audio.audioUrlFile) {\n      const contextAudio = this.context.audio;\n      contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = contextAudio._element.src;\n    }\n\n    if (!notOpen) this.plugins.dialog.open.call(this, 'audio', true);\n  },\n  onClick_controller: function (e) {\n    e.stopPropagation();\n    const command = e.target.getAttribute('data-command');\n    if (!command) return;\n    e.preventDefault();\n\n    if (/update/.test(command)) {\n      this.plugins.audio.openModify.call(this, false);\n    } else {\n      /** delete */\n      this.plugins.audio.destroy.call(this, this.context.audio._element);\n    }\n\n    this.controllersOff();\n  },\n  onControllerOff: function (selectionTag) {\n    this.util.removeClass(selectionTag, 'active');\n    this.context.audio.controller.style.display = 'none';\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  init: function () {\n    if (this.context.dialog.updateModal) return;\n    const contextAudio = this.context.audio;\n    if (contextAudio.audioInputFile) contextAudio.audioInputFile.value = '';\n    if (contextAudio.audioUrlFile) contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = '';\n\n    if (contextAudio.audioInputFile && contextAudio.audioUrlFile) {\n      contextAudio.audioUrlFile.removeAttribute('disabled');\n      contextAudio.preview.style.textDecoration = '';\n    }\n\n    contextAudio._element = null;\n  }\n};","map":{"version":3,"names":["dialog","component","fileManager","name","display","add","core","addModule","context","contextAudio","audio","_infoList","_infoIndex","_uploadFileLength","focusElement","targetSelect","_origin_w","options","audioWidth","_origin_h","audioHeight","_linkValue","_element","_cover","_container","audio_dialog","setDialog","modal","audioInputFile","querySelector","audioUrlFile","preview","audio_controller","setController","controller","addEventListener","submit","bind","_removeSelectedFiles","_fileInputChange","onClick_controller","_onLinkPreview","linkProtocol","appendChild","element","relative","option","lang","util","createElement","className","style","html","dialogBox","close","icons","cancel","audioBox","title","audioFileInput","file","audioAccept","audioMultipleFile","remove","audioUrlInput","url","submitButton","innerHTML","link_btn","edit","delete","value","removeAttribute","textDecoration","setAttribute","urlInput","_createAudioTag","oAudio","plugins","_setTagAttrs","call","w","h","cssText","attrs","audioTagAttrs","key","hasOwn","protocol","e","target","trim","textContent","indexOf","fileTags","select","onModifyMode","destroy","container","getParentElement","isComponent","dataIndex","getAttribute","focusEl","previousElementSibling","nextElementSibling","emptyDiv","parentNode","removeItem","init","controllersOff","wysiwyg","removeItemAllParents","current","childNodes","length","focusEdge","deleteInfo","functions","onAudioUpload","history","push","checkFileInfo","checkInfo","updateCover","resetFileInfo","resetInfo","on","update","updateModal","src","open","currentControllerName","preventDefault","stopPropagation","files","showLoading","submitAction","setupUrl","error","closeLoading","Error","message","fileList","fileSize","i","len","test","type","size","limitSize","audioUploadSizeLimit","infoSize","audiosInfo","err","onAudioUploadError","noticeOpen","info","isUpdate","onAudioUploadBefore","result","data","_w","Array","isArray","register","upload","response","audioUploadUrl","filesLen","formData","FormData","append","audioUploadHeader","callBack_upload","xmlHttp","audioUploadHandler","JSON","parse","responseText","errorMessage","create_audio","cover","set_cover","set_container","insertComponent","mediaAutoSelect","focus","line","appendFormatTag","setRange","selectComponent","setInfo","existElement","isRangeFormatElement","isWysiwygDiv","getFormatElement","prevElement","cloneNode","isListCell","refer","insertBefore","removeEmptyNode","isFormatElement","splitElement","children","htmlRemoveWhiteSpace","replaceChild","console","warn","selectionTag","setControllerPosition","left","top","controllersOn","onControllerOff","addClass","openModify","notOpen","command","removeClass"],"sources":["/Users/jirayuyungmeesuk/Desktop/code/client/node_modules/suneditor/src/plugins/dialog/audio.js"],"sourcesContent":["/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport component from '../modules/component';\nimport fileManager from '../modules/fileManager';\n\nexport default {\n    name: 'audio',\n    display: 'dialog',\n    add: function (core) {\n        core.addModule([dialog, component, fileManager]);\n\n        const context = core.context;\n        const contextAudio = context.audio = {\n            _infoList: [], // @Override fileManager\n            _infoIndex: 0, // @Override fileManager\n            _uploadFileLength: 0, // @Override fileManager\n            focusElement: null, // @Override dialog // This element has focus when the dialog is opened.\n            targetSelect: null,\n            _origin_w: core.options.audioWidth,\n            _origin_h: core.options.audioHeight,\n            _linkValue: '',\n            // @require @Override component\n            _element: null,\n            _cover: null,\n            _container: null,\n        };\n\n        /** dialog */\n        let audio_dialog = this.setDialog(core);\n        contextAudio.modal = audio_dialog;\n        contextAudio.audioInputFile = audio_dialog.querySelector('._se_audio_files');\n        contextAudio.audioUrlFile = audio_dialog.querySelector('.se-input-url');\n        contextAudio.focusElement = contextAudio.audioInputFile || contextAudio.audioUrlFile;\n        contextAudio.preview = audio_dialog.querySelector('.se-link-preview');\n\n        /** controller */\n        let audio_controller = this.setController(core);\n        contextAudio.controller = audio_controller;\n\n        /** add event listeners */\n        audio_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n        if (contextAudio.audioInputFile) audio_dialog.querySelector('.se-dialog-files-edge-button').addEventListener('click', this._removeSelectedFiles.bind(contextAudio.audioInputFile, contextAudio.audioUrlFile, contextAudio.preview));\n        if (contextAudio.audioInputFile && contextAudio.audioUrlFile) contextAudio.audioInputFile.addEventListener('change', this._fileInputChange.bind(contextAudio));\n        audio_controller.addEventListener('click', this.onClick_controller.bind(core));\n        if (contextAudio.audioUrlFile) contextAudio.audioUrlFile.addEventListener('input', this._onLinkPreview.bind(contextAudio.preview, contextAudio, core.options.linkProtocol));\n\n        /** append html */\n        context.dialog.modal.appendChild(audio_dialog);\n\n        /** append controller */\n        context.element.relative.appendChild(audio_controller);\n\n        /** empty memory */\n        audio_dialog = null, audio_controller = null;\n    },\n\n    /** HTML - dialog */\n    setDialog: function (core) {\n        const option = core.options;\n        const lang = core.lang;\n        const dialog = core.util.createElement('DIV');\n\n        dialog.className = 'se-dialog-content';\n        dialog.style.display = 'none';\n        let html = '' +\n            '<form method=\"post\" enctype=\"multipart/form-data\">' +\n                '<div class=\"se-dialog-header\">' +\n                    '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" title=\"' + lang.dialogBox.close + '\" aria-label=\"' + lang.dialogBox.close + '\">' +\n                        core.icons.cancel +\n                    '</button>' +\n                    '<span class=\"se-modal-title\">' + lang.dialogBox.audioBox.title + '</span>' +\n                '</div>' +\n                '<div class=\"se-dialog-body\">';\n\n                if (option.audioFileInput) {\n                    html += '' +\n                        '<div class=\"se-dialog-form\">' +\n                            '<label>' + lang.dialogBox.audioBox.file + '</label>' +\n                            '<div class=\"se-dialog-form-files\">' +\n                                '<input class=\"se-input-form _se_audio_files\" type=\"file\" accept=\"' + option.audioAccept + '\"' + (option.audioMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' +\n                                '<button type=\"button\" data-command=\"filesRemove\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\" aria-label=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' +\n                            '</div>' +\n                        '</div>';\n                }\n                 \n                if (option.audioUrlInput) {\n                    html += '' +\n                        '<div class=\"se-dialog-form\">' +\n                            '<label>' + lang.dialogBox.audioBox.url + '</label>' +\n                            '<input class=\"se-input-form se-input-url\" type=\"text\" />' +\n                            '<pre class=\"se-link-preview\"></pre>' +\n                        '</div>';\n                }\n                    \n                html += '' +\n                '</div>' +\n                '<div class=\"se-dialog-footer\">' +\n                    '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\" aria-label=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' +\n                '</div>' +\n            '</form>';\n\n        dialog.innerHTML = html;\n\n        return dialog;\n    },\n\n    /** HTML - controller */\n    setController: function (core) {\n        const lang = core.lang;\n        const icons = core.icons;\n        const link_btn = core.util.createElement('DIV');\n\n        link_btn.className = 'se-controller se-controller-link';\n        link_btn.innerHTML = '' +\n            '<div class=\"se-arrow se-arrow-up\"></div>' +\n            '<div class=\"link-content\">' +\n                '<div class=\"se-btn-group\">' +\n                    '<button type=\"button\" data-command=\"update\" tabindex=\"-1\" class=\"se-tooltip\">' +\n                        icons.edit +\n                        '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.edit + '</span></span>' +\n                    '</button>' +\n                    '<button type=\"button\" data-command=\"delete\" tabindex=\"-1\" class=\"se-tooltip\">' +\n                        icons.delete +\n                        '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.remove + '</span></span>' +\n                    '</button>' +\n                '</div>' +\n            '</div>';\n\n        return link_btn;\n    },\n\n    // Disable url input when uploading files\n    _fileInputChange: function () {\n        if (!this.audioInputFile.value) {\n            this.audioUrlFile.removeAttribute('disabled');\n            this.preview.style.textDecoration = '';\n        } else {\n            this.audioUrlFile.setAttribute('disabled', true);\n            this.preview.style.textDecoration = 'line-through';\n        }\n    },\n\n    // Disable url input when uploading files\n    _removeSelectedFiles: function (urlInput, preview) {\n        this.value = '';\n        if (urlInput) {\n            urlInput.removeAttribute('disabled');\n            preview.style.textDecoration = '';\n        }\n    },\n\n    // create new audio tag\n    _createAudioTag: function () {\n        const oAudio = this.util.createElement('AUDIO');\n        this.plugins.audio._setTagAttrs.call(this, oAudio);\n\n        const w = this.context.audio._origin_w;\n        const h = this.context.audio._origin_h;\n        oAudio.setAttribute('origin-size', w + ',' + h);\n        oAudio.style.cssText = (w ? ('width:' + w + '; ') : '') + (h ? ('height:' + h + ';') : '');\n\n        return oAudio;\n    },\n\n    _setTagAttrs: function (element) {\n        element.setAttribute('controls', true);\n\n        const attrs = this.options.audioTagAttrs;\n        if (!attrs) return;\n\n        for (let key in attrs) {\n            if (!this.util.hasOwn(attrs, key)) continue;\n            element.setAttribute(key, attrs[key]);\n        }\n    },\n\n    _onLinkPreview: function (context, protocol, e) {\n        const value = e.target.value.trim();\n        context._linkValue = this.textContent = !value ? '' : (protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0) ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n    },\n\n    /**\n     * @Required @Override fileManager\n     */\n    fileTags: ['audio'],\n\n    /**\n     * @Override core, fileManager, resizing\n     * @description It is called from core.selectComponent.\n     * @param {Element} element Target element\n     */\n    select: function (element) {\n        this.plugins.audio.onModifyMode.call(this, element);\n    },\n\n    /**\n     * @Override fileManager, resizing \n     */\n    destroy: function (element) {\n        element = element || this.context.audio._element;\n        const container = this.util.getParentElement(element, this.util.isComponent) || element;\n        const dataIndex = element.getAttribute('data-index') * 1;\n        const focusEl = (container.previousElementSibling || container.nextElementSibling);\n\n        const emptyDiv = container.parentNode;\n        this.util.removeItem(container);\n        this.plugins.audio.init.call(this);\n        this.controllersOff();\n\n        if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) { return current.childNodes.length === 0; }, null);\n\n        // focus\n        this.focusEdge(focusEl);\n\n        // fileManager event\n        this.plugins.fileManager.deleteInfo.call(this, 'audio', dataIndex, this.functions.onAudioUpload);\n\n        // history stack\n        this.history.push(false);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    checkFileInfo: function () {\n        this.plugins.fileManager.checkInfo.call(this, 'audio', ['audio'], this.functions.onAudioUpload, this.plugins.audio.updateCover.bind(this), false);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    resetFileInfo: function () {\n        this.plugins.fileManager.resetInfo.call(this, 'audio', this.functions.onAudioUpload);\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    on: function (update) {\n        const contextAudio = this.context.audio;\n\n        if (!update) {\n            this.plugins.audio.init.call(this);\n            if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.setAttribute('multiple', 'multiple');\n        } else if (contextAudio._element) {\n            this.context.dialog.updateModal = true;\n            contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = contextAudio._element.src;\n            if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.removeAttribute('multiple');\n        } else {\n            if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.removeAttribute('multiple');\n        }\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    open: function () {\n        this.plugins.dialog.open.call(this, 'audio', 'audio' === this.currentControllerName);\n    },\n\n    submit: function (e) {\n        const contextAudio = this.context.audio;\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        try {\n            if (contextAudio.audioInputFile && contextAudio.audioInputFile.files.length > 0) {\n                this.showLoading();\n                this.plugins.audio.submitAction.call(this, contextAudio.audioInputFile.files);\n            } else if (contextAudio.audioUrlFile && contextAudio._linkValue.length > 0) {\n                this.showLoading();\n                this.plugins.audio.setupUrl.call(this, contextAudio._linkValue);\n            }\n        } catch (error) {\n            this.closeLoading();\n            throw Error('[SUNEDITOR.audio.submit.fail] cause : \"' + error.message + '\"');\n        } finally {\n            this.plugins.dialog.close.call(this);\n        }\n\n        return false;\n    },\n\n    submitAction: function (fileList) {\n        if (fileList.length === 0) return;\n\n        let fileSize = 0;\n        let files = [];\n        for (let i = 0, len = fileList.length; i < len; i++) {\n            if (/audio/i.test(fileList[i].type)) {\n                files.push(fileList[i]);\n                fileSize += fileList[i].size;\n            }\n        }\n\n        const limitSize = this.options.audioUploadSizeLimit;\n        if (limitSize > 0) {\n            let infoSize = 0;\n            const audiosInfo = this.context.audio._infoList;\n            for (let i = 0, len = audiosInfo.length; i < len; i++) {\n                infoSize += audiosInfo[i].size * 1;\n            }\n\n            if ((fileSize + infoSize) > limitSize) {\n                this.closeLoading();\n                const err = '[SUNEDITOR.audioUpload.fail] Size of uploadable total audios: ' + (limitSize/1000) + 'KB';\n                if (typeof this.functions.onAudioUploadError !== 'function' || this.functions.onAudioUploadError(err, { 'limitSize': limitSize, 'currentSize': infoSize, 'uploadSize': fileSize }, this)) {\n                    this.functions.noticeOpen(err);\n                }\n                return;\n            }\n        }\n\n        const contextAudio = this.context.audio;\n        contextAudio._uploadFileLength = files.length;\n\n        const info = {\n            isUpdate: this.context.dialog.updateModal,\n            element: contextAudio._element\n        };\n\n        if (typeof this.functions.onAudioUploadBefore === 'function') {\n            const result = this.functions.onAudioUploadBefore(files, info, this, function (data) {\n                if (data && this._w.Array.isArray(data.result)) {\n                    this.plugins.audio.register.call(this, info, data);\n                } else {\n                    this.plugins.audio.upload.call(this, info, data);\n                }\n            }.bind(this));\n\n            if (typeof result === 'undefined') return;\n            if (!result) {\n                this.closeLoading();\n                return;\n            }\n            if (typeof result === 'object' && result.length > 0) files = result;\n        }\n\n        this.plugins.audio.upload.call(this, info, files);\n    },\n\n    error: function (message, response) {\n        this.closeLoading();\n        if (typeof this.functions.onAudioUploadError !== 'function' || this.functions.onAudioUploadError(message, response, this)) {\n            this.functions.noticeOpen(message);\n            throw Error('[SUNEDITOR.plugin.audio.exception] response: ' + message);\n        }\n    },\n\n    upload: function (info, files) {\n        if (!files) {\n            this.closeLoading();\n            return;\n        }\n        if (typeof files === 'string') {\n            this.plugins.audio.error.call(this, files, null);\n            return;\n        }\n\n        const audioUploadUrl = this.options.audioUploadUrl;\n        const filesLen = this.context.dialog.updateModal ? 1 : files.length;\n\n        // create formData\n        const formData = new FormData();\n        for (let i = 0; i < filesLen; i++) {\n            formData.append('file-' + i, files[i]);\n        }\n\n        // server upload\n        this.plugins.fileManager.upload.call(this, audioUploadUrl, this.options.audioUploadHeader, formData, this.plugins.audio.callBack_upload.bind(this, info), this.functions.onAudioUploadError);\n    },\n\n    callBack_upload: function (info, xmlHttp) {\n        if (typeof this.functions.audioUploadHandler === 'function') {\n            this.functions.audioUploadHandler(xmlHttp, info, this);\n        } else {\n            const response = JSON.parse(xmlHttp.responseText);\n            if (response.errorMessage) {\n                this.plugins.audio.error.call(this, response.errorMessage, response);\n            } else {\n                this.plugins.audio.register.call(this, info, response);\n            }\n        }\n    },\n\n    register: function (info, response) {\n        const fileList = response.result;\n\n        for (let i = 0, len = fileList.length, file, oAudio; i < len; i++) {\n            if (info.isUpdate) oAudio = info.element;\n            else oAudio = this.plugins.audio._createAudioTag.call(this);\n\n            file = { name: fileList[i].name, size: fileList[i].size };\n            this.plugins.audio.create_audio.call(this, oAudio, fileList[i].url, file, info.isUpdate);\n        }\n\n        this.closeLoading();\n    },\n\n    setupUrl: function (src) {\n        try {\n            if (src.length === 0) return false;\n            this.plugins.audio.create_audio.call(this, this.plugins.audio._createAudioTag.call(this), src, null, this.context.dialog.updateModal);\n        } catch (error) {\n            throw Error('[SUNEDITOR.audio.audio.fail] cause : \"' + error.message + '\"');\n        } finally {\n            this.closeLoading();\n        }\n    },\n\n    create_audio: function (element, src, file, isUpdate) {\n        const contextAudio = this.context.audio;\n        \n        // create new tag\n        if (!isUpdate) {\n            element.src = src;\n            const cover = this.plugins.component.set_cover.call(this, element);\n            const container = this.plugins.component.set_container.call(this, cover, '');\n            if (!this.insertComponent(container, false, true, !this.options.mediaAutoSelect)) {\n                this.focus();\n                return;\n            }\n            if (!this.options.mediaAutoSelect) {\n                const line = this.appendFormatTag(container, null);\n                if (line) this.setRange(line, 0, line, 0);\n            }\n        } // update\n        else {\n            if (contextAudio._element) element = contextAudio._element;\n            if (element && element.src !== src) {\n                element.src = src;\n                this.selectComponent(element, 'audio');\n            } else {\n                this.selectComponent(element, 'audio');\n                return;\n            }\n        }\n\n        this.plugins.fileManager.setInfo.call(this, 'audio', element, this.functions.onAudioUpload, file, false);\n        if (isUpdate) this.history.push(false);\n    },\n\n    updateCover: function (element) {\n        const contextAudio = this.context.audio;\n        this.plugins.audio._setTagAttrs.call(this, element);\n        \n        // find component element\n        let existElement = (this.util.isRangeFormatElement(element.parentNode) || this.util.isWysiwygDiv(element.parentNode)) ? \n            element : this.util.getFormatElement(element) || element;\n\n        // clone element\n        const prevElement = element;\n        contextAudio._element = element = element.cloneNode(false);\n        const cover = this.plugins.component.set_cover.call(this, element);\n        const container = this.plugins.component.set_container.call(this, cover, 'se-audio-container');\n\n        try {\n            if (this.util.isListCell(existElement)) {\n                const refer = this.util.getParentElement(prevElement, function (current) { return current.parentNode === existElement; });\n                existElement.insertBefore(container, refer);\n                this.util.removeItem(prevElement);\n                this.util.removeEmptyNode(refer, null);\n            } else if (this.util.isFormatElement(existElement)) {\n                const refer = this.util.getParentElement(prevElement, function (current) { return current.parentNode === existElement; });\n                existElement = this.util.splitElement(existElement, refer);\n                existElement.parentNode.insertBefore(container, existElement);\n                this.util.removeItem(prevElement);\n                this.util.removeEmptyNode(existElement, null);\n                if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n            } else {\n                existElement.parentNode.replaceChild(container, existElement);\n            }\n        } catch (error) {\n            console.warn('[SUNEDITOR.audio.error] Maybe the audio tag is nested.', error);\n        }\n\n        this.plugins.fileManager.setInfo.call(this, 'audio', element, this.functions.onAudioUpload, null, false);\n        this.plugins.audio.init.call(this);\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    onModifyMode: function (selectionTag) {\n        const contextAudio = this.context.audio;\n        \n        this.setControllerPosition(contextAudio.controller, selectionTag, 'bottom', {left: 0, top: 0});\n        this.controllersOn(contextAudio.controller, selectionTag, this.plugins.audio.onControllerOff.bind(this, selectionTag), 'audio');\n\n        this.util.addClass(selectionTag, 'active');\n        contextAudio._element = selectionTag;\n        contextAudio._cover = this.util.getParentElement(selectionTag, 'FIGURE');\n        contextAudio._container = this.util.getParentElement(selectionTag, this.util.isComponent);\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    openModify: function (notOpen) {\n        if (this.context.audio.audioUrlFile) {\n            const contextAudio = this.context.audio;\n            contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = contextAudio._element.src;\n        }\n        if (!notOpen) this.plugins.dialog.open.call(this, 'audio', true);\n    },\n\n    onClick_controller: function (e) {\n        e.stopPropagation();\n\n        const command = e.target.getAttribute('data-command');\n        if (!command) return;\n\n        e.preventDefault();\n\n        if (/update/.test(command)) {\n            this.plugins.audio.openModify.call(this, false);\n        }\n        else { /** delete */\n            this.plugins.audio.destroy.call(this, this.context.audio._element);\n        }\n\n        this.controllersOff();\n    },\n\n    onControllerOff: function (selectionTag) {\n        this.util.removeClass(selectionTag, 'active');\n        this.context.audio.controller.style.display = 'none';\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    init: function () {\n        if (this.context.dialog.updateModal) return;\n        const contextAudio = this.context.audio;\n\n        if (contextAudio.audioInputFile) contextAudio.audioInputFile.value = '';\n        if (contextAudio.audioUrlFile) contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = '';\n        if (contextAudio.audioInputFile && contextAudio.audioUrlFile) {\n            contextAudio.audioUrlFile.removeAttribute('disabled');\n            contextAudio.preview.style.textDecoration = '';\n        }\n\n        contextAudio._element = null;\n    }\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}