{"ast":null,"code":"/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport anchor from '../modules/_anchor';\nimport component from '../modules/component';\nimport resizing from '../modules/resizing';\nimport fileManager from '../modules/fileManager';\nexport default {\n  name: 'image',\n  display: 'dialog',\n  add: function add(core) {\n    core.addModule([dialog, anchor, component, resizing, fileManager]);\n    var options = core.options;\n    var context = core.context;\n    var contextImage = context.image = {\n      _infoList: [],\n      // @Override fileManager\n      _infoIndex: 0,\n      // @Override fileManager\n      _uploadFileLength: 0,\n      // @Override fileManager\n      focusElement: null,\n      // @Override dialog // This element has focus when the dialog is opened.\n      sizeUnit: options._imageSizeUnit,\n      _linkElement: '',\n      _altText: '',\n      _align: 'none',\n      _floatClassRegExp: '__se__float\\\\-[a-z]+',\n      _v_src: {\n        _linkValue: ''\n      },\n      svgDefaultSize: '30%',\n      base64RenderIndex: 0,\n      // @require @Override component\n      _element: null,\n      _cover: null,\n      _container: null,\n      // @Override resizing properties\n      inputX: null,\n      inputY: null,\n      _element_w: 1,\n      _element_h: 1,\n      _element_l: 0,\n      _element_t: 0,\n      _defaultSizeX: 'auto',\n      _defaultSizeY: 'auto',\n      _origin_w: options.imageWidth === 'auto' ? '' : options.imageWidth,\n      _origin_h: options.imageHeight === 'auto' ? '' : options.imageHeight,\n      _proportionChecked: true,\n      _resizing: options.imageResizing,\n      _resizeDotHide: !options.imageHeightShow,\n      _rotation: options.imageRotation,\n      _alignHide: !options.imageAlignShow,\n      _onlyPercentage: options.imageSizeOnlyPercentage,\n      _ratio: false,\n      _ratioX: 1,\n      _ratioY: 1,\n      _captionShow: true,\n      _captionChecked: false,\n      _caption: null,\n      captionCheckEl: null\n    };\n    /** image dialog */\n\n    var image_dialog = this.setDialog(core);\n    contextImage.modal = image_dialog;\n    contextImage.imgInputFile = image_dialog.querySelector('._se_image_file');\n    contextImage.imgUrlFile = image_dialog.querySelector('._se_image_url');\n    contextImage.focusElement = contextImage.imgInputFile || contextImage.imgUrlFile;\n    contextImage.altText = image_dialog.querySelector('._se_image_alt');\n    contextImage.captionCheckEl = image_dialog.querySelector('._se_image_check_caption');\n    contextImage.previewSrc = image_dialog.querySelector('._se_tab_content_image .se-link-preview');\n    /** add event listeners */\n\n    image_dialog.querySelector('.se-dialog-tabs').addEventListener('click', this.openTab.bind(core));\n    image_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n    if (contextImage.imgInputFile) image_dialog.querySelector('.se-file-remove').addEventListener('click', this._removeSelectedFiles.bind(contextImage.imgInputFile, contextImage.imgUrlFile, contextImage.previewSrc));\n    if (contextImage.imgUrlFile) contextImage.imgUrlFile.addEventListener('input', this._onLinkPreview.bind(contextImage.previewSrc, contextImage._v_src, options.linkProtocol));\n    if (contextImage.imgInputFile && contextImage.imgUrlFile) contextImage.imgInputFile.addEventListener('change', this._fileInputChange.bind(contextImage));\n    var imageGalleryButton = image_dialog.querySelector('.__se__gallery');\n    if (imageGalleryButton) imageGalleryButton.addEventListener('click', this._openGallery.bind(core));\n    contextImage.proportion = {};\n    contextImage.inputX = {};\n    contextImage.inputY = {};\n\n    if (options.imageResizing) {\n      contextImage.proportion = image_dialog.querySelector('._se_image_check_proportion');\n      contextImage.inputX = image_dialog.querySelector('._se_image_size_x');\n      contextImage.inputY = image_dialog.querySelector('._se_image_size_y');\n      contextImage.inputX.value = options.imageWidth;\n      contextImage.inputY.value = options.imageHeight;\n      contextImage.inputX.addEventListener('keyup', this.setInputSize.bind(core, 'x'));\n      contextImage.inputY.addEventListener('keyup', this.setInputSize.bind(core, 'y'));\n      contextImage.inputX.addEventListener('change', this.setRatio.bind(core));\n      contextImage.inputY.addEventListener('change', this.setRatio.bind(core));\n      contextImage.proportion.addEventListener('change', this.setRatio.bind(core));\n      image_dialog.querySelector('.se-dialog-btn-revert').addEventListener('click', this.sizeRevert.bind(core));\n    }\n    /** append html */\n\n\n    context.dialog.modal.appendChild(image_dialog);\n    /** link event */\n\n    core.plugins.anchor.initEvent.call(core, 'image', image_dialog.querySelector('._se_tab_content_url'));\n    contextImage.anchorCtx = core.context.anchor.caller.image;\n    /** empty memory */\n\n    image_dialog = null;\n  },\n\n  /** dialog */\n  setDialog: function setDialog(core) {\n    var option = core.options;\n    var lang = core.lang;\n    var dialog = core.util.createElement('DIV');\n    dialog.className = 'se-dialog-content se-dialog-image';\n    dialog.style.display = 'none';\n    var html = '' + '<div class=\"se-dialog-header\">' + '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" class=\"close\" title=\"' + lang.dialogBox.close + '\" aria-label=\"' + lang.dialogBox.close + '\">' + core.icons.cancel + '</button>' + '<span class=\"se-modal-title\">' + lang.dialogBox.imageBox.title + '</span>' + '</div>' + '<div class=\"se-dialog-tabs\">' + '<button type=\"button\" class=\"_se_tab_link active\" data-tab-link=\"image\">' + lang.toolbar.image + '</button>' + '<button type=\"button\" class=\"_se_tab_link\" data-tab-link=\"url\">' + lang.toolbar.link + '</button>' + '</div>' + '<form method=\"post\" enctype=\"multipart/form-data\">' + '<div class=\"_se_tab_content _se_tab_content_image\">' + '<div class=\"se-dialog-body\"><div style=\"border-bottom: 1px dashed #ccc;\">';\n\n    if (option.imageFileInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.imageBox.file + '</label>' + '<div class=\"se-dialog-form-files\">' + '<input class=\"se-input-form _se_image_file\" type=\"file\" accept=\"' + option.imageAccept + '\"' + (option.imageMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' + '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\" aria-label=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' + '</div>' + '</div>';\n    }\n\n    if (option.imageUrlInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.imageBox.url + '</label>' + '<div class=\"se-dialog-form-files\">' + '<input class=\"se-input-form se-input-url _se_image_url\" type=\"text\" />' + (option.imageGalleryUrl && core.plugins.imageGallery ? '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button __se__gallery\" title=\"' + lang.toolbar.imageGallery + '\" aria-label=\"' + lang.toolbar.imageGallery + '\">' + core.icons.image_gallery + '</button>' : '') + '</div>' + '<pre class=\"se-link-preview\"></pre>' + '</div>';\n    }\n\n    html += '</div>' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.imageBox.altText + '</label><input class=\"se-input-form _se_image_alt\" type=\"text\" />' + '</div>';\n\n    if (option.imageResizing) {\n      var onlyPercentage = option.imageSizeOnlyPercentage;\n      var onlyPercentDisplay = onlyPercentage ? ' style=\"display: none !important;\"' : '';\n      var heightDisplay = !option.imageHeightShow ? ' style=\"display: none !important;\"' : '';\n      html += '<div class=\"se-dialog-form\">';\n\n      if (onlyPercentage || !option.imageHeightShow) {\n        html += '' + '<div class=\"se-dialog-size-text\">' + '<label class=\"size-w\">' + lang.dialogBox.size + '</label>' + '</div>';\n      } else {\n        html += '' + '<div class=\"se-dialog-size-text\">' + '<label class=\"size-w\">' + lang.dialogBox.width + '</label>' + '<label class=\"se-dialog-size-x\">&nbsp;</label>' + '<label class=\"size-h\">' + lang.dialogBox.height + '</label>' + '</div>';\n      }\n\n      html += '' + '<input class=\"se-input-control _se_image_size_x\" placeholder=\"auto\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + ' />' + '<label class=\"se-dialog-size-x\"' + heightDisplay + '>' + (onlyPercentage ? '%' : 'x') + '</label>' + '<input type=\"text\" class=\"se-input-control _se_image_size_y\" placeholder=\"auto\"' + onlyPercentDisplay + (onlyPercentage ? ' max=\"100\"' : '') + heightDisplay + '/>' + '<label' + onlyPercentDisplay + heightDisplay + '><input type=\"checkbox\" class=\"se-dialog-btn-check _se_image_check_proportion\" checked/>&nbsp;' + lang.dialogBox.proportion + '</label>' + '<button type=\"button\" title=\"' + lang.dialogBox.revertButton + '\" aria-label=\"' + lang.dialogBox.revertButton + '\" class=\"se-btn se-dialog-btn-revert\" style=\"float: right;\">' + core.icons.revert + '</button>' + '</div>';\n    }\n\n    html += '' + '<div class=\"se-dialog-form se-dialog-form-footer\">' + '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_image_check_caption\" />&nbsp;' + lang.dialogBox.caption + '</label>' + '</div>' + '</div>' + '</div>' + '<div class=\"_se_tab_content _se_tab_content_url\" style=\"display: none\">' + core.context.anchor.forms.innerHTML + '</div>' + '<div class=\"se-dialog-footer\">' + '<div' + (option.imageAlignShow ? '' : ' style=\"display: none\"') + '>' + '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"none\" checked>' + lang.dialogBox.basic + '</label>' + '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"left\">' + lang.dialogBox.left + '</label>' + '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"center\">' + lang.dialogBox.center + '</label>' + '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"right\">' + lang.dialogBox.right + '</label>' + '</div>' + '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\" aria-label=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' + '</div>' + '</form>';\n    dialog.innerHTML = html;\n    return dialog;\n  },\n  _fileInputChange: function _fileInputChange() {\n    if (!this.imgInputFile.value) {\n      this.imgUrlFile.removeAttribute('disabled');\n      this.previewSrc.style.textDecoration = '';\n    } else {\n      this.imgUrlFile.setAttribute('disabled', true);\n      this.previewSrc.style.textDecoration = 'line-through';\n    }\n  },\n  _removeSelectedFiles: function _removeSelectedFiles(urlInput, previewSrc) {\n    this.value = '';\n\n    if (urlInput) {\n      urlInput.removeAttribute('disabled');\n      previewSrc.style.textDecoration = '';\n    }\n  },\n  _openGallery: function _openGallery() {\n    this.callPlugin('imageGallery', this.plugins.imageGallery.open.bind(this, this.plugins.image._setUrlInput.bind(this.context.image)), null);\n  },\n  _setUrlInput: function _setUrlInput(target) {\n    this.altText.value = target.alt;\n    this._v_src._linkValue = this.previewSrc.textContent = this.imgUrlFile.value = target.src;\n    this.imgUrlFile.focus();\n  },\n  _onLinkPreview: function _onLinkPreview(context, protocol, e) {\n    var value = e.target.value.trim();\n    context._linkValue = this.textContent = !value ? '' : protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0 ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n  },\n\n  /**\n   * @Override @Required fileManager\n   */\n  fileTags: ['img'],\n\n  /**\n   * @Override core, fileManager, resizing\n   * @description It is called from core.selectComponent.\n   * @param {Element} element Target element\n   */\n  select: function select(element) {\n    this.plugins.image.onModifyMode.call(this, element, this.plugins.resizing.call_controller_resize.call(this, element, 'image'));\n  },\n\n  /**\n   * @Override fileManager, resizing\n   */\n  destroy: function destroy(element) {\n    var imageEl = element || this.context.image._element;\n    var imageContainer = this.util.getParentElement(imageEl, this.util.isMediaComponent) || imageEl;\n    var dataIndex = imageEl.getAttribute('data-index') * 1;\n    var focusEl = imageContainer.previousElementSibling || imageContainer.nextElementSibling;\n    var emptyDiv = imageContainer.parentNode;\n    this.util.removeItem(imageContainer);\n    this.plugins.image.init.call(this);\n    this.controllersOff();\n    if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) {\n      return current.childNodes.length === 0;\n    }, null); // focus\n\n    this.focusEdge(focusEl); // event\n\n    this.plugins.fileManager.deleteInfo.call(this, 'image', dataIndex, this.functions.onImageUpload); // history stack\n\n    this.history.push(false);\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  on: function on(update) {\n    var contextImage = this.context.image;\n\n    if (!update) {\n      contextImage.inputX.value = contextImage._origin_w = this.options.imageWidth === contextImage._defaultSizeX ? '' : this.options.imageWidth;\n      contextImage.inputY.value = contextImage._origin_h = this.options.imageHeight === contextImage._defaultSizeY ? '' : this.options.imageHeight;\n      if (contextImage.imgInputFile && this.options.imageMultipleFile) contextImage.imgInputFile.setAttribute('multiple', 'multiple');\n    } else {\n      if (contextImage.imgInputFile && this.options.imageMultipleFile) contextImage.imgInputFile.removeAttribute('multiple');\n    }\n\n    this.plugins.anchor.on.call(this, contextImage.anchorCtx, update);\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  open: function open() {\n    this.plugins.dialog.open.call(this, 'image', 'image' === this.currentControllerName);\n  },\n  openTab: function openTab(e) {\n    var modal = this.context.image.modal;\n    var targetElement = e === 'init' ? modal.querySelector('._se_tab_link') : e.target;\n\n    if (!/^BUTTON$/i.test(targetElement.tagName)) {\n      return false;\n    } // Declare all variables\n\n\n    var tabName = targetElement.getAttribute('data-tab-link');\n    var contentClassName = '_se_tab_content';\n    var i, tabContent, tabLinks; // Get all elements with class=\"tabcontent\" and hide them\n\n    tabContent = modal.getElementsByClassName(contentClassName);\n\n    for (i = 0; i < tabContent.length; i++) {\n      tabContent[i].style.display = 'none';\n    } // Get all elements with class=\"tablinks\" and remove the class \"active\"\n\n\n    tabLinks = modal.getElementsByClassName('_se_tab_link');\n\n    for (i = 0; i < tabLinks.length; i++) {\n      this.util.removeClass(tabLinks[i], 'active');\n    } // Show the current tab, and add an \"active\" class to the button that opened the tab\n\n\n    modal.querySelector('.' + contentClassName + '_' + tabName).style.display = 'block';\n    this.util.addClass(targetElement, 'active'); // focus\n\n    if (tabName === 'image' && this.context.image.focusElement) {\n      this.context.image.focusElement.focus();\n    } else if (tabName === 'url') {\n      this.context.anchor.caller.image.urlInput.focus();\n    }\n\n    return false;\n  },\n  submit: function submit(e) {\n    var contextImage = this.context.image;\n    var imagePlugin = this.plugins.image;\n    e.preventDefault();\n    e.stopPropagation();\n    contextImage._altText = contextImage.altText.value;\n    contextImage._align = contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"]:checked').value;\n    contextImage._captionChecked = contextImage.captionCheckEl.checked;\n    if (contextImage._resizing) contextImage._proportionChecked = contextImage.proportion.checked;\n\n    try {\n      if (this.context.dialog.updateModal) {\n        imagePlugin.update_image.call(this, false, true, false);\n      }\n\n      if (contextImage.imgInputFile && contextImage.imgInputFile.files.length > 0) {\n        this.showLoading();\n        imagePlugin.submitAction.call(this, this.context.image.imgInputFile.files);\n      } else if (contextImage.imgUrlFile && contextImage._v_src._linkValue.length > 0) {\n        this.showLoading();\n        imagePlugin.onRender_imgUrl.call(this, contextImage._v_src._linkValue);\n      }\n    } catch (error) {\n      this.closeLoading();\n      throw Error('[SUNEDITOR.image.submit.fail] cause : \"' + error.message + '\"');\n    } finally {\n      this.plugins.dialog.close.call(this);\n    }\n\n    return false;\n  },\n  submitAction: function submitAction(fileList) {\n    if (fileList.length === 0) return;\n    var fileSize = 0;\n    var files = [];\n\n    for (var i = 0, len = fileList.length; i < len; i++) {\n      if (/image/i.test(fileList[i].type)) {\n        files.push(fileList[i]);\n        fileSize += fileList[i].size;\n      }\n    }\n\n    var limitSize = this.options.imageUploadSizeLimit;\n\n    if (limitSize > 0) {\n      var infoSize = 0;\n      var imagesInfo = this.context.image._infoList;\n\n      for (var _i = 0, _len = imagesInfo.length; _i < _len; _i++) {\n        infoSize += imagesInfo[_i].size * 1;\n      }\n\n      if (fileSize + infoSize > limitSize) {\n        this.closeLoading();\n        var err = '[SUNEDITOR.imageUpload.fail] Size of uploadable total images: ' + limitSize / 1000 + 'KB';\n\n        if (typeof this.functions.onImageUploadError !== 'function' || this.functions.onImageUploadError(err, {\n          'limitSize': limitSize,\n          'currentSize': infoSize,\n          'uploadSize': fileSize\n        }, this)) {\n          this.functions.noticeOpen(err);\n        }\n\n        return;\n      }\n    }\n\n    var contextImage = this.context.image;\n    contextImage._uploadFileLength = files.length;\n    var anchor = this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true);\n    var info = {\n      anchor: anchor,\n      inputWidth: contextImage.inputX.value,\n      inputHeight: contextImage.inputY.value,\n      align: contextImage._align,\n      isUpdate: this.context.dialog.updateModal,\n      alt: contextImage._altText,\n      element: contextImage._element\n    };\n\n    if (typeof this.functions.onImageUploadBefore === 'function') {\n      var result = this.functions.onImageUploadBefore(files, info, this, function (data) {\n        if (data && this._w.Array.isArray(data.result)) {\n          this.plugins.image.register.call(this, info, data);\n        } else {\n          this.plugins.image.upload.call(this, info, data);\n        }\n      }.bind(this));\n      if (typeof result === 'undefined') return;\n\n      if (!result) {\n        this.closeLoading();\n        return;\n      }\n\n      if (this._w.Array.isArray(result) && result.length > 0) files = result;\n    }\n\n    this.plugins.image.upload.call(this, info, files);\n  },\n  error: function error(message, response) {\n    this.closeLoading();\n\n    if (typeof this.functions.onImageUploadError !== 'function' || this.functions.onImageUploadError(message, response, this)) {\n      this.functions.noticeOpen(message);\n      throw Error('[SUNEDITOR.plugin.image.error] response: ' + message);\n    }\n  },\n  upload: function upload(info, files) {\n    if (!files) {\n      this.closeLoading();\n      return;\n    }\n\n    if (typeof files === 'string') {\n      this.plugins.image.error.call(this, files, null);\n      return;\n    }\n\n    var imageUploadUrl = this.options.imageUploadUrl;\n    var filesLen = this.context.dialog.updateModal ? 1 : files.length; // server upload\n\n    if (typeof imageUploadUrl === 'string' && imageUploadUrl.length > 0) {\n      var formData = new FormData();\n\n      for (var i = 0; i < filesLen; i++) {\n        formData.append('file-' + i, files[i]);\n      }\n\n      this.plugins.fileManager.upload.call(this, imageUploadUrl, this.options.imageUploadHeader, formData, this.plugins.image.callBack_imgUpload.bind(this, info), this.functions.onImageUploadError);\n    } else {\n      // base64\n      this.plugins.image.setup_reader.call(this, files, info.anchor, info.inputWidth, info.inputHeight, info.align, info.alt, filesLen, info.isUpdate);\n    }\n  },\n  callBack_imgUpload: function callBack_imgUpload(info, xmlHttp) {\n    if (typeof this.functions.imageUploadHandler === 'function') {\n      this.functions.imageUploadHandler(xmlHttp, info, this);\n    } else {\n      var response = JSON.parse(xmlHttp.responseText);\n\n      if (response.errorMessage) {\n        this.plugins.image.error.call(this, response.errorMessage, response);\n      } else {\n        this.plugins.image.register.call(this, info, response);\n      }\n    }\n  },\n  register: function register(info, response) {\n    var fileList = response.result;\n\n    for (var i = 0, len = fileList.length, file; i < len; i++) {\n      file = {\n        name: fileList[i].name,\n        size: fileList[i].size\n      };\n\n      if (info.isUpdate) {\n        this.plugins.image.update_src.call(this, fileList[i].url, info.element, file);\n        break;\n      } else {\n        this.plugins.image.create_image.call(this, fileList[i].url, info.anchor, info.inputWidth, info.inputHeight, info.align, file, info.alt);\n      }\n    }\n\n    this.closeLoading();\n  },\n  setup_reader: function setup_reader(files, anchor, width, height, align, alt, filesLen, isUpdate) {\n    var _this = this;\n\n    try {\n      (function () {\n        _this.context.image.base64RenderIndex = filesLen;\n        var wFileReader = _this._w.FileReader;\n        var filesStack = [filesLen];\n        _this.context.image.inputX.value = width;\n        _this.context.image.inputY.value = height;\n\n        for (var i = 0, reader, file; i < filesLen; i++) {\n          reader = new wFileReader();\n          file = files[i];\n\n          reader.onload = function (reader, update, updateElement, file, index) {\n            filesStack[index] = {\n              result: reader.result,\n              file: file\n            };\n\n            if (--this.context.image.base64RenderIndex === 0) {\n              this.plugins.image.onRender_imgBase64.call(this, update, filesStack, updateElement, anchor, width, height, align, alt);\n              this.closeLoading();\n            }\n          }.bind(_this, reader, isUpdate, _this.context.image._element, file, i);\n\n          reader.readAsDataURL(file);\n        }\n      })();\n    } catch (e) {\n      this.closeLoading();\n      throw Error('[SUNEDITOR.image.setup_reader.fail] cause : \"' + e.message + '\"');\n    }\n  },\n  onRender_imgBase64: function onRender_imgBase64(update, filesStack, updateElement, anchor, width, height, align, alt) {\n    var updateMethod = this.plugins.image.update_src;\n    var createMethod = this.plugins.image.create_image;\n\n    for (var i = 0, len = filesStack.length; i < len; i++) {\n      if (update) {\n        this.context.image._element.setAttribute('data-file-name', filesStack[i].file.name);\n\n        this.context.image._element.setAttribute('data-file-size', filesStack[i].file.size);\n\n        updateMethod.call(this, filesStack[i].result, updateElement, filesStack[i].file);\n      } else {\n        createMethod.call(this, filesStack[i].result, anchor, width, height, align, filesStack[i].file, alt);\n      }\n    }\n  },\n  onRender_imgUrl: function onRender_imgUrl(url) {\n    if (!url) url = this.context.image._v_src._linkValue;\n    if (!url) return false;\n    var contextImage = this.context.image;\n\n    try {\n      var file = {\n        name: url.split('/').pop(),\n        size: 0\n      };\n      if (this.context.dialog.updateModal) this.plugins.image.update_src.call(this, url, contextImage._element, file);else this.plugins.image.create_image.call(this, url, this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true), contextImage.inputX.value, contextImage.inputY.value, contextImage._align, file, contextImage._altText);\n    } catch (e) {\n      throw Error('[SUNEDITOR.image.URLRendering.fail] cause : \"' + e.message + '\"');\n    } finally {\n      this.closeLoading();\n    }\n  },\n  onRender_link: function onRender_link(imgTag, anchor) {\n    if (anchor) {\n      anchor.setAttribute('data-image-link', 'image');\n      imgTag.setAttribute('data-image-link', anchor.href);\n      anchor.appendChild(imgTag);\n      return anchor;\n    }\n\n    return imgTag;\n  },\n\n  /**\n   * @Override resizing\n   * @param {String} xy 'x': width, 'y': height\n   * @param {KeyboardEvent} e Event object\n   */\n  setInputSize: function setInputSize(xy, e) {\n    if (e && e.keyCode === 32) {\n      e.preventDefault();\n      return;\n    }\n\n    this.plugins.resizing._module_setInputSize.call(this, this.context.image, xy);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setRatio: function setRatio() {\n    this.plugins.resizing._module_setRatio.call(this, this.context.image);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  checkFileInfo: function checkFileInfo() {\n    var imagePlugin = this.plugins.image;\n    var contextImage = this.context.image;\n\n    var modifyHandler = function (tag) {\n      imagePlugin.onModifyMode.call(this, tag, null);\n      imagePlugin.openModify.call(this, true); // get size\n\n      contextImage.inputX.value = contextImage._origin_w;\n      contextImage.inputY.value = contextImage._origin_h; // get align\n\n      var format = this.util.getFormatElement(tag);\n      if (format) contextImage._align = format.style.textAlign || format.style.float; // link\n\n      var link = this.util.getParentElement(tag, this.util.isAnchor);\n      if (link && !contextImage.anchorCtx.linkValue) contextImage.anchorCtx.linkValue = ' ';\n      imagePlugin.update_image.call(this, true, false, true);\n      imagePlugin.init.call(this);\n    }.bind(this);\n\n    this.plugins.fileManager.checkInfo.call(this, 'image', ['img'], this.functions.onImageUpload, modifyHandler, true);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  resetFileInfo: function resetFileInfo() {\n    this.plugins.fileManager.resetInfo.call(this, 'image', this.functions.onImageUpload);\n  },\n  create_image: function create_image(src, anchor, width, height, align, file, alt) {\n    var imagePlugin = this.plugins.image;\n    var contextImage = this.context.image;\n    this.context.resizing._resize_plugin = 'image';\n    var oImg = this.util.createElement('IMG');\n    oImg.src = src;\n    oImg.alt = alt;\n    oImg.setAttribute('data-rotate', '0');\n    anchor = imagePlugin.onRender_link.call(this, oImg, anchor ? anchor.cloneNode(false) : null);\n\n    if (contextImage._resizing) {\n      oImg.setAttribute('data-proportion', contextImage._proportionChecked);\n    }\n\n    var cover = this.plugins.component.set_cover.call(this, anchor);\n    var container = this.plugins.component.set_container.call(this, cover, 'se-image-container'); // caption\n\n    if (contextImage._captionChecked) {\n      contextImage._caption = this.plugins.component.create_caption.call(this);\n\n      contextImage._caption.setAttribute('contenteditable', false);\n\n      cover.appendChild(contextImage._caption);\n    }\n\n    contextImage._element = oImg;\n    contextImage._cover = cover;\n    contextImage._container = container; // set size\n\n    imagePlugin.applySize.call(this, width, height); // align\n\n    imagePlugin.setAlign.call(this, align, oImg, cover, container);\n    oImg.onload = imagePlugin._image_create_onload.bind(this, oImg, contextImage.svgDefaultSize, container);\n    if (this.insertComponent(container, true, true, true)) this.plugins.fileManager.setInfo.call(this, 'image', oImg, this.functions.onImageUpload, file, true);\n    this.context.resizing._resize_plugin = '';\n  },\n  _image_create_onload: function _image_create_onload(oImg, svgDefaultSize, container) {\n    // svg exception handling\n    if (oImg.offsetWidth === 0) this.plugins.image.applySize.call(this, svgDefaultSize, '');\n\n    if (this.options.mediaAutoSelect) {\n      this.selectComponent(oImg, 'image');\n    } else {\n      var line = this.appendFormatTag(container, null);\n      if (line) this.setRange(line, 0, line, 0);\n    }\n  },\n  update_image: function update_image(init, openController, notHistoryPush) {\n    var contextImage = this.context.image;\n    var imageEl = contextImage._element;\n    var cover = contextImage._cover;\n    var container = contextImage._container;\n    var isNewContainer = false;\n\n    if (cover === null) {\n      isNewContainer = true;\n      imageEl = contextImage._element.cloneNode(true);\n      cover = this.plugins.component.set_cover.call(this, imageEl);\n    }\n\n    if (container === null) {\n      cover = cover.cloneNode(true);\n      imageEl = cover.querySelector('img');\n      isNewContainer = true;\n      container = this.plugins.component.set_container.call(this, cover, 'se-image-container');\n    } else if (isNewContainer) {\n      container.innerHTML = '';\n      container.appendChild(cover);\n      contextImage._cover = cover;\n      contextImage._element = imageEl;\n      isNewContainer = false;\n    } // check size\n\n\n    var changeSize;\n    var x = this.util.isNumber(contextImage.inputX.value) ? contextImage.inputX.value + contextImage.sizeUnit : contextImage.inputX.value;\n    var y = this.util.isNumber(contextImage.inputY.value) ? contextImage.inputY.value + contextImage.sizeUnit : contextImage.inputY.value;\n\n    if (/%$/.test(imageEl.style.width)) {\n      changeSize = x !== container.style.width || y !== container.style.height;\n    } else {\n      changeSize = x !== imageEl.style.width || y !== imageEl.style.height;\n    } // alt\n\n\n    imageEl.alt = contextImage._altText; // caption\n\n    var modifiedCaption = false;\n\n    if (contextImage._captionChecked) {\n      if (!contextImage._caption) {\n        contextImage._caption = this.plugins.component.create_caption.call(this);\n        cover.appendChild(contextImage._caption);\n        modifiedCaption = true;\n      }\n    } else {\n      if (contextImage._caption) {\n        this.util.removeItem(contextImage._caption);\n        contextImage._caption = null;\n        modifiedCaption = true;\n      }\n    } // link\n\n\n    var anchor = this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true);\n\n    if (anchor) {\n      if (contextImage._linkElement !== anchor) {\n        contextImage._linkElement = anchor.cloneNode(false);\n        cover.insertBefore(this.plugins.image.onRender_link.call(this, imageEl, contextImage._linkElement), contextImage._caption);\n        this.util.removeItem(anchor);\n      } else {\n        contextImage._linkElement.setAttribute('data-image-link', 'image');\n      }\n    } else if (contextImage._linkElement !== null) {\n      var imageElement = imageEl;\n      imageElement.setAttribute('data-image-link', '');\n\n      if (cover.contains(contextImage._linkElement)) {\n        var newEl = imageElement.cloneNode(true);\n        cover.removeChild(contextImage._linkElement);\n        cover.insertBefore(newEl, contextImage._caption);\n        contextImage._element = imageEl = newEl;\n      }\n    }\n\n    if (isNewContainer) {\n      var existElement = this.util.isRangeFormatElement(contextImage._element.parentNode) || this.util.isWysiwygDiv(contextImage._element.parentNode) ? contextImage._element : /^A$/i.test(contextImage._element.parentNode.nodeName) ? contextImage._element.parentNode : this.util.getFormatElement(contextImage._element) || contextImage._element;\n\n      if (this.util.isListCell(existElement)) {\n        var refer = this.util.getParentElement(contextImage._element, function (current) {\n          return current.parentNode === existElement;\n        });\n        existElement.insertBefore(container, refer);\n        this.util.removeItem(contextImage._element);\n        this.util.removeEmptyNode(refer, null);\n      } else if (this.util.isFormatElement(existElement)) {\n        var _refer = this.util.getParentElement(contextImage._element, function (current) {\n          return current.parentNode === existElement;\n        });\n\n        existElement = this.util.splitElement(existElement, _refer);\n        existElement.parentNode.insertBefore(container, existElement);\n        this.util.removeItem(contextImage._element);\n        this.util.removeEmptyNode(existElement, null);\n        if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n      } else {\n        if (this.util.isFormatElement(existElement.parentNode)) {\n          var formats = existElement.parentNode;\n          formats.parentNode.insertBefore(container, existElement.previousSibling ? formats.nextElementSibling : formats);\n          this.util.removeItem(existElement);\n        } else {\n          existElement.parentNode.replaceChild(container, existElement);\n        }\n      }\n\n      imageEl = container.querySelector('img');\n      contextImage._element = imageEl;\n      contextImage._cover = cover;\n      contextImage._container = container;\n    } // transform\n\n\n    if (modifiedCaption || !contextImage._onlyPercentage && changeSize) {\n      if (!init && (/\\d+/.test(imageEl.style.height) || this.context.resizing._rotateVertical && contextImage._captionChecked)) {\n        if (/%$/.test(contextImage.inputX.value) || /%$/.test(contextImage.inputY.value)) {\n          this.plugins.resizing.resetTransform.call(this, imageEl);\n        } else {\n          this.plugins.resizing.setTransformSize.call(this, imageEl, this.util.getNumber(contextImage.inputX.value, 0), this.util.getNumber(contextImage.inputY.value, 0));\n        }\n      }\n    } // size\n\n\n    if (contextImage._resizing) {\n      imageEl.setAttribute('data-proportion', contextImage._proportionChecked);\n\n      if (changeSize) {\n        this.plugins.image.applySize.call(this);\n      }\n    } // align\n\n\n    this.plugins.image.setAlign.call(this, null, imageEl, null, null); // set imagesInfo\n\n    if (init) {\n      this.plugins.fileManager.setInfo.call(this, 'image', imageEl, this.functions.onImageUpload, null, true);\n    }\n\n    if (openController) {\n      this.selectComponent(imageEl, 'image');\n    } // history stack\n\n\n    if (!notHistoryPush) this.history.push(false);\n  },\n  update_src: function update_src(src, element, file) {\n    element.src = src;\n\n    this._w.setTimeout(this.plugins.fileManager.setInfo.bind(this, 'image', element, this.functions.onImageUpload, file, true));\n\n    this.selectComponent(element, 'image');\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  onModifyMode: function onModifyMode(element, size) {\n    if (!element) return;\n    var contextImage = this.context.image;\n    contextImage._linkElement = contextImage.anchorCtx.linkAnchor = /^A$/i.test(element.parentNode.nodeName) ? element.parentNode : null;\n    contextImage._element = element;\n    contextImage._cover = this.util.getParentElement(element, 'FIGURE');\n    contextImage._container = this.util.getParentElement(element, this.util.isMediaComponent);\n    contextImage._caption = this.util.getChildElement(contextImage._cover, 'FIGCAPTION');\n    contextImage._align = element.style.float || element.getAttribute('data-align') || 'none';\n    element.style.float = '';\n    this.plugins.anchor.setCtx(contextImage._linkElement, contextImage.anchorCtx);\n\n    if (size) {\n      contextImage._element_w = size.w;\n      contextImage._element_h = size.h;\n      contextImage._element_t = size.t;\n      contextImage._element_l = size.l;\n    }\n\n    var userSize = contextImage._element.getAttribute('data-size') || contextImage._element.getAttribute('data-origin');\n\n    var w, h;\n\n    if (userSize) {\n      userSize = userSize.split(',');\n      w = userSize[0];\n      h = userSize[1];\n    } else if (size) {\n      w = size.w;\n      h = size.h;\n    }\n\n    contextImage._origin_w = w || element.style.width || element.width || '';\n    contextImage._origin_h = h || element.style.height || element.height || '';\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  openModify: function openModify(notOpen) {\n    var contextImage = this.context.image;\n\n    if (contextImage.imgUrlFile) {\n      contextImage._v_src._linkValue = contextImage.previewSrc.textContent = contextImage.imgUrlFile.value = contextImage._element.src;\n    }\n\n    contextImage._altText = contextImage.altText.value = contextImage._element.alt;\n    (contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"][value=\"' + contextImage._align + '\"]') || contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"][value=\"none\"]')).checked = true;\n    contextImage._align = contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"]:checked').value;\n    contextImage._captionChecked = contextImage.captionCheckEl.checked = !!contextImage._caption;\n\n    if (contextImage._resizing) {\n      this.plugins.resizing._module_setModifyInputSize.call(this, contextImage, this.plugins.image);\n    }\n\n    if (!notOpen) this.plugins.dialog.open.call(this, 'image', true);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  applySize: function applySize(w, h) {\n    var contextImage = this.context.image;\n    if (!w) w = contextImage.inputX.value || this.options.imageWidth;\n    if (!h) h = contextImage.inputY.value || this.options.imageHeight;\n\n    if (contextImage._onlyPercentage && !!w || /%$/.test(w)) {\n      this.plugins.image.setPercentSize.call(this, w, h);\n      return true;\n    } else if ((!w || w === 'auto') && (!h || h === 'auto')) {\n      this.plugins.image.setAutoSize.call(this);\n    } else {\n      this.plugins.image.setSize.call(this, w, h, false);\n    }\n\n    return false;\n  },\n\n  /**\n   * @Override resizing\n   */\n  sizeRevert: function sizeRevert() {\n    this.plugins.resizing._module_sizeRevert.call(this, this.context.image);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setSize: function setSize(w, h, notResetPercentage, direction) {\n    var contextImage = this.context.image;\n    var onlyW = /^(rw|lw)$/.test(direction) && /\\d+/.test(contextImage._element.style.height);\n    var onlyH = /^(th|bh)$/.test(direction) && /\\d+/.test(contextImage._element.style.width);\n\n    if (!onlyH) {\n      contextImage._element.style.width = this.util.isNumber(w) ? w + contextImage.sizeUnit : w;\n      this.plugins.image.cancelPercentAttr.call(this);\n    }\n\n    if (!onlyW) {\n      contextImage._element.style.height = this.util.isNumber(h) ? h + contextImage.sizeUnit : /%$/.test(h) ? '' : h;\n    }\n\n    if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n    if (!notResetPercentage) contextImage._element.removeAttribute('data-percentage'); // save current size\n\n    this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setAutoSize: function setAutoSize() {\n    var contextImage = this.context.image;\n    if (contextImage._caption) contextImage._caption.style.marginTop = '';\n    this.plugins.resizing.resetTransform.call(this, contextImage._element);\n    this.plugins.image.cancelPercentAttr.call(this);\n    contextImage._element.style.maxWidth = '';\n    contextImage._element.style.width = '';\n    contextImage._element.style.height = '';\n    contextImage._cover.style.width = '';\n    contextImage._cover.style.height = '';\n    this.plugins.image.setAlign.call(this, null, null, null, null);\n\n    contextImage._element.setAttribute('data-percentage', 'auto,auto'); // save current size\n\n\n    this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setOriginSize: function setOriginSize() {\n    var contextImage = this.context.image;\n\n    contextImage._element.removeAttribute('data-percentage');\n\n    this.plugins.resizing.resetTransform.call(this, contextImage._element);\n    this.plugins.image.cancelPercentAttr.call(this);\n    var originSize = (contextImage._element.getAttribute('data-origin') || '').split(',');\n    var w = originSize[0];\n    var h = originSize[1];\n\n    if (originSize) {\n      if (contextImage._onlyPercentage || /%$/.test(w) && (/%$/.test(h) || !/\\d/.test(h))) {\n        this.plugins.image.setPercentSize.call(this, w, h);\n      } else {\n        this.plugins.image.setSize.call(this, w, h);\n      } // save current size\n\n\n      this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n    }\n  },\n\n  /**\n   * @Override resizing\n   */\n  setPercentSize: function setPercentSize(w, h) {\n    var contextImage = this.context.image;\n    h = !!h && !/%$/.test(h) && !this.util.getNumber(h, 0) ? this.util.isNumber(h) ? h + '%' : h : this.util.isNumber(h) ? h + contextImage.sizeUnit : h || '';\n    var heightPercentage = /%$/.test(h);\n    contextImage._container.style.width = this.util.isNumber(w) ? w + '%' : w;\n    contextImage._container.style.height = '';\n    contextImage._cover.style.width = '100%';\n    contextImage._cover.style.height = !heightPercentage ? '' : h;\n    contextImage._element.style.width = '100%';\n    contextImage._element.style.height = heightPercentage ? '' : h;\n    contextImage._element.style.maxWidth = '';\n    if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n\n    contextImage._element.setAttribute('data-percentage', w + ',' + h);\n\n    this.plugins.resizing.setCaptionPosition.call(this, contextImage._element); // save current size\n\n    this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n  },\n\n  /**\n   * @Override resizing\n   */\n  cancelPercentAttr: function cancelPercentAttr() {\n    var contextImage = this.context.image;\n    contextImage._cover.style.width = '';\n    contextImage._cover.style.height = '';\n    contextImage._container.style.width = '';\n    contextImage._container.style.height = '';\n    this.util.removeClass(contextImage._container, this.context.image._floatClassRegExp);\n    this.util.addClass(contextImage._container, '__se__float-' + contextImage._align);\n    if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setAlign: function setAlign(align, element, cover, container) {\n    var contextImage = this.context.image;\n    if (!align) align = contextImage._align;\n    if (!element) element = contextImage._element;\n    if (!cover) cover = contextImage._cover;\n    if (!container) container = contextImage._container;\n\n    if (align && align !== 'none') {\n      cover.style.margin = 'auto';\n    } else {\n      cover.style.margin = '0';\n    }\n\n    if (/%$/.test(element.style.width) && align === 'center') {\n      container.style.minWidth = '100%';\n      cover.style.width = container.style.width;\n    } else {\n      container.style.minWidth = '';\n      cover.style.width = this.context.resizing._rotateVertical ? element.style.height || element.offsetHeight : !element.style.width || element.style.width === 'auto' ? '' : element.style.width || '100%';\n    }\n\n    if (!this.util.hasClass(container, '__se__float-' + align)) {\n      this.util.removeClass(container, contextImage._floatClassRegExp);\n      this.util.addClass(container, '__se__float-' + align);\n    }\n\n    element.setAttribute('data-align', align);\n  },\n\n  /**\n   * @Override dialog\n   */\n  init: function init() {\n    var contextImage = this.context.image;\n    if (contextImage.imgInputFile) contextImage.imgInputFile.value = '';\n    if (contextImage.imgUrlFile) contextImage._v_src._linkValue = contextImage.previewSrc.textContent = contextImage.imgUrlFile.value = '';\n\n    if (contextImage.imgInputFile && contextImage.imgUrlFile) {\n      contextImage.imgUrlFile.removeAttribute('disabled');\n      contextImage.previewSrc.style.textDecoration = '';\n    }\n\n    contextImage.altText.value = '';\n    contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"][value=\"none\"]').checked = true;\n    contextImage.captionCheckEl.checked = false;\n    contextImage._element = null;\n    this.plugins.image.openTab.call(this, 'init');\n\n    if (contextImage._resizing) {\n      contextImage.inputX.value = this.options.imageWidth === contextImage._defaultSizeX ? '' : this.options.imageWidth;\n      contextImage.inputY.value = this.options.imageHeight === contextImage._defaultSizeY ? '' : this.options.imageHeight;\n      contextImage.proportion.checked = true;\n      contextImage._ratio = false;\n      contextImage._ratioX = 1;\n      contextImage._ratioY = 1;\n    }\n\n    this.plugins.anchor.init.call(this, contextImage.anchorCtx);\n  }\n};","map":{"version":3,"names":["dialog","anchor","component","resizing","fileManager","name","display","add","core","addModule","options","context","contextImage","image","_infoList","_infoIndex","_uploadFileLength","focusElement","sizeUnit","_imageSizeUnit","_linkElement","_altText","_align","_floatClassRegExp","_v_src","_linkValue","svgDefaultSize","base64RenderIndex","_element","_cover","_container","inputX","inputY","_element_w","_element_h","_element_l","_element_t","_defaultSizeX","_defaultSizeY","_origin_w","imageWidth","_origin_h","imageHeight","_proportionChecked","_resizing","imageResizing","_resizeDotHide","imageHeightShow","_rotation","imageRotation","_alignHide","imageAlignShow","_onlyPercentage","imageSizeOnlyPercentage","_ratio","_ratioX","_ratioY","_captionShow","_captionChecked","_caption","captionCheckEl","image_dialog","setDialog","modal","imgInputFile","querySelector","imgUrlFile","altText","previewSrc","addEventListener","openTab","bind","submit","_removeSelectedFiles","_onLinkPreview","linkProtocol","_fileInputChange","imageGalleryButton","_openGallery","proportion","value","setInputSize","setRatio","sizeRevert","appendChild","plugins","initEvent","call","anchorCtx","caller","option","lang","util","createElement","className","style","html","dialogBox","close","icons","cancel","imageBox","title","toolbar","link","imageFileInput","file","imageAccept","imageMultipleFile","controller","remove","imageUrlInput","url","imageGalleryUrl","imageGallery","image_gallery","onlyPercentage","onlyPercentDisplay","heightDisplay","size","width","height","revertButton","revert","caption","forms","innerHTML","basic","left","center","right","submitButton","removeAttribute","textDecoration","setAttribute","urlInput","callPlugin","open","_setUrlInput","target","alt","textContent","src","focus","protocol","e","trim","indexOf","fileTags","select","element","onModifyMode","call_controller_resize","destroy","imageEl","imageContainer","getParentElement","isMediaComponent","dataIndex","getAttribute","focusEl","previousElementSibling","nextElementSibling","emptyDiv","parentNode","removeItem","init","controllersOff","wysiwyg","removeItemAllParents","current","childNodes","length","focusEdge","deleteInfo","functions","onImageUpload","history","push","on","update","currentControllerName","targetElement","test","tagName","tabName","contentClassName","i","tabContent","tabLinks","getElementsByClassName","removeClass","addClass","imagePlugin","preventDefault","stopPropagation","checked","updateModal","update_image","files","showLoading","submitAction","onRender_imgUrl","error","closeLoading","Error","message","fileList","fileSize","len","type","limitSize","imageUploadSizeLimit","infoSize","imagesInfo","err","onImageUploadError","noticeOpen","createAnchor","info","inputWidth","inputHeight","align","isUpdate","onImageUploadBefore","result","data","_w","Array","isArray","register","upload","response","imageUploadUrl","filesLen","formData","FormData","append","imageUploadHeader","callBack_imgUpload","setup_reader","xmlHttp","imageUploadHandler","JSON","parse","responseText","errorMessage","update_src","create_image","wFileReader","FileReader","filesStack","reader","onload","updateElement","index","onRender_imgBase64","readAsDataURL","updateMethod","createMethod","split","pop","onRender_link","imgTag","href","xy","keyCode","_module_setInputSize","_module_setRatio","checkFileInfo","modifyHandler","tag","openModify","format","getFormatElement","textAlign","float","isAnchor","linkValue","checkInfo","resetFileInfo","resetInfo","_resize_plugin","oImg","cloneNode","cover","set_cover","container","set_container","create_caption","applySize","setAlign","_image_create_onload","insertComponent","setInfo","offsetWidth","mediaAutoSelect","selectComponent","line","appendFormatTag","setRange","openController","notHistoryPush","isNewContainer","changeSize","x","isNumber","y","modifiedCaption","insertBefore","imageElement","contains","newEl","removeChild","existElement","isRangeFormatElement","isWysiwygDiv","nodeName","isListCell","refer","removeEmptyNode","isFormatElement","splitElement","children","htmlRemoveWhiteSpace","formats","previousSibling","replaceChild","_rotateVertical","resetTransform","setTransformSize","getNumber","setTimeout","linkAnchor","getChildElement","setCtx","w","h","t","l","userSize","notOpen","_module_setModifyInputSize","setPercentSize","setAutoSize","setSize","_module_sizeRevert","notResetPercentage","direction","onlyW","onlyH","cancelPercentAttr","_module_saveCurrentSize","marginTop","maxWidth","setOriginSize","originSize","heightPercentage","setCaptionPosition","margin","minWidth","offsetHeight","hasClass"],"sources":["/Users/jirayuyungmeesuk/Desktop/code/client/node_modules/suneditor/src/plugins/dialog/image.js"],"sourcesContent":["/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport anchor from '../modules/_anchor';\nimport component from '../modules/component';\nimport resizing from '../modules/resizing';\nimport fileManager from '../modules/fileManager';\n\nexport default {\n    name: 'image',\n    display: 'dialog',\n    add: function (core) {\n        core.addModule([dialog, anchor, component, resizing, fileManager]);\n        \n        const options = core.options;\n        const context = core.context;\n        const contextImage = context.image = {\n            _infoList: [], // @Override fileManager\n            _infoIndex: 0, // @Override fileManager\n            _uploadFileLength: 0, // @Override fileManager\n            focusElement: null, // @Override dialog // This element has focus when the dialog is opened.\n            sizeUnit: options._imageSizeUnit,\n            _linkElement: '',\n            _altText: '',\n            _align: 'none',\n            _floatClassRegExp: '__se__float\\\\-[a-z]+',\n            _v_src: {_linkValue: ''},\n            svgDefaultSize: '30%',\n            base64RenderIndex: 0,\n            // @require @Override component\n            _element: null,\n            _cover: null,\n            _container: null,\n            // @Override resizing properties\n            inputX: null,\n            inputY: null,\n            _element_w: 1,\n            _element_h: 1,\n            _element_l: 0,\n            _element_t: 0,\n            _defaultSizeX: 'auto',\n            _defaultSizeY: 'auto',\n            _origin_w: options.imageWidth === 'auto' ? '' : options.imageWidth,\n            _origin_h: options.imageHeight === 'auto' ? '' : options.imageHeight,\n            _proportionChecked: true,\n            _resizing: options.imageResizing,\n            _resizeDotHide: !options.imageHeightShow,\n            _rotation: options.imageRotation,\n            _alignHide: !options.imageAlignShow,\n            _onlyPercentage: options.imageSizeOnlyPercentage,\n            _ratio: false,\n            _ratioX: 1,\n            _ratioY: 1,\n            _captionShow: true,\n            _captionChecked: false,\n            _caption: null,\n            captionCheckEl: null\n        };\n\n        /** image dialog */\n        let image_dialog = this.setDialog(core);\n        contextImage.modal = image_dialog;\n        contextImage.imgInputFile = image_dialog.querySelector('._se_image_file');\n        contextImage.imgUrlFile = image_dialog.querySelector('._se_image_url');\n        contextImage.focusElement = contextImage.imgInputFile || contextImage.imgUrlFile;\n        contextImage.altText = image_dialog.querySelector('._se_image_alt');\n        contextImage.captionCheckEl = image_dialog.querySelector('._se_image_check_caption');\n        contextImage.previewSrc = image_dialog.querySelector('._se_tab_content_image .se-link-preview');\n\n        /** add event listeners */\n        image_dialog.querySelector('.se-dialog-tabs').addEventListener('click', this.openTab.bind(core));\n        image_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n        if (contextImage.imgInputFile) image_dialog.querySelector('.se-file-remove').addEventListener('click', this._removeSelectedFiles.bind(contextImage.imgInputFile, contextImage.imgUrlFile, contextImage.previewSrc));\n        if (contextImage.imgUrlFile) contextImage.imgUrlFile.addEventListener('input', this._onLinkPreview.bind(contextImage.previewSrc, contextImage._v_src, options.linkProtocol));\n        if (contextImage.imgInputFile && contextImage.imgUrlFile) contextImage.imgInputFile.addEventListener('change', this._fileInputChange.bind(contextImage));\n\n        const imageGalleryButton = image_dialog.querySelector('.__se__gallery');\n        if (imageGalleryButton) imageGalleryButton.addEventListener('click', this._openGallery.bind(core));\n        \n        contextImage.proportion = {};\n        contextImage.inputX = {};\n        contextImage.inputY = {};\n        if (options.imageResizing) {\n            contextImage.proportion = image_dialog.querySelector('._se_image_check_proportion');\n            contextImage.inputX = image_dialog.querySelector('._se_image_size_x');\n            contextImage.inputY = image_dialog.querySelector('._se_image_size_y');\n            contextImage.inputX.value = options.imageWidth;\n            contextImage.inputY.value = options.imageHeight;\n            \n            contextImage.inputX.addEventListener('keyup', this.setInputSize.bind(core, 'x'));\n            contextImage.inputY.addEventListener('keyup', this.setInputSize.bind(core, 'y'));\n\n            contextImage.inputX.addEventListener('change', this.setRatio.bind(core));\n            contextImage.inputY.addEventListener('change', this.setRatio.bind(core));\n            contextImage.proportion.addEventListener('change', this.setRatio.bind(core));\n            \n            image_dialog.querySelector('.se-dialog-btn-revert').addEventListener('click', this.sizeRevert.bind(core));\n        }\n\n        /** append html */\n        context.dialog.modal.appendChild(image_dialog);\n\n        /** link event */\n        core.plugins.anchor.initEvent.call(core, 'image', image_dialog.querySelector('._se_tab_content_url'));\n        contextImage.anchorCtx = core.context.anchor.caller.image;\n\n        /** empty memory */\n        image_dialog = null;\n    },\n\n    /** dialog */\n    setDialog: function (core) {\n        const option = core.options;\n        const lang = core.lang;\n        const dialog = core.util.createElement('DIV');\n\n        dialog.className = 'se-dialog-content se-dialog-image';\n        dialog.style.display = 'none';\n\n        let html = '' +\n            '<div class=\"se-dialog-header\">' +\n                '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" class=\"close\" title=\"' + lang.dialogBox.close + '\" aria-label=\"' + lang.dialogBox.close + '\">' +\n                    core.icons.cancel +\n                '</button>' +\n                '<span class=\"se-modal-title\">' + lang.dialogBox.imageBox.title + '</span>' +\n            '</div>' +\n            '<div class=\"se-dialog-tabs\">' +\n                '<button type=\"button\" class=\"_se_tab_link active\" data-tab-link=\"image\">' + lang.toolbar.image + '</button>' +\n                '<button type=\"button\" class=\"_se_tab_link\" data-tab-link=\"url\">' + lang.toolbar.link + '</button>' +\n            '</div>' +\n            '<form method=\"post\" enctype=\"multipart/form-data\">' +\n                '<div class=\"_se_tab_content _se_tab_content_image\">' +\n                    '<div class=\"se-dialog-body\"><div style=\"border-bottom: 1px dashed #ccc;\">';\n                    \n                    if (option.imageFileInput) {\n                        html += '' +\n                            '<div class=\"se-dialog-form\">' +\n                                '<label>' + lang.dialogBox.imageBox.file + '</label>' +\n                                '<div class=\"se-dialog-form-files\">' +\n                                    '<input class=\"se-input-form _se_image_file\" type=\"file\" accept=\"' + option.imageAccept + '\"' + (option.imageMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' +\n                                    '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\" aria-label=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' +\n                                '</div>' +\n                            '</div>' ;\n                    }\n        \n                    if (option.imageUrlInput) {\n                        html += '' +\n                            '<div class=\"se-dialog-form\">' +\n                                '<label>' + lang.dialogBox.imageBox.url + '</label>' +\n                                '<div class=\"se-dialog-form-files\">' +\n                                    '<input class=\"se-input-form se-input-url _se_image_url\" type=\"text\" />' +\n                                    ((option.imageGalleryUrl && core.plugins.imageGallery) ? '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button __se__gallery\" title=\"' + lang.toolbar.imageGallery + '\" aria-label=\"' + lang.toolbar.imageGallery + '\">' + core.icons.image_gallery + '</button>' : '') +\n                                '</div>' +\n                                '<pre class=\"se-link-preview\"></pre>' +\n                            '</div>';\n                    }\n        \n                    html += '</div>' +\n                        '<div class=\"se-dialog-form\">' +\n                            '<label>' + lang.dialogBox.imageBox.altText + '</label><input class=\"se-input-form _se_image_alt\" type=\"text\" />' +\n                        '</div>';\n\n            if (option.imageResizing) {\n                const onlyPercentage = option.imageSizeOnlyPercentage;\n                const onlyPercentDisplay = onlyPercentage ? ' style=\"display: none !important;\"' : '';\n                const heightDisplay = !option.imageHeightShow ? ' style=\"display: none !important;\"' : '';\n                html += '<div class=\"se-dialog-form\">';\n                        if (onlyPercentage || !option.imageHeightShow) {\n                            html += '' +\n                            '<div class=\"se-dialog-size-text\">' +\n                                '<label class=\"size-w\">' + lang.dialogBox.size + '</label>' +\n                            '</div>';\n                        } else {\n                            html += '' +\n                            '<div class=\"se-dialog-size-text\">' +\n                                '<label class=\"size-w\">' + lang.dialogBox.width + '</label>' +\n                                '<label class=\"se-dialog-size-x\">&nbsp;</label>' +\n                                '<label class=\"size-h\">' + lang.dialogBox.height + '</label>' +\n                            '</div>';\n                        }\n                        html += '' +\n                            '<input class=\"se-input-control _se_image_size_x\" placeholder=\"auto\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + ' />' +\n                            '<label class=\"se-dialog-size-x\"' + heightDisplay + '>' + (onlyPercentage ? '%' : 'x') + '</label>' +\n                            '<input type=\"text\" class=\"se-input-control _se_image_size_y\" placeholder=\"auto\"' + onlyPercentDisplay + (onlyPercentage ? ' max=\"100\"' : '') + heightDisplay + '/>' +\n                            '<label' + onlyPercentDisplay + heightDisplay + '><input type=\"checkbox\" class=\"se-dialog-btn-check _se_image_check_proportion\" checked/>&nbsp;' + lang.dialogBox.proportion + '</label>' +\n                            '<button type=\"button\" title=\"' + lang.dialogBox.revertButton + '\" aria-label=\"' + lang.dialogBox.revertButton + '\" class=\"se-btn se-dialog-btn-revert\" style=\"float: right;\">' + core.icons.revert + '</button>' +\n                        '</div>' ;\n            }\n\n            html += '' +\n                        '<div class=\"se-dialog-form se-dialog-form-footer\">' +\n                            '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_image_check_caption\" />&nbsp;' + lang.dialogBox.caption + '</label>' +\n                        '</div>' +\n                    '</div>' +\n                '</div>' +\n                '<div class=\"_se_tab_content _se_tab_content_url\" style=\"display: none\">' +\n                    core.context.anchor.forms.innerHTML +\n                '</div>' +\n                '<div class=\"se-dialog-footer\">' +\n                    '<div' + (option.imageAlignShow ? '' : ' style=\"display: none\"') + '>' +\n                        '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"none\" checked>' + lang.dialogBox.basic + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"left\">' + lang.dialogBox.left + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"center\">' + lang.dialogBox.center + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"right\">' + lang.dialogBox.right + '</label>' +\n                    '</div>' +\n                    '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\" aria-label=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' +\n                '</div>' +\n            '</form>';\n\n        dialog.innerHTML = html;\n\n        return dialog;\n    },\n\n    _fileInputChange: function () {\n        if (!this.imgInputFile.value) {\n            this.imgUrlFile.removeAttribute('disabled');\n            this.previewSrc.style.textDecoration = '';\n        } else {\n            this.imgUrlFile.setAttribute('disabled', true);\n            this.previewSrc.style.textDecoration = 'line-through';\n        }\n    },\n\n    _removeSelectedFiles: function (urlInput, previewSrc) {\n        this.value = '';\n        if (urlInput) {\n            urlInput.removeAttribute('disabled');\n            previewSrc.style.textDecoration = '';\n        }\n    },\n\n    _openGallery: function () {\n        this.callPlugin('imageGallery', this.plugins.imageGallery.open.bind(this, this.plugins.image._setUrlInput.bind(this.context.image)), null);\n    },\n\n    _setUrlInput: function (target) {\n        this.altText.value = target.alt;\n        this._v_src._linkValue = this.previewSrc.textContent = this.imgUrlFile.value = target.src;\n        this.imgUrlFile.focus();\n    },\n\n    _onLinkPreview: function (context, protocol, e) {\n        const value = e.target.value.trim();\n        context._linkValue = this.textContent = !value ? '' : (protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0) ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n    },\n\n    /**\n     * @Override @Required fileManager\n     */\n    fileTags: ['img'],\n\n    /**\n     * @Override core, fileManager, resizing\n     * @description It is called from core.selectComponent.\n     * @param {Element} element Target element\n     */\n    select: function (element) {\n        this.plugins.image.onModifyMode.call(this, element, this.plugins.resizing.call_controller_resize.call(this, element, 'image'));\n    },\n\n    /**\n     * @Override fileManager, resizing\n     */\n    destroy: function (element) {\n        const imageEl = element || this.context.image._element;\n        const imageContainer = this.util.getParentElement(imageEl, this.util.isMediaComponent) || imageEl;\n        const dataIndex = imageEl.getAttribute('data-index') * 1;\n        let focusEl = (imageContainer.previousElementSibling || imageContainer.nextElementSibling);\n        \n        const emptyDiv = imageContainer.parentNode;\n        this.util.removeItem(imageContainer);\n        this.plugins.image.init.call(this);\n        this.controllersOff();\n\n        if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) { return current.childNodes.length === 0; }, null);\n\n        // focus\n        this.focusEdge(focusEl);\n        \n        // event\n        this.plugins.fileManager.deleteInfo.call(this, 'image', dataIndex, this.functions.onImageUpload);\n\n        // history stack\n        this.history.push(false);\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    on: function (update) {\n        const contextImage = this.context.image;\n        \n        if (!update) {\n            contextImage.inputX.value = contextImage._origin_w = this.options.imageWidth === contextImage._defaultSizeX ? '' : this.options.imageWidth;\n            contextImage.inputY.value = contextImage._origin_h = this.options.imageHeight === contextImage._defaultSizeY ? '' : this.options.imageHeight;\n            if (contextImage.imgInputFile && this.options.imageMultipleFile) contextImage.imgInputFile.setAttribute('multiple', 'multiple');\n        } else {\n            if (contextImage.imgInputFile && this.options.imageMultipleFile) contextImage.imgInputFile.removeAttribute('multiple');\n        }\n        this.plugins.anchor.on.call(this, contextImage.anchorCtx, update);\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    open: function () {\n        this.plugins.dialog.open.call(this, 'image', 'image' === this.currentControllerName);\n    },\n\n    openTab: function (e) {\n        const modal = this.context.image.modal;\n        const targetElement = (e === 'init' ? modal.querySelector('._se_tab_link') : e.target);\n\n        if (!/^BUTTON$/i.test(targetElement.tagName)) {\n            return false;\n        }\n\n        // Declare all variables\n        const tabName = targetElement.getAttribute('data-tab-link');\n        const contentClassName = '_se_tab_content';\n        let i, tabContent, tabLinks;\n\n        // Get all elements with class=\"tabcontent\" and hide them\n        tabContent = modal.getElementsByClassName(contentClassName);\n        for (i = 0; i < tabContent.length; i++) {\n            tabContent[i].style.display = 'none';\n        }\n\n        // Get all elements with class=\"tablinks\" and remove the class \"active\"\n        tabLinks = modal.getElementsByClassName('_se_tab_link');\n        for (i = 0; i < tabLinks.length; i++) {\n            this.util.removeClass(tabLinks[i], 'active');\n        }\n\n        // Show the current tab, and add an \"active\" class to the button that opened the tab\n        modal.querySelector('.' + contentClassName + '_' + tabName).style.display = 'block';\n        this.util.addClass(targetElement, 'active');\n\n        // focus\n        if (tabName === 'image' && this.context.image.focusElement) {\n            this.context.image.focusElement.focus();\n        } else if (tabName === 'url') {\n            this.context.anchor.caller.image.urlInput.focus();\n        }\n\n        return false;\n    },\n\n    submit: function (e) {\n        const contextImage = this.context.image;\n        const imagePlugin = this.plugins.image;\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        contextImage._altText = contextImage.altText.value;\n        contextImage._align = contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"]:checked').value;\n        contextImage._captionChecked = contextImage.captionCheckEl.checked;\n        if (contextImage._resizing) contextImage._proportionChecked = contextImage.proportion.checked;\n\n        try {\n            if (this.context.dialog.updateModal) {\n                imagePlugin.update_image.call(this, false, true, false);\n            }\n            \n            if (contextImage.imgInputFile && contextImage.imgInputFile.files.length > 0) {\n                this.showLoading();\n                imagePlugin.submitAction.call(this, this.context.image.imgInputFile.files);\n            } else if (contextImage.imgUrlFile && contextImage._v_src._linkValue.length > 0) {\n                this.showLoading();\n                imagePlugin.onRender_imgUrl.call(this, contextImage._v_src._linkValue);\n            }\n        } catch (error) {\n            this.closeLoading();\n            throw Error('[SUNEDITOR.image.submit.fail] cause : \"' + error.message + '\"');\n        } finally {\n            this.plugins.dialog.close.call(this);\n        }\n\n        return false;\n    },\n\n    submitAction: function (fileList) {\n        if (fileList.length === 0) return;\n\n        let fileSize = 0;\n        let files = [];\n        for (let i = 0, len = fileList.length; i < len; i++) {\n            if (/image/i.test(fileList[i].type)) {\n                files.push(fileList[i]);\n                fileSize += fileList[i].size;\n            }\n        }\n\n        const limitSize = this.options.imageUploadSizeLimit;\n        if (limitSize > 0) {\n            let infoSize = 0;\n            const imagesInfo = this.context.image._infoList;\n            for (let i = 0, len = imagesInfo.length; i < len; i++) {\n                infoSize += imagesInfo[i].size * 1;\n            }\n\n            if ((fileSize + infoSize) > limitSize) {\n                this.closeLoading();\n                const err = '[SUNEDITOR.imageUpload.fail] Size of uploadable total images: ' + (limitSize/1000) + 'KB';\n                if (typeof this.functions.onImageUploadError !== 'function' || this.functions.onImageUploadError(err, { 'limitSize': limitSize, 'currentSize': infoSize, 'uploadSize': fileSize }, this)) {\n                    this.functions.noticeOpen(err);\n                }\n                return;\n            }\n        }\n\n        const contextImage = this.context.image;\n        contextImage._uploadFileLength = files.length;\n        \n        const anchor = this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true);\n        const info = {\n            anchor: anchor,\n            inputWidth: contextImage.inputX.value,\n            inputHeight: contextImage.inputY.value,\n            align: contextImage._align,\n            isUpdate: this.context.dialog.updateModal,\n            alt: contextImage._altText,\n            element: contextImage._element\n        };\n\n        if (typeof this.functions.onImageUploadBefore === 'function') {\n            const result = this.functions.onImageUploadBefore(files, info, this, function (data) {\n                if (data && this._w.Array.isArray(data.result)) {\n                    this.plugins.image.register.call(this, info, data);\n                } else {\n                    this.plugins.image.upload.call(this, info, data);\n                }\n            }.bind(this));\n            \n            if (typeof result === 'undefined') return;\n            if (!result) {\n                this.closeLoading();\n                return;\n            }\n            if (this._w.Array.isArray(result) && result.length > 0) files = result;\n        }\n\n        this.plugins.image.upload.call(this, info, files);\n    },\n\n    error: function (message, response) {\n        this.closeLoading();\n        if (typeof this.functions.onImageUploadError !== 'function' || this.functions.onImageUploadError(message, response, this)) {\n            this.functions.noticeOpen(message);\n            throw Error('[SUNEDITOR.plugin.image.error] response: ' + message);\n        }\n    },\n\n    upload: function (info, files) {\n        if (!files) {\n            this.closeLoading();\n            return;\n        }\n        if (typeof files === 'string') {\n            this.plugins.image.error.call(this, files, null);\n            return;\n        }\n\n        const imageUploadUrl = this.options.imageUploadUrl;\n        const filesLen = this.context.dialog.updateModal ? 1 : files.length;\n\n        // server upload\n        if (typeof imageUploadUrl === 'string' && imageUploadUrl.length > 0) {\n            const formData = new FormData();\n            for (let i = 0; i < filesLen; i++) {\n                formData.append('file-' + i, files[i]);\n            }\n            this.plugins.fileManager.upload.call(this, imageUploadUrl, this.options.imageUploadHeader, formData, this.plugins.image.callBack_imgUpload.bind(this, info), this.functions.onImageUploadError);\n        } else { // base64\n            this.plugins.image.setup_reader.call(this, files, info.anchor, info.inputWidth, info.inputHeight, info.align, info.alt, filesLen, info.isUpdate);\n        }\n    },\n\n    callBack_imgUpload: function (info, xmlHttp) {\n        if (typeof this.functions.imageUploadHandler === 'function') {\n            this.functions.imageUploadHandler(xmlHttp, info, this);\n        } else {\n            const response = JSON.parse(xmlHttp.responseText);\n            if (response.errorMessage) {\n                this.plugins.image.error.call(this, response.errorMessage, response);\n            } else {\n                this.plugins.image.register.call(this, info, response);\n            }\n        }\n    },\n\n    register: function (info, response) {\n        const fileList = response.result;\n\n        for (let i = 0, len = fileList.length, file; i < len; i++) {\n            file = { name: fileList[i].name, size: fileList[i].size };\n            if (info.isUpdate) {\n                this.plugins.image.update_src.call(this, fileList[i].url, info.element, file);\n                break;\n            } else {\n                this.plugins.image.create_image.call(this, fileList[i].url, info.anchor, info.inputWidth, info.inputHeight, info.align, file, info.alt);\n            }\n        }\n        \n        this.closeLoading();\n    },\n\n    setup_reader: function (files, anchor, width, height, align, alt, filesLen, isUpdate) {\n        try {\n            this.context.image.base64RenderIndex = filesLen;\n            const wFileReader = this._w.FileReader;\n            const filesStack = [filesLen];\n            this.context.image.inputX.value = width;\n            this.context.image.inputY.value = height;\n    \n            for (let i = 0, reader, file; i < filesLen; i++) {\n                reader = new wFileReader();\n                file = files[i];\n    \n                reader.onload = function (reader, update, updateElement, file, index) {\n                    filesStack[index] = { result: reader.result, file: file };\n\n                    if (--this.context.image.base64RenderIndex === 0) {\n                        this.plugins.image.onRender_imgBase64.call(this, update, filesStack, updateElement, anchor, width, height, align, alt);\n                        this.closeLoading();\n                    }\n                }.bind(this, reader, isUpdate, this.context.image._element, file, i);\n\n                reader.readAsDataURL(file);\n            }\n        } catch (e) {\n            this.closeLoading();\n            throw Error('[SUNEDITOR.image.setup_reader.fail] cause : \"' + e.message + '\"');\n        }\n    },\n\n    onRender_imgBase64: function (update, filesStack, updateElement, anchor, width, height, align, alt) {\n        const updateMethod = this.plugins.image.update_src;\n        const createMethod = this.plugins.image.create_image;\n        \n        for (let i = 0, len = filesStack.length; i < len; i++) {\n            if (update) {\n                this.context.image._element.setAttribute('data-file-name', filesStack[i].file.name);\n                this.context.image._element.setAttribute('data-file-size', filesStack[i].file.size);\n                updateMethod.call(this, filesStack[i].result, updateElement, filesStack[i].file);\n            } else {\n                createMethod.call(this, filesStack[i].result, anchor, width, height, align, filesStack[i].file, alt);\n            }\n        }\n    },\n\n    onRender_imgUrl: function (url) {\n        if (!url) url = this.context.image._v_src._linkValue;\n        if (!url) return false;\n        const contextImage = this.context.image;\n\n        try {\n            const file = {name: url.split('/').pop(), size: 0};\n            if (this.context.dialog.updateModal) this.plugins.image.update_src.call(this, url, contextImage._element, file);\n            else this.plugins.image.create_image.call(this, url, this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true), contextImage.inputX.value, contextImage.inputY.value, contextImage._align, file, contextImage._altText);\n        } catch (e) {\n            throw Error('[SUNEDITOR.image.URLRendering.fail] cause : \"' + e.message + '\"');\n        } finally {\n            this.closeLoading();\n        }\n    },\n\n    onRender_link: function (imgTag, anchor) {\n        if (anchor) {\n            anchor.setAttribute('data-image-link', 'image');\n            imgTag.setAttribute('data-image-link', anchor.href);\n            anchor.appendChild(imgTag);\n            return anchor;\n        }\n\n        return imgTag;\n    },\n\n    /**\n     * @Override resizing\n     * @param {String} xy 'x': width, 'y': height\n     * @param {KeyboardEvent} e Event object\n     */\n    setInputSize: function (xy, e) {\n        if (e && e.keyCode === 32) {\n            e.preventDefault();\n            return;\n        }\n\n        this.plugins.resizing._module_setInputSize.call(this, this.context.image, xy);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setRatio: function () {\n        this.plugins.resizing._module_setRatio.call(this, this.context.image);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    checkFileInfo: function () {\n        const imagePlugin = this.plugins.image;\n        const contextImage = this.context.image;\n\n        const modifyHandler = function (tag) {\n            imagePlugin.onModifyMode.call(this, tag, null);\n            imagePlugin.openModify.call(this, true);\n            // get size\n            contextImage.inputX.value = contextImage._origin_w;\n            contextImage.inputY.value = contextImage._origin_h;\n            // get align\n            const format = this.util.getFormatElement(tag);\n            if (format) contextImage._align = format.style.textAlign || format.style.float;\n            // link\n            const link = this.util.getParentElement(tag, this.util.isAnchor);\n            if (link && !contextImage.anchorCtx.linkValue) contextImage.anchorCtx.linkValue = ' ';\n            \n            imagePlugin.update_image.call(this, true, false, true);\n            imagePlugin.init.call(this);\n        }.bind(this);\n\n        this.plugins.fileManager.checkInfo.call(this, 'image', ['img'], this.functions.onImageUpload, modifyHandler, true);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    resetFileInfo: function () {\n        this.plugins.fileManager.resetInfo.call(this, 'image', this.functions.onImageUpload);\n    },\n\n    create_image: function (src, anchor, width, height, align, file, alt) {\n        const imagePlugin = this.plugins.image;\n        const contextImage = this.context.image;\n        this.context.resizing._resize_plugin = 'image';\n\n        let oImg = this.util.createElement('IMG');\n        oImg.src = src;\n        oImg.alt = alt;\n        oImg.setAttribute('data-rotate', '0');\n        anchor = imagePlugin.onRender_link.call(this, oImg, anchor ?  anchor.cloneNode(false) : null);\n\n        if (contextImage._resizing) {\n            oImg.setAttribute('data-proportion', contextImage._proportionChecked);\n        }\n\n        const cover = this.plugins.component.set_cover.call(this, anchor);\n        const container = this.plugins.component.set_container.call(this, cover, 'se-image-container');\n\n        // caption\n        if (contextImage._captionChecked) {\n            contextImage._caption = this.plugins.component.create_caption.call(this);\n            contextImage._caption.setAttribute('contenteditable', false);\n            cover.appendChild(contextImage._caption);\n        }\n\n        contextImage._element = oImg;\n        contextImage._cover = cover;\n        contextImage._container = container;\n\n        // set size\n        imagePlugin.applySize.call(this, width, height);\n\n        // align\n        imagePlugin.setAlign.call(this, align, oImg, cover, container);\n\n        oImg.onload = imagePlugin._image_create_onload.bind(this, oImg, contextImage.svgDefaultSize, container);\n        if (this.insertComponent(container, true, true, true)) this.plugins.fileManager.setInfo.call(this, 'image', oImg, this.functions.onImageUpload, file, true);\n        this.context.resizing._resize_plugin = '';\n    },\n\n    _image_create_onload: function (oImg, svgDefaultSize, container) {\n        // svg exception handling\n        if (oImg.offsetWidth === 0) this.plugins.image.applySize.call(this, svgDefaultSize, '');\n        if (this.options.mediaAutoSelect) {\n            this.selectComponent(oImg, 'image');\n        } else {\n            const line = this.appendFormatTag(container, null);\n            if (line) this.setRange(line, 0, line, 0);\n        }\n    },\n\n    update_image: function (init, openController, notHistoryPush) {\n        const contextImage = this.context.image;\n        let imageEl = contextImage._element;\n        let cover = contextImage._cover;\n        let container = contextImage._container;\n        let isNewContainer = false;\n\n        if (cover === null) {\n            isNewContainer = true;\n            imageEl = contextImage._element.cloneNode(true);\n            cover = this.plugins.component.set_cover.call(this, imageEl);\n        }\n\n        if (container === null) {\n            cover = cover.cloneNode(true);\n            imageEl = cover.querySelector('img');\n            isNewContainer = true;\n            container = this.plugins.component.set_container.call(this, cover, 'se-image-container');\n        } else if (isNewContainer) {\n            container.innerHTML = '';\n            container.appendChild(cover);\n            contextImage._cover = cover;\n            contextImage._element = imageEl;\n            isNewContainer = false;\n        }\n\n        // check size\n        let changeSize;\n        const x = this.util.isNumber(contextImage.inputX.value) ? contextImage.inputX.value + contextImage.sizeUnit : contextImage.inputX.value;\n        const y = this.util.isNumber(contextImage.inputY.value) ? contextImage.inputY.value + contextImage.sizeUnit : contextImage.inputY.value;\n        if (/%$/.test(imageEl.style.width)) {\n            changeSize = x !== container.style.width || y !== container.style.height;\n        } else {\n            changeSize = x !== imageEl.style.width || y !== imageEl.style.height;\n        }\n\n        // alt\n        imageEl.alt = contextImage._altText;\n        \n        // caption\n        let modifiedCaption = false;\n        if (contextImage._captionChecked) {\n            if (!contextImage._caption) {\n                contextImage._caption = this.plugins.component.create_caption.call(this);\n                cover.appendChild(contextImage._caption);\n                modifiedCaption = true;\n            }\n        } else {\n            if (contextImage._caption) {\n                this.util.removeItem(contextImage._caption);\n                contextImage._caption = null;\n                modifiedCaption = true;\n            }\n        }\n\n        // link\n        const anchor = this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true);\n        if (anchor) {\n            if (contextImage._linkElement !== anchor) {\n                contextImage._linkElement = anchor.cloneNode(false);\n                cover.insertBefore(this.plugins.image.onRender_link.call(this, imageEl, contextImage._linkElement), contextImage._caption);\n                this.util.removeItem(anchor);\n            } else {\n                contextImage._linkElement.setAttribute('data-image-link', 'image');\n            }\n        } else if (contextImage._linkElement !== null) {\n            const imageElement = imageEl;\n            imageElement.setAttribute('data-image-link', '');\n            if (cover.contains(contextImage._linkElement)) {\n                const newEl = imageElement.cloneNode(true);\n                cover.removeChild(contextImage._linkElement);\n                cover.insertBefore(newEl, contextImage._caption);\n                contextImage._element = imageEl = newEl;\n            }\n        }\n\n        if (isNewContainer) {\n            let existElement = (this.util.isRangeFormatElement(contextImage._element.parentNode) || this.util.isWysiwygDiv(contextImage._element.parentNode)) ? \n                contextImage._element : \n                /^A$/i.test(contextImage._element.parentNode.nodeName) ? contextImage._element.parentNode : this.util.getFormatElement(contextImage._element) || contextImage._element;\n                \n            if (this.util.isListCell(existElement)) {\n                const refer = this.util.getParentElement(contextImage._element, function (current) { return current.parentNode === existElement; });\n                existElement.insertBefore(container, refer);\n                this.util.removeItem(contextImage._element);\n                this.util.removeEmptyNode(refer, null);\n            } else if (this.util.isFormatElement(existElement)) {\n                const refer = this.util.getParentElement(contextImage._element, function (current) { return current.parentNode === existElement; });\n                existElement = this.util.splitElement(existElement, refer);\n                existElement.parentNode.insertBefore(container, existElement);\n                this.util.removeItem(contextImage._element);\n                this.util.removeEmptyNode(existElement, null);\n                if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n            } else {\n                if (this.util.isFormatElement(existElement.parentNode)) {\n                    const formats = existElement.parentNode;\n                    formats.parentNode.insertBefore(container, existElement.previousSibling ? formats.nextElementSibling : formats);\n                    this.util.removeItem(existElement);\n                } else {\n                    existElement.parentNode.replaceChild(container, existElement);\n                }\n            }\n\n            imageEl = container.querySelector('img');\n\n            contextImage._element = imageEl;\n            contextImage._cover = cover;\n            contextImage._container = container;\n        }\n\n        // transform\n        if (modifiedCaption || (!contextImage._onlyPercentage && changeSize)) {\n            if (!init && (/\\d+/.test(imageEl.style.height) || (this.context.resizing._rotateVertical && contextImage._captionChecked))) {\n                if (/%$/.test(contextImage.inputX.value) || /%$/.test(contextImage.inputY.value)) {\n                    this.plugins.resizing.resetTransform.call(this, imageEl);\n                } else {\n                    this.plugins.resizing.setTransformSize.call(this, imageEl, this.util.getNumber(contextImage.inputX.value, 0), this.util.getNumber(contextImage.inputY.value, 0));\n                }\n            }\n        }\n\n        // size\n        if (contextImage._resizing) {\n            imageEl.setAttribute('data-proportion', contextImage._proportionChecked);\n            if (changeSize) {\n                this.plugins.image.applySize.call(this);\n            }\n        }\n\n        // align\n        this.plugins.image.setAlign.call(this, null, imageEl, null, null);\n\n        // set imagesInfo\n        if (init) {\n            this.plugins.fileManager.setInfo.call(this, 'image', imageEl, this.functions.onImageUpload, null, true);\n        }\n\n        if (openController) {\n            this.selectComponent(imageEl, 'image');\n        }\n\n        // history stack\n        if (!notHistoryPush) this.history.push(false);\n    },\n\n    update_src: function (src, element, file) {\n        element.src = src;\n        this._w.setTimeout(this.plugins.fileManager.setInfo.bind(this, 'image', element, this.functions.onImageUpload, file, true));\n        this.selectComponent(element, 'image');\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    onModifyMode: function (element, size) {\n        if (!element) return;\n        \n        const contextImage = this.context.image;\n        contextImage._linkElement = contextImage.anchorCtx.linkAnchor = /^A$/i.test(element.parentNode.nodeName) ? element.parentNode : null;\n        contextImage._element = element;\n        contextImage._cover = this.util.getParentElement(element, 'FIGURE');\n        contextImage._container = this.util.getParentElement(element, this.util.isMediaComponent);\n        contextImage._caption = this.util.getChildElement(contextImage._cover, 'FIGCAPTION');\n        contextImage._align = element.style.float || element.getAttribute('data-align') || 'none';\n        element.style.float = '';\n        this.plugins.anchor.setCtx(contextImage._linkElement, contextImage.anchorCtx);\n\n        if (size) {\n            contextImage._element_w = size.w;\n            contextImage._element_h = size.h;\n            contextImage._element_t = size.t;\n            contextImage._element_l = size.l;\n        }\n\n        let userSize = contextImage._element.getAttribute('data-size') || contextImage._element.getAttribute('data-origin');\n        let w, h;\n        if (userSize) {\n            userSize = userSize.split(',');\n            w = userSize[0];\n            h = userSize[1];\n        } else if (size) {\n            w = size.w;\n            h = size.h;\n        }\n\n        contextImage._origin_w = w || element.style.width || element.width || '';\n        contextImage._origin_h = h || element.style.height || element.height || '';\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    openModify: function (notOpen) {\n        const contextImage = this.context.image;\n        if (contextImage.imgUrlFile) {\n            contextImage._v_src._linkValue = contextImage.previewSrc.textContent = contextImage.imgUrlFile.value = contextImage._element.src;\n        }\n        contextImage._altText = contextImage.altText.value = contextImage._element.alt;\n        (contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"][value=\"' + contextImage._align + '\"]') || contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"][value=\"none\"]')).checked = true;\n        contextImage._align = contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"]:checked').value;\n        contextImage._captionChecked = contextImage.captionCheckEl.checked = !!contextImage._caption;\n        \n        if (contextImage._resizing) {\n            this.plugins.resizing._module_setModifyInputSize.call(this, contextImage, this.plugins.image);\n        }\n\n        if (!notOpen) this.plugins.dialog.open.call(this, 'image', true);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    applySize: function (w, h) {\n        const contextImage = this.context.image;\n\n        if (!w) w = contextImage.inputX.value || this.options.imageWidth;\n        if (!h) h = contextImage.inputY.value || this.options.imageHeight;\n        \n        if ((contextImage._onlyPercentage && !!w) || /%$/.test(w)) {\n            this.plugins.image.setPercentSize.call(this, w, h);\n            return true;\n        } else if ((!w || w === 'auto') && (!h || h === 'auto')) {\n            this.plugins.image.setAutoSize.call(this);\n        } else {\n            this.plugins.image.setSize.call(this, w, h, false);\n        }\n\n        return false;\n    },\n\n    /**\n     * @Override resizing\n     */\n    sizeRevert: function () {\n        this.plugins.resizing._module_sizeRevert.call(this, this.context.image);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setSize: function (w, h, notResetPercentage, direction) {\n        const contextImage = this.context.image;\n        const onlyW = /^(rw|lw)$/.test(direction) && /\\d+/.test(contextImage._element.style.height);\n        const onlyH = /^(th|bh)$/.test(direction) && /\\d+/.test(contextImage._element.style.width);\n\n        if (!onlyH) {\n            contextImage._element.style.width = this.util.isNumber(w) ? w + contextImage.sizeUnit : w;\n            this.plugins.image.cancelPercentAttr.call(this);\n        }\n        if (!onlyW) {\n            contextImage._element.style.height = this.util.isNumber(h) ? h + contextImage.sizeUnit : /%$/.test(h) ? '' : h;\n        }\n\n        if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n        if (!notResetPercentage) contextImage._element.removeAttribute('data-percentage');\n\n        // save current size\n        this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setAutoSize: function () {\n        const contextImage = this.context.image;\n\n        if (contextImage._caption) contextImage._caption.style.marginTop = '';\n        this.plugins.resizing.resetTransform.call(this, contextImage._element);\n        this.plugins.image.cancelPercentAttr.call(this);\n\n        contextImage._element.style.maxWidth = '';\n        contextImage._element.style.width = '';\n        contextImage._element.style.height = '';\n        contextImage._cover.style.width = '';\n        contextImage._cover.style.height = '';\n\n        this.plugins.image.setAlign.call(this, null, null, null, null);\n        contextImage._element.setAttribute('data-percentage', 'auto,auto');\n\n        // save current size\n        this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n    },\n    \n    /**\n     * @Override resizing\n     */\n    setOriginSize: function () {\n        const contextImage = this.context.image;\n        contextImage._element.removeAttribute('data-percentage');\n\n        this.plugins.resizing.resetTransform.call(this, contextImage._element);\n        this.plugins.image.cancelPercentAttr.call(this);\n\n        const originSize = (contextImage._element.getAttribute('data-origin') || '').split(',');\n        const w = originSize[0];\n        const h = originSize[1];\n\n        if (originSize) {\n            if (contextImage._onlyPercentage || (/%$/.test(w) && (/%$/.test(h) || !/\\d/.test(h)))) {\n                this.plugins.image.setPercentSize.call(this, w, h);\n            } else {\n                this.plugins.image.setSize.call(this, w, h);\n            }\n\n            // save current size\n            this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n        }\n    },\n\n    /**\n     * @Override resizing\n     */\n    setPercentSize: function (w, h) {\n        const contextImage = this.context.image;\n        h = !!h && !/%$/.test(h) && !this.util.getNumber(h, 0) ? this.util.isNumber(h) ? h + '%' : h : this.util.isNumber(h) ? h + contextImage.sizeUnit : (h || '');\n        const heightPercentage = /%$/.test(h);\n\n        contextImage._container.style.width = this.util.isNumber(w) ? w + '%' : w;\n        contextImage._container.style.height = '';\n        contextImage._cover.style.width = '100%';\n        contextImage._cover.style.height = !heightPercentage ? '' : h;\n        contextImage._element.style.width = '100%';\n        contextImage._element.style.height = heightPercentage ? '' : h;\n        contextImage._element.style.maxWidth = '';\n\n        if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n\n        contextImage._element.setAttribute('data-percentage', w + ',' + h);\n        this.plugins.resizing.setCaptionPosition.call(this, contextImage._element);\n\n        // save current size\n        this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n    },\n\n    /**\n     * @Override resizing\n     */\n    cancelPercentAttr: function () {\n        const contextImage = this.context.image;\n        \n        contextImage._cover.style.width = '';\n        contextImage._cover.style.height = '';\n        contextImage._container.style.width = '';\n        contextImage._container.style.height = '';\n\n        this.util.removeClass(contextImage._container, this.context.image._floatClassRegExp);\n        this.util.addClass(contextImage._container, '__se__float-' + contextImage._align);\n\n        if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setAlign: function (align, element, cover, container) {\n        const contextImage = this.context.image;\n        \n        if (!align) align = contextImage._align;\n        if (!element) element = contextImage._element;\n        if (!cover) cover = contextImage._cover;\n        if (!container) container = contextImage._container;\n\n        if (align && align !== 'none') {\n            cover.style.margin = 'auto';\n        } else {\n            cover.style.margin = '0';\n        }\n\n        if (/%$/.test(element.style.width) && align === 'center') {\n            container.style.minWidth = '100%';\n            cover.style.width = container.style.width;\n        } else {\n            container.style.minWidth = '';\n            cover.style.width = this.context.resizing._rotateVertical ? (element.style.height || element.offsetHeight) : ((!element.style.width || element.style.width === 'auto') ? '' : element.style.width || '100%');\n        }\n\n        if (!this.util.hasClass(container, '__se__float-' + align)) {\n            this.util.removeClass(container, contextImage._floatClassRegExp);\n            this.util.addClass(container, '__se__float-' + align);\n        }\n        \n        element.setAttribute('data-align', align);\n    },\n\n    /**\n     * @Override dialog\n     */\n    init: function () {\n        const contextImage = this.context.image;\n        if (contextImage.imgInputFile) contextImage.imgInputFile.value = '';\n        if (contextImage.imgUrlFile) contextImage._v_src._linkValue = contextImage.previewSrc.textContent = contextImage.imgUrlFile.value = '';\n        if (contextImage.imgInputFile && contextImage.imgUrlFile) {\n            contextImage.imgUrlFile.removeAttribute('disabled');\n            contextImage.previewSrc.style.textDecoration = '';\n        }\n\n        contextImage.altText.value = '';\n        contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"][value=\"none\"]').checked = true;\n        contextImage.captionCheckEl.checked = false;\n        contextImage._element = null;\n        this.plugins.image.openTab.call(this, 'init');\n\n        if (contextImage._resizing) {\n            contextImage.inputX.value = this.options.imageWidth === contextImage._defaultSizeX ? '' : this.options.imageWidth;\n            contextImage.inputY.value = this.options.imageHeight === contextImage._defaultSizeY ? '' : this.options.imageHeight;\n            contextImage.proportion.checked = true;\n            contextImage._ratio = false;\n            contextImage._ratioX = 1;\n            contextImage._ratioY = 1;\n        }\n\n        this.plugins.anchor.init.call(this, contextImage.anchorCtx);\n    }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}