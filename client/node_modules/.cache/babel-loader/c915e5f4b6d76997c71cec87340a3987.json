{"ast":null,"code":"/* global document */\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { useEffect, useMemo, useRef, useContext } from 'react';\nimport { applyReactStyle } from '../utils/apply-react-style';\nimport { MapContext } from './map';\nimport { arePointsEqual } from '../utils/deep-equal';\nconst defaultProps = {\n  draggable: false,\n  popup: null,\n  rotation: 0,\n  rotationAlignment: 'auto',\n  pitchAlignment: 'auto'\n};\n/* eslint-disable complexity,max-statements */\n\nfunction Marker(props) {\n  const {\n    map,\n    mapLib\n  } = useContext(MapContext);\n  const thisRef = useRef({\n    props\n  });\n  thisRef.current.props = props;\n  const marker = useMemo(() => {\n    let hasChildren = false;\n    React.Children.forEach(props.children, el => {\n      if (el) {\n        hasChildren = true;\n      }\n    });\n    const options = { ...props,\n      element: hasChildren ? document.createElement('div') : null\n    };\n    const mk = new mapLib.Marker(options).setLngLat([props.longitude, props.latitude]);\n    mk.getElement().addEventListener('click', e => {\n      var _a, _b;\n\n      (_b = (_a = thisRef.current.props).onClick) === null || _b === void 0 ? void 0 : _b.call(_a, {\n        type: 'click',\n        target: mk,\n        originalEvent: e\n      });\n    });\n    mk.on('dragstart', e => {\n      var _a, _b;\n\n      const evt = e;\n      evt.lngLat = marker.getLngLat();\n      (_b = (_a = thisRef.current.props).onDragStart) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n    });\n    mk.on('drag', e => {\n      var _a, _b;\n\n      const evt = e;\n      evt.lngLat = marker.getLngLat();\n      (_b = (_a = thisRef.current.props).onDrag) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n    });\n    mk.on('dragend', e => {\n      var _a, _b;\n\n      const evt = e;\n      evt.lngLat = marker.getLngLat();\n      (_b = (_a = thisRef.current.props).onDragEnd) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n    });\n    return mk;\n  }, []);\n  useEffect(() => {\n    marker.addTo(map.getMap());\n    return () => {\n      marker.remove();\n    };\n  }, []);\n  useEffect(() => {\n    applyReactStyle(marker.getElement(), props.style);\n  }, [props.style]);\n\n  if (marker.getLngLat().lng !== props.longitude || marker.getLngLat().lat !== props.latitude) {\n    marker.setLngLat([props.longitude, props.latitude]);\n  }\n\n  if (props.offset && !arePointsEqual(marker.getOffset(), props.offset)) {\n    marker.setOffset(props.offset);\n  }\n\n  if (marker.isDraggable() !== props.draggable) {\n    marker.setDraggable(props.draggable);\n  }\n\n  if (marker.getRotation() !== props.rotation) {\n    marker.setRotation(props.rotation);\n  }\n\n  if (marker.getRotationAlignment() !== props.rotationAlignment) {\n    marker.setRotationAlignment(props.rotationAlignment);\n  }\n\n  if (marker.getPitchAlignment() !== props.pitchAlignment) {\n    marker.setPitchAlignment(props.pitchAlignment);\n  }\n\n  if (marker.getPopup() !== props.popup) {\n    marker.setPopup(props.popup);\n  }\n\n  return createPortal(props.children, marker.getElement());\n}\n\nMarker.defaultProps = defaultProps; // @ts-ignore\n\nexport default React.memo(Marker);","map":{"version":3,"sources":["../../../src/components/marker.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/* global document */\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { useEffect, useMemo, useRef, useContext } from 'react';\nimport { applyReactStyle } from '../utils/apply-react-style';\nimport { MapContext } from './map';\nimport { arePointsEqual } from '../utils/deep-equal';\nconst defaultProps = {\n    draggable: false,\n    popup: null,\n    rotation: 0,\n    rotationAlignment: 'auto',\n    pitchAlignment: 'auto'\n};\n/* eslint-disable complexity,max-statements */\nfunction Marker(props) {\n    const { map, mapLib } = useContext(MapContext);\n    const thisRef = useRef({ props });\n    thisRef.current.props = props;\n    const marker = useMemo(() => {\n        let hasChildren = false;\n        React.Children.forEach(props.children, el => {\n            if (el) {\n                hasChildren = true;\n            }\n        });\n        const options = {\n            ...props,\n            element: hasChildren ? document.createElement('div') : null\n        };\n        const mk = new mapLib.Marker(options).setLngLat([props.longitude, props.latitude]);\n        mk.getElement().addEventListener('click', (e) => {\n            var _a, _b;\n            (_b = (_a = thisRef.current.props).onClick) === null || _b === void 0 ? void 0 : _b.call(_a, {\n                type: 'click',\n                target: mk,\n                originalEvent: e\n            });\n        });\n        mk.on('dragstart', e => {\n            var _a, _b;\n            const evt = e;\n            evt.lngLat = marker.getLngLat();\n            (_b = (_a = thisRef.current.props).onDragStart) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n        });\n        mk.on('drag', e => {\n            var _a, _b;\n            const evt = e;\n            evt.lngLat = marker.getLngLat();\n            (_b = (_a = thisRef.current.props).onDrag) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n        });\n        mk.on('dragend', e => {\n            var _a, _b;\n            const evt = e;\n            evt.lngLat = marker.getLngLat();\n            (_b = (_a = thisRef.current.props).onDragEnd) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n        });\n        return mk;\n    }, []);\n    useEffect(() => {\n        marker.addTo(map.getMap());\n        return () => {\n            marker.remove();\n        };\n    }, []);\n    useEffect(() => {\n        applyReactStyle(marker.getElement(), props.style);\n    }, [props.style]);\n    if (marker.getLngLat().lng !== props.longitude || marker.getLngLat().lat !== props.latitude) {\n        marker.setLngLat([props.longitude, props.latitude]);\n    }\n    if (props.offset && !arePointsEqual(marker.getOffset(), props.offset)) {\n        marker.setOffset(props.offset);\n    }\n    if (marker.isDraggable() !== props.draggable) {\n        marker.setDraggable(props.draggable);\n    }\n    if (marker.getRotation() !== props.rotation) {\n        marker.setRotation(props.rotation);\n    }\n    if (marker.getRotationAlignment() !== props.rotationAlignment) {\n        marker.setRotationAlignment(props.rotationAlignment);\n    }\n    if (marker.getPitchAlignment() !== props.pitchAlignment) {\n        marker.setPitchAlignment(props.pitchAlignment);\n    }\n    if (marker.getPopup() !== props.popup) {\n        marker.setPopup(props.popup);\n    }\n    return createPortal(props.children, marker.getElement());\n}\nMarker.defaultProps = defaultProps;\n// @ts-ignore\nexport default React.memo(Marker);\n//# sourceMappingURL=marker.js.map"]},"metadata":{},"sourceType":"module"}